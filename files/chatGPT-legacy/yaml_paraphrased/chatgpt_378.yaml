- hosts: webserver
  name: Install Apache web server
  tasks:
  - apt: name=apache state=installed
    name: Install Apache
  - name: Start Apache
    systemd: name=apache state=started
  - copy: src=index.html dest=/var/www/html/
    name: Copy index.html
  - name: Restart Apache
    service: name=apache state=restarted
- hosts: dbserver
  name: Install MySQL database server
  tasks:
  - apt: name=mysql-server state=installed
    name: Install MySQL
  - name: Start MySQL
    systemd: name=mysql-server state=started
  - mysql_db: name=mydatabase
    name: Create database
  - mysql_user:
      name: myuser
      password: mypassword
      priv: '*.*:ALL'
    name: Create user
- hosts: nginx
  name: Install Nginx web server
  tasks:
  - apt: name=nginx state=installed
    name: Install Nginx
  - name: Start Nginx
    systemd: name=nginx state=started
  - copy: src=index.html dest=/usr/share/nginx/html/
    name: Copy index.html
  - name: Restart Nginx
    service: name=nginx state=restarted
- hosts: all
  name: Configure firewall
  tasks:
  - name: Open port 80
    ufw: rule=allow port=80/tcp
  - name: Enable firewall
    ufw: state=enabled
- hosts: appserver
  name: Deploy application
  tasks:
  - git: repo=https://github.com/example/app.git dest=/opt/app
    name: Git clone repository
  - args:
      chdir: /opt/app
    command: npm install
    name: Install dependencies
  - args:
      chdir: /opt/app
    command: nodemon server.js
    name: Start application
