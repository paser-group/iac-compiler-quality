- become: true
  hosts: all
  name: Ansible Galaxy Installation
  tasks:
  - command: pip install ansible-galaxy
    ignore_errors: true
    name: Install Ansible Galaxy
    register: install_ansible_galaxy
  - command: openssl version
    name: Check for OpenSSL3.X issue
    register: openssl_version
  - command: yum install openssl3.x
    name: Install OpenSSL3.X
    when: '''3.'' in openssl_version.stdout'
  - command: pip install ansible-galaxy
    name: Retry Ansible Galaxy Installation
    register: install_ansible_galaxy_retry
    when: install_ansible_galaxy.rc != 0
  - fail:
      msg: Ansible Galaxy Installation Failed
    name: Fail playbook on Ansible Galaxy Installation
    when: install_ansible_galaxy_retry.rc != 0
