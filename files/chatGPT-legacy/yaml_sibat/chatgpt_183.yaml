- hosts: all
  name: Execute PowerShell script in elevated shell mode
  tasks:
  - name: Run PowerShell script
    win_shell: 'Set-ExecutionPolicy Unrestricted

      [System.Reflection.Assembly]::LoadWithPartialName("Microsoft.VisualBasic")

      $username = [Microsoft.VisualBasic.Interaction]::InputBox("Enter username")

      $password = [Microsoft.VisualBasic.Interaction]::InputBox("Enter password",
      "Password", "", 0, 0)

      $sec_password = ConvertTo-SecureString $password -AsPlainText -Force

      $credential = New-Object System.Management.Automation.PSCredential ($username,
      $sec_password)

      Start-Process powershell.exe -Credential $credential -ArgumentList "-ExecutionPolicy",
      "Bypass", "-File", "C:\Test\TestScript.ps1"

      '
