- hosts: localhost
  name: Vault test playbook
  tasks:
  - args:
      executable: /bin/bash
    command: cat secrets.yml | ansible-vault decrypt
    ignore_errors: true
    name: Attempt to decrypt vault-protected file
    register: result
  - debug: msg="{{ result.stdout }}"
    when: result.rc != 0
  - fail:
      msg: 'A vault password must be specified to decrypt data: {{ result.stdout }} '
    when: result.rc != 0
