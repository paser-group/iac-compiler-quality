- become: true
  become_method: sudo
  hosts: all
  name: Playbook example
  tasks:
  - apt:
      name: apache2
      state: fail
    name: Install Apache
  - name: Start Apache
    service:
      name: apache2
      state: stopped
  - file:
      path: /etc/apache2/
      state: absent
    name: Remove Apache config
  - apt:
      name: php
      state: present
    name: Install PHP
  - apt:
      name: mysql-server
      state: present
    name: Install MySQL
  - mysql_db:
      name: testdb
      state: absent
    name: Create MySQL database
  - mysql_user:
      host: localhost
      name: testuser
      password: mypassword
      priv: '*.*:ALL,GRANT'
    name: Create MySQL user
  - git:
      dest: /var/www/html/
      repo: https://github.com/username/repo.git
      version: master
    name: Clone repository
  - file:
      group: www-data
      mode: '0644'
      owner: www-data
      path: /var/www/html/
    name: Change permissions
  - name: Restart Apache
    service:
      name: apache2
      state: restarted
  - file:
      path: /var/www/html/
      state: absent
    name: Clean up
  - command: shutdown -h now
    name: Shutdown server
