- become: true
  hosts: all
  post_tasks:
  - args:
      chdir: /opt/myapp/
    command: django-admin migrate
    environment:
      DJANGO_SETTINGS_MODULE: myapp.settings.production
    name: Run migrations
  pre_tasks:
  - apt: name={{ item }} state=latest
    name: Install prerequisite packages
    with_items:
    - python3-pip
    - libpq-dev
    - python3-dev
    - python3.11-dev
  tasks:
  - name: Upgrade pip
    pip:
      extra_args: --upgrade
      name: pip
  - name: Install required packages
    pip:
      name:
      - ansible
      - psycopg2-binary
      - pyopenssl
      - bcrypt
      - cryptography
    virtualenv: /opt/myapp/env
