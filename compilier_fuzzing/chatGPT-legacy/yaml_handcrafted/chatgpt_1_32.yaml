- gather_facts: false
  hosts: localhost
  tasks:
  - debug:
      msg: removed_at_date is {{ removed_at_date }} and removed_in_version is {{ removed_in_version
        }}
    name: Check removed_at_date and removed_in_version
  - args:
      warn: true
    command: echo "This command will not run after {{ removed_at_date }}."
    name: Test removed_at_date
    when: removed_at_date <= ansible_date_time.iso8601
  - args:
      warn: true
    command: echo "This command will not run in Ansible {{ removed_in_version }}."
    name: Test removed_in_version
    when: ansible_version.full | version_compare(removed_in_version, '<')
  vars:
    removed_at_date: '2022-01-01'
    removed_in_version: '2.0'
