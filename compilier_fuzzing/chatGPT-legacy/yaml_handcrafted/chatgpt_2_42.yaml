- gather_facts: false
  hosts: all
  name: Testing connection to multiple groups of hosts through their respective bastion
    hosts
  tasks:
  - delegate_facts: true
    delegate_to: '{{bastion1}}'
    group_by: bastion1
    name: Test connection to group1
    ping: null
    run_once: true
    serial: 1
    when: inventory_hostname in groups['group1']
  - delegate_facts: true
    delegate_to: '{{bastion2}}'
    group_by: bastion2
    name: Test connection to group2
    ping: null
    run_once: true
    serial: 1
    when: inventory_hostname in groups['group2']
  vars:
    bastion1: <bastion1_ip>
    bastion2: <bastion2_ip>
