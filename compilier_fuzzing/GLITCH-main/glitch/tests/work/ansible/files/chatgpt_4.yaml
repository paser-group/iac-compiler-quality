- become: true
  hosts: all
  name: Install yum package on RHEL5
  tasks:
  - name: Install yum-utils
    yum:
      name: yum-utils
      state: present
  - name: Check RHN status
    register: rhn_status
    shell: rhn_check
  - name: Install yum package
    when: rhn_status.rc == 0
    with_items:
    - package1
    - package2
    yum:
      name: '{{ item }}'
      state: present
  - name: Install yum package from local repo
    when: rhn_status.rc != 0
    with_items:
    - package1
    - package2
    yum:
      disablerepo: '*'
      enablerepo: local
      name: '{{ item }}'
      state: present
