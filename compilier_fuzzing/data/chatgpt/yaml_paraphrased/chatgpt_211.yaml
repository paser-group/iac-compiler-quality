- gather_facts: false
  hosts: all
  name: Buggy playbook with readips
  tasks:
  - name: Fetch IPs of target hosts
    readips:
      filename: /path/to/hostfile
    register: target_ips
  - delegate_facts: true
    delegate_to: '{{ bastion1_ip }}'
    name: Ping target hosts via Bastion 1
    ping: null
    when: inventory_hostname in groups['group1']
    with_items: '{{ target_ips }}'
  - delegate_facts: true
    delegate_to: '{{ bastion2_ip }}'
    name: Ping target hosts via Bastion 2
    ping: null
    when: inventory_hostname in groups['group2']
    with_items: '{{ target_ips }}'
  vars:
    bastion1_ip: 192.168.1.1
    bastion2_ip: 192.168.2.1
