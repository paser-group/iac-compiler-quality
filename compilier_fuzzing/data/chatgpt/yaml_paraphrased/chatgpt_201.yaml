- become: true
  hosts: all
  name: Install required packages
  tasks:
  - name: Install dependencies
    yum:
      name:
      - rpm-build
      - rpm-devel
      - redhat-rpm-config
      - createrepo
      state: present
  - file:
      path: /root/rpmbuild
      state: directory
    name: Create RPM build directory
  - copy:
      dest: /root/rpmbuild/SPECS/myapp.spec
      src: '{{ playbook_dir }}/files/myapp.spec'
    name: Copy SPEC file
  - get_url:
      dest: /root/rpmbuild/SOURCES/myapp-1.0.0.tar.gz
      url: https://github.com/myapp/myapp/archive/1.0.0.tar.gz
    name: Download source code
  - args:
      chdir: /root/rpmbuild/SPECS
    name: Build RPM package
    shell: rpmbuild -bb /root/rpmbuild/SPECS/myapp.spec
  - copy:
      dest: '{{ playbook_dir }}/artifacts/myapp-1.0.0-1.el7.x86_64.rpm'
      src: /root/rpmbuild/RPMS/x86_64/myapp-1.0.0-1.el7.x86_64.rpm
    name: Move RPM package to build artifacts directory
