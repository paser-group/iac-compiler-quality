- become: true
  handlers:
  - name: Restart Apache
    service:
      name: apache2
      state: restarted
  hosts: all
  name: Create a new user
  tasks:
  - name: Add user to system
    user:
      createhome: true
      name: testuser
      password: '{{ ''password'' | password_hash(''sha512'') }}'
      shell: /bin/bash
  - name: Set user's .bashrc file
    template:
      dest: /home/testuser/.bashrc
      group: testuser
      owner: testuser
      src: bashrc.j2
  - apt:
      cache_valid_time: 3600
      update_cache: true
    name: Update system packages
  - apt:
      name:
      - apache2
      - postgresql
      state: latest
    name: Install necessary packages
  - name: Install Python packages
    pip:
      name:
      - requests
      - flask
      state: present
  - name: Configure Postgresql database
    postgresql_db:
      name: testdb
      state: present
    postgresql_user:
      login_host: localhost
      login_password: '{{ ''password'' }}'
      login_port: 5432
      login_user: postgres
      name: testuser
      password: '{{ ''secret'' }}'
      priv: ALL
  - name: Start Apache web server
    notify:
    - Restart Apache
    service:
      name: apache2
      state: started
