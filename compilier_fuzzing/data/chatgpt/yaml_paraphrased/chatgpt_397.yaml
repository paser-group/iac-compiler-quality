- become: true
  hosts: webservers
  name: Install Apache
  tasks:
  - name: Install Apache HTTP Server
    notify: Start Apache
    yum:
      name: httpd
      state: installed
  - name: Start Apache
    service:
      name: httpd
      state: started
- become: true
  hosts: all
  name: Create directory
  tasks:
  - file:
      mode: '0755'
      path: /data
      state: directory
    name: Create data directory
- become: true
  hosts: webservers
  name: Configure web server
  tasks:
  - copy:
      dest: /var/www/html/index.html
      src: templates/index.html
    name: Copy index.html file
- become: true
  hosts: webservers
  name: Deploy web application
  tasks:
  - copy:
      dest: /var/www/html/
      src: app_files/
    name: Copy application files
    notify: Restart Apache
  - name: Restart Apache
    service:
      enabled: true
      name: httpd
      state: restarted
- become: true
  hosts: all
  name: Upgrade packages
  tasks:
  - name: Upgrade all packages to latest version
    yum:
      name: '*'
      state: latest
- become: true
  hosts: webservers
  name: Remove Apache
  tasks:
  - name: Remove Apache httpd
    notify: Stop Apache
    yum:
      name: httpd
      state: absent
  - name: Stop Apache
    service:
      enabled: false
      name: httpd
      state: stopped
- become: true
  hosts: all
  name: Remove data directory
  tasks:
  - file:
      path: /data
      state: absent
    name: Remove data directory
