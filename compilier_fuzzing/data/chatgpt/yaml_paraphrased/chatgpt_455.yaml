- hosts: all
  name: Copy files to remote hosts
  tasks:
  - copy:
      dest: /path/to/remote/file
      src: /path/to/local/file
    name: Copy file
    register: copy_output
  - debug:
      var: copy_output.stat.mode
    name: Print file permissions
  - file:
      mode: 511
      path: /path/to/remote/file
    name: Change file permissions
  - apt:
      name: missing-package
      state: present
      update_cache: true
    name: Install missing package
  - name: Restart service
    service:
      name: apache2
      state: restarted
  - file:
      path: /path/to/remote/file
      state: absent
    name: Remove temporary file
  - fail:
      msg: The playbook has failed.
    name: Fail the playbook
