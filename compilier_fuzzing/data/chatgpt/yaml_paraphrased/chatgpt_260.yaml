- apt:
    name: nginx
    state: present
  name: Install nginx
- apt:
    name:
    - php7.0-cli
    - php7.0-fpm
    - php7.0-mysql
    - php7.0-curl
    - php7.0-gd
    - php7.0-mcrypt
    state: present
  name: Install PHP7.0 and PHP modules
- apt:
    name: mysql-server
    state: present
  name: Install MySQL Server
- apt:
    update_cache: true
  name: Update apt cache
- name: Configure nginx
  notify: restart nginx
  template:
    dest: /etc/nginx/nginx.conf
    src: nginx.conf.j2
- name: Configure PHP-FPM
  notify: restart php7.0-fpm
  template:
    dest: /etc/php/7.0/fpm/php-fpm.conf
    src: php-fpm.conf.j2
- become: true
  mysql_db:
    encoding: utf8
    name: testdb
  name: Configure MySQL
- name: Restart nginx
  service:
    name: nginx
    state: restarted
- name: Restart PHP7.0-FPM
  service:
    name: php7.0-fpm
    state: restarted
- name: Restart MySQL
  service:
    name: mysql
    state: restarted
- apt:
    name: nginx
    state: absent
  name: Remove nginx
- apt:
    name:
    - php7.0-cli
    - php7.0-fpm
    - php7.0-mysql
    - php7.0-curl
    - php7.0-gd
    - php7.0-mcrypt
    state: absent
  name: Remove PHP7.0 and PHP modules
- apt:
    name: mysql-server
    state: absent
  name: Remove MySQL Server
- apt:
    update_cache: true
  name: Update apt cache
- name: Configure nginx
  notify: restart nginx
  template:
    dest: /etc/nginx/nginx.conf
    src: nginx.conf.j2
- name: Configure PHP-FPM
  notify: restart php7.0-fpm
  template:
    dest: /etc/php/7.0/fpm/php-fpm.conf
    src: php-fpm.conf.j2
- become: true
  mysql_db:
    encoding: utf8
    name: testdb
  name: Configure MySQL
- name: Restart nginx
  service:
    name: nginx
    state: restarted
- name: Restart PHP7.0-FPM
  service:
    name: php7.0-fpm
    state: restarted
- name: Restart MySQL
  service:
    name: mysql
    state: restarted
