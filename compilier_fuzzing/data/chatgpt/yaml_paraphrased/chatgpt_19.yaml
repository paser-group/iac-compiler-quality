- hosts: localhost
  tasks:
  - debug:
      var: db.user
    name: Check if the DB user is defined
    when: db.user is defined and db.password.cipher is defined and db.password.cipher
      == "vault"
  - debug:
      msg: Accessing the {{db.name}} database as user {{db.user}} with password {{db.password}}
    name: Try to access the database
    when: db.user is defined and db.password.cipher is defined and db.password.cipher
      == "vault"
  vars:
    db:
      name: mydb
      password: '{{ my_password }}'
      user: '{{ my_user }}'
