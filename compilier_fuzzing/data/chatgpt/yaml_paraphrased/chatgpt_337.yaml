- apt: name=apache2 state=installed
  name: Install Apache
- name: Start Apache service
  service: name=apache2 state=started enabled=yes
- copy: src=app/ dest=/var/www/html/
  name: Deploy application
- name: Restart Apache service
  service: name=apache2 state=restarted
- file: path=/home/user/sensitive.txt state=absent
  name: Delete sensitive file
- name: Set up firewall
  ufw: rule=allow port=80/tcp
- apt: name=mysql-server state=installed
  name: Install database
- mysql_db:
    name: mydatabase
    state: present
  mysql_user:
    name: dbuser
    password: dbpass
    priv: mydatabase.*:ALL
  name: Configure database
- authorized_key:
    key: '{{ lookup(''file'', ''/home/ubuntu/.ssh/id_rsa.pub'') }}'
    state: present
    user: ubuntu
  name: Configure SSH access
- apt: name=python state=installed
  name: Install Python
- apt: name=python-pip state=installed
  name: Install pip
- name: Install required Python packages
  pip: name=requests state=latest
- file: path=/backup state=directory
  name: Create backup folder
- name: Backup database
  shell: mysqldump -u dbuser -p dbpass mydatabase > /backup/backup.sql
- apt: name=nginx state=installed
  name: Install Nginx
- copy: src=nginx.conf dest=/etc/nginx/nginx.conf
  name: Configure Nginx
- name: Start Nginx
  service: name=nginx state=started enabled=yes
