- apt: name=nginx state=installed
  name: Install and start Nginx
  service: name=nginx state=running
- copy: src=./nginx.conf dest=/etc/nginx/nginx.conf owner=root group=root mode=0644
  name: Copy configuration file
- name: Restart Nginx
  service: name=nginx state=restarted
- file: path=/etc/myapp owner=user group=user mode=0755 state=directory
  name: Create a directory
- apt: name=nodejs state=installed
  name: Install Node.js
- apt: name=npm state=installed
  name: Install NPM
- name: Install pm2 module
  npm: name=pm2 global=yes
- git: repo=https://github.com/myapp.git dest=/var/www/myapp
  name: Clone repository
- name: Install dependencies
  npm: chdir=/var/www/myapp name=dependencies state=present
- command: pm2 start /var/www/myapp/app.js
  name: Start the application
- file: path=/var/www/myapp state=absent
  name: Cleanup
- name: Restart server
  shell: reboot now
