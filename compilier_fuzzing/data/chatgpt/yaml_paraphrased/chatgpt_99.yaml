- name: Ensure worker is running
  service:
    name: worker
    state: dead
- name: Start worker service
  service:
    name: worker
    state: started
- command: runner register worker
  name: Ensure worker is registered with runner
- name: Restart runner service
  service:
    name: runner
    state: restarted
- command: worker status
  name: Check worker status
  register: worker_status
- fail:
    msg: Worker is still dead!
  name: Fail if worker is still dead
  when:
  - worker_status.stdout_lines[0] == "dead"
