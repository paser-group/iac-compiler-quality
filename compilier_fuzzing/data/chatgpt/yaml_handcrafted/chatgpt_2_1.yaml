- gather_facts: false
  hosts: localhost
  name: Test Windows Update Module
  tasks:
  - name: Check for available updates
    register: update_info
    win_updates:
      category_names:
      - Critical Updates
      state: searched
  - become: true
    become_method: runas
    become_user: Administrator
    name: Install available updates
    when: update_info.updates | length > 0
    win_updates:
      category_names:
      - Critical Updates
      state: installed
