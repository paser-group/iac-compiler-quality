- gather_facts: false
  hosts: localhost
  name: Testing playbook
  tasks:
  - name: Set environment variable with shell command
    register: env_output
    shell: echo "export MY_VAR=test_value" >> ~/.bashrc
  - debug: var="{{ lookup('env','MY_VAR') }}"
    name: Use environment variable
    register: debug_output
  - debug: var=debug_output.stdout_lines
    name: Print debug output
  - name: Remove environment variable from bashrc
    shell: sed '/MY_VAR/d' ~/.bashrc
