- become: true
  hosts: all
  name: Create RPM build procedure
  tasks:
  - name: Install required packages
    yum:
      name:
      - rpm-build
      - redhat-rpm-config
      state: present
  - copy:
      dest: /root/rpmbuild/SPECS/
      src: /path/to/spec/file
    name: Copy spec file
  - copy:
      dest: /root/rpmbuild/SOURCES/
      src: /path/to/source/files
    name: Copy source files
  - name: Build RPM
    shell: rpmbuild -ba /root/rpmbuild/SPECS/my-package.spec
  - copy:
      dest: /var/www/html/ansible-files/
      src: /root/rpmbuild/RPMS/x86_64/my-package.rpm
    name: Copy RPM to server
  - name: Install RPM
    yum:
      name: /var/www/html/ansible-files/my-package.rpm
      state: present
