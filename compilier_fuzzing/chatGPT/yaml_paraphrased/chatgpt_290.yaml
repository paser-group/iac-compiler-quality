- become: true
  hosts: web_servers
  name: Install Apache Web Server
  tasks:
  - apt:
      update_cache: true
    name: Update apt cache
  - apt:
      name: apache2
      state: latest
    name: Install Apache2
  - name: Start Apache2
    service:
      enabled: true
      name: apache2
      state: started
- become: true
  hosts: db_servers
  name: Create Users
  tasks:
  - name: Create Users
    user:
      name: '{{ item.name }}'
      password: '{{ item.password }}'
      state: present
    with_items: '{{ users }}'
  vars:
    users:
    - name: user1
      password: userpass123
    - name: user2
      password: userpass456
- become: true
  handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted
  hosts: nginx_servers
  name: Install and configure Nginx
  tasks:
  - apt:
      name: nginx
      state: latest
    name: Install Nginx
  - copy:
      dest: /etc/nginx/nginx.conf.bak
      src: /etc/nginx/nginx.conf
    name: Configure Nginx
    notify: restart nginx
