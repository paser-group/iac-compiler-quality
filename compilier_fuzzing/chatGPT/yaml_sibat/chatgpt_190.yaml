- gather_facts: false
  handlers:
  - mail:
      body: The test test_get_text_width_no_locale failed on the test machine running
        Ubuntu 22.04.
      subject: 'Error: test_get_text_width_no_locale failed on Ubuntu 22.04'
      to: admin@example.com
    name: send_email
  hosts: localhost
  name: Test playbook
  tasks:
  - apt:
      name:
      - libc-bin
      - libc6
      - libc6-dev
      state: latest
      update_cache: true
    name: Install required packages
    when: ansible_distribution == "Ubuntu" and ansible_distribution_release == "22.04"
  - command: python -c "import locale; print(locale.getlocale())"
    ignore_errors: true
    name: Test get_text_width_no_locale function
    register: output
  - assert:
      that:
      - output.stderr == 'None'
      - output.stdout == '(None, None)'
    failed_when: true
    name: Check if locale is set correctly
    notify: send_email
