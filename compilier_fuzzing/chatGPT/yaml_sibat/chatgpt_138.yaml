- become: true
  hosts: localhost
  name: Create user
  tasks:
  - name: Ensure user exists
    user:
      createhome: true
      generate_ssh_key: true
      local: true
      name: '{{ username }}'
      password: '{{ password }}'
      ssh_key_bits: 2048
      ssh_key_file: /home/{{ username }}/.ssh/id_rsa
      state: present
      update_password: on_create
  vars:
    password: secretpassword
    username: testuser
