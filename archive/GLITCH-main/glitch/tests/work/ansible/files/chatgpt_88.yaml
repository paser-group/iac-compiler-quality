- become: true
  hosts: all
  name: Fix SSM connection
  tasks:
  - file:
      mode: 493
      path: /tmp/ssm
      state: directory
    name: Create temporary directory
  - name: Set environment variable
    register: set_env_var
    shell: export SSM_TMP_DIR=/tmp/ssm
  - environment:
      SSM_TMP_DIR: '{{ set_env_var.stdout }}'
    name: Test SSM connection
    register: ssm_connection_test
    shell: ssm connection
  - debug: null
    msg: 'SSM connection test result: {{ ssm_connection_test.stdout }}'
