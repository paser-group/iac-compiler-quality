- hosts: windows
  name: Update Windows
  tasks:
  - name: Install Windows update
    register: result
    win_updates:
      category_names:
      - SecurityUpdates
      delay_before_reboot: 300
      reboot: true
      reboot_timeout: 1200
      state: installed
  - name: Reboot if required
    when: result.reboot_required == True
    win_reboot: null
  - delay: 300
    name: Check if the update was successful
    register: check
    retries: 5
    until: check.updatable_item_count == 0
    win_updates:
      category_names:
      - SecurityUpdates
      state: searched
