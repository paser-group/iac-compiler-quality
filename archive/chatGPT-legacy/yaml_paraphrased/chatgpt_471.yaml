- apt:
    name: nginx
    state: installed
  name: Installing nginx
- name: Configuring nginx
  notify: restart nginx
  template:
    dest: /etc/nginx/nginx.conf
    src: /templates/nginx.conf.j2
- apt:
    name: php-fpm
    state: installed
  name: Installing php-fpm
- name: Configuring php
  notify: restart php-fpm
  template:
    dest: /etc/php/7.2/fpm/php.ini
    src: /templates/php.ini.j2
- name: Starting services
  service:
    enabled: true
    name: '{{ item }}'
    state: started
  with_items:
  - nginx
  - php-fpm
- git:
    dest: /var/www/html/
    repo: https://github.com/user/repo.git
  name: Cloning git repository
  register: git_clone
- command:
    chdir: /var/www/html/
    cmd: git checkout {{ branch }}
  name: Deploying code
  when: git_clone.changed
- name: Restarting nginx
  service:
    name: nginx
    state: restarted
- name: Restarting php-fpm
  service:
    name: php-fpm
    state: restarted
- apt:
    name: '{{ item }}'
    state: present
  name: Installing missing packages
  with_items:
  - package1
  - package2
  - package3
- command: /path/to/custom/script.sh
  name: Running custom script
- file: path=/tmp/testfile state=absent
  name: Removing temporary files
- name: Creating user account
  user:
    append: true
    groups: sudo
    name: john
    password: '12345'
