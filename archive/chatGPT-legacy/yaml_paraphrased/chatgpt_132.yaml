- hosts: all
  name: Playbook with a bug
  tasks:
  - debug:
      msg: '{{ inventory_hostname }} is running the playbook {{ playbook_file }}'
    name: Show file name
  - copy:
      dest: /tmp/{{ inventory_hostname }}-test.txt
      src: '{{ playbook_dir }}/test.txt'
    name: Copy file
    when: inventory_hostname == 'localhost'
  - command: echo "this is a secret" > /tmp/secret.txt
    name: Test vault
    no_log: true
    register: command_out
  - ansible.builtin.command: ansible-vault encrypt /tmp/secret.txt --vault-password-file=/etc/vault_pass.txt
    name: Encrypt secret
  - ansible.builtin.command: cat /tmp/secret.txt
    name: Display the secret
    no_log: true
    register: secret
  - debug:
      msg: '{{ secret.stdout }}'
    name: Show secret
  - file:
      path: /tmp/secret.txt
      state: absent
    name: Remove secret
    no_log: true
  vars_files:
  - vault_password_file.txt
