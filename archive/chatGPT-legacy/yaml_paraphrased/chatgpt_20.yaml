- become: true
  handlers:
  - name: restart apache
    service:
      name: apache2
      state: restarted
  hosts: all
  name: Install and start Apache
  tasks:
  - apt:
      name: apache2
      state: present
    name: Install Apache
  - lineinfile:
      line: Listen 8080
      path: /etc/apache2/ports.conf
      regexp: Listen 80
    name: Change Apache port
    notify: restart apache
  - name: Start Apache
    service:
      name: apache2
      state: started
