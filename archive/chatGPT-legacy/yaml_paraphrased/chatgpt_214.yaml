- gather_facts: false
  hosts: group1,group2
  name: Buggy playbook
  serial: 1
  tasks:
  - name: Task 1
    shell: whoami
  - ansible.builtin.shell: echo {{ ansible_host }}
    delegate_to: '{{ groups[group1] }}'
    name: Task 2
    vars:
      ansible_host: '{{ groups[group1] | random }}'
  - ansible.builtin.shell: echo {{ ansible_host }}
    become: true
    become_user: root
    delegate_to: '{{ groups[group2] }}'
    name: Task 3
    vars:
      ansible_host: '{{ groups[group2] | random }}'
  - ansible.builtin.shell: whoami
    delegate_to: '{{ read_internet }}'
    name: Task 4
  vars:
    ansible_ssh_private_key_file: /path/to/key
    ansible_user: username
