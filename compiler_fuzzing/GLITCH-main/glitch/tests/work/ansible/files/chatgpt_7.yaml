- become: true
  hosts: all
  tasks:
  - name: install yum-utils
    when: ansible_distribution == 'RedHat' and ansible_distribution_major_version
      == '5'
    yum:
      enablerepo: rhel-5-server-rpms
      name: yum-utils
      state: present
  - name: add RHN repo
    when: ansible_distribution == 'RedHat' and ansible_distribution_major_version
      == '5'
    yum_repository:
      baseurl: https://someurl.example.com/rhel-5-server-rhn
      description: Red Hat Network
      enabled: true
      gpgcheck: false
      name: rhel-5-server-rhn
  - name: install packages
    when: ansible_distribution == 'RedHat' and ansible_distribution_major_version
      == '5'
    with_items:
    - package1
    - package2
    - package3
    yum:
      enablerepo: rhel-5-server-rhn
      name: '{{ item }}'
      state: present
