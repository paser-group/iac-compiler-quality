- become: true
  hosts: all
  tasks:
  - file:
      mode: 448
      path: /home/ansible/.ssh
      state: directory
    name: Create a directory to store the private key file
  - copy:
      dest: /home/ansible/.ssh
      mode: 256
      src: /path/to/private_key_file
    name: Copy private key file to the server
  - lineinfile:
      dest: /etc/ansible/hosts
      line: ansible_ssh_private_key_file=/home/ansible/.ssh/private_key_file
      regexp: ^ansible_ssh_private_key_file
    name: Configure ansible_ssh_private_key_file
  - command: ssh -i /home/ansible/.ssh/private_key_file user@hostname
    name: Test the connection
    register: output
  - debug: null
    msg: '{{ output.stdout }}'
