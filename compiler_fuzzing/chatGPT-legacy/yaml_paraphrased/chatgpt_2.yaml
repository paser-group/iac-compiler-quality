- hosts: windows_servers
  name: Update Windows Server
  tasks:
  - name: Copy updates to target server
    win_copy:
      dest: C:\Temp\updates
      src: '{{ source }}'
  - name: Install updates
    register: result
    win_updates:
      category_names:
      - CriticalUpdates
      - SecurityUpdates
      - UpdateRollups
      log_path: '{{ log_path }}'
  - name: Reboot if required
    when: result.reboot_required == true
    win_reboot: null
  - name: Wait for server to come back online
    wait_for_connection:
      connect_timeout: 10
      delay: 5
      sleep: 5
  - name: Verify updates were installed successfully
    win_updates:
      log_path: '{{ log_path }}'
      state: installed
  vars:
    log_path: C:\Temp\updates.log
    source: C:\updates
