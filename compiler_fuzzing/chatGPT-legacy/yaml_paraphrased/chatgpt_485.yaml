- environment:
    PYTHONPATH: '{{ ansible_env.PYTHONPATH }}:/path/to/cryptography/library'
  hosts: localhost
  name: Playbook to create an encrypted file using ansible-vault
  tasks:
  - ansible.builtin.copy:
      content: This is a secret message
      dest: /tmp/encrypted_file.txt
      mode: '0600'
    become: false
    changed_when: config_file is changed
    encrypt: 'yes'
    name: Create an encrypted file
    vars:
      ansible_python_interpreter: /usr/bin/python3
    vars_files:
    - vault_password_file.yml
    when: ansible_python_version.major == 3 and ansible_python_version.minor >= 6
  vars:
    ansible_become_password: '{{ vault_password }}'
  vars_files:
  - vault_password_file.yml
- environment:
    PYTHONPATH: '{{ ansible_env.PYTHONPATH }}:/path/to/cryptography/library'
  hosts: localhost
  name: Playbook to modify an existing encrypted file
  tasks:
  - ansible.builtin.copy:
      content: This is a modified secret message
      dest: /tmp/encrypted_file.txt
      mode: '0600'
    become: false
    changed_when: config_file is changed
    encrypt: 'yes'
    name: Modify an encrypted file
    vars:
      ansible_python_interpreter: /usr/bin/python3
    vars_files:
    - vault_password_file.yml
    when: ansible_python_version.major == 3 and ansible_python_version.minor >= 6
  vars:
    ansible_become_password: '{{ vault_password }}'
  vars_files:
  - vault_password_file.yml
