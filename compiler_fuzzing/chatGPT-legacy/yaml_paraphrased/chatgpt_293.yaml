- hosts: all
  name: Install and start Apache
  tasks:
  - apt: pkg=apache2 state=installed update_cache=true
    name: Installing Apache2
  - name: Starting Apache2
    service: name=apache2 state=restarted
- handlers:
  - name: Restart apache
    service: name=apache2 state=restarted
  hosts: all
  name: Configure web server
  tasks:
  - copy:
      content: <html><body><h1>Welcome to my website</h1></body></html>
      dest: /var/www/html/index.html
    name: Create index.html file
    notify: Restart apache
- hosts: all
  name: Create a new user
  tasks:
  - name: Add user
    user:
      name: '{{username}}'
      password: '{{password}}'
      state: present
  vars:
    password: password123
    username: james
- hosts: all
  name: Install MySQL
  tasks:
  - apt_key: keyserver=pgp.mit.edu id=5072E1F5
    name: Add MySQL apt key
  - apt_repository:
      repo: deb http://repo.mysql.com/apt/debian/ stretch mysql-5.7
      state: present
    name: Add MySQL repository
  - apt: name=mysql-server state=latest
    name: Install MySQL Server
  - name: Start MySQL Server
    service: name=mysql state=started
- hosts: all
  name: Create MySQL Database
  tasks:
  - become: true
    mysql_db:
      name: '{{database_name}}'
    name: Create database
  - become: true
    mysql_user:
      host: localhost
      name: '{{user_name}}'
      password: '{{user_password}}'
      priv: '{{database_name}}.*:ALL'
    name: Create user
  vars:
    database_name: testdb
    user_name: testuser
    user_password: testpass
