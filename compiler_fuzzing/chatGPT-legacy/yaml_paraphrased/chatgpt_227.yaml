- gather_facts: false
  hosts: all
  tasks:
  - delegate_to: localhost
    name: Install packages
    package:
      name: '{{ item }}'
      state: present
    register: result
    with_items:
    - gcc
    - python-dev
  - debug:
      var: result
    name: Display results
  - delegate_to: localhost
    name: Print hello world
    register: shell_result
    shell: 'echo "Hello world"

      '
  - debug:
      var: shell_result
    name: Display Shell results
  - become: true
    delegate_to: localhost
    name: Create a user
    user:
      name: testuser
      state: present
  - copy:
      dest: /path/to/dest
      src: /path/to/src
    delegate_to: localhost
    name: Copy a file
  - become: true
    name: Restart the service
    service:
      name: nginx
      state: restarted
  vars:
    ansible_connection: local
