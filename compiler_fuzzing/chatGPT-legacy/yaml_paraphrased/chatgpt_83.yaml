- become: true
  gather_facts: false
  hosts: localhost
  name: Play to install custom collection
  tasks:
  - ansible.builtin.shell:
      cmd: 'ansible-galaxy collection install notexist.custom_coll:1.0

        '
    failed_when: '''Failed to download collection'' not in collection_install_result.stderr'
    name: Install custom collection
    register: collection_install_result
  - delay: 5
    name: Use custom module from collection
    notexist.custom_coll.my_module:
      param1: value1
    register: module_result
    retries: 5
    until: module_result is succeeded
  - debug:
      var: module_result.stdout_lines
    name: Print module result
