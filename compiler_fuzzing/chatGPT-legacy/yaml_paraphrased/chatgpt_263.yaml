- become: true
  hosts: all
  name: Install nginx on Ubuntu
  tasks:
  - apt: name=nginx state=installed update_cache=yes
    name: Install nginx
  - name: Start nginx
    service: name=nginx state=started
  - copy: src=./index.html dest=/var/www/html/index.html
    name: Upload index.html
  - name: Restart nginx
    service: name=nginx state=restarted
- become: true
  hosts: all
  name: Install MySQL on Ubuntu
  tasks:
  - apt: update_cache=yes
    name: Update apt cache
  - apt: name=mysql-server state=installed
    name: Install MySQL
  - name: Start MySQL
    service: name=mysql state=started
  - mysql_user: name=root password=Abcde12345 priv=*.*:ALL state=present
    name: Secure MySQL root user
- become: true
  hosts: all
  name: Deploy a Flask App
  tasks:
  - apt: name=python3 state=installed
    name: Install Python
  - apt: name=python3-pip state=installed
    name: Install pip
  - git: repo=https://github.com/kareem/dummy-flask-app.git dest=/var/www/FlaskApp
    name: Clone Flask App
  - name: Install Flask app dependencies
    pip: requirements=/var/www/FlaskApp/requirements.txt
  - name: Make sure Flask app is running
    service: name=FlaskApp state=started
