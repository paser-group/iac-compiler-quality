
- name: Test Ansible issue
  hosts: all
  gather_facts: no

  tasks:
    - name: Create temporary directory
      shell: mktemp -d
      register: temp_dir
    - name: Get remote temporary directory details
      stat:
        path: "{{ temp_dir.stdout }}"
      register: remote_temp_dir
    - name: Remove temporary directory
      file:
        path: "{{ temp_dir.stdout }}"
        state: absent

  handlers:
    - name: Print remote temporary directory path
      debug:
        var: remote_temp_dir.stat.path
