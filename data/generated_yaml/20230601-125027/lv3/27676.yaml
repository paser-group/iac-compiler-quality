yaml
---
- name: Remove VTP Password
  hosts: all
  gather_facts: false
  vars:
    ansible_network_os: nxos

  tasks:
  - name: "Remove VTP password"
    nxos_vtp_password:
      password: ""
      provider:
        host: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ lookup('file', 'path_to_password_file') }}"
        authorize: yes
        auth_pass: "{{ lookup('file', 'path_to_become_password_file') }}"
      state: absent
    register: output

  - name: Fail the Play if command failed
    fail: msg="Failed to delete VTP password"
    when: output.failed == true
