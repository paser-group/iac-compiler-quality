yaml
- name: Check if user exists and create if missing
  hosts: all
  gather_facts: false
  vars:
    username: john
  tasks:
    - name: Check if user exists
      command: id {{ username }}
      register: user_check
      changed_when: false

    - name: Create user if missing
      user:
        name: "{{ username }}"
        state: present
      when: user_check.rc != 0
