
- name: Create a VMware virtual machine snapshot
  hosts: all
  tasks:
    - name: Create a snapshot
      vmware_guest_snapshot:
        hostname: "{{ inventory_hostname }}"
        username: "{{ vault_vmware_username }}"
        password: "{{ vault_vmware_password }}"
        validate_certs: False
        name: "{{ vm_name }}"
        state: present
        remove_children: False
        wait_for_ip_address: False
        revert: False
        description: "Snapshot created by Ansible"
      delegate_to: "{{ groups['vmware'][0] }}"
      become: yes
