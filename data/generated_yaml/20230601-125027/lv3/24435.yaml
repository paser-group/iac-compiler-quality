
---
- name: create VM from template with disk option
  hosts: localhost
  tasks:
    - name: create VM from template
      vmware_guest:
        hostname: "{{ vcenter_server }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: False
        datacenter: "{{ datacenter_name }}"
        folder: "{{ folder_name }}"
        name: "{{ vm_name }}"
        template: "{{ template_name }}"
        hardware:
          memory_mb: "{{ memory_gb | int * 1024 }}"
          num_cpus: "{{ num_cpus }}"
        disks:
          - size_gb: "{{ disk_size_gb }}"
            type: "{{ disk_type }}"
            datastore: "{{ datastore_name }}"
        networks:
          - name: "{{ network_name }}"
            ip: "{{ ip_address }}"
            netmask: "{{ netmask }}"
            gateway: "{{ gateway }}"
      register: vm

    - name: debug vm
      debug:
        var: vm
