
- name: Test selective callback while looping
  hosts: all
  tasks:
    - name: Loop through items
      debug:
        msg: "Printing item {{ item }}"
      with_items:
        - item1
        - item2
        - item3
        - item4
        - item5
        - item6
        - item7
      register: loop_output

    - name: Fail a single item
      debug:
        msg: "Failing item2"
      when: "'item2' in item.stdout"

    - name: Report status
      debug:
        msg: "Reported {{ item.status }} for item {{ item.item }}"
      with_items: "{{ loop_output.results }}"
