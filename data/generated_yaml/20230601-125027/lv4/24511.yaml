
- name: Take VM snapshots
  vmware_guest_snapshot:
    hostname: "{{ vmware_hostname }}"
    username: "{{ vmware_username }}"
    password: "{{ vmware_password }}"
    datacenter: "{{ vmware_datacenter }}"
    folder: "{{ vmware_folder }}"
    name: "{{ vmware_vm_name }}"
    description: "{{ vmware_snapshot_description }}"
    state: present
    remove_children: no
  vars:
    snapshot_taken: false
  register: snapshot_status
  when: snapshot_taken == false
  become: true
  become_method: sudo
