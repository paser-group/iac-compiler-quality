
- name: Add public key to authorized_keys when user doesn't exist and path is != default
  hosts: all
  
  tasks:
  - name: Create user directory
    file:
      path: /home/arbitrary_user/.ssh
      state: directory
      
  - name: Create authorized_keys file for arbitrary_user
    file:
      path: /home/arbitrary_user/.ssh/authorized_keys
      state: touch
      
  - name: Add public key to arbitrary_user's authorized_keys file
    authorized_key:
      user: arbitrary_user
      key: "{{ lookup('file', '/tmp/pubkey.pub') }}"
      path: /home/arbitrary_user/.ssh/authorized_keys
      state: present
      validate_certs: false
      manage_dir: no
