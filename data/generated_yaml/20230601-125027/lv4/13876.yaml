
- hosts: all
  gather_facts: no

  tasks:
    - name: Test remote temporary directory resolution
      shell: 'ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o PasswordAuthentication=no -q {{ inventory_hostname }} "echo $TMPDIR"'
      register: output
    - debug:
        var: output.stderr_lines
        verbosity: 2
      failed_when: "'failed to resolve remote temporary directory from' in output.stderr"
