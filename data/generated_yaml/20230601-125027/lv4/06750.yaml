yaml
- name: Clone repo with submodules
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Clone repo with submodules
      git:
        repo: "https://github.com/example/repo.git"
        dest: "/path/to/repo"
        version: "master"
        submodules: "yes"
      register: git_output

    - name: Echo failed submodules
      debug:
        var: item.msg
      loop: "{{ git_output.results | reject('success') | map(attribute='msg') | list }}"
