
- name: Test any_errors_fatal option with unreachable hosts
  hosts: all
  gather_facts: false
  tasks:
  - name: Ping hosts
    ping:
  - name: Check if host is reachable
    raw: echo "test connection" > /dev/tcp/{{ inventory_hostname }}/22
    ignore_errors: true
    when: inventory_hostname != "localhost" and inventory_hostname != "127.0.0.1"
    register: raw_result
  - name: Print raw result
    debug:
      var: raw_result
  - name: Run a command
    command: /bin/true
    when: inventory_hostname == "localhost" or inventory_hostname == "127.0.0.1"
