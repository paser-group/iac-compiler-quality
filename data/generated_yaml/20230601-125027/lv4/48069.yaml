
- name: Test 'stderr' callback plugin for unreachable errors
  hosts: all
  gather_facts: false

  tasks:
    - name: Attempt to ping unreachable host
      ping:
        data: "ping data"
      delegate_to: localhost
      ignore_errors: true
      register: result

    - name: Output error message to stderr
      fail:
        msg: "Failed to ping {{ inventory_hostname }} with error message {{ result }}"
      when: result is failed

  become: true
