
- name: Stress test for dynamic inventory usage error
  hosts: all

  vars:
    dynamic_inventory: |
      #!/bin/bash
      echo "ubuntu1 ansible_host=10.1.1.1 ansible_user=root ansible_ssh_private_key_file=/var/tmp/key_I.pem"
      echo "alpine1 ansible_host=10.1.1.2 ansible_user=root ansible_ssh_private_key_file=/var/tmp/key_I.pem"
      echo "centos1 ansible_host=10.1.1.3 ansible_user=root ansible_ssh_private_key_file=/var/tmp/key_I.pem"
      echo "redhat1 ansible_host=10.1.1.4 ansible_user=root ansible_ssh_private_key_file=/var/tmp/key_I.pem"
      
  tasks:
    - name: Execute a shell command on all hosts
      shell: echo "Hello World"
  
    - name: Create a dynamic inventory file before playbook starts
      copy:
        dest: "{{ playbook_dir }}/dynamic_hosts"
        content: "{{ dynamic_inventory }}"
      become: true

    - name: Execute another shell command on all hosts
      shell: echo "The playbook has started"
