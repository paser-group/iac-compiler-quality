
- name: Create Elasticache Cluster
  hosts: all
  gather_facts: no

  tasks:
    - name: Create redis cache cluster
      ec2_elasticache:
        name: elasticache-cluster-01
        state: present
        cache_node_type: cache.t2.micro
        engine: redis
        cache_security_group_names: ['cache-security-group']
        vpc_security_group_ids: ['sg-1234567890']
        subnet_group_name: 'redis-cache-subnet-group'
        subnets: ['subnet-1234567890']
        region: us-east-1
        aws_access_key: "{{ lookup('env', 'AWS_ACCESS_KEY_ID') }}"
        aws_secret_key: "{{ lookup('env', 'AWS_SECRET_ACCESS_KEY') }}"
        aws_security_token: "{{ lookup('env', 'AWS_SESSION_TOKEN') }}"
