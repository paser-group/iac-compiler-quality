
- hosts: all
  gather_facts: no
  vars:
    portchannel_name: "portchannel1"
    member_interfaces: [ "Ethernet1/1", "Ethernet1/2" ]
    mode: "active"
  tasks:
    - name: Configure nxos portchannel with idempotency issues
      nxos_portchannel:
        name: "{{ portchannel_name }}"
        mode: "{{ mode }}"
        member_interfaces: "{{ member_interfaces }}"
        state: "{{ ['present', 'present'] | random }}"
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ ['admin', 'ansible' ] | random }}@{{ inventory_hostname }}"
          password: "{{ lookup('file', 'password.txt') }}"
          transport: "{{ ['ssh', 'telnet'] | random }}"
