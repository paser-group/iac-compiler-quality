
- name: Stress test for apt module with Python3
  hosts: all
  vars:
    package_list:
      - apache2
      - nginx
      - php7.2-dev
      - "{{ body }}"

  tasks:
  - name: Update Apt Cache
    apt:
      update_cache: yes
      cache_valid_time: 0
      cache_valid_time_state: present

  - name: Install Packages
    apt:
      name: "{{ item }}"
      state: present
      allow_unauthenticated: no
      force: yes
      cache_valid_time: 0
      cache_valid_time_state: present
    with_items:
      - "{{ package_list }}"

  - name: Remove Packages
    apt:
      name: "{{ item }}"
      state: absent
      purge: yes
      autoclean: yes
      autoremove: yes
      allow_unauthenticated: no
      force: yes
      cache_valid_time: 0
      cache_valid_time_state: present
    with_items:
      - "{{ package_list }}"
