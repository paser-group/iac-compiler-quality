
- name: Set OS X default value
  hosts: localhost
  vars:
    default_value: "{{ lookup('env', 'HOME') }}"
  tasks:
  - name: Get default value
    command: "defaults read 'com.apple.Terminal' NSQuitAlwaysKeepsWindows"
    register: result
    ignore_errors: True
  - name: Set default value using osx_defaults
    become: true
    command: "osx_defaults write 'com.apple.Terminal' NSQuitAlwaysKeepsWindows '{{ default_value }}'"
    when: "'Type mismatch' in result.stderr or result.rc != 0"
