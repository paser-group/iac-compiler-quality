
- name: Create a VMware guest
  hosts: localhost
  gather_facts: no
  vars:
    vm_name: test_vm
    template_name: ubuntu_template
    folder_name: /vm/folder1
    esxi_hostname: esxi1.example.com
    datacenter_name: dc1
    cluster_name: cluster1
    resource_pool_path: /dc1/host/cluster1/Resources/test_resource_pool
  tasks:
  - name: Create a VMware guest
    vmware_guest:
      name: "{{ vm_name }}"
      template: "{{ template_name }}"
      state: poweredon
      folder: "{{ folder_name }}"
      esxi_hostname: "{{ esxi_hostname }}"
      datacenter_name: "{{ datacenter_name }}"
      cluster_name: "{{ cluster_name }}"
      resource_pool: "{{ resource_pool_path }}"
      networks:
        - name: Network1
          ip: "{{ hostvars['ubuntu1']['ansible_default_ipv4']['address'] }}"
