
- name: Test gcpubsub module
  hosts: localhost
  gather_facts: no
  vars:
    project_id: "{{ lookup('env', 'GCLOUD_PROJECT') }}"
    credentials_file: "{{ lookup('env', 'GCLOUD_CREDENTIALS_FILE') }}"
    topic: "test_topic"
    subscription: "test_subscription"
  tasks:
    - name: Create test topic
      gcpubsub:
        mode: create_topic
        project_id: "{{ project_id }}"
        credentials_file: "{{ credentials_file }}"
        name: "{{ topic }}"
      register: topic_result

    - name: Check topic result
      debug:
        var: topic_result

    - name: Create test subscription
      gcpubsub:
        mode: create_subscription
        project_id: "{{ project_id }}"
        credentials_file: "{{ credentials_file }}"
        topic: "{{ topic }}"
        name: "{{ subscription }}"
      register: subscription_result

    - name: Check subscription result
      debug:
        var: subscription_result
