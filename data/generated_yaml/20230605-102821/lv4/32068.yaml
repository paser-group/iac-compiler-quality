yaml
- name: Retrieve service manager on target host
  hosts: all
  tasks:
    - name: Get service manager
      shell: "ps --no-headers -o comm 1"
      register: init_system
    - name: Set ansible_service_mgr fact
      set_fact:
        ansible_service_mgr: "{{ 'systemd' if 'systemd' in init_system.stdout else 'sysvinit' }}"
    - name: Print ansible_service_mgr fact
      debug:
        var: ansible_service_mgr
