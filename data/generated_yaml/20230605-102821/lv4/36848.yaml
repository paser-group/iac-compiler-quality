
- name: Test Error Handling
  hosts: all

  tasks:
    - name: Run invalid command
      command: invalidcommand
      register: invalid_output
      ignore_errors: true
    - name: Fail on Error in stdout
      fail:
        msg: "Error detected in stdout: {{ invalid_output.stdout }}"
      when: invalid_output.stdout is search('Error.*Error')

