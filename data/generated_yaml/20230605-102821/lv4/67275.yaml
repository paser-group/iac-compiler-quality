
---
- name: Test ec2_win_password
  hosts: localhost
  gather_facts: no
  tasks:
  - name: Launch EC2 Instance
    ec2:
      key_name: my-key
      instance_type: t2.micro
      image: ami-0c55b159cbfafe1f0
      wait: yes
      region: us-east-1
      count: 1
      vpc_subnet_id: subnet-1a2b3c4d
    register: ec2_data
  - name: Set winrm_password
    set_fact:
      winrm_password: "{{ 'password' | password_hash('sha256') }}"
  - name: Set key data
    set_fact:
      key_data: "{{ lookup('file', '/etc/ansible/keys/my-key.pem') }}"
  - name: Test ec2_win_password
    ec2_win_password:
      instance_id: "{{ ec2_data.instances[0].id }}"
      password: "{{ winrm_password }}"
      key_data: "{{ key_data }}"
      verify_ssl: no
      protocol: http
