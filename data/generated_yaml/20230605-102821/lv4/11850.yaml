yaml
- name: Test Shell Module Error Codes
  hosts: all

  tasks:
    - name: Execute Invalid Shell Command
      shell: invalid-command
      register: cmd_output
      ignore_errors: true

    - name: Debug Command Output
      debug:
        var: cmd_output.stdout_lines

    - name: Fail on Incorrect Error Code
      fail:
        msg: "Command exited with incorrect code {{ cmd_output.rc }}."
      when: cmd_output.rc != 127
