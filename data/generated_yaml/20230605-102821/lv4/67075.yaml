
---
- name: Add or update SSH keys for a user in IPA
  hosts: ubuntu1
  become: yes
  tasks:
    - name: Retrieve current user information
      ipa_user:
        server: example.com
        user: admin
        password: "******"
        state: present
        uid: user1
      register: user_info

    - name: Add SSH key to the user's authorized keys
      ipa_user:
        server: example.com
        user: admin
        password: "******"
        state: present
        uid: user1
        sshpubkey: "{{ lookup('file', '/path/to/public_key.pub') }}"
      when: not user_info.changed
