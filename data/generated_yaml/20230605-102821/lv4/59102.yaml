
- name: Set IAM password policy for all users
  hosts: localhost
  gather_facts: no
  vars:
    max_password_age: -1
  tasks:
    - name: Retrieve IAM users
      community.aws.aws_iam_facts:
      register: iam_users
  
    - name: Set password policy
      community.aws.aws_iam_password_policy:
        require_lowercase_characters: true
        require_uppercase_characters: true
        require_numbers: true
        require_symbols: true
        minimum_password_length: 12
        max_password_age: "{{ max_password_age }}"
        allow_users_to_change_password: true
      register: policy_output
  
    - name: Print output
      debug:
        var: policy_output
