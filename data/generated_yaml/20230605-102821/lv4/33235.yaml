
---
- name: Change the default path of Ansible semaphore
  connection: local
  hosts: localhost
  tasks:
    - name: Create temporary directory
      tempfile:
        state: directory
        suffix: '_semaphore'
      register: semaphore_folder
    - name: Set semaphore path
      copy:
        dest: /etc/ansible/semaphore_file_path
        content: "{{ semaphore_folder.path }}"
        mode: '0644'
    - name: Archive semaphore folder
      archive:
        path: "{{ semaphore_folder.path }}"
        dest: "{{ playbook_dir }}/semaphore_archive.tar.gz"
      delegate_to: localhost
