yaml
- name: Install Ansible
  hosts: all
  become: true
  vars:
    ansible_pkg: "ansible"
    python_pkgs: ["python", "python3-pip", "python2-pip"]
  tasks:
    - name: Update Python Packages
      package:
        name: "{{ item }}"
        state: latest
      loop: "{{ python_pkgs }}"
      ignore_errors: yes

    - name: Install pip via easy_install
      raw: "easy_install pip"
      args:
        creates: "/usr/bin/pip"

    - name: Update Pip
      pip:
        name: pip
        extra_args: --upgrade
        state: latest

    - name: Install Ansible via Pip
      pip:
        name: "{{ ansible_pkg }}"
        state: present
      notify: restart ansible

  handlers:
    - name: Restart Ansible
      service:
        name: ansible
        state: restarted
