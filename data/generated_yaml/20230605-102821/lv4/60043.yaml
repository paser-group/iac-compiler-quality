
---
- name: Test database connection
  hosts: all
  tasks:
    - name: Check PostgreSQL connection
      postgresql_db:
        login_user: postgres
        login_password: '{{lookup(''file'', ''/root/postgres_db_password.txt'') }}'
        login_host: localhost
        port: 5432
      register: result

    - debug: var=result

    - name: Check default postgres database
      fail:
        msg: "Default database connection found!"
      when: result.database == 'postgres'
