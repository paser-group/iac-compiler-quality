
- hosts: all
  gather_facts: no

  tasks:
  - name: Create file with iso8859-15 encoding
    shell: echo "StÃ©phane" > /tmp/test-fichier.txt
    args:
      executable: /usr/bin/bash
    changed_when: false

  - name: Diff file with iso8859-15 encoding
    diff:
      path: /tmp/test-fichier.txt
      src: /tmp/test-fichier.txt
      format: iso8859-15
    register: diff_output
    failed_when: "'unknown error handler name' not in diff_output.stderr"
