
- name: Retrieve S3 bucket contents
  hosts: localhost
  gather_facts: no
  vars_files:
    - "{{ ansible_env.HOME }}/aws/credentials"
  tasks:
    - name: Retrieve S3 contents
      s3:
        profile: "{{ lookup('env', 'AWS_PROFILE') }}"
        bucket: "<bucket_name>"
        object: ""
      register: result
      ignore_errors: yes
    - debug:
        var: result.content
