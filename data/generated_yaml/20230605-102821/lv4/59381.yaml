
---
- hosts: cisco-ios
  gather_facts: no
  vars:
    ansible_network_os: ios
    ansible_ssh_user: testuser
    ansible_ssh_private_key_file: /path/to/private/key
    ansible_become_pass: "{{ lookup('file', '/path/to/become_password.txt') }}"
  tasks:
    - name: Configure SSH Key for Authentication
      ios_command:
        commands:
          - "enable password cisco"
          - "ip ssh pubkey-chain"
          - "username testuser"
          - "key-string"
          - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQAB"
        host: "{{ inventory_hostname }}"
        provider:
          username: "{{ ansible_ssh_user }}"
          use_keys: true
    - name: Test SSH Connectivity
      ios_ping:
        host: "{{ inventory_hostname }}"
        provider:
          username: "{{ ansible_ssh_user }}"
          use_keys: true
