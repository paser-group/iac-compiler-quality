
- name: Test for AnyErrorsFatal Issue
  hosts: all
  gather_facts: no
  vars:
    any_errors_fatal: true
  tasks:
    - name: Failing task
      command: /bin/false
      register: result
      ignore_errors: "{{ any_errors_fatal }}"
    - name: Rescue task
      debug:
        msg: "Rescue task was executed"
      rescue:
        - name: Cleanup task
          command: /bin/true
    - name: Always task
      debug:
        msg: "Always task was executed"
      always:
        - name: Cleanup task after failed task
          command: /bin/true
