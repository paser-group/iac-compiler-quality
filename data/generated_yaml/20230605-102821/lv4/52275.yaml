
- hosts: all
  tasks:
  - name: Install pip
    become: true
    apt:
      name: python-pip
      update_cache: yes

  - name: Install virtualenv
    become: true
    pip:
      name: virtualenv

  - name: Create virtualenv with arguments
    become: true
    command: virtualenv /path/to/virtualenv --system-site-packages --never-download

  - name: Activate virtualenv
    become: true
    command: source /path/to/virtualenv/bin/activate

  - name: Install package in virtualenv
    become: true
    command: pip install some_package
    environment:
      PATH: "/path/to/virtualenv/bin:{{ ansible_env.PATH }}"
  