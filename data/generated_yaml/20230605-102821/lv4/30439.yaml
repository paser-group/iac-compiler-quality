yaml
- name: Configure IGMP Snooping
  hosts: switch
  gather_facts: no
  vars:
    non_default_igmp_values:
      - igmp_enabled: yes
      - igmp_version: 2
      - igmp_immediate_leave: yes
  
  tasks:
    - name: Set non-default igmp snooping values
      nxos_igmp_snooping:
        igmp_snooping_groups: yes
        igmp_snooping_report_supplicant: yes
        igmp_snooping_optimization: yes
        igmp_snooping_profile: 'custom_profile'
        igmp_snooping_profile_options: "{{ non_default_igmp_values }}"
      register: result

    - name: Check idempotence
      assert:
        that: result is not changed
      ignore_errors: yes
