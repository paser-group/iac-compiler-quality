
---
- hosts: localhost
  connection: local
  tasks:
    - name: Create Azure Key Vault
      azure_rm_keyvault:
        name: myKeyVault
        location: eastus
        resource_group: myResourceGroup
        tenant_id: "{{vault_tenant_id}}"
        client_id: "{{vault_client_id}}"
        secret: "{{vault_secret}}"
      register: keyvault

    - name: Get secret from the created keyvault
      azure_rm_keyvaultsecret:
        resource_group: myResourceGroup
        keyvault_name: "{{keyvault.name}}"
        secret_name: mySecret
      register: secret

    - name: Echo the fetched secret
      debug:
        msg: "{{secret.value}}"
...
