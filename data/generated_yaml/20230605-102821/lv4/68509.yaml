
- name: Handle authorized keys for user
  hosts: all
  tasks:
    - name: Add authorized key for user
      authorized_key:
        user: '{{ user }}'
        state: present
        key: '{{ lookup("file", {{ ssh_key_path }}) }}'
        path: '{{ ssh_key_path }}'
      when: user is defined
