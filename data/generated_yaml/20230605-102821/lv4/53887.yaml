
- name: Create, Verify, and Delete VLAN on Nexus Switch
  hosts: switch
  gather_facts: no
  vars:
    vlan_id: 10
  tasks:
    - name: Create VLAN
      nxos_vlan:
        vlan_id: "{{ vlan_id }}"
        name: "VLAN {{ vlan_id }}"
        mode: "fabricpath"
        state: "present"
      register: vlan_result

    - name: Verify that VLAN is present
      nxos_vlan:
        vlan_id: "{{ vlan_id }}"
        name: "VLAN {{ vlan_id }}"
        mode: "fabricpath"
        state: "present"
      when: not vlan_result.changed

    - name: Delete VLAN
      nxos_vlan:
        vlan_id: "{{ vlan_id }}"
        state: "absent"
      when: vlan_result.changed
