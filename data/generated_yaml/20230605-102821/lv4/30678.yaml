
- name: Create cloudwatch event rule
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Create a simple cron schedule
      cron:
        name: "simple cron schedule"
        minute: "*/15"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
      register: cron_output

    - name: Create a cloudwatch event rule
      cloudwatchevent_rule:
        name: "myevent"
        schedule_expression: "cron({{ cron_output.stdout_lines[0] }} {{ cron_output.stdout_lines[1] }} {{ cron_output.stdout_lines[2] }} {{ cron_output.stdout_lines[3] }} {{ cron_output.stdout_lines[4] }})"
        state: present
      register: event_output

    - name: Print cloudwatch event details
      debug:
        var: event_output
