
- name: Create softlink and encrypt using ansible-vault
  hosts: localhost
  tasks:
    - name: Create softlink
      file:
        src: /etc/ansible/testsymlink
        dest: /etc/ansible/symlink
        state: link
      register: symlink_result

    - name: Encrypt softlink using ansible-vault
      ansible.builtin.command: >-
        ansible-vault encrypt {{ symlink_result.dest }}
      register: encrypt_result

- name: Use encrypted symlink
  hosts: localhost
  tasks:
    - name: Access encrypted softlink
      file:
        path: /etc/ansible/symlink
        state: link
        follow: yes
      register: symlink_access_result

    - name: Debug symlink access
      debug:
        var: symlink_access_result
