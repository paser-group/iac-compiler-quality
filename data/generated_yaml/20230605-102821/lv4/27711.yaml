
- name: Test nxos_snmp_community on NX-OS devices
  hosts: nxos_devices
  gather_facts: no
  connection: network_cli
  tasks:
    - name: Get SNMP community string
      nxos_command:
        commands:
          - show snmp community
      register: snmp_out

    - name: Debug SNMP output
      debug:
        var: snmp_out.stdout_lines

    - name: Set SNMP community string
      nxos_snmp_community:
        name: community1
        config: present
        mode: snmpv2c
        groups:
          - network-admin
      failed_when: false
      register: nxos_out

    - name: Debug NX-OS output
      debug:
        var: nxos_out.stdout_lines
