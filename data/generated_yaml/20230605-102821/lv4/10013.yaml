
- hosts: all
  gather_facts: no

  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    - name: Check inventory script syntax error
      shell: |
        python -m py_compile '{{ ansible_inventory }}'
      register: syntax_result
      ignore_errors: yes

    - name: Report syntax error
      debug:
        msg: "Syntax error detected in the inventory script: {{ syntax_result.stderr }}"
      when: syntax_result.rc != 0

    - name: Check inventory script YAML format
      shell: |
        python3 -c "import yaml; yaml.safe_load(open('{{ ansible_inventory }}'))"
      register: yaml_result
      ignore_errors: yes

    - name: Report YAML error
      debug:
        msg: "YAML error detected in the inventory script: {{ yaml_result.stderr }}"
      when: yaml_result.rc != 0

    - name: Validate inventory script hosts
      setup:
      when: inventory_hostname == 'localhost'

    - name: Display the inventory
      debug:
        var: inventory_hostname
