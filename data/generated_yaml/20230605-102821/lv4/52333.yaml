
- name: Test ec2_vpc_peer module
  hosts: localhost
  gather_facts: false
  vars:
    aws_access_key: "<your_aws_access_key>"
    aws_secret_key: "<your_aws_secret_key>"
    region: "<your_aws_region>"
  tasks:
    - name: Create a VPC Peering Connection
      ec2_vpc_peer:
        state: present
        vpc_id: "<local_vpc_id>"
        peer_region: "<peer_aws_region>"
        peer_vpc_id: "<peer_vpc_id>"
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        region: "{{ region }}"
      register: vpc_peer_connection
      
    - name: Check if VPC peering connection was established
      debug:
        msg: "{{ hostvars[item]['ansible_facts']['ec2_vpc_peer_details']['msg'] }}"
      loop: "{{ groups['localhost'] }}"
      when: "'ec2_vpc_peer_details' in hostvars[item]['ansible_facts']"
