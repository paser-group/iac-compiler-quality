yaml
- name: test-gcp-iam
  hosts: localhost
  gather_facts: no
  tasks:
    - name: create test GCP IAM service account
      google.cloud.gcp_iam_service_account:
        name: "{{ 'test-sa' }}"
        display_name: "{{ 'Test Service Account' }}"
        project: "{{ lookup('env', 'GCP_PROJECT_ID') }}"
        auth_kind: "{{ 'serviceaccount' }}"
        service_account_file: "{{ lookup('env', 'GOOGLE_APPLICATION_CREDENTIALS') }}"
      register: result
    - name: create the existing GCP IAM service account
      google.cloud.gcp_iam_service_account:
        name: "{{ 'test-sa' }}"
        display_name: "{{ 'Test Service Account' }}"
        project: "{{ lookup('env', 'GCP_PROJECT_ID') }}"
        auth_kind: "{{ 'serviceaccount' }}"
        service_account_file: "{{ lookup('env', 'GOOGLE_APPLICATION_CREDENTIALS') }}"
      register: result_existent
      ignore_errors: true
    - name: display the result
      debug:
        var: result
    - name: display the result again
      debug:
        var: result_existent
