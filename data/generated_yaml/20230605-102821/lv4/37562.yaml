
- hosts: all
  gather_facts: no

  tasks:
  - name: Test Foreman callback plugin authentication error
    shell: 'echo "Authentication failed." && exit 127'
    notify: Foreman Authentication Error

  handlers:
    - name: Foreman Authentication Error
      foreman_callback_plugin:
        server_url: 'https://foreman.example.com'
        username: 'admin'
        password: 'incorrect_password'
        ssl_ca_cert: '/etc/pki/tls/certs/ca-bundle.crt'
        log_level: 'debug'
