
- name: Test IAM Module
  hosts: all
  gather_facts: no
  vars:
    aws_access_key: <your_aws_access_key_id>
    aws_secret_key: <your_aws_secret_access_key>
    aws_region: <your_aws_region>
  tasks:
    - name: Test IAM Credentials
      iam:
        iam_type: user
        name: test_user
        access_key: "{{ aws_access_key }}"
        secret_key: "{{ aws_secret_key }}"
        region: "{{ aws_region }}"
        state: present
      register: iam_info
    - name: Debug IAM
      debug:
        var: iam_info
      when: iam_info.failed == true
    - name: Report IAM Error
      fail:
        msg: "IAM credentials are not working, please verify credentials"
      when: iam_info.failed == true
