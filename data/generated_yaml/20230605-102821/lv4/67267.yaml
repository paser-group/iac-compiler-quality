
- hosts: all
  gather_facts: false
  vars:
    iscsi_port: "{{ 3260 }}"
  tasks:
    - name: Install open_iscsi package
      package:
        name: open-iscsi
        state: present

    - name: Start iscsid service
      service:
        name: iscsid
        state: started

    - name: Discover iSCSI targets
      command:
        cmd: iscsiadm -m discovery -t st -p {{ inventory_hostname }}:{{ iscsi_port }}

    - name: Unmask the default port string field issue
      command:
        cmd: iscsiadm -m node --login
