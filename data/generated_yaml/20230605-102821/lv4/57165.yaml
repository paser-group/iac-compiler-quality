
- name: Mount NFS share
  hosts: all
  become: yes
  tasks:
  - name: Mount NFS share
    mount:
      path: /mnt/nfs/share
      src: "{{inventory_hostname}}:/home/user/share"
      fstype: nfs
      state: mounted

  - name: Unmount NFS share
    mount:
      path: /mnt/nfs/share
      state: unmounted

  - name: Validate unmount
    shell: |
      if mount | grep "/mnt/nfs/share"; then
        echo "Share still mounted"
      else
        echo "Unmount successful"
      fi
    register: unmount_status

  - name: Display unmount status
    debug:
      var: unmount_status.stdout_lines
