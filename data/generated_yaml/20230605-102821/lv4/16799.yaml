
- name: Add Custom Module Path
  hosts: all
  gather_facts: no
  tasks:
    - name: Create ansible.cfg
      file:
        state: touch
        path: /etc/ansible/ansible.cfg
        mode: '0600'
      become: yes
      become_method: sudo
    - name: Add custom module path to ansible.cfg
      lineinfile:
        path: /etc/ansible/ansible.cfg
        line: "library = /var/lib/custom_modules"
        insertafter: '\[defaults\]'
      become: yes
      become_method: sudo
    - name: Test Custom Module
      command: ansible localhost -m custom_module
      register: result
    - name: Debug Task Result
      debug:
        msg: "{{ result.stdout_lines }}"
