
- hosts: all
  gather_facts: no
  become: yes
  remote_user: <remote_user>
  vars:
    ansible_ssh_common_args: '-o ProxyCommand="ssh -W %h:%p -q <bastion_user>@<bastion_host>"'
  tasks:
  - name: Check SSH connectivity to every node
    ping:
  - name: Check connectivity to every node using SSH config
    command: ssh -q -o "StrictHostKeyChecking=no" {{inventory_hostname}}
    register: ssh_result
    ignore_errors: yes
  - name: Print the SSH result 
    debug: var=ssh_result
