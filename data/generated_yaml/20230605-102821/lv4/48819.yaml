
- name: Test authorized_key module
  hosts: all
  gather_facts: false

  tasks:
    - name: Add SSH public key for user
      authorized_key:
        user: "{{ ansible_user }}"
        state: present
        key: "{{ lookup('file', './public_key.txt') }}"
      register: auth_key_result

    - name: Echo authorization output
      debug:
        var: auth_key_result

    - name: Test SSH connection
      command: "echo 'SSH connection established'"
      register: ssh_output
      become: true
      become_user: "{{ ansible_user }}"
      become_method: sudo

    - name: Echo SSH output
      debug:
        var: ssh_output
