
- name: Test include_role with condition and loop limit
  hosts: all
  vars:
    leaky_var: "{{ some_var }}"
  tasks:
    - name: Include role with conditional
      include_role:
        name: myrole
      when: "ansible_hostname == 'ubuntu1'"
    - name: Include role with loop
      include_role:
        name: myrole
      loop: "{{ groups['alpine'] }}"
      loop_control:
        loop_var: item
    - name: Print leaked var
      debug:
        var: leaky_var
