
- hosts: localhost
  connection: local
  become: no
  gather_facts: no

  tasks:
    - name: Create EBS volume
      ec2_vol:
        region: "us-east-1"
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        instance: "{{ instance_id }}"
        device_name: "{{ device_name }}"
        size: "{{ size }}"
        volume_type: "{{ volume_type }}"
      register: vol_result

    - name: Attach EBS Volume
      ec2_vol:
        region: "us-east-1"
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        instance: "{{ instance_id }}"
        device_name: "{{ device_name }}"
        volume_id: "{{ vol_result.volume_id }}"
        state: "attached"
