
---
- name: Reboot fails with Ubuntu node
  hosts: ubuntu1
  become: yes
  vars:
    ansible_become_pass: "{{ lookup('file', '/path/to/password/file') }}"
  tasks:
    - name: Reboot the node
      shell: |
        sleep 3600 &
        sleep_pid=$!
        shutdown -r now || true
        wait $sleep_pid
      async: 3600
      poll: 0
