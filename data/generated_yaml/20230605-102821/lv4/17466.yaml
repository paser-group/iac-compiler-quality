
- hosts: all
  gather_facts: no
  tasks:
    - name: "Run async task with incorrect directory"
      async: 30
      poll: 0
      chdir: "/tmp"
      shell: 'ls -l /'
      register: result

    - name: "Unmask and fail async task"
      fail:
        msg: "Async task failed with incorrect directory"
      when: result.failed
