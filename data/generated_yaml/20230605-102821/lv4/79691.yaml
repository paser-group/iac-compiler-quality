
- name: Test for remote_user vulnerability
  hosts: all
  gather_facts: no
  connection: local
  vars:
    ansible_connection: httpapi
    ansible_httpapi_use_ssl: yes
    ansible_httpapi_port: 8443
    ansible_user: "{{ lookup('env','USER') }}"
    ansible_password: "{{ lookup('env','PASSWORD') }}"
  tasks:
    - name: Check remote_user value
      uri:
        url: https://{{ inventory_hostname }}/api/v1/userinfo
        method: GET
        validate_certs: no
      register: user_info
    - name: Display remote_user value
      debug:
        var: user_info.json.remote_user
