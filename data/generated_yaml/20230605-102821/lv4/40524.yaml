
- name: Test playbook
  hosts: all
  tasks:
  - name: Set variable locally
    set_fact:
      myvar: "test"
    run_once: true
    delegate_to: localhost

  - name: local_action task
    local_action:
      module: debug
      msg: "{{ hostvars[groups['all'][0]]['myvar'] }}"
      become: true
    run_once: true
    delegate_to: localhost
