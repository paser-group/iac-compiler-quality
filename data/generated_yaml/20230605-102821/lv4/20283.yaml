
- name: Set registry key
  win_regedit:
    path: "{{ reg_path }}"
    name: "{{ reg_key }}"
    value: "{{ reg_value }}"
    type: "{{ reg_type }}"
  register: reg_key_result

- name: Check if registry key is changed
  win_regedit:
    path: "{{ reg_path }}"
    name: "{{ reg_key }}"
    value: "{{ reg_value }}"
    type: "{{ reg_type }}"
  register: reg_key_check
  ignore_errors: yes

- name: Fail when the registry key is changed
  fail:
    msg: "Registry Key {{ reg_key }} is changed."
  when: reg_key_check.changed and not reg_key_result.changed
