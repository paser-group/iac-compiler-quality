
- name: Retrieve EC2 Auto Scaling Group Information
  hosts: localhost
  gather_facts: false
  vars:
    region: "{{ lookup('env','AWS_REGION') }}"
    asg_name: "example_asg"
    tg_name: "example_tg"
  tasks:
  - name: Gather EC2 Auto Scaling Group Facts
    ec2_asg_facts:
      region: "{{ region }}"
      names: [ "{{ asg_name }}" ]
  - name: Verify Target Group Availability
    fail:
      msg: Target group {{ tg_name }} not found
    when: "'{{ tg_name }}' not in (ansible_facts.ec2_asg_facts[0].target_groups|map(attribute='name')|list)"
