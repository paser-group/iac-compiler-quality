
---
- name: My Playbook
  hosts: all
  gather_facts: false
  tasks:
    - name: Ping all hosts
      ping:

    - name: Run task only on reachable hosts
      debug:
        msg: "This task will run only on the reachable hosts"
      when: inventory_hostname in groups['all']

    - name: Run task only on unreachable hosts
      debug:
        msg: "This task should run only on the unreachable hosts"
      delegate_to: localhost
      when: inventory_hostname not in groups['all']
