
- hosts: ubuntu1
  gather_facts: no
  vars:
    guest_name: test_vm
    memory_mb: 1024
    mem_reservation: 0

  tasks:
    - name: Create VM
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: False
        name: "{{ guest_name }}"
        memory_mb: "{{ memory_mb }}"
        mem_reservation: "{{ mem_reservation }}"
        guest_id: "{{ guest_id }}"
      register: vm

    - name: Debug
      debug:
        var: vm
      when: vm.rc != 0
