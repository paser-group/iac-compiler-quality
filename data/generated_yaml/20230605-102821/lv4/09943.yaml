
- name: Check mode test playbook
  hosts: all
  gather_facts: no

  tasks:
    - name: Test for bug
      copy:
        src: /tmp/local.file.txt
        dest: /tmp/remote.file.txt
        failed_when: false
        ignore_errors: true
      register: test_result
      check_mode: true
      when: test_result is not succeeded

    - debug:
        msg: "Task failed in check mode"
      when: test_result is failed
      check_mode: true
