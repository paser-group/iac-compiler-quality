
- name: Launch EC2 Instances
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    key_name: "{{ your_key }}"
    group: "{{ your_security_group }}"
    instance_type: "{{ your_instance_type }}"
    image: "{{ your_ami_id }}"
    count: "{{ your_instance_count }}"
    region: "{{ your_region }}"
  tasks:
    - name: Launch EC2 Instance
      ec2:
        key_name: "{{ key_name }}"
        group_id: "{{ group }}"
        instance_type: "{{ instance_type }}"
        image: "{{ image }}"
        count: "{{ count }}"
        region: "{{ region }}"
      register: ec2

    - name: Show EC2 Instance IDs
      debug:
        var: item.id
      with_items: "{{ ec2.instances }}"

    - name: Terminate EC2 Instance
      ec2_instance:
        instance_ids: "{{ ec2.instance_ids }}"
        state: absent
