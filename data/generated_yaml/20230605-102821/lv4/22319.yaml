
---
- hosts: all
  gather_facts: no
  vars:
    eos_user: admin
    eos_password: "{{ lookup('file','/etc/ansible/eos_password.txt') }}"
  tasks:
    - name: Test Connection to EOS Device
      eos_command:
        commands: show version
      register: eos_command_output
      ignore_errors: yes
    - name: Echo Output
      debug:
        var: eos_command_output
    - name: Check Connection Status
      fail:
        msg: "Unable to connect to EOS device"
      when: "'Error in establishing SSH connection' in eos_command_output.stderr"
