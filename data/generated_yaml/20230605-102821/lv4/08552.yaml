
- name: Create EC2 instance using VPC
  hosts: localhost
  become: yes
  gather_facts: no
  vars:
    region: "us-west-2"
    vpc_subnet_id: "subnet-xxxxxx"
    vpc_security_group_id: "sg-xxxxxx"
  tasks:
    - name: Launch an EC2 Instance
      ec2_vpc:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        instance_type: t2.micro
        image: ami-0c55b159cbfafe1f0
        vpc_subnet_id: "{{ vpc_subnet_id }}"
        key_name: my-key
        wait: true
        count: 1
        group_id: "{{ vpc_security_group_id }}"
        region: "{{ region }}"
        assign_public_ip: false
      register: ec2_instance
    - name: Extract EC2 Instance ID
      debug:
        var: ec2_instance.instances[0].id
