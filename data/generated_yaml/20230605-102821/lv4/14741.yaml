
- hosts: ubuntu1
  gather_facts: no
  become: yes
  vars:
    haproxy_nodes:
      - { name: 'alpine1', ip: '10.1.1.2' }
      - { name: 'centos1', ip: '10.1.1.3' }
      - { name: 'redhat1', ip: '10.1.1.4' }

  tasks:
  - name: Install haproxy
    apt:
      name: haproxy
      update_cache: yes
      
  - name: Configure HAProxy
    haproxy:
      backend: web-backend
      mode: tcp
      balance: roundrobin
      server: "{{ item.name }} {{ item.ip }}:80 check"
    with_items: "{{ haproxy_nodes }}"
    delegate_to: "{{ item.name }}"
