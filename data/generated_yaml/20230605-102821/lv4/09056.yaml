
---
- name: Test Service Module Restart Functionality
  hosts: all
  tasks:
    - name: Restarting a service
      service:
        name: "{{ SERVICE_NAME }}"
        state: restarted
        register: serviceRestartStatus
      ignore_errors: yes
    - name: Debugging service restart status
      debug:
        var: serviceRestartStatus
      when: serviceRestartStatus is defined and serviceRestartStatus is failed
    - name: Stopping a service after failed restart
      service:
        name: "{{ SERVICE_NAME }}"
        state: stopped
      when: serviceRestartStatus is defined and serviceRestartStatus is failed
