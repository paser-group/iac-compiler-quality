
- name: Test YAML Inventory Plugin
  hosts: all
  gather_facts: no
  tasks:
    - name: Load YAML Inventory File
      include_vars:
        file: "{{ inventoryfile }}"

    - name: Ping all hosts
      ping:

  pre_tasks:
    - name: Check inventory file exists
      stat:
        path: "{{ inventoryfile }}"
      register: file_status
      failed_when: false

    - name: Fail if inventory file not found
      fail:
        msg: "Inventory file not found"
      when: not file_status.stat.exists
