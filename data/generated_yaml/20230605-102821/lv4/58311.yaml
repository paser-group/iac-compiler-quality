
- name: Manage ServiceNow records with ADFS authentication
  hosts: all
  gather_facts: no
  vars:
    sn_instance: "{{ lookup('env', 'SN_INSTANCE') }}"
    sn_username: "{{ lookup('env', 'SN_USERNAME') }}"
    sn_password: "{{ lookup('env', 'SN_PASSWORD') }}"
    sn_auth_type: "{{ lookup('env', 'SN_AUTH_TYPE') }}"
    sn_client_id: "{{ lookup('env', 'SN_CLIENT_ID') }}"
    sn_client_secret: "{{ lookup('env', 'SN_CLIENT_SECRET') }}"
    sn_redirect_uri: "{{ lookup('env', 'SN_REDIRECT_URI') }}"

  tasks:
  - name: Create a new record in ServiceNow
    snow_record:
      state: present
      table: incident
      data:
        short_description: "test description"
        impact: "4"
      auth_type: "{{ sn_auth_type }}"
      instance: "{{ sn_instance }}"
      username: "{{ sn_username }}"
      password: "{{ sn_password }}"
      client_id: "{{ sn_client_id }}"
      client_secret: "{{ sn_client_secret }}"
      redirect_uri: "{{ sn_redirect_uri }}"
    register: result

  - name: Display the result
    debug:
      var: result
