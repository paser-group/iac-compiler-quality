
- name: Test WinRM connection
  hosts: windows_hosts
  gather_facts: False

  tasks:
    - name: Disable https verification
      win_powershell:
        script: Set-Item -Path WSMan:\localhost\Client\AllowUnencrypted -Value True
      register: powershell
      ignore_errors: True

    - name: Test WinRM connection via PowerShell
      win_shell: echo "Hello from PowerShell on remote host {{ inventory_hostname }}"
      register: ps_output
      ignore_errors: True

      vars:
        ansible_shell_type: powershell

    - name: Show WinRM connection status
      debug:
        var: ps_output
