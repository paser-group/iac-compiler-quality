
- name: Create an EC2 instance
  hosts: localhost
  gather_facts: false
  vars:
    instance_type: t2.micro
    ami: ami-0c94855ba95c71c99
    subnet_id: subnet-0fb658fc
    security_group: default
    vpc_id: vpc-4b2d4a1a
    key_pair: ansible-key
    region: us-west-2
  tasks:
    - name: Launch the instance
      ec2_instance:
        name: Test Instance
        instance_type: "{{ instance_type }}"
        image_id: "{{ ami }}"
        key_name: "{{ key_pair }}"
        region: "{{ region }}"
        security_group: "{{ security_group }}"
        subnet_id: "{{ subnet_id }}"
        vpc_id: "{{ vpc_id }}"
        network_interfaces:
          - device_index: 0
            subnet_id: "{{ subnet_id }}"
            groups:
              - "{{ security_group }}"
            associate_public_ip_address: true
        wait: true
      register: ec2

    - name: Debugging
      debug:
        var: ec2.instance_id
