
- name: Install Certbot and dependencies
  become: true
  apt:
    name:
      - certbot
      - python3-certbot-nginx
      - python3-certbot-dns-cloudflare
    state: latest

- name: Create Let's Encrypt certificate using http-01 challenge type
  become: true
  shell: certbot certonly --agree-tos --non-interactive --email admin@example.com --http-01 --rsa-key-size 4096 -d example.com

- name: Check if certificate has been successfully installed
  become: true
  shell: ls /etc/letsencrypt/live/example.com/fullchain.pem

- name: Display the certificate details
  become: true
  shell: openssl x509 -in /etc/letsencrypt/live/example.com/fullchain.pem -text -noout
