
- name: Add Authorized Key
  hosts: all
  become: yes
  tasks:
    - name: "Generate Authorized Key"
      command: ssh-keygen -q -t rsa -C "authorized_key" -N '' -f /tmp/authorized_key
    - name: "Add the key to authorized_keys"
      authorized_key:
        user: nonexist
        key: "{{ lookup('file','/tmp/authorized_key.pub') }}"
        state: present
        path: /tmp/nonexist/.ssh/authorized_keys
