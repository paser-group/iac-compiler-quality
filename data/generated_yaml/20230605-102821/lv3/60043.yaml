
---
- hosts: all
  gather_facts: false
  vars:
    db_name: "{{Lookup('env','DB_NAME')}}"
  tasks:
    - name: Check for database name
      fail:
        msg: "Database name has not been passed, used default database to connect to."
      when: db_name is not defined
    - name: Connect to database
      postgresql_db:
        name: "{{ db_name }}"
        login_user: "{{Lookup('env', 'DB_USER')}}"
        login_password: "{{Lookup('password', '/path/to/password/file')}}"
...
