
---
- name: Test SSH connectivity
  hosts: all
  gather_facts: false
  become: true
  vars:
    ansible_ssh_common_args: '-o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no'
  tasks:
    - name: Ping all nodes
      ping:
      register: ping_result

    - name: Display unreachable nodes
      debug:
        msg: "{{ inventory_hostname }} is unreachable"
      when: "'UNREACHABLE' in ping_result.msg"
