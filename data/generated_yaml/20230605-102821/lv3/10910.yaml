
- name: Test ec2.py script for unbound 'error' variable
  hosts: localhost
  gather_facts: no
  tasks:
  - name: Execute ec2.py script
    command: ansible -i ec2.py all -m ping
    register: result
    ignore_errors: true

  - name: Check for 'error' variable
    debug:
      var: result | json_query('error')
    when: "'error' in result.stdout_lines[1]"
