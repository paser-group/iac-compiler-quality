---
- name: Memory Allocation Test
  hosts: all
  gather_facts: false
  tasks:
    - name: Install stress tool
      become: true
      package:
        name: stress
        state: present
      register: stress

    - name: Run stress tool to consume memory
      become: true
      command: stress --vm-bytes $(free -m | awk 'NR==2{print $2}')M --vm-keep -m 1
      when: stress.changed
