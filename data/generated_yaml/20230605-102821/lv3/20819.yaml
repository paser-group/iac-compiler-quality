yaml
---
- hosts: "{{ target }}"

  tasks:
  - name: Create VM
    vmware_guest:
      hostname: "{{ hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      validate_certs: "{{ validate_certs | default('no') }}"
      name: "{{ name }}"
      template: "{{ template }}"
      datacenter: "{{ datacenter }}"
      folder: "{{ folder }}"
      disk:
        - size_gb: "{{ disk_size }}"
      networks:
        - name: "{{ network }}"
          ip: "{{ ip }}"
          netmask: "{{ netmask }}"
          gateway: "{{ gateway }}"

    register: vm

  - name: Update thumbprint
    vmware_host:
      hostname: "{{ hostname }}"
      username: "{{ username }}"
      password: "{{ password }}"
      cluster_name: "{{ cluster }}"
      thumbprint: "{{ vm.instance_uuid }}"
      state: present
