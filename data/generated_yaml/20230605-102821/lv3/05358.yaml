
- name: Supplying an incorrect sudo password
  hosts: all
  gather_facts: no
  become: true
  tasks:
    - name: Check sudo access
      shell: echo "I have sudo access"
      register: result
      ignore_errors: true

    - name: Try to access root with an incorrect password
      expect:
        command: su -
        responses:
          sudo password: "wrong password"
      register: output
      ignore_errors: true

    - name: Verify the error message
      assert:
        that: "'incorrect password' in output.stdout"
