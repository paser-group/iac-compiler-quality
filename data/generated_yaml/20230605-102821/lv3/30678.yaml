
- name: Retrieve EC2 instance facts
  ec2_instance_facts:
    region: us-east-1
  register: instances
  
- name: Create CloudWatch Event rule
  cloudwatchevent_rule:
    name: test_rule
    state: present
    event_pattern: >
      {
        "source": [
          "aws.ec2"
        ],
        "detail": {
          "instance-id": [
            "{{ instances.instances[0].instance_id }}"
          ]
        }
      }
  vars:
    ansible_python_interpreter: /usr/bin/python3
