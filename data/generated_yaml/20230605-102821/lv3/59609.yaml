
- name: Test aws_secret lookup plugin on Ubuntu 18.04
  hosts: ubuntu1
  gather_facts: no
  tasks:
    - name: Install required packages
      apt:
        name:
          - awscli
          - python3-boto3
          - python3-jmespath
        state: present

    - name: Create a test secret in AWS Secrets Manager
      shell: |
        aws secretsmanager create-secret --name test-secret --secret-string "mysecret"

    - name: Retrieve secret value using aws_secret lookup plugin
      debug:
        var: lookup('aws_secret', 'test-secret')

