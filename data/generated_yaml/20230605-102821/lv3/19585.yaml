---
- name: Simulate "Invalid value. Expected value to be an array" error 
  hosts: local
  gather_facts: no
  
  vars:
    my_defaults:
      bad_key:
        domain: com.test.domain
        type: string
        value: "bad value"

  tasks:    
    - name: Set default value
      osx_defaults:
        domain: "{{ item.value.domain }}"
        key: "{{ item.key }}"
        value:
          - "{{ item.value.value }}"
        type: "{{ item.value.type }}"
      with_dict: "{{ my_defaults }}"
