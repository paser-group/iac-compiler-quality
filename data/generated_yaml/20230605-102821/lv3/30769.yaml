
- name: Install Cisco Nexus OS on Virtual Machine
  hosts: all
  gather_facts: no
  vars:
    vtp_password: "{{ lookup('password', '/path/to/vtp_password/file') }}"
    target: "ubuntu1"
    vmname: "nexus"
    network: "node-net"
    ip: "10.1.1.5"
    netmask: "255.255.255.0"
    gateway: "10.1.1.254"
  tasks:
    - name: Create Virtual Machine
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ lookup('password', '/path/to/vcenter/password/file') }}"
        validate_certs: no
        datacenter: "{{ datacenter }}"
        folder: "{{ folder }}"
        name: "{{ vmname }}"
        template: "{{ vm_template }}"
        hardware:
          num_cpus: "{{ vcpu }}"
          memory_mb: "{{ memory }}"
        networks:
          name: "{{ network }}"
          devices:
            network_adapter:
              type: e1000
              network_name: "{{ network }}"
        customization:
          hostname: "{{ vmname }}"
          domain: "{{ dns_domain }}"
          timezone: "{{ timezone }}"
          ip_settings:
            ip: "{{ ip }}"
            netmask: "{{ netmask }}"
            gateway: "{{ gateway }}"
            dns_servers:
              - "{{ dns_server }}"
          password: "{{ vtp_password }}"
      delegate_to: localhost
