
- name: Test dynamic inventory with OpenStack plugin
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Run ServerList task with OpenStack inventory
      os_server:
        auth:
          auth_url: http://openstack.example.com:5000/v3
          username: ansible
          password: "{{ lookup('file', 'openstack_password.txt') }}"
          project_name: ansible
          project_domain_name: Default
          user_domain_name: Default
        state: present
        name: test_server
        region_name: RegionOne
        image: CentOS
        flavor: m1.small
        key_name: ansible_key
        network: "{{ group_names[0] }}_network"
        security_groups: default
      register: server

    - name: Debug server
      debug:
        var: server
