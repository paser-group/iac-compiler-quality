
- name: Test apt_key module issue with url cert
  hosts: all
  tasks:
    - name: Install self-signed certificate
      copy:
        content: "{{ certificate }}"
        dest: "/etc/ssl/certs/self-signed.crt"
      when: inventory_hostname == 'ubuntu1' or inventory_hostname == 'centos1'

    - name: Add apt repository
      apt_key:
        url: "http://{{ inventory_hostname }}:80/repo_key"
        state: present
        validate_certs: True
        ca_cert: "/etc/ssl/certs/self-signed.crt"
      become: yes
