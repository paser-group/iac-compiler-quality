
- name: Test gcpubsub Connection
  hosts: all
  tasks:
    - name: Install gcpubsub library
      pip:
        name: google-cloud-pubsub
        version: "2.1.0"
    - name: Retrieve messages
      google.pubsub:
        project: "{{ gcp_project }}"
        auth_kind: serviceaccount
        service_account_file: "/path/to/service/account/file.json"
        mode: pull
        subscription: my-subscription
      register: pubsub_output
