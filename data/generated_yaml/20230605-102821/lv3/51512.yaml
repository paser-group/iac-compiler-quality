
- name: Install PowerShell DSC Module       
  win_shell: Install-Module -Name xFailoverCluster -Force
  become: yes

- name: Add Nodes to Cluster       
  win_dsc:
    resource_name: xCluster
    clustername: AnsibleCluster
    nodenames:
      - Node1
      - Node2
    pscredential:
      username: "Domain\\username"
      password: "{{ lookup('file', './password.txt') }}"
  become: yes

- name: Configure Cluster Security Settings
  win_dsc:
    resource_name: xClusterSecuritySettings
    ClusterName: AnsibleCluster
    DnsName: AnsibleCluster
    Credential:
      UserName: "Domain\\username"
      Password: "{{ lookup('file', './password.txt') }}"
  become: yes
