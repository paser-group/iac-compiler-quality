
- hosts: localhost
  gather_facts: no
  tasks:
    - name: Gather VMWare guest data
      vmware_guest:
        hostname: "{{ vmware_host }}"
        username: "{{ vmware_username }}"
        password: "{{ lookup('file', '/path/to/password/file') }}"
        validate_certs: no
        esxi_hostname: "{{ esxi_hostname }}"
        folder: "{{ esxi_folder }}"
        cache_dir: "/etc/ansible/vmware_cache/{{ inventory_hostname }}"
        cache_max_age: "{{ cache_max_age }}"
        GuestNicInfo: yes
        GuestDiskInfo: yes
        hardware_devices: yes
        power_state: yes
      register: vmware_guests
