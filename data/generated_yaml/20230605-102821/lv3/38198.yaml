
- name: Create Azure security group with comma-separated IP address prefixes in the rule
  hosts: localhost
  gather_facts: no
  vars:
    security_group_name: "test-security-group"
    security_rule_name: "test-security-rule"
    source_address_prefix: "10.1.1.1/24, 10.1.1.2/24"
  tasks: 
    - name: Create security group
      azure_rm_securitygroup:
        resource_group: "test-resource-group"
        name: "{{ security_group_name }}"
        location: "eastus"
        state: present
      register: sg

    - name: Create security rule
      azure_rm_securitygroup_rule:
        resource_group: "test-resource-group"
        security_group: "{{ security_group_name }}"
        name: "{{ security_rule_name }}"
        priority: 100
        direction: Inbound
        access: Allow
        protocol: Tcp
        source_address_prefix: "{{ source_address_prefix }}"
