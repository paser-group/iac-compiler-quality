
- name: Install Chocolatey package with enhanced exit codes
  hosts: all
  gather_facts: no
  become: yes
  tasks:
    - name: Install chocolatey package with enhanced exit codes
      win_chocolatey:
        name: "package_name"
        state: latest
        useEnhancedExitCodes: true
        use_oh_my_posh: true
      register: choco_result

    - name: Fail the playbook on errors
      fail:
        msg: "Chocolatey installation failed with error code {{ choco_result.rc }}"
      when: choco_result|failed and choco_result.rc not in [0, 3010]
