
- name: Install Ansible via setup.py
  hosts: localhost
  gather_facts: no
  become: yes

  tasks:
  - name: Install dependencies
    yum:
      name:
        - python3
        - python3-pip
        - python3-setuptools

  - name: Download Ansible
    get_url:
      url: "https://github.com/ansible/ansible/archive/stable-2.10.tar.gz"
      dest: "/tmp/ansible.tar.gz"

  - name: Unpack Ansible archive
    unarchive:
      src: "/tmp/ansible.tar.gz"
      dest: "/tmp/"

  - name: Install Ansible via setup.py
    command: "python3 setup.py install"
    args:
      chdir: "/tmp/ansible-stable-2.10"
    register: result

  - name: Print debug output
    debug:
      var: result

- name: Verify Ansible installation on remote nodes
  hosts: all
  gather_facts: no
  become: yes

  tasks:
  - name: Ping remote nodes
    ping:

  - name: Execute a command on remote nodes
    command: "echo 'Hello Ansible'"
