
---
- name: Create port group and duplicate the port group
  hosts: localhost
  gather_facts: no
  
  tasks:
  - name: Create port group
    vmware_portgroup:
      hostname: "{{ vcenter_hostname }}"
      username: "{{ vcenter_username }}"
      password: "{{ vcenter_password }}"
      datacenter_name: "{{ datacenter_name }}"
      cluster_name: "{{ cluster_name }}"
      vswitch_name: "{{ vswitch_name }}"
      portgroup_name: "{{ portgroup_name }}"
      state: present
    register: result

  - name: Create duplicate port group to trigger idempotency issue
    vmware_portgroup:
      hostname: "{{ vcenter_hostname }}"
      username: "{{ vcenter_username }}"
      password: "{{ vcenter_password }}"
      datacenter_name: "{{ datacenter_name }}"
      cluster_name: "{{ cluster_name }}"
      vswitch_name: "{{ vswitch_name }}"
      portgroup_name: "{{ portgroup_name }}"
      state: present
