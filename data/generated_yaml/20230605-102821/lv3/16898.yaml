
- name: Add nodes to the inventory file
  hosts: localhost
  connection: local
  gather_facts: no
  gather_subset: "!all"
  tasks:
    - add_host:
        name: "{{ item }}"
        ansible_host: "{{ hostvars[item].ansible_host }}"
        ansible_user: "{{ hostvars[item].ansible_user }}"
        ansible_ssh_private_key_file: "{{ hostvars[item].ansible_ssh_private_key_file }}"
      with_items:
        - "ubuntu1"
        - "alpine1"
        - "centos1"
        - "redhat1"

- name: Call local_action before a play that does not target localhost 
  hosts: all
  tasks:
    - name: Execute a local action
      local_action: shell echo "this is a local_action"
    - name: Execute a command that should be run on a specific node
      shell: echo "this should be run on a specific node"
      delegate_to: "{{ item }}"
      with_items:
        - "ubuntu1"
        - "alpine1"
        - "centos1"
        - "redhat1"

- name: Play that targets localhost
  hosts: localhost
  connection: local
  gather_facts: no
  gather_subset: "!all"
  tasks:
    - name: Execute a command on localhost
      command: echo "this is being executed on localhost"
