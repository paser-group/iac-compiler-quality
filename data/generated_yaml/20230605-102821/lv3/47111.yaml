
- name: Deploy Azure Resource Manager template
  hosts: localhost
  
  vars:
    resource_group: 'my-resource-group'
    location: 'eastus'
    template_path: '/path/to/azuredeploy.json'
    parameters_path: '/path/to/azuredeploy.parameters.json'
  
  tasks:
    - name: Create Azure Resource Group
      azure_rm_resourcegroup:
        name: "{{ resource_group }}"
        location: "{{ location }}"
      register: rg
  
    - name: Deploy Template
      azure_rm_deployment:
        resource_group_name: "{{ resource_group }}"
        template: "{{ lookup('file', template_path) }}"
        parameters: "{{ lookup('file', parameters_path) }}"
        mode: incremental
        state: present
        retries: 3
