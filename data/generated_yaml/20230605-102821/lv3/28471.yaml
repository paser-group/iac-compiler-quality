
- name: Create new VM
  vmware_guest:
    hostname: vcenter.example.com
    username: administrator@vsphere.local
    password: password
    validate_certs: False
    name: test_vm
    template: template_name
    folder: ansible-folder
    hardware:
      memory_mb: 1024
      num_cpus: 2
      scsi: paravirtual
      devices:
        - type: network
          network_name: node-net
    networks:
      - name: node-net
        ip: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
        netmask: 255.255.255.0
        gateway: 10.1.1.254
        type: static
        device_type: vmxnet3
        device_name: nic0
    state: poweredon
    wait_for_ip_address: True
    customization_spec: specs_name
  register: vm

- debug:
    var: vm
