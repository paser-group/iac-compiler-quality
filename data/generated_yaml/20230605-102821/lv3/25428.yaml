yaml
- name: Create S3 bucket policy with IAM principle
  hosts: localhost
  gather_facts: no

  vars:
    s3_bucket_name: "your-bucket-name"
    iam_principal: "arn:aws:iam::123456789012:role/MyRole"

  tasks:
    - name: Set bucket policy with IAM principle
      s3_bucket_policy:
        bucket: "{{ s3_bucket_name }}"
        policy:
          Version: "2012-10-17"
          Statement:
            - Sid: "ListObjects"
              Effect: "Allow"
              Principal:
                AWS: "{{ iam_principal }}"
              Action:
                - "s3:ListBucket"
              Resource: "arn:aws:s3:::{{ s3_bucket_name }}/*"
            - Sid: "GetObjects"
              Effect: "Allow"
              Principal:
                AWS: "{{ iam_principal }}"
              Action:
                - "s3:GetObject"
              Resource: "arn:aws:s3:::{{ s3_bucket_name }}/*"
