
- name: Take snapshot of non-existent VM 
  hosts: localhost 
  connection: local 
  vars:
    uuid: "7ce4dd4d-8f98-4fbd-a60b-449407608b32"
    snapshot_name: "test_snapshot"
  tasks:
    - name: Snapshot virtual machine
      vmware_guest_snapshot:
        hostname: "vcenter.example.com"
        username: "user"
        password: "password"
        folder: "/"
        name: "{{ uuid }}"
        snapshot_name: "{{ snapshot_name }}"
      register: result
      ignore_errors: yes
    - fail:
        msg: "Snapshotting '{{ uuid }}' has failed with error '{{ result.msg }}'"
      when: "'Failed to apply snapshot' in result.msg"
