
- name: Sudo without -u option
  hosts: all
  become: yes

  tasks:
  - name: Run command without -u option
    shell: "sudo su - oracle"
    register: result
    async: 45
    poll: 5

  - name: Wait for task to complete
    async_status:
      jid: "{{ result.ansible_job_id }}"
    register: job_result
    until: job_result.finished
    retries: 10
    delay: 5
