
- name: Group hosts using group_by module
  hosts: all
  tasks:
    - name: Add variables for each host
      add_host:
        name: "{{ item }}"
        groups: "{{ item.split('.')[0] }}"
        ansible_host: "{{ item }}"
      with_items:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3
        - 10.1.1.4
    
    - name: Group the hosts
      group_by:
        key: "{{ hostvars[item].groups }}_group"
      with_items: "{{ ansible_play_hosts }}"
    
    - name: Debug the host variables
      debug:
        var: hostvars[item]
      with_items: "{{ ansible_play_hosts }}"
