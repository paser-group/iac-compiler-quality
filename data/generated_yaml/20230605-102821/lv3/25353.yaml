
- name: Reboot VM
  hosts: all
  gather_facts: no
  become: yes

  vars:
    vmware_host: "localhost"
    vmware_username: "username"
    vmware_password: "password"
    vmware_vm_name: "vm_01"

  tasks:
  - name: Restart the VM
    vmware_guest:
      hostname: "{{ vmware_host }}"
      username: "{{ vmware_username }}"
      password: "{{ vmware_password }}"
      validate_certs: no
      name: "{{ vmware_vm_name }}"
      state: restarted
  - name: Wait for reboot
    wait_for:
      host: "{{ vmware_vm_name }}"
      port: 22
      state: started
      delay: 30
      timeout: 300
