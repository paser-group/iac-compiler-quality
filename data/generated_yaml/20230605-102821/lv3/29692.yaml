
- name: Create an EC2 Instance without Image ID
  hosts: localhost
  gather_facts: no

  vars:
    aws_access_key: <your aws_access_key>
    aws_secret_key: <your aws_secret_key>
    region: <your region>

  tasks:
    - name: Launch an EC2 instance
      ec2:
        region: "{{ region }}"
        instance_type: t2.micro
        key_name: "my-key-name"
        count: 1
        vpc_subnet_id: "subnet-xxxx"
        group: "sg-xxxx"
        instance_tags:
          Name: "my-instance-name"

# Next task
- name: Display EC2 instances
  hosts: localhost
  gather_facts: no

  vars:
    aws_access_key: <your aws_access_key>
    aws_secret_key: <your aws_secret_key>
    region: <your region>

  tasks:
    - name: Display all instances
      ec2_instance_facts:
        region: "{{ region }}"
        filters:
          "tag:Name": "my-instance-name"
      register: ec2_facts_result

    - name: debug launched EC2 instance without image id
      debug:
        var: ec2_facts_result.instances
