
- hosts: all
  gather_facts: yes
  tasks:
    - name: Install dependencies
      yum:
        name:
          - "{{ item }}"
        state: present
      loop:
        - epel-release
        - python-pip
        - gcc
        - python-devel
      become: true

    - name: Create nested tasks directory and file
      file:
        path: "/opt/ansible_test/nested_tasks/"
        state: directory
      become: true

    - name: Add content to nested file
      copy:
        content: This is a test file
        dest: "/opt/ansible_test/nested_tasks/nested_file"
      become: true

    - name: Execute nested task
      include_tasks: "{{ lookup('template', 'nested_tasks/nested_task.yml.j2') }}"
