
- name: Launch EC2 Instances
  hosts: localhost
  gather_facts: no
  vars:
    instance_type: t2.micro
    image: ami-0c55b159cbfafe1f0
    instance_name: "{{ ec2_name }}"
    region: "{{ ec2_region }}"
    state: present
    count: "{{ ec2_count }}"

  tasks:
    - name: Launch EC2
      ec2:
        key_name: "{{ ec2_keypair }}"
        instance_type: "{{ instance_type }}"
        image: "{{ image }}"
        wait: true
        region: "{{ region }}"
        group: "{{ ec2_security_group }}"
        count: "{{ count }}"
        instance_tags:
          Name: "{{ instance_name }}"
          State: "{{ state }}"
      register: ec2_launch

    - name: Debug Output
      debug:
        var: ec2_launch.instances
