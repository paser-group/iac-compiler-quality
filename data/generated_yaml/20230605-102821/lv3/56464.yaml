
- hosts: all
  tasks:
  - name: Create a sample file in /tmp
    file:
      path: /tmp/{{ item }}.txt
      state: touch
    with_items:
    - ubuntu1
    - alpine1
    - centos1
    - redhat1
    register: files_created

  - name: Fail at random
    debug:
      msg: "Failing randomly"
    failed_when: "item.changed and (item.stdout_lines[0] is undefined or item.stdout_lines[0] is not match('^warning'))"
    with_items:
    - "{{ files_created.results }}"
