
---
- name: Check disk space on hosts
  hosts: all
  become: yes
  gather_facts: yes

  tasks:
  - name: Display available disk space
    shell: df -h .
    register: disk_status

  - name: Fail if disk size limit reached
    fail:
      msg: "Disk size limit reached on {{ inventory_hostname }}"
    when: disk_status.stdout_lines[1].split()[4] | int >= 90
