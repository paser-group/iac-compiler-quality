
- name: Install open-iscsi and set default port
  hosts: all
  become: true
  vars:
    iscsi_port: 3260    # default port as integer
  tasks:
    - name: Install open-iscsi
      apt:
        name: open-iscsi
        state: latest
    - name: Configure open-iscsi default port
      lineinfile:
        path: /etc/iscsi/iscsid.conf
        regexp: '^node.conn\[0\].port = '
        line: 'node.conn[0].port = "{{ iscsi_port }}"'
