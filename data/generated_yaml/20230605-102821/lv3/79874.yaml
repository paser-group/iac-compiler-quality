
- name: Demonstrate Ansible Compiler Bug
  hosts: all
  gather_facts: no

  vars:
    var: "foo.bar"
    foo:
      bar:
        baz: ""

  tasks:
    - name: Set a variable with conflicting type definition
      set_fact:
        foo: "{{ { bar: foo.bar.baz } }}"

    - name: Print the value of the nested variable
      debug:
        var: "{{ var }}"

    - name: Check if the variable is defined
      debug:
        msg: "'{{ var }}' is defined."
      when: var is defined

    - name: Check if the nested variable is defined
      debug:
        msg: "'{{ var }}.baz' is defined."
      when: var.baz is defined
