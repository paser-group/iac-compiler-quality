
- name: Replicate Linode inventory plugin access_token issue
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Set API key as an environment variable
      set_fact:
        linode_access_token: "{{ lookup('env', 'LINODE_API_KEY') }}"

    - name: Configure Linode inventory plugin
      linode:
        access_token: "{{ linode_access_token }}"
        cache_max_age: 604800
        cache_path: ~/.ansible/tmp/ansible-linode-inventory.cache
        group_by_region: true
        internet_accessible: false
        localhost_is_private: false
        no_rebuild_cache: false
        region: us-east
      delegate_to: localhost
