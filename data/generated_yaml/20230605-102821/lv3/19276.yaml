
- name: Test EC2 module
  hosts: localhost
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Run EC2 module with incorrect credentials
      ec2_instance_info:
        aws_access_key: 'INVALID_ACCESS_KEY'
        aws_secret_key: 'INVALID_SECRET_KEY'
        region: 'us-west-2'
      register: ec2_instance_output
      ignore_errors: true

    - name: Fail task if ec2_instance_output fails
      fail:
        msg: 'EC2 module failed to execute'
      when: ec2_instance_output is failed
