
- name: Run shell command
  hosts: all
  gather_facts: no
  tasks:
    - name: Execute shell command that logs entire command in case of failure
      shell: "echo {{sensitive_information}} >> sensitive_log.txt"
      register: shell_output
      ignore_errors: yes
    - name: Check if shell command failed
      fail:
        msg: "Shell command failed with output: {{shell_output.stdout}}"
      when: shell_output.rc != 0
