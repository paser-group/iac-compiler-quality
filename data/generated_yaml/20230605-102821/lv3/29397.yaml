
- hosts: all
  become: yes
  gather_facts: no
  tasks:
  - name: create s3 bucket
    s3_bucket:
      name: my-bucket
      region: us-west-2
      access_key: "{{ aws_access_key_id }}"
      secret_key: "{{ aws_secret_access_key }}"
    register: create_bucket_result

  - name: create s3 bucket again
    s3_bucket:
      name: my-bucket
      region: us-west-2
      access_key: "{{ aws_access_key_id }}"
      secret_key: "{{ aws_secret_access_key }}"
    register: create_bucket_again_result
    ignore_errors: yes

  - assert:
      that:
        - "'Your previous request to create the named bucket succeeded and you already own it' in create_bucket_again_result.msg"
