
- name: Connect to Cisco IOS device
  hosts: cisco_device
  gather_facts: no
  connection: local
  vars:
    ansible_connection: network_cli
    ansible_network_os: ios
    ansible_become_method: enable
  tasks:
    - name: Issue command using pubkey authentication
      ios_command:
        commands: 
          - show version 
        transport: ssh 
        provider: 
          host: "{{ inventory_hostname }}"
          username: "{{ ansible_user }}"
          password: "{{ lookup('file', 'vault/ios_password.txt') }}"
          authorize: true
          auth_pass: "{{ lookup('file', 'vault/ios_enable_password.txt') }}"
          ssh_keyfile: /home/ansible/.ssh/id_rsa.pub
      register: command_output
