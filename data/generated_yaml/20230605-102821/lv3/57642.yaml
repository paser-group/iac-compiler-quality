
- name: Gather information about the virtual machines in the vCenter inventory and print their names
  hosts: localhost
  gather_facts: no
  vars:
    vcenter_server: "vcenter.example.com"
    vcenter_username: "username"
    vcenter_password: "password"
  tasks:
    - name: Gather information about the virtual machines in the vCenter inventory and print their names
      vmware_vm_inventory:
        hostname: "{{ vcenter_server }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
      register: vm_inventory
      
    - name: Print the VMs in the vCenter Inventory
      debug:
        msg: "{{ item.name }}"
      with_items: "{{ vm_inventory.virtual_machines }}"

    - name: Try to remove orphaned virtual machine
      vmware_guest:
        hostname: "{{ vcenter_server }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        name: "orphaned_vm"
        state: absent
