
- name: create snapshot of VM
  vmware_guest_snapshot:
    hostname: "{{ inventory_hostname }}"
    username: "{{ vault_vmware_username }}"
    password: "{{ vault_vmware_password }}"
    virtualmachine: "{{ vm_name }}"
    name: "{{ snapshot_name }}"
  register: snapshot_result

- name: assert snapshot creation idempotency
  assert:
    that: snapshot_result.changed == False
    msg: "Snapshot creation not idempotent"
