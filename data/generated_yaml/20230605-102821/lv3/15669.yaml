
- name: Test WinRM connection with Kerberos authentication
  hosts: windows-machines
  gather_facts: no
  vars:
    ansible_connection: winrm
    ansible_winrm_transport: kerberos
    ansible_winrm_scheme: https
    ansible_winrm_port: 5986
    ansible_winrm_server_cert_validation: ignore
    ansible_user: <domain\username>
    ansible_password: '<path_to_password_file>'
  tasks:
  - name: Test WinRM connection
    win_ping:
  
  - name: Assert connection is authenticated with Kerberos
    win_shell: 'echo %KerbAuthLevel%'
    register: result

  - name: Debug output
    debug:
      var: result.stdout_lines
