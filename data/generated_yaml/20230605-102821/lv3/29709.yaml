
---
- hosts: localhost
  connection: local
  tasks:
    - name: Create VM on Azure
      azure_rm_virtualmachine:
        resource_group: myResourceGroup
        name: myVM
        vm_size: Standard_B1s
        admin_username: azureuser
        admin_password: Password123!
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: "16.04.0-LTS"
          version: latest
        network_interfaces:
          - name: nic1
            primary: True
            subnet_name: "mySubnet" # Error caused by this parameter
        storage_account_name: mystorageaccount
        os_disk_name: myosdisk
        os_disk_caching: ReadWrite
        os_disk_create_option: FromImage
        data_disks:
          - name: mydatadisk
            lun: 0
            disk_size_gb: 10
            caching: None
            create_option: Empty
      register: vm

    - debug:
        var: vm
