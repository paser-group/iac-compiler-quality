yaml
- name: Test SSH Connection
  hosts: all
  gather_facts: no
  tasks:
    - name: Test SSH connectivity
      wait_for:
        port: 22
        host: "{{ inventory_hostname }}"
        search_regex: OpenSSH
        state: started
      ignore_errors: yes
      register: ssh_result

    - debug:
        var: ssh_result.stdout_lines
      when: ssh_result|failed
