
- name: Export Virtual Machine to OVF
  hosts: localhost
  gather_facts: no
  vars:
    vmware_host: <HOST_IP>
    vmware_user: <VMWARE_USERNAME>
    vmware_password: <VMWARE_PASSWORD>
    vmware_validate_certs: no
    ovf_export_directory: ./outputs
    ovf_export_name: exported-vm

  tasks:
  - name: Connect to VMware vCenter
    vmware_guest:
      hostname: "{{ vmware_host }}"
      username: "{{ vmware_user }}"
      password: "{{ vmware_password }}"
      validate_certs: "{{ vmware_validate_certs }}"
      vm_name: <VM_NAME>
      state: present

  - name: Export OVF
    vmware_ovf_export:
      hostname: "{{ vmware_host }}"
      username: "{{ vmware_user }}"
      password: "{{ vmware_password }}"
      validate_certs: "{{ vmware_validate_certs }}"
      ovf_directory: "{{ ovf_export_directory }}"
      ovf_name: "{{ ovf_export_name }}"
      vm_id: <VM_ID>
      disk_format: ovf
