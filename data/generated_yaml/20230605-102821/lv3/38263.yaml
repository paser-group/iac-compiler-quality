
- name: Create a new VM on VMware
  hosts: localhost
  gather_facts: no

  vars:
    vmware_user: "administrator@vsphere.local"
    vmware_password: "{{ lookup('file', '/path/to/vmware_password_file') }}"
    vmware_host: "vcenter.example.com"
    vmware_datastore: "datastore1"
    vmware_network: "VM Network"
    vmware_guest_name: "new_vm"
    vmware_guest_num_cpus: "2"
    vmware_guest_memory_mb: "4096"
    vmware_guest_disk_size_gb: "100"

  tasks:
  - name: Create a new VM on VMware
    vmware_guest:
      hostname: "{{ vmware_host }}"
      username: "{{ vmware_user }}"
      password: "{{ vmware_password }}"
      validate_certs: no
      name: "{{ vmware_guest_name }}"
      datacenter: "DC1"
      datastore: "{{ vmware_datastore }}"
      folder: "/Datacenters/DC1/vm/"
      cluster: "Cluster1"
      network_labels:
        - "{{ vmware_network }}"
      num_cpus: "{{ vmware_guest_num_cpus }}"
      memory_mb: "{{ vmware_guest_memory_mb }}"
      disk:
        - size_gb: "{{ vmware_guest_disk_size_gb }}"
          type: thin
          datastore: "{{ vmware_datastore }}"
      state: poweredon
    delegate_to: localhost
