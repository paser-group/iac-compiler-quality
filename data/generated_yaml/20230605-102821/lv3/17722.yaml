
- name: Test playbook
  hosts: all
  gather_facts: false
  vars:
      user: "{{ ansible_user }}"
      cmds:
          - whoami
          - pwd
  tasks:
      - name: Run tests
        shell: "{{ item }} && echo successful || echo failed"
        with_items: "{{ cmds }}"
        register: test_output
        become: true
        become_user: "{{ user }}"
      - name: Print test output
        debug: var=test_output
