
- name: Edit lineinfile
  hosts: all
  gather_facts: false
  tasks:
    - name: Replace line in file
      lineinfile:
        path: /etc/hosts
        regexp: '^127.0.0.1.*'
        line: '127.0.0.1 {{ ansible_hostname }}'
        validate: 'echo "Simulating validation error"; exit 1;'
      register: result
    - debug:
        var: result
