
- name: Create EC2 VPC Subnet
  hosts: localhost
  connection: local
  gather_facts: False
  become: yes

  vars:
    vpc_id: "vpc-12345678"
    cidr_block: "192.168.1.0/24"
    az: "{{ ['us-west-2a', 'us-west-2b', 'us-west-2c'] | random }}"

  tasks:
    - name: Create subnet
      ec2_vpc_subnet:
        state: present
        vpc_id: "{{ vpc_id }}"
        cidr_block: "{{ cidr_block }}"
        region: us-west-2
        availability_zone: "{{ az }}"
      register: result

    - name: Debug
      debug:
        var: result

