
- hosts: all
  vars:
    azure_user: <your_azure_username>
    azure_password: <your_azure_password>
    azure_subscription_id: <your_azure_subscription_id>
    azure_tenant: <your_azure_tenant>
    azure_resource_group: <your_resource_group_name>
    azure_storage_account_name: <your_storage_account_name>
  tasks:
    - name: Ensure a new Azure Storage Account is created with Public Access Disabled
      azure_rm_storageaccount:
        resource_group: "{{ azure_resource_group }}"
        storage_account_name: "{{ azure_storage_account_name }}"
        kind: BlobStorage
        sku_name: Standard_LRS
        access_tier: Cool
        enable_https_traffic_only: true
        allow_blob_public_access: false
        validate_certs: yes
        state: present
      register: storage_account_result

    - name: Debug Storage Account Creation Output
      debug:
        var: storage_account_result
