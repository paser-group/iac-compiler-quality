
- name: Remove VTP password
  nxos_vtp_password:
    password: ""
    state: absent
  register: result

- name: Set VTP password if not exists
  nxos_vtp_password:
    password: "password"
    state: present
  when: "'failed to remove vtp password' in result.stderr"

- name: Configure VLAN
  nxos_vlan:
    vlan_id: 123
    name: test_vlan
    state: present
    vlan_provider: "{{ inventory_hostname }}"
