
- name: Test Proxy Connection with Certificate Verification
  hosts: all
  tasks:
    - name: Ping hosts with proxy
      ping:
      environment:
        HTTPS_PROXY: "http://<proxy_server>"
        HTTPS_PROXY_AUTH: "<proxy_user>:<proxy_password>"
        REQUESTS_CA_BUNDLE: "/etc/ssl/certs/ca-certificates.crt"
        ANSIBLE_REMOTE_USER: "<remote_user>"
      # For self-signed certs
      vars:
        ansible_connection: ssh
        ansible_ssh_extra_args: '-o VerifyHostKeyDNS=no'
