
- name: Backup files to S3 bucket using fakes3 protocol
  hosts: localhost
  vars:
    bucket_name: "my.bucket.name.with.dots"
    s3_endpoint: "http://10.1.1.5:4569/"
  tasks:
    - name: Sync local directory with s3 bucket
      s3_sync:
        bucket: "{{ bucket_name }}"
        local_dir: /path/to/local/directory
        delete: yes
        endpoint_url: "{{ s3_endpoint }}"
        protocol: fakes3
        mode: push
