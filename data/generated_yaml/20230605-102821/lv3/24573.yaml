
- hosts: all
  gather_facts: no
  tasks:
    - name: Ensure Boto module is not present in the system
      command: pip uninstall boto -y

    - name: Test IAM Cert module with missing Boto module
      iam_cert:
        region: us-west-2
        mode: create
        cert_path: /tmp/cert_path
        key_path: /tmp/key_path
        cn: test.example.com
        version: "{{ boto_version }}"
      register: iam_cert_output
      environment:
        AWS_ACCESS_KEY_ID: "{{ iam_access_key }}"
        AWS_SECRET_ACCESS_KEY: "{{ iam_secret_key }}"
        AWS_REGION: "{{ region }}"
      ignore_errors: true

  vars:
    boto_version: "1.1.4"
    iam_access_key: "ACCESS_KEY"
    iam_secret_key: "SECRET_KEY"
    region: "us-west-2"
