
- name: Test Connection Refused Error
  hosts: all
  gather_facts: no

  tasks:
    - name: Wait for TCP connection to fail
      wait_for:
        host: 10.1.1.5
        port: 5000
        state: stopped
        timeout: 10
        delay: 5
        active_connection_states: SYN_SENT

    - name: Execute iam_policy.py
      shell: python3 /path/to/iam_policy.py
      delegate_to: localhost
