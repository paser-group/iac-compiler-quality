
---
- name: Configure UFW on all hosts
  hosts: all
  become: yes
  gather_facts: no

  tasks:
  - name: Install UFW
    apt:
      name: ufw

  - name: Configure UFW rules
    ufw:
      rule: allow
      # Incorrect path used in the original issue
      src: '{{ hostvars[inventory_hostname]["ansible_default_ipv4"]["address"] }}'
      port: 22
      comment: "Allow SSH from {{ inventory_hostname }}"
    become: yes
