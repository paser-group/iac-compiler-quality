
- hosts: all
  gather_facts: no

  vars:
    empty_list: []

  tasks:
    - set_fact:
        sub_hosts: "{{ empty_list | default(groups['all']) }}"

    - include: tasks1.yml
      when: sub_hosts

    - include: tasks2.yml
      when: sub_hosts

    - include: tasks3.yml
      when: sub_hosts

- hosts: "{{ sub_hosts }}"
  gather_facts: no

  tasks:
    - debug:
        msg: "Running tasks on {{ inventory_hostname }}"
