
- name: Change user password
  hosts: all
  become: true
  vars:
    username: "testuser"
    new_password: "newpass"
  tasks:
    - name: Update user password
      user:
        name: "{{ username }}"
        password: "{{ new_password }}"
    - name: Check if password is updated
      shell: "sudo grep {{ new_password }} /etc/shadow"
      register: result
      ignore_errors: yes
    - name: Display output
      debug:
        var: result.stderr_lines
