
- name: Test ansible_service_mgr fact for sysvinit issue
  hosts: all
  tasks:
  - name: Check ansible_service_mgr fact for sysvinit
    shell: echo {{ansible_service_mgr}}
    register: service_mgr_fact
    when: ansible_service_mgr == 'sysvinit' and ansible_distribution == 'Ubuntu'
  - name: Stop service using systemd
    systemd:
      name: ssh
      state: stopped
    become: true
    when: service_mgr_fact.changed
