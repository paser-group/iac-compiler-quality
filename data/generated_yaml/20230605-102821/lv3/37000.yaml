
- name: Delete powered on VM in vSphere
  hosts: all
  gather_facts: no
  vars:
    ansible_ssh_private_key_file: /var/tmp/key_I.pem
    ansible_become_password_file: "{{ lookup('file', '/path/to/password/file') }}"
  tasks:
  - name: Delete powered on VM
    vmware_guest:
      hostname: vcenter.example.com
      username: administrator@vsphere.local
      password: "{{ ansible_become_password }}"
      datacenter: Datacenter
      name: my_vm
      state: absent
      force_delete: yes
      force_delete_powered_on: yes
