
- name: Test Scoped Block with Default Variables
  hosts: all
  gather_facts: false
  become: true
  tasks:
    - name: This block uses a scoped variable
      block:
        - name: Command 1
          debug:
            msg: Inside scoped block
        - name: Command 2
          debug:
            msg: Inside scoped block
        - name: Command 3
          debug:
            msg: Inside scoped block
        - name: Set the scoped value
          set_fact:
            scoped_variable: true
      vars:
        scoped_variable: false
    - name: This block should not have access to the scoped variable
      block:
        - name: Command 4
          debug:
            msg: Outside scoped block
        - name: Command 5
          debug:
            msg: Outside scoped block
        - name: Command 6
          debug:
            msg: Outside scoped block
        - name: Check if the scoped variable value changed
          debug:
            msg: "{{ scoped_variable }}"
      when: scoped_variable == true
