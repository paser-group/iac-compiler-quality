
- hosts: all
  gather_facts: false
  tasks:
    - set_fact:
        my_fact: "initial_value"
      run_once: true
      async: 30
      poll: 0
    - async_status:
        jid: "{{ item.ansible_job_id }}"
      loop: "{{ ansible_play_batch }}"
      register: jid_result
    - debug:
        msg: "{{ my_fact }}"
      run_once: true
      when: "'all' in jid_result.finished[0].item and jid_result.finished[0].item.index('all') == 0"
