
- name: Launch instance on GCE
  hosts: localhost
  gather_facts: false
  vars:
    service_account_email: "fake-email@fake.com"
  tasks:
    - name: Create instance
      google.cloud.gcompute:
        name: test-instance
        zone: us-central1-a
        machine_type: n1-standard-1
        image_family: ubuntu-minimal-2004-lts
        service_account_email: "{{ service_account_email }}"
        project: "fake-project"
      register: instance

    - name: Ping instance
      ping:
      delegate_to: "{{ instance.name }}"
