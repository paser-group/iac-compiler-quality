
---
- name: Test for vmware_guest mem_reservation bug
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create virtual machine
      vmware_guest:
        name: test_vm
        state: present
        hardware:
          memory_mb: 2048
          num_cpus: 2
        datastore: datastore1
        network_interfaces:
          - network_label: VM Network
            power_on: yes
        disk:
          - size_gb: 20
            type: thin
        folder: /TestFolder
        mem_reservation: 0
      register: vm_settings

    - name: Verify mem_reservation value
      assert:
        that: vm_settings.mem_reservation == 0
