
- name: Test apt_key module
  hosts: all
  gather_facts: no

  tasks:
    - name: Add GPG key from URL with certificate
      apt_key:
        url: "https://{{hostvars[item]['ansible_hostname']}}/gpg-key.asc"
        state: present
        validate_certs: no
      when: "'ubuntu1' in inventory_hostname"

    - name: Add GPG key with invalid URL
      apt_key:
        url: "htps://invalid-url.com/gpg-key.asc"
        state: present
      when: "'alpine1' in inventory_hostname"

    - name: Add GPG key from non-existent URL
      apt_key:
        url: "https://non-existent-url.com/gpg-key.asc"
        state: present
      when: "'centos1' in inventory_hostname"

    - name: Remove a non-existent GPG key
      apt_key:
        id: "ABCDEF01"
        state: absent
      when: "'redhat1' in inventory_hostname"

    - name: Add GPG key with invalid state
      apt_key:
        url: "https://{{hostvars[item]['ansible_hostname']}}/gpg-key.asc"
        state: invalid_state
      when: "'ubuntu1' in inventory_hostname"
