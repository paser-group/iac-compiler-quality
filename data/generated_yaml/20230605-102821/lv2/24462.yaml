
- name: Test playbook for become prompt not recognized issue
  hosts: all
  gather_facts: false

  tasks:
  - name: Sudo with correct password
    shell: echo '{{ansible_become_pass}}' | sudo -S apt-get update
    become: true

  - name: Sudo with incorrect user
    shell: echo '{{ansible_become_pass}}' | sudo -S apt-get update
    become: true
    become_user: invalid_user

  - name: Invalid become_prompt input
    shell: echo '{{ansible_become_pass}}' | sudo -S apt-get update
    become: true
    become_method: sudo
    become_prompt: 'Please enter the password:'

  - name: Valid become_prompt input
    shell: echo '{{ansible_become_pass}}' | sudo -S apt-get update
    become: true
    become_method: sudo
    become_prompt: '[sudo] password for user:'
