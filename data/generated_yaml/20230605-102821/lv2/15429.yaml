
- name: Test copy module with_items
  hosts: all
  gather_facts: no

  tasks:
  - name: Include nested file
    include: "{{ item }}"
    with_items:
      - "{{ playbook_dir }}/files/file1.txt"
      - "{{ playbook_dir }}/files/file2.txt"

  - name: Copy files with incorrect item variable
    copy:
      src: "{{ item }}"
      dest: "/tmp/{{ item.basename }}_{{ index }}.txt"
    with_items:
      - "{{ playbook_dir }}/files/file1.txt"
      - "{{ playbook_dir }}/files/file2.txt"
    loop_control:
      index_var: "index"
