
- name: Test SSH Connection
  hosts: all
  gather_facts: false
  tasks:
    - name: Test connection with invalid user
      command: ssh -o StrictHostKeyChecking=no -o BatchMode=yes -o ConnectTimeout=5 invaliduser@{{ inventory_hostname }}
      register: output
      ignore_errors: yes

    - name: Assert failed connections
      assert:
        that:
          - "'Permission denied' in output.stderr"
          - "'Name or service not known' in output.stderr"
          - "'Bad hostname' in output.stderr"
      ignore_errors: yes
