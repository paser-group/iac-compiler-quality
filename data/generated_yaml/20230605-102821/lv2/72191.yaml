yaml
- name: Test SSH connection with host key checking
  hosts: all
  gather_facts: false
  tasks:
  - name: Add host key to known hosts file
    known_hosts:
      name: "ubuntu1"
      key: "{{ lookup('pipe', 'ssh-keyscan -t rsa ubuntu1') }}"
      path: "/root/.ssh/known_hosts"
