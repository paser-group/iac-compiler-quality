
- name: Allocate Memory & Stress Test
  hosts: all
  become: true
  gather_facts: false

  tasks:
  - name: Allocate Large Blocks of Memory
    shell: "dd if=/dev/zero of=/tmp/test bs=1M count=2048"

  - name: Display Output of 'top' in a Loop to Ensure No Failures
    shell: "for i in `seq 1 100`; do top -b -n 1 | head -20 >> /tmp/output ; done"

  - name: Free Memory Resources
    shell: "rm /tmp/test"
