
---
- name: foreman authentication errors test playbook
  hosts: all
  become: true
  tasks:
    - name: install foreman plugin
      apt:
        name: python-foreman
        state: latest
        update_cache: yes
    - name: authenticate with foreman
      foreman_callback:
        foreman_host: "https://foreman.example.com/"
        username: "{{vault_username}}"
        password: "{{lookup('file', '/root/.ansible/vault_password_file')}}"
        client_cert: "/etc/pki/tls/cert.pem"
        client_key: "/etc/pki/tls/key.pem"
        cacert: "/etc/pki/tls/certs/ca-bundle.crt"
    - name: add hosts to foreman
      foreman:
        foreman_host: "https://foreman.example.com/"
        username: "{{vault_username}}"
        password: "{{lookup('file', '/root/.ansible/vault_password_file')}}"
        hostname: "{{inventory_hostname}}"
        organization: Default_ORG
