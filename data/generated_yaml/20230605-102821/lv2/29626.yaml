
- hosts: all
  gather_facts: false
  vars:
    mount_dir: /mnt/nfs-share
    nfs_server: 10.0.0.1
    nfs_share_name: nfs-share
  tasks:
    - name: Ensure mount directory exists
      file:
        path: "{{ mount_dir }}"
        state: directory
    - name: Mount NFS share
      mount:
        path: "{{ mount_dir }}"
        src: "{{ nfs_server }}:/{{ nfs_share_name }}"
        fstype: nfs
        opts: "hard,intr,rsize=32768,wsize=32768,noauto"
        state: mounted
      notify:
        - Check mount status
    - name: Delete mount directory
      file:
        path: "{{ mount_dir }}"
        state: absent
  handlers:
    - name: Check mount status
      shell: |
        grep -qs "{{ mount_dir }}" /proc/mounts
        if [ $? -ne 0 ]; then
          echo "Mount failed"
          exit 1
        fi
      ignore_errors: yes
