
- name: IOS Config Stress Test
  hosts: ios_devices
  gather_facts: no

  tasks:
    - name: Send malformed command to IOS device
      ios_command:
        commands:
          - enable
          - configure typo
          - exit
        provider:
          username: "{{ username }}"
          password: "{{ password }}"
          host: "{{ inventory_hostname }}"
        register: result
      ignore_errors: yes

    - name: Fail the playbook if the command above returns success
      fail:
        msg: "ios_config module incorrectly claims success when commands fail"
      when: result|success
