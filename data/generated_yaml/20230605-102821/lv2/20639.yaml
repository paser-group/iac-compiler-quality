
- name: Stress test Ansible compiler with vSphere guest
  hosts: all
  gather_facts: no

  tasks:
    - name: Create a new vSphere Guest VM
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        login: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        datacenter: "{{ datacenter_name }}"
        folder: "/"
        name: "{{ vmname }}"
        state: poweredon
        template: "{{ template }}"
        hardware:
          memory_mb: "{{ hostvars['localhost']['ansible_facts']['free_memory_mb']*4 }}"
          num_cpus: "{{ hostvars['localhost']['ansible_processor_vcpus'] }}"
          scsi: paravirtual
