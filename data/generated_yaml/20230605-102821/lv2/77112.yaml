
- name: Install and check KubeVirt module
  hosts: all
  gather_facts: no
  become: yes
  tasks:
    - name: Install KubeVirt module
      shell: apt-get install kubevirt
    - name: Verify KubeVirt installation
      assert:
        that: "'Could not find imported module support code' not in output"
        fail_msg: "KubeVirt module installation failed"
        success_msg: "KubeVirt module installed successfully"
      register: result
    - name: Uninstall KubeVirt module
      shell: apt-get remove kubevirt
    - name: Verify KubeVirt uninstallation
      assert:
        that: "'Could not find imported module support code' in output"
        fail_msg: "KubeVirt module uninstallation failed"
        success_msg: "KubeVirt module uninstalled successfully"
      register: result
