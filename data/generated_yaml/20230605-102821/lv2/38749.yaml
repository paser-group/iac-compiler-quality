
- name: Test for include_role with delegate_to
  hosts: all
  tasks:
    - name: Include role with delegate_to
      include_role:
        name: myrole
      delegate_to: "{{ item }}"
      with_items: "{{ groups['all'] }}"
      ignore_errors: yes
      no_log: true

    - name: Fail if any errors were raised
      fail:
        msg: "Errors were raised while running the playbook"
      when: "{{ play_hosts | intersect(inventory_failed_hosts) }}"
