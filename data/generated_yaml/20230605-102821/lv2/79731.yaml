
---
- name: Test Ansible Galaxy Install
  hosts: all
  gather_facts: no

  tasks:
  - name: Install a specific version of a role from Galaxy
    ansible.builtin.shell: ansible-galaxy install jdauphant.nginx==2.21.4 -p /etc/ansible/roles
    when: ansible_distribution in ['Ubuntu', 'Debian']

  - name: Generate a dynamic inventory
    ansible.builtin.copy:
      dest: /etc/ansible/inventory
      content: |
        [all]
        ubuntu1 ansible_host=10.1.1.1 ansible_user=root ansible_password=123456
        alpine1 ansible_host=10.1.1.2 ansible_user=root ansible_ssh_pass=123456
        centos1 ansible_host=10.1.1.3 ansible_user=root ansible_become=true ansible_become_method=sudo ansible_become_pass=123456
        redhat1 ansible_host=10.1.1.4 ansible_user=root ansible_ssh_private_key_file=/var/tmp/key_R.pem ansible_ssh_pass=123456
      when: ansible_distribution in ['Ubuntu', 'Debian']

  - name: Install a role from Git
    git:
      repo: https://github.com/example/ansible-role-test.git
      version: "{{ item }}"
      dest: /etc/ansible/roles/ansible-role-test
    loop:
      - master
      - develop
      - feature/branch_test
      - v.2.21.4
