
---
- name: Launch spot instance with user data
  hosts: all
  vars:
    - user_data: "{{ body }}"
    - spot_price: "10"
  tasks:
    - name: "Create EC2 Spot Instances with User Data"
      ec2:
        key_name: "mykeypair"
        region: "us-east-1"
        instance_type: "t2.micro"
        image_id: "ami-0c55b159cbfafe1f0"
        spot_price: "{{ spot_price }}"
        user_data: "{{ user_data }}"
        instance_initiated_shutdown_behavior: "terminate"
        wait: yes
      register: ec2
      ignore_errors: yes

    - name: Check for EC2 instance creation
      debug: var=ec2.instances
