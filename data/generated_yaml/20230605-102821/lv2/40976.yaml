
---
- name: Test azure_rm_keyvaultsecret authentication
  hosts: all
  gather_facts: false
  become: true

  tasks:
  - name: Attempt to access a secret with invalid credentials
    azure_rm_keyvaultsecret_info:
      vault_uri: "https://my-keyvault.vault.azure.net/"
      secret_name: "my-secret"
      client_id: "{{ lookup('env','INVALID_CREDENTIALS') }}"
      client_secret: "{{ lookup('env','INVALID_CREDENTIALS') }}"
      tenant_id: "{{ lookup('env','INVALID_CREDENTIALS') }}"
    register: result
    ignore_errors: true

  - name: Debug result
    debug:
      var: result
