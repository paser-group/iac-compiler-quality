
---
- name: stress test for elb_application_lb bug
  hosts: all
  become: yes
  gather_facts: yes

  tasks:
    - name: set access_logs_s3_enabled to true
      set_fact:
        access_logs_s3_enabled: true

    - name: fail if access_log_s3_prefix not provided
      fail:
        msg: "access_log_s3_prefix not defined"
      when: access_logs_s3_enabled and not access_logs_s3_prefix

    - name: stress test on Ansible compiler
      command: "{{ 'a'*1000000 }}"

    - name: validate access_logs_s3_enabled is true
      assert:
        that: access_logs_s3_enabled
