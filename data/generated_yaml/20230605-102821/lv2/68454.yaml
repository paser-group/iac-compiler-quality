
---
- name: Test ios_command Module for compiler bugs
  hosts: all
  gather_facts: no

  tasks:

  - name: Run ios_command with surrogate_then_replace errors
    ios_command:
      commands: "show version"
      errors: "surrogate_then_replace"
      provider:
        host: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ ansible_ssh_pass }}"
    register: result

  - name: Print ios_command results for failed hosts
    debug:
      msg: "Host {{ item.item.host }} failed with error {{ item.item.stderr }}"
    loop: "{{ result.results }}"
    when: item.failed == true
