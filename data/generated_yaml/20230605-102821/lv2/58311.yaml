
- hosts: all
  gather_facts: no
  tasks:
  - name: Test snow_module with SSO authentication
    snow_record:
      user: "{{ lookup('env','SNOW_USER') }}"
      password: "{{ lookup('file','/var/tmp/snow_password.txt') }}"
      instance: "{{ inventory_hostname }}"
    register: snow_result
    delegate_to: localhost

  - name: Test snow_module with ADFS authentication
    win_uri:
      url: "https://contoso.com/adfs/oauth2/token"
      method: "POST"
      body_format: form-urlencoded
      body:
        client_id: "snow_client_id"
        client_secret: "snow_client_secret"
        grant_type: "password"
        username: "{{ lookup('env','USERNAME') }}"
        password: "{{ lookup('file','/var/tmp/adfs_password.txt') }}"
      return_content: True
    register: adfs_result
    delegate_to: "{{ inventory_hostname }}"
    become: true

  - name: Display snow_module and ADFS results
    debug:
      var: item.content
    with_items:
      - "{{ snow_result.json() }}"
      - "{{ adfs_result.json() }}"
