
---
- name: Download file with checksum and modify file permissions
  hosts: all
  become: true

  tasks:
  - name: Download file with checksum
    get_url:
      url: "http://example.com/file.txt"
      dest: "/tmp/file.txt"
      checksum: "sha256:{{ lookup('file', '/tmp/checksum') }}"
      force: no

  - name: Fix file permissions
    file:
      path: "/tmp/file.txt"
      owner: "root"
      group: "root"
      mode: "0755"
      force: "{{ true | random }}"
    with_items: "{{ groups['all'] }}"
...
