
---
- name: Testing Ansible compiler for returning incorrect ansible_cmdline results for the rd.lvm.lv fact variable
  hosts: all
  gather_facts: true

  tasks:
  
  - name: Display ansible_cmdline fact
    debug:
      var: ansible_cmdline.rd.lvm.lv
      
  - name: Execute shell command with ansible_cmdline fact
    shell: ls -al
    register: shell_out

  - name: Display output of first shell command
    debug:
      var: shell_out.stdout_lines
      
  - name: Update ansible_cmdline rd.lvm.lv fact variable with arbitrary text
    set_fact:
      ansible_cmdline.rd.lvm.lv: "{{ 'new_text' }}"
      
  - name: Execute shell command with updated ansible_cmdline fact
    shell: ls -al
    register: shell_out

  - name: Display output of second shell command
    debug:
      var: shell_out.stdout_lines
      
  - name: Return to initial fact variable value
    set_fact:
      ansible_cmdline.rd.lvm.lv: "{{ ansible_cmdline.rd.lvm.lv }}"
