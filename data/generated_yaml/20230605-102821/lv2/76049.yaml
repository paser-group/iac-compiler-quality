
- name: Execute a successful task redo
  hosts:
    - ubuntu1
    - alpine1
    - centos1
    - redhat1
  gather_facts: no
  
  tasks:
    - name: Run a shell command on all hosts
      shell: "echo 'Hello, world!'"
      any_errors_fatal: yes
      run_once: yes
      
    - name: Re-run the command on failed hosts
      shell: "{% if hostvars[inventory_hostname].failed %}echo 'Hello, world!'{% endif %}"
      any_errors_fatal: yes
      run_once: yes
