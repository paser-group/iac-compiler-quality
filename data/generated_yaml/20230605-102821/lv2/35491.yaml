
---
- hosts: all
  tasks:
  - name: Create vmkernel interface
    vmware_vmkernel:
      hostname: "{{ inventory_hostname }}"
      username: "root"
      password: "password"
      validate_certs: no
      esxi_hostname: "example-esxi.example.com"
      name: "eth0"
      portgroup_name: "VM Network"
      ip_address: "{{ hostvars[inventory_hostname].ansible_default_ipv4.address }}"
      subnet_mask: "255.255.255.0"
      autostart: True
      state: present
