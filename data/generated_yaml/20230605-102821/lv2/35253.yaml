
- name: Test Ansible Galaxy ignores --roles-path flag
  hosts: ubuntu1
  gather_facts: false

  tasks:
  - name: Install role using ansible-galaxy from a non-default path
    command: ansible-galaxy install -p /tmp/roles geerlingguy.docker
    become: true
    become_method: sudo

  - name: Run ansible-playbook with --roles-path flag
    shell: ansible-playbook main.yml --roles-path /tmp/roles
    args:
      chdir: /home/ubuntu/test-playbook/
    become: true
    become_method: sudo

  - name: Verify whether the role was installed correctly
    assert:
      that:
      - '"geerlingguy.docker" in ansible_roles'

