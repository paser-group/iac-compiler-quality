
---
- name: azure_rm_virtualmachine deserialization error stress test
  hosts: all
  become: true

  tasks:
    - name: create VM with invalid resource group
      azure_rm_virtualmachine:
        resource_group: invalid-{{ ansible_hostname }}
        name: vm-{{ ansible_hostname }}
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: '18.04-LTS'
          version: latest
        admin_username: azureuser
        admin_password: "{{ 'invalid-password' | to_uuid }}"

    - name: create VM with invalid offer
      azure_rm_virtualmachine:
        resource_group: test-rg
        name: vm-{{ ansible_hostname }}
        image:
          offer: invalid-offer
          publisher: Canonical
          sku: '18.04-LTS'
          version: latest
        admin_username: azureuser
        admin_password: "{{ 'invalid-password' | to_uuid }}"

    - name: create VM with invalid publisher
      azure_rm_virtualmachine:
        resource_group: test-rg
        name: vm-{{ ansible_hostname }}
        image:
          offer: UbuntuServer
          publisher: invalid-publisher
          sku: '18.04-LTS'
          version: latest
        admin_username: azureuser
        admin_password: "{{ 'invalid-password' | to_uuid }}"

    - name: create VM with invalid SKU
      azure_rm_virtualmachine:
        resource_group: test-rg
        name: vm-{{ ansible_hostname }}
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: invalid-sku
          version: latest
        admin_username: azureuser
        admin_password: "{{ 'invalid-password' | to_uuid }}"

    - name: create VM with invalid admin password
      azure_rm_virtualmachine:
        resource_group: test-rg
        name: vm-{{ ansible_hostname }}
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: '18.04-LTS'
          version: latest
        admin_username: azureuser
        admin_password: invalid-password

    - name: create VM with valid configuration
      azure_rm_virtualmachine:
        resource_group: test-rg
        name: vm-{{ ansible_hostname }}
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: '18.04-LTS'
          version: latest
        admin_username: azureuser
        admin_password: "{{ 'valid-password' | to_uuid }}"
