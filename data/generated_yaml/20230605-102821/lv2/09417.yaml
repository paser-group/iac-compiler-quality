
- name: EL 6.6 connection ControlPersist issues stress test playbook
  hosts: all
  gather_facts: false
  tasks:
    - name: Set up connection failure scenario
      shell: ssh -o ControlPersist=no {{ item }} "exit"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
    - name: Set up connection retry scenario
      shell: ssh -o ControlPersist=no {{ item }} "exit"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
    - name: Set up connection persistence scenario
      shell: ssh -o ControlPersist=yes {{ item }} "exit"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
    - name: Check connection status
      shell: ssh {{ item }} "echo 'Connected!'"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
