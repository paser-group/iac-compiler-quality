
- name: Create a security group in the current VPC and reference a group from another VPC
  hosts: all
  become: true
  vars:
    vpc_id: "vpc-12345678"
    remote_vpc_id: "vpc-87654321"
    remote_security_group_name: "other-group"
  tasks:
  - name: Create the security group in the current VPC
    ec2_group:
      name: "test-group"
      description: "Test security group"
      vpc_id: "{{ vpc_id }}"
      region: "us-west-2"
      rules:
        - proto: tcp
          ports:
            - 22
          cidr_ip: "0.0.0.0/0"
        - proto: tcp
          ports:
            - 80
          group_name: "{{ remote_security_group_name }}"
          group_id: "{{ remote_vpc_id }}-{{ remote_security_group_name }}"

