yaml
- name: Wait for SSH service to become available on all nodes
  hosts: all
  gather_facts: no
  
  tasks:
  - name: Attempt connection to SSH service on all nodes
    wait_for:
      port: 22
      host: "{{ inventory_hostname }}"
      timeout: 5
      state: drained
    ignore_errors: yes
    
  - name: Attempt connection to non-existent port and throw error
    wait_for:
      port: 8000
      host: "{{ inventory_hostname }}"
      delay: 10
      timeout: 3
      state: stopped
    register: result

  - name: Show error message on failure to connect
    debug:
      var: result.msg
    when: result.failed == true
