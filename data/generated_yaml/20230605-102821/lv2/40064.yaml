
---
- name: Test ios_config idempotency
  hosts: all
  gather_facts: no

  tasks:
    - name: Add loopback interface to Cisco device
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: cisco
          password: cisco
          authorize: yes
          auth_pass: cisco
        lines:
          - interface Loopback0
          - ip address 10.0.0.1 255.255.255.0

    - name: Change IP address of loopback interface
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: cisco
          password: cisco
          authorize: yes
          auth_pass: cisco
        lines:
          - interface Loopback0
          - no ip address 10.0.0.1 255.255.255.0
          - ip address 192.168.0.1 255.255.255.0

    - name: Add new loopback interface
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: cisco
          password: cisco
          authorize: yes
          auth_pass: cisco
        lines:
          - interface Loopback1
          - ip address 10.0.0.2 255.255.255.0

    - name: Readd loopback interface with different IP
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: cisco
          password: cisco
          authorize: yes
          auth_pass: cisco
        lines:
          - interface Loopback0
          - ip address 10.0.0.1 255.255.255.0
