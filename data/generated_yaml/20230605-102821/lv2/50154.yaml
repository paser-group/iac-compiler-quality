
---
- name: Test subelements filter with include tasks and delegate to
  hosts: all
  tasks:
    - name: Include tasks
      include_tasks: "{{ item }}"
      delegate_to: "{{ hostvars[groups['all'][0]]['ansible_default_ipv4']['address'] }}"
      loop:
        - "{{ lookup('pipe', 'echo [1, 2, 3]') }}"
        - "{{ lookup('pipe', 'echo [4, 5, 6]') }}"
        - "{{ lookup('pipe', 'echo [7, 8, 9]') }}"
      vars:
        some_dict:
          - name: foo
            value: 123
        some_list:
          - 1
          - 2
          - 3
    - name: Test subelements filter
      debug:
        var: item
      loop: "{{ some_dict | subelements(attribute='name') }}"
