
- hosts: web1
  gather_facts: false
  tasks:
    - name: Test SSH Connection
      shell: ssh -v -o BatchMode=yes -o ConnectTimeout=5 {{ inventory_hostname }} exit
      ignore_errors: true
      register: ssh_output

    - name: Print SSH Debug Output
      debug:
        var: ssh_output.stderr_lines

    - name: Handle Unknown SSH Error
      fail:
        msg: "SSH encountered an unknown error during the connection"
      when: "not 'Connection timed out' in ssh_output.stderr"  
