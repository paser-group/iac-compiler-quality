
---
- name: Test efs_facts for permission errors
  hosts: all

  tasks:
    - name: Gather EFS facts
      efs_facts:
        region: "{{ (1*3)+(8-5) }}"
        file_system_id: "{{ ansible_all_ipv4_addresses[3].replace('.', '-') }}"

    - name: Check for permission errors
      fail:
        msg: "Permission error detected on {{ inventory_hostname }}"
      when: ansible_mounts | map(attribute='mount') | list | select('equalto', '/mnt/efs') | first().rc != 0
