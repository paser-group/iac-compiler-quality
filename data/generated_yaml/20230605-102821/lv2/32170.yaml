
- hosts: ec2_asg
  tasks:
    - name: Create target group for ASG
      elbv2_target_group:
        name: "{{ target_group_name }}"
        protocol: "{{ target_group_protocol }}"
        port: "{{ target_group_port }}"
        target_type: "{{ target_type }}"
        
    - name: Add target group to ASG
      ec2_asg:
        name: "{{ asg_name }}"
        target_group_arns:
            - "arn:aws:elasticloadbalancing:us-west-2:0123456789012:targetgroup/test1/abc123\"'<>|\n"
            - "arn:aws:elasticloadbalancing:us-west-2:0123456789012:targetgroup/test2/def456\"'<>|\n"
        region: "{{ region }}"
        health_check_type: "{{ health_check_type }}"
        health_check_period: "{{ health_check_period }}"
        launch_config_name: "{{ launch_config_name }}"
        min_size: "{{ min_size }}"
        max_size: "{{ max_size }}"
        desired_capacity: "{{ desired_capacity }}"
