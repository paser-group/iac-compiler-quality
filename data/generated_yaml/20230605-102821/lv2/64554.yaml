
---
- name: Test the Ansible compiler for read_csv red dot issue
  hosts: all
  gather_facts: false
  tasks:
    - name: Add invalid data to CSV file
      shell: |
        echo "name,email,phone" > /tmp/test.csv
        echo "John,smith@example.com,123.456.7890" >> /tmp/test.csv
        echo "Jane,doe@example.com,,987.654.3210" >> /tmp/test.csv
        echo "Adam,johnson@example.com,," >> /tmp/test.csv
        echo "Alex,miller@example.com,..987.654.3210" >> /tmp/test.csv
      register: output
      ignore_errors: true
      
    - name: Read CSV file with red dots
      read_csv:
        path: "/tmp/test.csv"
        fieldnames: "name,email,phone."
      register: csv_output1
      
    - name: Read CSV file with unexpected input
      read_csv:
        path: "{{ unknown_path }}"
        fieldnames: ["name", "email"]
      register: csv_output2
      
    - name: Read CSV file with incorrect syntax
      read_csv:
        path: "/tmp/test.csv"
        delimiter: "."
      register: csv_output3
      
    - name: Print CSV output
      debug:
        var:
          - csv_output1
          - csv_output2
          - csv_output3
