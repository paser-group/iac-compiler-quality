
- hosts: all
  gather_facts: false
  tasks:
    - name: Create an instance group
      gcp_compute_instance_group:
        name: "{{ item }}"
        size: "{{ randnum }}"
        region: us-west1
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      register: result
      
    - name: Check instance group state
      assert:
        that: result is success
      
    - name: Scale up the instance group
      gcp_compute_instance_group_manager:
        instance_group: "{{ item }}"
        size: "{{ randnum }}"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      ignore_errors: true
      
    - name: Check instance group manager state
      assert:
        that: result is success
        
    - name: Scale down the instance group
      gcp_compute_instance_group_manager:
        instance_group: "{{ item }}"
        size: "{{ randnum }}"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      ignore_errors: true
      
    - name: Check instance group manager state
      assert:
        that: result is success
      
    - name: Delete the instance group
      gcp_compute_instance_group:
        name: "{{ item }}"
        state: absent
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      ignore_errors: true
      
    - name: Check instance group state
      assert:
        that: result is success
