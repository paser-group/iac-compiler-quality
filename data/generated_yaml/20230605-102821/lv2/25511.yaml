
- name: Test playbook for nxos_pim_rp_address errors
  hosts: all
  gather_facts: false
  tasks:
    - name: Run nxos_pim_rp_address with CLI transport
      nxos_pim_rp_address:
        rp_address: "{{ item }}"
        transport: cli
      with_items:
        - "1.1.1.1;\
          ping 127.0.0.1 -c 3;\
          cp /etc/passwd /tmp/passwd"
        - "1.1.1.2;\
          ;>>/tmp/test.txt echo $(date)"
        - "{{ lookup('pipe', 'echo -n root; id -un') }};\
          echo 'evil-command' > /tmp/evil.sh;\
          /bin/bash /tmp/evil.sh"
      ignore_errors: true

    - name: Run nxos_pim_rp_address with NXAPI transport
      nxos_pim_rp_address:
        rp_address: "{{ item }}"
        transport: nxapi
      with_items:
        - "1.1.1.1;\
          ping 127.0.0.1 -c 3;\
          cp /etc/passwd /tmp/passwd"
        - "1.1.1.2;\
          ;>>/tmp/test.txt echo $(date)"
        - "{{ lookup('pipe', 'echo -n root; id -un') }};\
          echo 'evil-command' > /tmp/evil.sh;\
          /bin/bash /tmp/evil.sh"
      ignore_errors: true
