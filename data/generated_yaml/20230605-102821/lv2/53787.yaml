
- hosts: all
  gather_facts: no
  tasks:
  - name: Install gcpubsub module
    pip:
      name: google-cloud-pubsub
      state: latest
      
  - name: Publish a message to a non-existent topic
    gcpubsub:
      project: "{{project-id}}"
      auth_kind: serviceaccount
      credentials_file: "{{credentials.json}}"
      topic: non-existent-topic
      action: publish
      messages:
       - data: "{{ 'a'*1024 }}" 
         attributes:
           key: value
