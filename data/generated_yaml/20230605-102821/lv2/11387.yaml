
---
- name: Test for Bad Var Issue
  hosts: ubuntu1, alpine1, centos1, redhat1
  vars:
    - correct_var: "This is a correct var"

  tasks:
  - name: Include Playbook with wrong var
    include_vars:
      file: "{{ playbook_dir }}/wrong_vars.yml"
    register: included_playbook
    ignore_errors: true

  - name: Error Handling for wrong Var
    fail:
      msg: "{{ included_playbook }}"
    when: "'bad_var' in included_playbook.object_exceptions[0].message"

  - name: Testing Correct Var
    debug:
      var: correct_var
