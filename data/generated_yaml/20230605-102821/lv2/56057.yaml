
- name: Stress test for nxos_facts
  hosts: all
  gather_facts: false
  become: true

  tasks:
    - name: Generate large number of Cisco Nexus devices for facts gathering
      ios_facts:
        host: "{{ item }}"
        username: admin
        password: cisco
        gather_subset: all
      register: "{{ item }}"
      with_sequence: count=100

    - name: Verifying facts for the Cisco Nexus devices
      nxos_facts:
        host: "{{ item.ansible_facts.ansible_net_hostname }}"
        username: "{{ item.ansible_facts.ansible_user }}"
        password: "{{ item.ansible_facts.ansible_password }}"
      with_items: "{{ ansible_play_hosts }}"

