
- name: Install Ansible and verify installation
  hosts: all
  become: yes
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install Ansible dependencies
      apt:
        name:
        - python-setuptools
        - python3-pip
        - python3-dev
        state: latest

    - name: Install Ansible
      pip:
        name: ansible
        state: present

    - name: Verify installation
      command: ansible --version
      register: ver_output
      ignore_errors: true
      changed_when: false

    - name: Check for successful installation
      assert:
        that:
          - "'ansible' in ver_output.stdout"
      success_msg: "Ansible installation successful!"
      fail_msg: "Ansible installation failed with fatal error: pyconfig.h: No such file or directory"
