
- name: "Test playbook"
  hosts: all
  gather_facts: no
  vars:
    - condition: "{{ condition_var | default(omit) }}"
  tasks:
    - name: "Test set and unset variable"
      block:
        - set_fact:
            condition: "{{ null | from_yaml }}"
          when: "{{ condition is not defined }}"
        - debug:
            msg: "Condition: {{ condition }}"
        - set_fact:
            condition: "notnull"
        - debug:
            msg: "Condition: {{ condition }}"
        - set_fact:
            condition: "{{ condition_var }}"
          when: "{{ condition_var is defined }}"
        - debug:
            msg: "Condition: {{ condition }}"
      rescue:
        - debug:
            msg: "Unexpected error occurred: {{ ansible_failed_result }}"
