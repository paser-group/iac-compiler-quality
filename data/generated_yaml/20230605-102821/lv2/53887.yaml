
- name: Create VLAN with idempotency test
  hosts: all
  gather_facts: no
  tasks:
  - name: Create VLAN with mode
    nxos_vlan:
      vlan_id: 1100
      mode: vxlan
      state: present
    register: vlan_create_present

  - name: Debug output VLAN
    debug:
      var: vlan_create_present

  - name: Create VLAN without mode
    nxos_vlan:
      vlan_id: 1100
      state: present
    register: vlan_create_single

  - name: Debug output without mode
    debug:
      var: vlan_create_single

  - name: Update VLAN to with mode
    nxos_vlan:
      vlan_id: 1100
      mode: trill
      state: present
    register: vlan_update_present

  - name: Debug output VLAN updated with mode
    debug:
      var: vlan_update_present

  - name: Create VLAN again with mode
    nxos_vlan:
      vlan_id: 1100
      mode: vxlan
      state: present
    register: vlan_update_idempotent

  - name: Debug output VLAN post-idempotent
    debug:
      var: vlan_update_idempotent
