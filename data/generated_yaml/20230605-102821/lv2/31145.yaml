
- name: Perform stress test on apt module
  hosts: all
  gather_facts: no

  tasks:
    - name: Update apt package cache
      apt:
        name: dirmngr
        state: latest

    - name: Install package with correct permissions
      apt:
        name: tree
        state: latest

    - name: Attempt to install package with incorrect permissions
      become: yes
      become_method: su
      command: apt-get install -y vim

    - name: Remove package with correct permissions
      apt:
        name: tree
        state: absent

    - name: Attempt to remove package with incorrect permissions
      become: yes
      become_method: su
      command: apt-get remove -y vim

    - name: Purge package with correct permissions
      apt:
        name: tree
        state: purged

    - name: Attempt to purge package with incorrect permissions
      become: yes
      become_method: su
      command: apt-get purge -y vim
