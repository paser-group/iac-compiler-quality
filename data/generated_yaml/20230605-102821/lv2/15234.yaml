
- name: Memory Outage Test
  hosts: all
  gather_facts: no
  become: true
  vars:
    package_manager: yum
    update_limit: 10

  tasks:

  - name: Unlimited Update
    shell: "{{ package_manager }} update -y"
    ignore_errors: true

  - name: Limit Update
    shell: "{{ package_manager }} update -y | head -{{ update_limit }}"
    ignore_errors: true

  - name: Exhaust Memory
    shell: "dd if=/dev/zero of=/tmp/out bs=100M count=50"
    ignore_errors: true

  - name: Check Memory Status
    shell: free -m | grep Mem
    register: memory_status
    ignore_errors: true

  - name: Debug Information
    debug:
      var: memory_status.stdout_lines
      verbosity: 2
      ignore_errors: true
