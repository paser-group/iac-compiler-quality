
- hosts: all
  gather_facts: no
  become: true
  tasks:
    - name: Configure s3 bucket lifecycle
      s3_lifecycle:
        bucket: "{{ body }}"
        rules:
          - id: Delete old logs"
            status: enabled
            prefix: "{{ body }}}"
            expiration_days: 30
            abort_incomplete_multipart_upload_days: 1
        aws_access_key: "{{ aws_access }}"
        aws_secret_key: "{{ aws_secret }}"
      ignore_errors: yes

    - name: Print debug logs
      debug:
        var: s3_lifecycle
