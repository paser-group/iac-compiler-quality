
- name: Configure instance-initiated shutdown behavior
  hosts: all
  become: yes
  
  vars:
    behavior: stop # change to terminate to test
  
  tasks:
    - name: Set instance-initiated shutdown behavior
      ec2_instance_attribute:
        instance_ids:
          - i-{{ inventory_hostname[-1] }}
        instance_initiated_shutdown_behavior: '{{ behavior }}'
      register: result
  
    - name: Show result
      debug:
        var: result
