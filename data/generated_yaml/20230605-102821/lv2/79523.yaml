
- name: Test apt module with Python3
  hosts: all
  become: true

  tasks:
  - name: Update apt cache
    apt:
      update_cache: yes
      cache_valid_time: 0
      force_apt_get: true

  - name: Install Python3 
    apt:
      name: python3 
      state: present

  - name: Install nginx package 
    apt:
      name: nginx
      state: present

  - name: Verify nginx package installation 
    apt:
      name: nginx
      state: present
    register: nginx_result

  - name: Fail the playbook if nginx package installation fails 
    fail:
      msg: "Failed to install nginx package"
    when: not nginx_result

  - name: Remove nginx package 
    apt:
      name: nginx
      state: absent

  - name: Verify nginx package removal 
    apt:
      name: nginx
      state: absent
    register: nginx_remove_result

  - name: Fail the playbook if nginx package removal fails 
    fail:
      msg: "Failed to remove nginx package"
    when: not nginx_remove_result
