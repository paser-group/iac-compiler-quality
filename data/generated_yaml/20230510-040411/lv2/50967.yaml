
- name: Test Azure dynamic inventory
  hosts: localhost
  gather_facts: no

  vars:
    my_groups: "test_group"
    my_inventory_hostname: "localhost"

  tasks:
    - name: Check if hostname is in inventory
      debug: var=inventory_hostname
      when: inventory_hostname in groups[my_groups]

    - name: Check if my inventory_hostname is in inventory
      debug: var=inventory_hostname
      when: my_inventory_hostname in groups[my_groups]

    - name: Run command on all hosts (WITH_ITEMS syntax)
      win_command: echo "Running on {{ item }}"
      with_items:
        - "{{ groups[my_groups] }}"
