
- hosts: all
  gather_facts: false
  tasks:
    - name: Check disk space
      shell: |
        df -h /
      register: result

    - name: Debug disk space
      debug:
        var: result.stdout_lines
      when: result is defined and result.stdout_lines is defined and result.stdout_lines | length > 0

    - name: Unreachable if disk space full
      ping: 
      become: true
      ignore_unreachable: "{{ '/dev/sda1 100%' in result.stdout_lines[1] }}"
