
- name: Test playbook for nxos_igmp_interface module
  hosts: all
  gather_facts: false

  tasks:
    - name: Apply default values to igmp interface
      nxos_igmp_interface:
        name: "{{ hostvars[inventory_hostname]['igmp_interface_name'] }}"
        apply_default_values: true
        version: "{{ hostvars[inventory_hostname]['igmp_interface_version'] }}"
      register: igmp_interface

    - name: Apply default values again
      nxos_igmp_interface:
        name: "{{ hostvars[inventory_hostname]['igmp_interface_name'] }}"
        apply_default_values: true
        version: "{{ hostvars[inventory_hostname]['igmp_interface_version'] }}"
      register: igmp_interface_second_run

    - name: Test idempotency
      assert:
        that: igmp_interface.changed == igmp_interface_second_run.changed
