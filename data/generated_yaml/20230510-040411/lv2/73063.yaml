
- hosts: all
  vars:
    galaxy_git_url: "https://github.com/myuser/myrepo.git"
  tasks:
    - name: Install role from git
      command: >
        galaxy
        install
        {{ galaxy_git_url }}
        --force
        --verbose
        --ignore-errors
    - name: Clean up
      block:
        - name: Remove installed role
          command: >
            galaxy
            remove
            myuser.myrole
            --force
      rescue:
        - debug:
            msg: "Failed to remove role. Please remove manually."
