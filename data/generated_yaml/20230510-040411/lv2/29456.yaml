
- name: Test EC2 instance_initiated_shutdown_behavior
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Stop EC2 instance with instance_initiated_shutdown_behavior set to stop
      ec2:
        instance_ids: "{{ ec2_instance_id }}"
        state: stopped
        instance_initiated_shutdown_behavior: stop
    - name: Start EC2 instance with instance_initiated_shutdown_behavior set to terminate
      ec2:
        instance_ids: "{{ ec2_instance_id }}"
        state: started
        instance_initiated_shutdown_behavior: "terminate"
    - name: Verify EC2 instance has instance_intiated_shutdown_behavior of terminate
      ec2_instance_info:
        instance_ids: "{{ ec2_instance_id }}"    
      register: ec2_info
    - name: Debug info on instance
      debug: var=ec2_info
