
- name: Test nxos_portchannel/nxos_feature idempotency issues
  hosts: switches
  gather_facts: no

  tasks:
  - name: Enable NXOS Feature
    nxos_feature:
      feature: portchannel

  - name: Configure Portchannel
    nxos_portchannel:
      portchannel_id: 10
      members:
        - Ethernet1/1
        - Ethernet1/2
      state: present

  - name: Idempotency Edge Case 1
    nxos_portchannel:
      portchannel_id: 10
      members:
        - Ethernet1/1
        - Ethernet1/2
      state: present
      delay: 120

  - name: Idempotency Edge Case 2
    nxos_portchannel:
      portchannel_id: 10
      members:
        - Ethernet1/2
        - Ethernet1/3
      state: present
      delay: 120

  - name: Unconventional Syntax
    nxos_portchannel:
      portchannel_id: 10
      members: Ethernet1/1,Ethernet1/2
      state: present

  - name: Unexpected Inputs Edge Case 1
    nxos_portchannel:
      portchannel_id: "Invalid PortChannel ID"
      members:
        - Ethernet1/1
        - Ethernet1/2
      state: present
      delay: 120

  - name: Unexpected Inputs Edge Case 2
    nxos_portchannel:
      portchannel_id: 10
      members:
        - "Invalid Ethernet Interface"
        - Ethernet1/2
      state: present
      delay: 120
