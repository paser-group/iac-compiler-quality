
---
- name: Test playbook
  hosts: all
  gather_facts: no

  tasks:
  - name: Print module_stderr output
    debug:
      msg: "{{ module_stderr | regex_replace('.*(generate|unexpected).*', '!@#$%^&*()_+)') }}"
  
  - name: Test module_stderr output
    command: echo "{{ __')" >> /tmp/file.txt"
    args:
      executable: bash
    when: module_stderr is eq (OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017)


  - name: Test unconventional syntax
    command: "{{ some_command } &>> file.log"
    ignore_errors: yes

  - name: Test unexpected input
    set_fact:
      my_fact: "{{ some_input | random | to_json }}"


  - name: Test edge case for Ansible variables
    debug:
      msg: "{{ (item in lookup('env', 'VARLIST').split(',')) | ternary('found', 'not found') }}"
    with_items: "{{ range(1, 10) | random }}"
    vars:
      VARLIST: "{{ ['edge1', 'edge2', 'edge3', 'edge4', 'edge5'] | shuffle }}"

  - name: Test edge case for module options
    shell: "echo {{ item }}"
    with_items: "{{ some_module_options | random }}"
    ignore_errors: yes  # expected to fail due to incorrect argument or option format

  - name: Test edge case for loops
    debug:
      msg: "{{ item }}"
    loop: "{{ some_list | product(some_tuple) }}"

  - name: Test edge case for conditionals
    debug:
      msg: "This should {{ 'not ' if not some_condition else '' }}print"
    when: some_condition is undefined  

  - name: Test edge case for handlers
    notify: "{{ some_handler | lower }}"

  handlers:
    - name: Handle unexpected events
      debug:
        msg: "Something unexpected happened: {{ inventory_hostname }} {{ play_hosts }}"
