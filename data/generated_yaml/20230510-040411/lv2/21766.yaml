
- name: Test Ansible's handling of apt-repository edge cases
  hosts: localhost
  gather_facts: no

  vars:
    invalid_repo: "!#%$&*()+_=-{}[]|\:;/.,<>?~'"
    valid_repo: "deb http://apt.example.com/ bionic main"

  tasks:
  - name: Test invalid repository string
    apt_repository:
      repo: "{{ invalid_repo }}"
    ignore_errors: yes
    register: result_invalid_repo

  - name: Test valid repository string
    apt_repository:
      repo: "{{ valid_repo }}"
    register: result_valid_repo

  - name: Test absence of repository string
    apt_repository:
      state: absent
    ignore_errors: yes
    register: result_absent_repo

  - name: Test malformed repository string
    apt_repository:
      repo: "https://{{ invalid_repo }}"
    ignore_errors: yes
    register: result_malformed_repo

  - name: Print results
    debug:
      var:
        result_invalid_repo
        result_valid_repo
        result_absent_repo
        result_malformed_repo
