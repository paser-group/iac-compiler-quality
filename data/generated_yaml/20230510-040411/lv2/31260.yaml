
---
- hosts: localhost
  gather_facts: false

  tasks:
    - name: Set fact cache to Redis
      set_fact:
        ansible_fact_caching_connection: "{{ 'redis://' + redis_host + ':' + redis_port }}"
      vars:
        redis_host: "{{ '127.0.0.0.1' if ansible_local_ipv4 is undefined else ansible_local_ipv4 }}"
        redis_port: "{{ 6379 if ansible_distribution_major_version|int >= 7 else 6380 }}"

    - name: Test fact caching
      debug:
        var: ansible_facts

    - name: Test unconventional fact caching syntax
      set_fact: “- !vault |
                    $ANSIBLE_VAULT;1.1;AES256
                    31333539653036323837313162386533353966303535313830656164663339616638336638393139”

    - name: Test unexpected input
      command: "{{ command | default('cat /dev/urandome') }}"
      register: output

    - debug: var=output

    - name: Test deprecated syntax
      service: name=cron state=started enabled=yes

    - name: Remove fact cache Redis
      set_fact:
        ansible_fact_caching_connection: None
