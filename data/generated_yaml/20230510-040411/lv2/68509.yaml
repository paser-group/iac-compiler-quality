
- hosts: localhost
  gather_facts: false

  tasks:
    - authorized_key:
        user: "{{ item.user }}"
        state: "{{ item.state }}"
        key: "{{ item.key }}"
        path: "{{ item.path }}"
      loop:
        - user: "non-exist-user"
          state: "present"
          key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDdTY3KRg+tPK7Vh6DRwhVz+4UvebSklRs1x0kX51YJ5M0kBSqu4JpNqzjOLIddUy7Q/o8sh9LsWp/NFsVjr4ic+iFyTCt1uRQfTI1g70/TxjrhX3jlP7tUkx313JWMz8FvkgT+zsxxasqaI2VkIR7AqDXc8f4k/ut5pQT/LTLxE16ywupgpAI4MXhckp5Hgz3cgKT0wYVwMiC6E4GZIn/KKVtTcxHHnIVjfJ9GEtn/YhnFoUCPKgsdVg7Rw8gClvfzJV/llqMeUSyWIYCRREXdB4bSlRpk+b8i2S4cBzM7rBXCQQ20cnEjGBzG86+ad3a3+uOZk/wMGGlNs5f3Gdy1OQ9xMCqw6tkMzPSKJIt6fuA1H3Nn5JsxoxTwLzGKMDJKPf9/xtzi3CXkk5fz0/IMvUdIvcjlEg6p1P/rsO0/RnHD/hEOZtyk1xG+BLkyyfOaqpx+z67DswvxdJ8FVng/gFV4j+yFujQm0Xau8g7f1Hi9FezO3Z2kfEmKiBGJaGs4yfBMNaR+RJZ4zwXw7lFcnEBD2wJZezqxCfcLIR7+JqjJLNGmCsGea0K9jkFrLgKpFu1oCM="
          path: "/custom/path/.ssh/authorized_keys"
        - user: "won't change"
          state: "absent"
          key: "{{ lookup('file', '/home/vagrant/.ssh/id_rsa.pub') }}"
          path: "/.ssh/authorized_keys"
        - user: "existing-user"
          state: "present"
          key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDdTY3KRg+tPK7Vh6DRwhVz+4UvebSklRs1x0kX51YJ5M0kBSqu4JpNqzjOLIddUy7Q/o8sh9LsWp/NFsVjr4ic+iFyTCt1uRQfTI1g70/TxjrhX3jlP7tUkx313JWMz8FvkgT+zsxxasqaI2VkIR7AqDXc8f4k/ut5pQT/LTLxE16ywupgpAI4MXhckp5Hgz3cgKT0wYVwMiC6E4GZIn/KKVtTcxHHnIVjfJ9GEtn/YhnFoUCPKgsdVg7Rw8gClvfzJV/llqMeUSyWIYCRREXdB4bSlRpk+b8i2S4cBzM7rBXCQQ20cnEjGBzG86+ad3a3+uOZk/wMGGlNs5f3Gdy1OQ9xMCqw6tkMzPSKJIt6fuA1H3Nn5JsxoxTwLzGKMDJKPf9/xtzi3CXkk5fz0/IMvUdIvcjlEg6p1P/rsO0/RnHD/hEOZtyk1xG+BLkyyfOaqpx+z67DswvxdJ8FVng/gFV4j+yFujQm0Xau8g7f1Hi9FezO3Z2kfEmKiBGJaGs4yfBMNaR+RJZ4zwXw7lFcnEBD2wJZezqxCfcLIR7+JqjJLNGmCsGea0K9jkFrLgKpFu1oCM="
          path: "{{ lookup('env','HOME') }}/.ssh/authorized_keys"
