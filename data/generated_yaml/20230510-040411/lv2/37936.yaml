
- name: Test nxos_config spanning-tree port bug
  hosts: switch
  connection: network_cli

  tasks:
    - name: Configure spanning-tree port type as edge trunk
      nxos_config:
        lines:
          - spanning-tree port type edge trunk
        before:
          - interface Ethernet1/1
          - no switchport access vlan
          - no switchport mode
        after:
          - ip address 10.0.0.1/24
      register: config

    - name: Show running configuration
      nxos_command:
        command_string: show running-config
      register: output

    - name: Check if configuration was applied with no errors
      debug:
        msg: |
          {{ output.stdout_lines | join('\n') }}
      when: "'spanning-tree port type edge trunk' in output.stdout"
