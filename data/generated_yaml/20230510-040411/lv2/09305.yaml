
- name: Test Ansible compiler for SSH/rsync not installed issue
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Check if ssh/rsync is installed
      stat:
        path: /usr/bin/{{ item }}
      with_items:
        - ssh
        - rsync
      register: result

    - name: Display status
      debug:
        var: result

    - name: Install ssh/rsync if not installed
      package:
        name: "{{ item }}"
        state: present
      when: "not result.results[{{ item_index }}].stat.exists"
      with_items: ["ssh", "rsync"]
