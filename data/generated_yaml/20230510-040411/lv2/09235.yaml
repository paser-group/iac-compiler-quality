
- name: Test playbook for apt module with_items
  hosts: all
  vars:
    packages:
      - apache2
      - nodejs
      - python3
      - perl
      - libssl-dev
  tasks:
  - name: Update apt cache and upgrade packages
    apt:
      update_cache: yes
      upgrade: yes
  - name: Install packages using single item in loop
    apt:
      name: "{{ item }}"
      state: present
    with_items: "{{ packages[0] }}"
  - name: Install packages using multiple items in loop
    apt:
      name: "{{ item }}"
      state: present
    with_items: "{{ packages }}"
  - name: Attempt to install invalid package
    apt:
      name: non_existent_package
      state: present
    ignore_errors: yes
  - name: Install package with unconventional syntax
    apt: name="python-yaml"
  - name: Remove packages
    apt:
      name: "{{ item }}"
      state: absent
    with_items: "{{ packages }}"
