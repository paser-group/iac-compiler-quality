
- name: Test playbook for command module's 'removes' option
  hosts: localhost
  tasks:
    - name: Run command with 'removes' option and a non-existing file
      command: echo "Hello, World" > /tmp/hello.txt
      register: output1
      changed_when: false
      removes: /tmp/foo.txt

    - name: Run command with 'removes' option and an existing file
      command: rm /tmp/hello.txt
      register: output2
      changed_when: false
      removes: /tmp/hello.txt

    - name: Run command with 'removes' option and file specified as a variable
      vars:
        my_file: /tmp/world.txt
      command: touch /tmp/world.txt
      register: output3
      changed_when: false
      removes: "{{ my_file }}"

    - name: Run command with 'removes' option and folder specified as a variable
      vars:
        my_folder: /tmp/foo
      command: mkdir /tmp/foo
      register: output4
      changed_when: false
      removes: "{{ my_folder }}"

    - name: Run command with 'removes' option and symlink specified as a variable
      vars:
        my_link: /tmp/bar
      command: ln -s /tmp/hello.txt /tmp/bar
      register: output5
      changed_when: false
      removes: "{{ my_link }}"

    - name: Run command with 'removes' option and a wildcard
      command: touch /tmp/ansible_test_*.txt
      register: output6
      changed_when: false
      removes: "/tmp/ansible_test_*.txt"
