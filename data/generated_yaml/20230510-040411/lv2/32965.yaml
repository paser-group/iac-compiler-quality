
- name: Test playbook for regression
  hosts: localhost
  gather_facts: no
  vars:
    python_path: "/usr/bin/fake_python"

  tasks:
    - name: Copy a fake Python file
      copy:
        src: "fake_python.py"
        dest: "{{ python_path }}"
        mode: "0777"
      ignore_errors: true

    - name: Run Ansible with /usr/bin/python unavailable
      shell: ansible-playbook -c local -i localhost, fake_playbook.yml
      ignore_errors: true

    - name: Call a Python module that doesn't exist
      command: >
        {{ python_path }} -c "import some_missing_module"
      ignore_errors: true
      
    - name: Symlink Python executable to a non-executable file
      file:
        src: "{{ python_path }}"
        dest: "/usr/bin/fake_python_symlink"
        mode: "0644"
      ignore_errors: true
      
    - name: Execute the playbook with a symlinked Python executable
      command: ansible-playbook -c local -i localhost, fake_playbook.yml
      ignore_errors: true
