
---
- name: Testing azure_rm_keyvaultsecret
  hosts: localhost
  gather_facts: no

  tasks:
  - name: Creating a secret with invalid credentials
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: invalid-id
      secret: invalid-secret
      secret_name: test-secret
      value: test-value
    register: result
    ignore_errors: yes

  - name: Retrieve a secret with invalid credentials
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: invalid-id
      secret: invalid-secret
      secret_name: test-secret
    register: result
    ignore_errors: yes

  - name: Delete a secret with invalid credentials
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: invalid-id
      secret: invalid-secret
      secret_name: test-secret
      state: absent
    register: result
    ignore_errors: yes

  - name: Creating a secret with wrong vault_url
    azure_rm_keyvaultsecret:
      vault_url: https://invalid-vault-url/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: test-secret
      value: test-value
    register: result
    ignore_errors: yes

  - name: Retrieve a secret with wrong vault_url
    azure_rm_keyvaultsecret:
      vault_url: https://invalid-vault-url/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: test-secret
    register: result
    ignore_errors: yes

  - name: Delete a secret with wrong vault_url
    azure_rm_keyvaultsecret:
      vault_url: https://invalid-vault-url/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: test-secret
      state: absent
    register: result
    ignore_errors: yes

  - name: Creating a secret with empty name
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: ""
      value: test-value
    register: result
    ignore_errors: yes

  - name: Retrieve a secret with empty name
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: ""
    register: result
    ignore_errors: yes

  - name: Delete a secret with empty name
    azure_rm_keyvaultsecret:
      vault_url: https://myvault.vault.azure.net/
      client_id: test-client-id
      client_secret: test-client-secret
      secret_name: ""
      state: absent
    register: result
    ignore_errors: yes
