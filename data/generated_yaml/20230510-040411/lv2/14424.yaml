
- name: Test playbook for GitHub issue #<issue_number>
  hosts: all
  gather_facts: no

  vars:
    should_fail: true
    include_path: "{{ playbook_dir }}/roles/test_role/tasks/test_task.yml"

  tasks:
    - name: Set any_errors_fatal to true
      set_fact:
        any_errors_fatal: true

    - name: Run a task that should fail
      include_tasks: "{{ include_path }}"
      vars:
        should_fail: "{{ should_fail }}"

    - name: Print a message if previous task fails
      debug:
        msg: "The previous task failed as expected"
      failed_when: not any_errors_fatal
