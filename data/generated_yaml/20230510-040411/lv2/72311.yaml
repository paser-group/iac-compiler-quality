
- name: Test Ansible ping and SSH connectivity to target host
  hosts: all
  gather_facts: false

  tasks:

  - name: Ping the target host
    ping:
    register: ping_output

  - name: Check SSH connectivity to target host
    shell: ssh -q -oBatchMode=yes -oStrictHostKeyChecking=no {{ inventory_hostname }}
    args:
      executable: /bin/bash
    register: ssh_output
    ignore_errors: true

  - name: Display SSH error message
    debug:
      msg: "{{ ssh_output.stdout }}"
    when: ssh_output.rc != 0

  - name: Display ping error message
    debug:
      msg: "{{ ping_output }}"
    failed_when: ping_output.failed
