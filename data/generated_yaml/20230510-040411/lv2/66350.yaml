
-
  hosts: localhost
  gather_facts: false

  tasks:
    -
      name: Create an existing security group
      os_security_group:
        state: present
        name: existing_security_group
        project: my_project
        description: Existing Security Group

    -
      name: Create an existing security group rule
      os_security_group_rule:
        state: present
        secgroup: existing_security_group
        proto: any
        remote_ip_prefix: 0.0.0.0/0
        ingress: true

    -
      name: Add the same security group rule that already exists
      os_security_group_rule:
        state: present
        secgroup: existing_security_group
        proto: any
        remote_ip_prefix: 0.0.0.0/0
        ingress: true

    -
      name: Delete the existing security group
      os_security_group:
        state: absent
        name: existing_security_group
        project: my_project
