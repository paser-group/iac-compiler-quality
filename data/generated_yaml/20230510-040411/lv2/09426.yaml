
---
- name: Test playbook for fatal error while evaluating conditional
  hosts: all
  gather_facts: no

  tasks:
    - name: Verify yes condition in inventory
      debug:
        msg: "Yes condition in inventory"
      when: "yes in inventory_var"

    - name: Verify no condition in inventory
      debug:
        msg: "No condition in inventory"
      when: "no in inventory_var"

    - name: Verify integer condition in inventory
      debug:
        msg: "Integer condition in inventory"
      when: "1 in inventory_var"

    - name: Verify string condition in inventory
      debug:
        msg: "String condition in inventory"
      when: "'foo' in inventory_var"

    - name: Verify undefined variable condition
      debug:
        msg: "Undefined variable condition"
      when: "undefined_var is defined"

    - name: Verify empty variable condition
      debug:
        msg: "Empty variable condition"
      when: "empty_var | default('') == ''"

    - name: Verify nested conditional with brackets
      debug:
        msg: "Nested conditional with brackets"
      when: "(yes in inventory_var) and (no not in inventory_var)"

    - name: Verify nested conditional with parentheses
      debug:
        msg: "Nested conditional with parentheses"
      when: "(yes in inventory_var) or (no not in inventory_var)"

    - name: Verify boolean expression
      debug:
        msg: "Boolean expression"
      when: "true and false"

    - name: Verify incorrect syntax
      debug:
        msg: "Incorrect syntax"
      when: "{{missing_quote or missing_bracket not in inventory_var}}"

    - name: Verify long syntax
      debug:
        msg: "Long syntax"
      when: "{'foo': 'bar', 'baz': 'qux', 'quux': 'corge', 'grault': 'garply', 'waldo': 'fred', 'plugh': `xyzzy`}"

    - name: Verify unconventional syntax
      debug:
        msg: "Unconventional syntax"
      when: "in vent or y_var"

    - name: Verify unexpected input
      debug:
        msg: "Unexpected input"
      when: "${yes in inventory_var}"

    - name: Verify multiple conditions
      debug:
        msg: "Multiple conditions"
      when: "yes in inventory_var and no not in inventory_var or 1 in inventory_var"

    - name: Verify invalid variable
      debug:
        msg: "Invalid variable"
      when: "{{ inventory_var }}{{ invalid_var }}"
