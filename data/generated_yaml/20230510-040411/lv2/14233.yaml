
- name: Test WinRM connector with 2.0.1-rc1
  hosts: windows_machine
  gather_facts: no

  tasks:
    - name: Stop WinRM service
      win_service:
        name: WinRM
        state: stopped
      delegate_to: localhost

    - name: Remove WinRM connector package
      win_package:
        name: winrm-2.0.1-rc1
        state: absent

    - name: Reinstall WinRM connector package
      win_package:
        name: winrm-2.0.1-rc1
        state: present

    - name: Start WinRM service
      win_service:
        name: WinRM
        state: started

    - name: Test WinRM connectivity
      win_ping:
      delegate_to: localhost
