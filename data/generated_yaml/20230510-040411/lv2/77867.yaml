
- name: Test include_role bug
  hosts: all
  gather_facts: false
  vars:
    foo: "bar"
    bar: "baz"
    baz: "qux"
  tasks:
    - debug:
        msg: "{{ foo }}"
      when: "item == '{{ foo }}'"
      loop: "{{ ['{{ foo }}', '{{ bar }}', '{{ baz }}'] }}"
    - include_role:
        name: "{{ item }}"
      when: "item != '{{ bar }}'"
      loop: "{{ ['foo', 'bar', 'baz'] }}"
      vars:
        bar: "quux"
    - debug:
        msg: "{{ foo }}"
      when: "item == '{{ bar }}'"
      loop: "{{ ['{{ foo }}', '{{ bar }}', '{{ baz }}'] }}"
