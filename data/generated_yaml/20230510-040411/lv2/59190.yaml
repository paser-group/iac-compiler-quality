
- name: Test vmware_guest module edge cases
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Specifying mem_reservation as an invalid datatype should fail
      vmware_guest:
        hostname: "{{ inventory_hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        name: "{{ vm_name }}"
        memory_mb: "{{ memory_mb }}"
        mem_reservation: "foo"
      register: result
      ignore_errors: yes

    - name: Overwriting mem_reservation with an improper value should raise an error
      vmware_guest:
        hostname: "{{ inventory_hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        name: "{{ vm_name }}"
        memory_mb: "{{ memory_mb }}"
        mem_reservation: "0"
      register: result
      ignore_errors: yes

    - name: Setting mem_reservation to an arbitrary value
      vmware_guest:
        hostname: "{{ inventory_hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        name: "{{ vm_name }}"
        memory_mb: "{{ memory_mb }}"
        mem_reservation: "{{ mem_reservation }}"
      register: result
      ignore_errors: yes

    - name: Defining an invalid memory value should raise a ValueError
      vmware_guest:
        hostname: "{{ inventory_hostname }}"
        username: "{{ username }}"
        password: "{{ password }}"
        name: "{{ vm_name }}"
        memory_mb: "foo"
        mem_reservation: "{{ mem_reservation }}"
      register: result
      failed_when: "'ValueError' in result.stderr"
      ignore_errors: yes
