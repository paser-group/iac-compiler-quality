
---
- name: S3 bucket error test
  hosts: localhost
  tasks:
    - name: Create S3 bucket
      s3_bucket:
        name: "bucket-name"
      ignore_errors: True

    - name: Generate error
      s3_bucket:
        name: "bucket-name"
        state: present
      register: result
      ignore_errors: True

    - name: Fail the playbook if the error matches expectations
      assert:
        that: "'Your previous request to create the named bucket succeeded and you already own it' in result.stderr"
