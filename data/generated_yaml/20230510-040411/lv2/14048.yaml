
- name: Test file state=link bug
  hosts: all
  gather_facts: no
  vars:
    file1: "/tmp/file1"
    file2: "/tmp/file2"
  tasks:
    - name: Create file1
      file:
        path: "{{ file1 }}"
        state: touch
    - name: Create symlink with incorrect destination
      file:
        src: "{{ file1 }}"
        dest: "{{ file1 }}.lnk"
        state: link
        force: yes
    - name: Create symlink with incorrect mode
      file:
        src: "{{ file1 }}"
        dest: "{{ file2 }}"
        state: link
        mode: 777
        force: yes
    - name: Create symlink with incorrect owner
      file:
        src: "{{ file1 }}"
        dest: "{{ file2 }}"
        state: link
        owner: nobody
        force: yes
    - name: Create symlink with incorrect group
      file:
        src: "{{ file1 }}"
        dest: "{{ file2 }}"
        state: link
        group: nosuchgroup
        force: yes
    - name: Create symlink without force flag, should fail
      file:
        src: "{{ file1 }}"
        dest: "{{ file2 }}"
        state: link
    - name: Create symlink with whitespace in destination path
      file:
        src: "{{ file1 }}"
        dest: "{{ file1 }} .lnk"
        state: link
        force: yes
