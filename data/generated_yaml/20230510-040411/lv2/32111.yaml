
- name: Configure non-default VRFs with eos_eapi module
  eos_eapi:
    command_string: "{{ item }}"
    host: "{{ inventory_hostname }}"
    username: "{{ ansible_user }}"
    password: "{{ ansible_password }}"
  with_items:
    - show running-config vrf
    - configure replace vrf test_vrf
    - configure terminal ; ip vrf test_vrf ; exit
    - configure terminal ; interface Loopback100 ; ip vrf forwarding test_vrf ; ip address 10.1.1.1/24 ; no shutdown ; exit
    - configure terminal ; interface Vlan100 ; vrf forwarding test_vrf ; ip address 192.168.0.1/24 ; no shutdown ; exit
    - configure replace vrf default
    - configure terminal ; interface Loopback101 ; ip vrf forwarding management ; ip address 192.168.1.1/24 ; no shutdown ; exit
    - configure terminal ; interface Vlan101 ; vrf forwarding management ; ip address 172.16.1.1/24 ; no shutdown ; exit
