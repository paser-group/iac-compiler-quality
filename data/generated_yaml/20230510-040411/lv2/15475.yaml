
---

- name: Test playbook for template with_dict issue
  hosts: localhost
  gather_facts: false

  vars:
    dict1: {'key1': 'value1'}
    dict2: {'key2': '{{ non_existing_variable }}'}

  tasks:
    - name: Test with_dict with undefined variables in hash value
      template:
        src: test_template.j2
        dest: "{{ item.key }}"
      with_dict:
        "{{ dict1 }} | combine(dict2)"
