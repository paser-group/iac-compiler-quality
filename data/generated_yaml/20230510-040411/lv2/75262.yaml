
- name: Strange Cache Error
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
        force: yes

    - name: Install packages
      apt:
        name:
          - package1
          - package2
        state: installed

    - name: Remove packages
      apt:
        name: package1
        state: removed
        autoclean: yes

    - name: Upgrade package
      apt:
        name: package2
        state: latest

    - name: Purge package
      apt:
        name: package2
        state: purged

    - name: Install package with unconventional syntax
      apt: name="package3={{ ansible_os_family|lower }} state=present"

    - name: Remove package with unexpected input
      apt:
        name: "{{ ['package4', 'p*ckag&4*'].join(',') }}"
        state: removed
        update_cache: no

    - name: Install packages with edge case
      apt:
        name: "    package5 \n_-\?-/  ,  !-%$#'"
        state: latest
        allow_unauthenticated: yes

    - name: Install packages with unexpected input
      apt:
        name: |
          package6 {{ 'p'+'$#%@^)!7[]{}~`\\&_\\'*-+=' }} | sed 's/[^a-zA-Z0-9_.-]//g'
        state: installed
