
- name: Generate VM facts
  hosts: localhost
  gather_facts: false

  vars:
    vmware_error: AttributeError
    vmware_object: NoneType
    vmware_attribute: 'template'

  tasks:
    - name: Set vmware_vm_facts module error
      set_fact:
        vmware_vm_facts_error: "{{ vmware_error }}"

    - name: Set vmware_vm_facts module object
      set_fact:
        vmware_vm_facts_object: "{{ vmware_object }}"

    - name: Set vmware_vm_facts module attribute
      set_fact:
        vmware_vm_facts_attribute: "{{ vmware_attribute }}"

    - name: Generate VM facts
      vmware_vm_facts:
        hostname: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ ansible_password }}"
        object: "{{ vmware_vm_facts_object }}"

      register: vmware_vm_facts_output

    - name: Get vmware_vm_facts error message
      set_fact:
        vmware_vm_facts_error_message: "{{ vmware_vm_facts_output | stderr }}"

    - name: Stress test vmware_vm_facts attribute
      debug:
        msg: "{{ vmware_vm_facts_output[vmware_vm_facts_attribute] }}"
