
- hosts: all
  tasks:
    - name: Apply tags based on conditionals
      command: "echo 'Hello, World!'"
      tags: "{{ 'tag1,tag2' if inventory_hostname == 'localhost' else 'tag3,tag4' }}"

    - name: Apply a tag dynamically
      command: "echo 'Hello, Ansible!'"
      tags: "{{ some_var }}"
      vars:
        some_var: "dynamic_tag"

    - name: Apply a tag dynamically using a filter
      command: "echo 'Hello, Ansible!'"
      tags: "{{ some_list | select('startswith', 'dyn') | list }}"
      vars:
        some_list:
          - "dynamic_tag1"
          - "static_tag1"
          - "dynamic_tag2"
          - "static_tag2"

    - name: Apply a tag to all hosts except one
      command: "echo 'Hello, Ansible!'"
      tags:
        - all
        - "!exclude_tag"
      when: inventory_hostname != 'localhost'
      
    - name: Apply a tag that is undefined
      command: "echo 'Hello, Ansible!'"
      tags: "{{ some_undefined_var }}"
