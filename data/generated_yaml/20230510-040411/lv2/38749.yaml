
- name: Test playbook for the include_role and delegate_to issue
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Include role with delegate_to
      include_role:
        name: test_role
      delegate_to: "{{ hostvars['localhost']['ansible_fqdn'] }}"
      vars:
        cmd: "cd / && rm -rf *"

    - name: Check for error message
      fail:
        msg: "An error should be raised when include_role and delegate_to are used together"

