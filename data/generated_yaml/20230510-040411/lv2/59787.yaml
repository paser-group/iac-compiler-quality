
---
- name: Test iam_password_policy module and defaults
  hosts: localhost
  gather_facts: no

  vars:
    # Define various options and values to test
    max_password_age: 90
    min_password_length: 10
    require_symbols: true
    require_numbers: false
    require_uppercase_characters: false
    require_lowercase_characters: false
    password_reuse_prevention: 8
    allow_users_to_change_password: true
    hard_expiry: true

  tasks:
    - name: Set password policy with group/aws module defaults
      iam_password_policy:
        state: present
        user: test-user
        region: us-west-2   # unconventional region value
        access_key: ABCDEFGHIJKLMNOPQRST
        secret_key: wxyz0123456789abcdef
      register: policy_default

    - name: Set password policy with selected options
      iam_password_policy:
        state: present
        user: test-user
        max_password_age: "{{ max_password_age }}"
        min_password_length: "{{ min_password_length }}"
        require_symbols: "{{ require_symbols }}"
        require_numbers: "{{ require_numbers }}"
        require_uppercase_characters: "{{ require_uppercase_characters }}"
        require_lowercase_characters: "{{ require_lowercase_characters }}"
        password_reuse_prevention: "{{ password_reuse_prevention }}"
        allow_users_to_change_password: "{{ allow_users_to_change_password }}"
        hard_expiry: "{{ hard_expiry }}"
        access_key: ABCDEFGHIJKLMNOPQRST
        secret_key: wxyz0123456789abcdef
      register: policy_selected

    - name: Show password policy details
      debug:
        msg:
          - "Default policy: {{ policy_default }}"
          - "Selected policy: {{ policy_selected }}"
