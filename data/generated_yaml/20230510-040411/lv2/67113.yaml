
---
- name: Test Macports Upgrade Reporting
  hosts: localhost
  gather_facts: no

  tasks:

  - name: Install Macports
    command: sudo port install macports

  - name: Upgrade non-existing package with error condition
    command: sudo port -d selfupdate && sudo port -d upgrade something_that_does_not_exist
    register: upgrade_status
    ignore_errors: true

  - name: Report changes if something was upgraded
    debug:
      msg: |
        {% if upgrade_status.stdout_lines | join("\n") | search("upgraded") %}
          Report changes as something was upgraded
        {% else %}
          Do not report changes as nothing was upgraded
        {% endif %}
