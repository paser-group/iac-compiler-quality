
- name: Test when conditional with debug and items/with_items
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Debug message with when condition and items
      debug:
        msg: "Testing when conditional with items: {{ item }}"
      when: item == 'test'
      with_items:
        - foo
        - bar
        - test
        - baz

    - name: Debug message with when condition and with_items
      debug:
        msg: "Testing when conditional with with_items: {{ item }}"
      when: item == 'test'
      with_items:
        - foo
        - bar
        - "{{ ['test'] }}"

    - name: Debug message with failed when condition and with_items
      debug:
        msg: "Testing failed when condition with with_items"
      when: item == 'test' and item == 'foo'
      with_items:
        - foo
        - bar
        - "{{ ['test'] }}"

    - name: Debug message with loop and when condition
      debug:
        msg: "Testing loop with when condition: {{ item }}"
      when: item == 'test'
      loop:
        - foo
        - bar
        - test
        - baz

    - name: Debug message with unexpected input
      debug:
        msg: "Testing unexpected input: {{ item }}"
      when: item == 'test {{ some_unexpected_input }}'
      loop:
        - "foo"
        - "bar"
