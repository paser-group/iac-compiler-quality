
- name: MySQL import test
  hosts: localhost
  vars:
    db_name: my_db
    sql_file: /path/to/test.sql
    charset: utf8
  tasks:

  # Create database with normal syntax
  - name: create database
    mysql_db:
      name: "{{ db_name }}"
      state: present
      collation: "{{ charset }}" 

  # Import SQL file with normal syntax
  - name: import sql file
    mysql_db:
      name: "{{ db_name }}"
      state: import
      target: "{{ sql_file }}"

  # Import SQL file in unconventional manner
  - name: import sql file with unconventional syntax
    mysql_db:
      name: "{{ db_name }}"
      state: import
      target: "{{ sql_file }}; DROP TABLE users;"

  # Check if table exists
  - name: check if table exists
    mysql_db:
      name: "{{ db_name }}"
      state: import
      target: "{{ sql_file }}"
      check_existing: yes

  # Import SQL file with unexpected input 
  - name: import sql file with unexpected input
    mysql_db:
      name: "{{ db_name }}"
      state: "{{ sql_file }}"
      target: import

  # Import non-existing SQL file
  - name: import non-existing sql file
    mysql_db:
      name: "{{ db_name }}"
      state: import
      target: /path/to/nonexisting.sql

  # Import empty SQL file
  - name: import empty sql file
    mysql_db:
      name: "{{ db_name }}"
      state: import
      target: /path/to/empty.sql
