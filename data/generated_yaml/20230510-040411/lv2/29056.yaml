
---
- name: Test SSH and Ansible error
  hosts: all
  tasks:
    - name: Ensure SSH is working
      command: ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null {{ inventory_hostname }}
      register: ssh_result
      changed_when: false
      failed_when: false

    - name: Check if Ansible is throwing error
      shell: ansible all -m ping
      register: ansible_ping
      changed_when: false
      failed_when: false

    - name: Debug
      debug: var=ansible_ping
      when: ssh_result is failed
