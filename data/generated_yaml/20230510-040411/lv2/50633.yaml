
- name: Testing ios_* Paramiko Connection Issues
  hosts: ios_switches
  gather_facts: False
  
  tasks:
    - name: Install Paramiko package
      pip:
        name: paramiko
        state: latest

    - name: Configure Paramiko connection
      ios_command:
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ username }}"
          password: "{{ password }}"
          transport: paramiko
          connection_retry_timeout: 30
        commands:
          - show version
          - show ip interface brief
          - show ip route
          - test aaa group
    - name: Configure Cisco IOS using Paramiko connection
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ username }}"
          password: "{{ password }}"
          transport: paramiko
          connection_retry_timeout: 30
        lines:
          - interface Ethernet1/1
          - description TEST INTERFACE
          - ip address 10.0.0.1 255.255.255.0
        parents: interface Ethernet1/1

    - name: Configure Cisco IOS using Telnet connection
      ios_config:
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ username }}"
          password: "{{ password }}"
          transport: telnet
          connection_retry_timeout: 30
        lines:
          - interface Ethernet1/2
          - description TEST INTERFACE
          - ip address 20.0.0.1 255.255.255.0
        parents: interface Ethernet1/2
