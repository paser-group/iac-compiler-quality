
- name: Test playbook for variable precedence
  hosts: localhost
  vars:
    my_array:
      - item1
      - "{{ my_var }}"
      - item2

  tasks:
    - name: Print array values
      debug:
        var: my_array

    - name: Set a group variable
      set_fact:
        group_var: "{{ group_vars['all']['my_var'] }}"

    - name: Print the group variable
      debug:
        var: group_var

    - name: Create nested dictionary
      set_fact:
        my_dict:
          - key1:
              - "{{ my_array }}"
            key2:
              - "{{ group_var }}"

    - name: Print the final dictionary
      debug:
        var: my_dict
