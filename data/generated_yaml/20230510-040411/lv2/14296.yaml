
---
- hosts: all
  become: yes
  vars:
    - default_var: "initial_value"
  tasks:
    - name: set default_var within a loop
      debug:
        var: default_var
      with_items:
        - "new_value_1"
        - "new_value_2"
        - "new_value_3"
      vars:
        default_var: "{{ item }}"
    - name: set default_var to a list of values
      set_fact:
        default_var: "{{ default_var | default([]) + [item | string] }}"
      loop:
        - "new_value_4"
        - 5
        - "{{ not_defined }}"
  vars:
    - default_var: "final_value"
