
- name: Stress Testing the win_shortcut module
  hosts: windows_servers
  gather_facts: yes
  tasks:
    - name: Create a shortcut with conventional parameters, ensures idempotence
      win_shortcut:
        path: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Notepad++.lnk
        target: C:\Program Files\Notepad++\notepad++.exe
      register: shortcut_result

    - name: Create a shortcut with non-conventional syntax, ensures idempotence
      win_shortcut:
        path: C:\Users\Administrator\Desktop\Ansible.lnk
        arguments: '"C:\Program Files\Ansible\ansible-playbook.exe" -i hosts playbook.yml'
        hotkey: 'ALT+CTRL+A'
      register: shortcut_result

    - name: Update the same shortcut using different methods, ensures idempotence
      win_shortcut:
        path: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Notepad++.lnk
        target: C:\Windows\System32\notepad.exe
        arguments: ' '
      register: shortcut_result

    - name: Attempt to create a shortcut with invalid inputs, should fail
      win_shortcut:
        path: C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Invalid.lnk
      ignore_errors: yes
      register: error_result

    - name: Verify shortcut creation/update status
      assert:
        that: shortcut_result.changed | bool
        msg: "Shortcut not created/updated successfully"

    - name: Verify error message generated by using invalid inputs
      assert:
        that: "'Invalid shortcut target or shortcut file already exists' in error_result.msg"
        msg: "Unexpected error message"
