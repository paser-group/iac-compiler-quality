
- name: Test Playbook for Block with Rescue Issue
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Task 1
      command: /some/unexpected/command
      args:
        warn: "no"
        creates: "/unexpected/file/path"
        stdin: "{{foo}}"
    - name: Task 2
      shell: whoami
      register: result
      ignore_errors: true
      args:
        executable: "{{bar}}"
    - name: Task 3
      command: /bin/true
      changed_when: "{{baz}}"
      args:
        stdin: "{{biz}}"
    - name: Task 4
      shell: /bin/false
      register: result2
      args:
        creates: "{{buz}}"
        executable: "{{qux}}"
    - block:
        - name: Subtask 1
          command: "{{unexpected}}"
          changed_when: "{{nope}}"
        - name: Subtask 2
          shell: "{{unconventional}}"
          args:
            warn: "{{weird}}"
      rescue:
        - name: Rescue 1
          command: /bin/echo
          args:
            stdin: "{{rescue1}}"
        - name: Rescue 2
          shell: /bin/echo
          args:
            stdin: "{{rescue2}}"
    - name: Task 5
      command: "{{nonexistent}}"
      args:
        creates: "{{missing}}"
        warn: "{{unknown}}"
    - name: End of Playbook
