
- name: Environment variable evaluated as template issue playbook
  hosts: localhost
  become: yes
  
  vars:
    message: "{{ lookup('env','MESSAGE') }}"
    
  tasks:
    - name: Ensure environment variable is present
      assert:
        that: "'MESSAGE' in lookup('env', 'MESSAGE')"
        
    - name: Evaluate environment variable as a template
      set_fact:
        template_output: "{{ message | default('Hello world! \\{{ nonexistent }}', True) }}"
        
    - name: Print the output of evaluated template
      debug:
        var: template_output
        
    - name: Trigger fatal error
      set_fact:
        nonexistent_var: "{{ nonexistent }}"
