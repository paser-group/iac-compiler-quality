
- hosts: localhost
  vars:
    includes_list:
      - path: "{{ playbook_dir }}/tasks/invalid.yml"
      - path: "{{ playbook_dir }}/tasks/valid.yml"
  tasks:
    - block:
        - name: Include invalid tasks file
          include: "{{ item.path }}"
          any_errors_fatal: true
        loop: "{{ includes_list }}"
      rescue:
        - name: Handle any fatal errors during invalid tasks file inclusion
          debug:
            msg: "Invalid tasks file '{{ item.path }}' caused fatal error."
        loop: "{{ includes_list }}"
      
    - block:
        - name: Include valid tasks file
          include: "{{ item.path }}"
          any_errors_fatal: false
        loop: "{{ includes_list }}"
      rescue:
        - name: Handle any fatal errors during valid tasks file inclusion
          debug:
            msg: "Valid tasks file '{{ item.path }}' caused fatal error."
        loop: "{{ includes_list }}"
