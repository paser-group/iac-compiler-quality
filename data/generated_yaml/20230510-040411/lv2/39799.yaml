
---
- hosts: localhost
  connection: local
  vars:
    resource_group: "{{ '-' * 400 }}"
    nic_name: "{{ 'nic-' * 400 }}"
    nsg_name: "{{ 'nsg-' * 400 }}"
  tasks:
    - name: Create Network Interface with default NSG
      azure_rm_networkinterface:
        resource_group: "{{ resource_group }}"
        name: "{{ nic_name }}"
        virtual_network_name: "test-vnet"
        subnet_name: "test-subnet"
        public_ip_name: "test-public-ip"
        network_security_group_name: "{{ nsg_name }}"
      register: result

    - name: Fail the Playbook if Network Interface creation was not successful
      fail:
        msg: "Failed to create Network Interface with default NSG"

    - name: Delete created Network Interface
      azure_rm_networkinterface:
        resource_group: "{{ resource_group }}"
        name: "{{ nic_name }}"
        state: absent
