
- hosts: all
  vars:
    group_vars:
      group1:
        var1: "group1_var1"
      group2:
        var1: "group2_var1"
  tasks:
    - name: Check if the server is in both group1 and group2
      debug:
        msg: "This server is in both group1 and group2"
      when:
        - "'group1' in group_names"
        - "'group2' in group_names"

    - name: Check if the server is not in either group1 and group2
      debug:
        msg: "This server is not in either group1 or group2"
      when:
        - "'group1' not in group_names"
        - "'group2' not in group_names"

    - name: Apply group1 var to the server not belonging to group1
      set_fact:
        var2: "{{ group_vars['group1']['var1'] }}"
      when:
        - "'group1' not in group_names"

    - name: Apply group2 var to the server not belonging to group2
      set_fact:
        var2: "{{ group_vars['group2']['var1'] }}"
      when:
        - "'group2' not in group_names"
