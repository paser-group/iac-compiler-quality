
- name: Slack notification failure edge cases
  hosts: localhost
  vars:
    slack_webhook_url: "https://hooks.slack.com/services/TOKEN/CHANNEL/ID"

  tasks:
    - name: Send slack notification
      slack:
        token: "{{ slack_webhook_url }}"
        channel: "#general"
        message: "{{ some_message + undefined_variable }}"
        color: "{{ random_color }}"
        username: "{{ long_username | upper }}"
        icon_url: "{% if random() < 0.5 %}http://invalid_url{% endif %}"
        icon_emoji: "{% if random() < 0.5 %}:invalid_emoji{% endif %}"
      ignore_errors: yes

    - name: Wait for Slack API failure
      wait_for:
        port: "{{ random_port }}"
        delay: "{{ random_delay }}"
        timeout: "{{ random_timeout }}"
        msg: "{{ some_message }}"
