
- name: Test synchronize module with local_action
  hosts: all
  gather_facts: False

  tasks:
    - name: Test unusual remote_user configuration
      synchronize:
        src: /tmp/source
        dest: /tmp/destination
        delete: yes
      vars:
        ansible_connection: local
        ansible_shell_type: fish
        remote_user: ${{ lookup('env', 'USER') }}

    - name: Test remote_user invalid syntax
      synchronize:
        src: /tmp/source
        dest: /tmp/destination
        delete: yes
      vars:
        ansible_connection: local
        ansible_shell_type: fish
        remote_user: "{{ variable }"

    - name: Test remote_user set to null
      synchronize:
        src: /tmp/source
        dest: /tmp/destination
        delete: yes
      vars:
        ansible_connection: local
        ansible_shell_type: fish
        remote_user:

    - name: Test with wrong ssh key provided
      synchronize:
        src: /tmp/source
        dest: /tmp/destination
        delete: yes
      vars:
        ansible_connection: ssh
        ansible_ssh_private_key_file: /non/existent/pem/file
        remote_user: root

    - name: Test with wrong ssh password provided
      synchronize:
        src: /tmp/source
        dest: /tmp/destination
        delete: yes
      vars:
        ansible_connection: ssh
        ansible_ssh_password: incorrect_password
        remote_user: root     
