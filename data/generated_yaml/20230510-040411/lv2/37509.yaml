
- name: Test AWX templating error
  hosts: localhost
  vars:
    myvar: "{{ lookup('env','HOME') }}"
    myfilename: "{{ '/tmp/'+myvar+'-filename' }}"
    mylist:
      - 1
      - 2
      - "{{ myvar }}"
  tasks:
    - name: Set fact via template
      set_fact:
        myfact: "{{ myvar }}"
    - name: Set fact with default value
      set_fact:
        myfact: "{{ notdefinedvar | default('defaultvalue') }}"
    - name: Set fact with arithmetic
      set_fact:
        myfact: "{{ 1 + 2 }}"
    - name: Set fact with conditionals
      set_fact:
        myfact: "{{ 'yes' if myvar == 'something' else 'no' }}"
    - name: Set fact with nested variables
      set_fact:
        myfact: "{{ myvar }} {{ mylist[0] }}"
    - name: Set fact with nested Jinja expressions
      set_fact:
        myfact: "{{ mylist[ (1 + 1) | int ] }}"
    - name: Set fact with invalid syntax in template
      set_fact:
        myfact: "{{ myvar + }}"

