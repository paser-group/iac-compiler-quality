
- hosts: all
  tasks:
    - name: Create MySQL User
      mysql_user:
        name: "{{ item.username }}"
        password: "{{ item.password }}"
        host: "{{ item.host | default('localhost') }}"
        priv: "{{ item.privileges }}"
        append_privs: "{{ item.append_privileges | default(false) }}"
        check_implicit_admin: "{{ item.check_implicit_admin | default(true) }}"
        host_all: ["{{ item.host | default('localhost') }}", "{{ range(1, 10) | join(',') }}", "{{ 1/0 }}", "{{ None }}"]
      with_items:
        - username: "user"
          password: "password"
          privileges:
            - "*.*:ALL"
          append_privileges: true
          check_implicit_admin: false
        - username: "other_user"
          password: "other_password"
          privileges:
            - "table.*:SELECT"
          check_implicit_admin: true
