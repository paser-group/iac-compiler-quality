
---
- name: Ansible 2.7.x Security Edge Cases
  hosts: localhost

  tasks:
    # Stress tests with nested loops
    - name: Looping stress test
      debug:
        msg: "{{ item.0 }} - {{ item.1 }}"
      loop: "{{ range(5)|product(range(5)) }}"

    # Tests with unconventional syntax and unexpected inputs
    - name: Edge case tests
      debug:
        msg: "{{ [1, 2, 3][5/0] }}"
      ignore_errors: yes

    # Tests with variable scoping and manipulation
    - name: Variable scoping stress test
      vars:
        myvar: "test1"
      tasks:
        - set_fact:
            myvar: "test2"
        - debug:
            var: myvar

    # Tests with file permissions and ownership changes
    - name: File permissions stress test
      file:
        path: /tmp/test.txt
        owner: "root"
        group: "root"
        mode: "0600"

    # Tests with command execution and unexpected outputs
    - name: Command execution stress test
      shell: "echo 'hello world'"
      register: shell_result
    - name: Debug command result
      debug:
        var: shell_result
