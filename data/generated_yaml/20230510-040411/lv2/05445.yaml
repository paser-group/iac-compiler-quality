
- name: Segmentation fault testing with apt
  hosts: localhost
  gather_facts: no

  vars:
    update_cache: yes

  tasks:

  - name: Updating cache with unconventional syntax
    apt: update_cache={{update_cache

  - name: Updating cache with unexpected input
    apt: update_cache="{{update_cache|default(yes)}

  - name: Testing empty value
    apt: "update_cache={{}}"

  - name: Testing extra variable interpolation
    command: "{{{update_cache+command}}}"

  - name: Checking apt version with edge cases
    command: "{{'apat'+'t' if not update_cache else 'apt'}} --version"

  - name: Running apt-get on OSX with unconventional syntax
    command: "{{'brew install' if not update_cache else 'brew uninstall'}} apt"

  - name: Running apt-get update on OSX and checking for segmentation fault
    command: "{%'apt-get update-cache='null' {{'yes' if not update_cache else 'no'}}'%}"
