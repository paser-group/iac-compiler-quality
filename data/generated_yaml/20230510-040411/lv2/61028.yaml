
---
- name: gcp_container_cluster with private_cluster_config
  hosts: localhost
  gather_facts: no
  vars:
    project_id: "my-project"
    zone: "us-central1-a"
    cluster_name: "cluster-1"
    network_policy_enabled: "true"
    private_cluster_config: "true"
    master_node_count: "1"
    invalid_input: "*&^%$"
  tasks:
    - name: Create container cluster with enabled private cluster configuration
      gcp_container_cluster:
        name: "{{ cluster_name }}"
        project: "{{ project_id }}"
        zone: "{{ zone }}"
        network_policy_enabled: "{{ network_policy_enabled }}"
        private_cluster_config: "{{ private_cluster_config }}"
        initial_node_count: "{{ master_node_count }}"
      register: result

    - name: Check if the cluster creation fails with invalid input
      gcp_container_cluster:
        name: "{{ invalid_input }}"
        project: "{{ project_id }}"
        zone: "{{ zone }}"
        network_policy_enabled: "{{ network_policy_enabled }}"
        private_cluster_config: "{{ private_cluster_config }}"
        initial_node_count: "{{ master_node_count }}"
      ignore_errors: yes

    - name: Print the result variable
      debug:
        var: result
