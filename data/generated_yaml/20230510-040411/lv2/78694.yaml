
- name: Test command module error handling
  hosts: all
  tasks:
    - name: Test normal command execution
      command: echo "Hello World"
    
    - name: Test indefinite command wait
      command: "sleep infinity"

    - name: Test invalid command syntax
      command: "echo 'Hello World' &
                && sleep 5"
                
    - name: Test long-running command timeout
      command: "sleep 30"
      async: 30
      poll: 0

    - name: Test command failure
      command: "rm /nonexistent_file"
      ignore_errors: yes
    
    - name: Test unconventionally quoted command
      command: "echo \"Hello World\" 'Ansible'"
    
    - name: Test command failure with register
      command: "rm /nonexistent_file"
      register: result
      ignore_errors: yes
      failed_when: result.rc == 0
    
    - name: Test command failure with changed_when
      command: "rm /nonexistent_file"
      changed_when: False
      ignore_errors: yes
