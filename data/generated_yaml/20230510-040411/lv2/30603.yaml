
- name: Test ansible_default_ipv4 fact on Linux Subsystem for Windows
  hosts: localhost
  gather_facts: true

  tasks:
  - name: Check if ansible_default_ipv4 is empty
    debug:
      msg: "ansible_default_ipv4 is empty"
    when: ansible_default_ipv4 == ""

  - name: Check if ansible_default_ipv4 is defined
    debug:
      msg: "ansible_default_ipv4 is defined"
    when: ansible_default_ipv4 is defined

  - name: Check if ansible_default_ipv4 is an IPv4 address
    debug:
      msg: "ansible_default_ipv4 is not an IPv4 address"
    when: ansible_default_ipv4 is match("^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$") | bool == false

  - name: Check if ansible_default_ipv4 is a valid IP address
    debug:
      msg: "ansible_default_ipv4 is not a valid IP address"
    when: ansible_default_ipv4 is ipaddr(0)

  - name: Check if ansible_default_ipv4 is not a private IP address
    debug:
      msg: "ansible_default_ipv4 is a private IP address"
    when: ansible_default_ipv4 is match("^127\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$|^(10\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})$|^(192\.168\.[0-9]{1,3}\.[0-9]{1,3})$|^(172\.(1[6-9]|2[0-9]|3[0-1])\.[0-9]{1,3}\.[0-9]{1,3})$") | bool == true

  - name: Check if ansible_default_ipv4 is not a reserved IP address
    debug:
      msg: "ansible_default_ipv4 is a reserved IP address"
    when: ansible_default_ipv4 is match("^(0\.0\.0\.0|255\.255\.255\.255)$") | bool == true

  - name: Check if ansible_default_ipv4 is a multicast IP address
    debug:
      msg: "ansible_default_ipv4 is a multicast IP address"
    when: ansible_default_ipv4 is match("^(22[4-9]|23[0-9])\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$") | bool == true

  - name: Check if ansible_default_ipv4 is not a link-local IP address
    debug:
      msg: "ansible_default_ipv4 is a link-local IP address"
    when: ansible_default_ipv4 is match("^169\.254\.[0-9]{1,3}\.[0-9]{1,3}$") | bool == true

  - name: Check if ansible_default_ipv4 is not a loopback IP address
    debug:
      msg: "ansible_default_ipv4 is a loopback IP address"
    when: ansible_default_ipv4 is match("^127\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$") | bool == true

  - name: Check if ansible_default_ipv4 is not a multicast, broadcast or anycast IP address
    debug:
      msg: "ansible_default_ipv4 is a multicast, broadcast or anycast IP address"
    when: ansible_default_ipv4 is match("^(22[4-9]|23[0-9])\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$|^255\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$|^224\.0\.[0-9]{1,3}\.[0-9]{1,3}$|^169\.254\.[0-9]{1,3}\.[0-9]{1,3}$") | bool == true
