
- name: Test delegate_to
  hosts: all
  tasks:
    - name: Top-level task
      shell: whoami
      delegate_to: "{{ groups['databases'][0] }}"
      ignore_errors: yes
      register: result

    - name: Check SSH errors
      fail:
        msg: "SSH error detected"
      when: "'SSH Error' in result.stderr_lines"
