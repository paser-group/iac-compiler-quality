
---
- name: Test ansible_user_* facts inconsistency
  hosts: all
  tasks:
    - name: Check current user
      debug:
        msg: "Current user is {{ ansible_user }}"

    - name: Test sudo become method with user override
      become: yes
      become_method: sudo
      become_user: root
      debug:
        msg: "Sudo user is {{ ansible_user }}"

    - name: Test su become method with user override
      become: yes
      become_method: su
      become_user: root
      debug:
        msg: "Su user is {{ ansible_user }}"

    - name: Test sudo become method with default user
      become: yes
      become_method: sudo
      debug:
        msg: "Sudo default user is {{ ansible_user_sudo }}"

    - name: Test su become method with default user
      become: yes
      become_method: su
      debug:
        msg: "Su default user is {{ ansible_user_su }}"

    - name: Test sudo become method with user override and non-existent user
      become: yes
      become_method: sudo
      become_user: nonexistent_user
      debug:
        msg: "Sudo non-existent user is {{ ansible_user }}"

    - name: Test su become method with user override and non-existent user
      become: yes
      become_method: su
      become_user: nonexistent_user
      debug:
        msg: "Su non-existent user is {{ ansible_user }}"
