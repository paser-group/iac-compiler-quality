
- hosts: localhost
  tasks:
    - azure_rm_virtualmachine_facts:
        resource_group: "{{ random_string(length=10, chars=ascii_letters + digits) }}"
        vm_name: "{{ random_string(length=10, chars=ascii_letters + digits) }}"
        tags:
          "{{ random_string(length=10, chars=ascii_letters + digits) }}": "{{ random_string(length=10, chars=ascii_letters + digits) }}"
        subresource_names:
          - nic
          - osdisk
          - datadisks
      register: vm_facts

    - debug:
        var: vm_facts
