
- hosts: all
  gather_facts: no

  vars:
    password: "mysecretpassword"

  tasks:
    - name: Encrypt a file with a password file
      command: ansible-vault encrypt --vault-password-file={{ password_file }} {{ item }}
      with_items:
        - foo.txt
        - bar.txt
      register: result

    - name: Check the encryption status
      debug: var=result

    - name: Decrypt a file with a password prompt
      command: ansible-vault decrypt {{ item }}
      with_items:
        - foo.txt
        - bar.txt
      register: result

    - name: Check the decryption status
      debug: var=result

    - name: Decrypt a file with a password file using an invalid password
      command: ansible-vault decrypt --vault-password-file={{ password_file }} --new-vault-password-file={{ new_password_file }} {{ item }}
      with_items:
        - foo.txt
        - bar.txt
      register: result

    - name: Check the decryption status with an invalid password
      debug: var=result

    - name: Decrypt a file with a password file using an empty password
      command: ansible-vault decrypt --vault-password-file={{ empty_password_file }} {{ item }}
      with_items:
        - foo.txt
        - bar.txt
      register: result

    - name: Check the decryption status with an empty password
      debug: var=result
