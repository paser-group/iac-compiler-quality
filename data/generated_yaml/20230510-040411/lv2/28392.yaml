
---
- hosts: localhost
  connection: local
  tasks:
  - name: Create a VM
    azure_rm_virtualmachine:
      resource_group: myResourceGroup
      name: myVM
      image:
        offer: UbuntuServer
        publisher: Canonical
        sku: '18.04-LTS'
        version: latest
      size: Standard_B1s
      admin_username: myadmin
      admin_password: MyP@ssw0rd1234
      network_interfaces:
        - name: myNIC1
          primary: True
      os_disk:
        create_option: fromImage
        managed_disk_type: Standard_LRS
        disk_size_gb: 128
      data_disks:
        - name: myDataDisk1
          disk_size_gb: 4096
          create_option: fromImage
          lun: 0
    register: vm_result
  - name: Errors for cleaning up after VM with failed deploy
    azure_rm_virtualmachine:
      resource_group: myResourceGroup
      name: myVM
      image:
        offer: UbuntuServer
        publisher: Canonical
        sku: '18.04-LTS'
        version: latest
      size: Standard_B1s
      admin_username: myadmin
      admin_password: MyP@ssw0rd1234
      network_interfaces:
        - name: myNIC1
          primary: True
      os_disk:
        create_option: fromImage
        managed_disk_type: Standard_LRS
        disk_size_gb: 128
      data_disks:
        - name: myDataDisk1
          disk_size_gb: 4096
          create_option: fromImage
          lun: 0
      # Invalid syntax
      ssh_port: "22
      # Unexpected input
      vm_count: 1
    ignore_errors: yes
