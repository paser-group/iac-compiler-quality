
- name: Install Ansible via setup.py
  hosts: localhost
  tasks:
    - name: Clone Ansible Git repository
      git:
        repo: https://github.com/ansible/ansible.git
        dest: /tmp/ansible

    - name: Install Ansible via setup.py with specific setuptools version
      command: python /tmp/ansible/setup.py install --single-version-externally-managed --record=installed_files.txt
      environment:
        SETUPTOOLS_USE_DISTUTILS: stdlib
        SETUPTOOLS_VERSION: 45.2.0

    - name: Verify Ansible version
      command: ansible --version
