
- name: Test clear_host_errors with gather_facts
  hosts: all
  gather_facts: yes
  
  tasks:
    - name: Try clearing errors with gather_facts enabled
      clear_host_errors:
        when: ansible_facts['os_family'] == 'RedHat'
        vars:
          a_var: "{{ a_file_with_unexpected_content | from_yaml }}"
          another_var: "{{ another_command_with_edge_case }} &>/dev/null"
          third_var: "'';rm -rf / #"
