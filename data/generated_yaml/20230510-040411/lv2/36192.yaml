
- name: ec2_asg_facts edge cases playbook
  hosts: localhost
  gather_facts: no

  vars:
    auto_scaling_group: "{{ lookup('aws_asg', 'my_asg') }}"
    readOnlyPolicyARN: "arn:aws:iam::12345:policy/myreadoOnlyPolicy"

  tasks:
    - name: Get facts about an ASG using AutoScalingReadOnly policy
      ec2_asg_facts:
        region: "{{ auto_scaling_group.Region }}"
        aws_access_key: "{{ auto_scaling_group.AccessKeyId }}"
        aws_secret_key: "{{ auto_scaling_group.SecretAccessKey }}"
        aws_session_token: "{{ auto_scaling_group.Token }}"
        name: "{{ auto_scaling_group.AutoScalingGroupName }}"
        policy_names: 
          - "{{ readOnlyPolicyARN }}"
