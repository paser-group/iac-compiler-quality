
---
- hosts: windows
  vars:
    xml_fragment: "<xml><node1>Lorem Ipsum</node1><node2>dolor sit amet</node2><node3>consectetur adipiscing elit</node3></xml>"
  tasks:
    - name: Install XML module
      win_chocolatey:
        name: xmlstarlet
        state: present

    - name: Add XML fragment to file
      win_shell: |
        xmlstarlet ed -s "//tag1" -t elem -n "newTag" -v "{{ xml_fragment }}" file.xml
      register: output

    - name: Print output
      debug:
        var: output.stderr_lines
