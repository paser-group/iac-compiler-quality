
- name: Stress Test Playbook
  hosts: all
  any_errors_fatal: yes
  gather_facts: no
  
  tasks:
    - name: Task 1
      debug:
        msg: "This is task 1."
      run_once: yes
      
    - name: Task 2
      debug:
        msg: "This is task 2. A previously active host should be reactivated."
      when: active_host is not defined
      
    - name: Task 3
      debug: 
        msg: "This is task 3. Any errors fatal."
      
    - name: Task 4
      debug:
        msg: "This is task 4. It uses unconventional syntax."
      when: "'loop_var' not in item"
      with_items:
        - foo
        - bar
      loop_control:
        loop_var: "{{ item }}"
        
    - name: Task 5
      fail:
        msg: "This is task 5. It should fail."
      when: "'localhost' in inventory_hostname"
      
    - name: Task 6
      shell: "echo {{ ansible_managed }}"
      register: command_output
      failed_when: false
      
    - name: Task 7
      debug:
        msg: "This is task 7."
      when: not ('localhost' in group_names) and command_output.rc == 0
