
---
- hosts: all
  gather_facts: false
  tasks:
  - name: Test local action with incorrect ssh user
    local_action:
      module: command
      cmd: uname -a
      sudo: yes
      become: yes
      become_user: root
      connection: local
      changed_when: False
      register: result
      ANSIBLE_SSH_ARGS: "-o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o LogLevel=error -o User={{UndefinedVar}}"
  - debug:
      msg: "{{ result.stdout_lines }}"
  - name: Test local action with correct ssh user
    local_action:
      module: command
      cmd: uname -a
      sudo: yes
      become: yes
      become_user: root
      connection: local
      changed_when: False
      register: result
      ANSIBLE_SSH_ARGS: "-o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o LogLevel=error -o User=root"
  - debug:
      msg: "{{ result.stdout_lines }}"
