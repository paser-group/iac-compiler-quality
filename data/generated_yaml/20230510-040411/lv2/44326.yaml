
- name: VMware Portgroup Security Policy Test
  hosts: all
  gather_facts: false

  tasks:
    - name: Set security policy
      vmware_portgroup:
        name: "{{ item }}"
        security:
          allow_promiscuous: "{{ 'true' if item is divisibleby 2 else 'false' }}"
          authorize: "{{ 'true' if item is divisibleby 3 else 'false' }}"
          mac_changes: "{{ 'true' if item is divisibleby 5 else 'false' }}"
          forgework: "{{ 'true' if item is divisibleby 7 else 'false' }}"
        state: present
      with_sequence: start=1 end=20

    - name: Update security policy with false value
      vmware_portgroup:
        name: "{{ item }}"
        security:
          allow_promiscuous: {{ false if item is divisibleby 2 else true }}
        state: present
      with_sequence: start=1 end=20

    - name: Remove security policy
      vmware_portgroup:
        name: "{{ item }}"
        security:
          allow_promiscuous: "{{ 'true' if item is divisibleby 2 else 'false' }}"
          authorize: "{{ 'true' if item is divisibleby 3 else 'false' }}"
          mac_changes: "{{ 'true' if item is divisibleby 5 else 'false' }}"
          forgework: "{{ 'true' if item is divisibleby 7 else 'false' }}"
        state: absent
      with_sequence: start=1 end=20
