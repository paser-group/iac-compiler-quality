
- name: Test playbook for issue "including a play will cause load error for the role behind it"
  hosts: localhost
  gather_facts: false
  vars:
    role_to_include: "{{ 'my_role' }}"
    invalid_role_name: "@!#$%^&*()_+{}|:<>?,./;"
  
  tasks:
  
  - name: Include role with valid name
    include_role:
      name: "{{ role_to_include }}"
      
  - name: Include role with invalid name
    include_role:
      name: "{{ invalid_role_name }}"
      
  - name: Include play with no role behind it
    include_playbook:
      playbook: "{{ playbook_dir }}/playbook_with_no_role.yml"
      
  - name: Include play with a role that's not defined
    include_playbook:
      playbook: "{{ playbook_dir }}/playbook_with_undefined_role.yml"
      
  - name: Include role with extra variables
    include_role:
      name: "{{ role_to_include }}"
    vars:
      extra_variable: "this_is_an_extra_variable"
      
  - name: Include role with tags
    include_role:
      name: "{{ role_to_include }}"
    tags:
      - tag1
      - tag2
      
  - name: Include role with skip_tags
    include_role:
      name: "{{ role_to_include }}"
    skip_tags:
      - skip_tag1
      - skip_tag2
      
  - name: Include role with different inventory
    include_role:
      name: "{{ role_to_include }}"
    inventory: "{{ inventory_dir }}/inventory2.ini"
      
  - name: Include role with conditionals
    include_role:
      name: "{{ role_to_include }}"
    when: "ansible_os_family == 'RedHat'"
      
  - name: Include role with custom connection
    include_role:
      name: "{{ role_to_include }}"
    connection: "local"
