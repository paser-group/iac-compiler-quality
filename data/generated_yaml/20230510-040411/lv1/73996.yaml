
---
- hosts: all
  become: yes
  vars:
    python_recursion_depth_limit: 4000
  tasks:
  - name: Check if recursion depth limit has been reached
    command: python3 -c "import sys; print(sys.getrecursionlimit())"
    register: recursion_depth

  - name: Increase recursion depth limit if needed
    command: python3 -c "import sys; sys.setrecursionlimit({{ python_recursion_depth_limit }}) if sys.getrecursionlimit() < {{ python_recursion_depth_limit }} else None"
    when: recursion_depth.stdout|int < python_recursion_depth_limit

  - name: Run the playbook
    // insert your tasks here to run the playbook

