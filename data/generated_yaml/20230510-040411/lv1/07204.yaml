yaml
---
- hosts: all
  gather_facts: true
  
  tasks:
  
  - name: Check for sudo access
    shell: whoami
    register: sudo_check
    ignore_errors: true
    
  - meta: end_play
    when: sudo_check.rc != 0
  
  - name: Install necessary packages
    package:
      name: "{{ item }}"
      state: present
    with_items:
      - package1
      - package2
      - package3
      
  # ... other tasks as needed
  
  become: true
  become_method: sudo
