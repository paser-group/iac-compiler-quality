yaml
---
- name: Execute Command and return error code
  hosts: all
  gather_facts: false
  vars:
    command_to_execute: "your_command_here"
    timeout_seconds: 60
  tasks:
    - name: Execute command and capture output
      command: "{{ command_to_execute }}"
      async: "{{ timeout_seconds }}"
      poll: 0
      register: command_output

    - name: Wait for command to complete
      async_status:
        jid: "{{ command_output.ansible_job_id }}"
      register: command_status
      until: command_status.finished

    - name: Display command output
      debug:
        msg: "{{ command_output.stdout }} {{ command_output.stderr }}"
