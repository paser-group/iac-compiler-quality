
---
- name: Resolve RequestLimitExceeded error during DescribeVpcEndpoints operation
  hosts: all
  become: true
  tasks:
    - name: Set AWS CLI retries
      shell: "export AWS_MAX_ATTEMPTS=20"
    - name: Describe VPC Endpoints
      ec2_vpc_endpoint_facts:
        region: <your-region>
      register: ec2_vpc_endpoint_facts_result
      ignore_errors: yes
    - name: Retry Describe VPC Endpoints
      ec2_vpc_endpoint_facts:
        region: <your-region>
      when: ec2_vpc_endpoint_facts_result.failed
      retries: "{{ lookup('env','AWS_MAX_ATTEMPTS') }}"
