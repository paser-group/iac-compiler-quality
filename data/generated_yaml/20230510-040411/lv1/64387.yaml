
- hosts: your_host_group_name_here
  become: yes
  vars:
    project_dir: /path/to/your/project/directory
  tasks:
    - name: Stop and remove existing containers
      docker_compose:
        project_src: "{{ project_dir }}"
        state: stopped
        remove_volumes: yes
        remove_orphans: yes
      register: stopped_containers
      ignore_errors: yes

    - name: Remove existing project directory
      file:
        path: "{{ project_dir }}"
        state: absent
      when: stopped_containers.rc != 0

    - name: Create project directory
      file:
        path: "{{ project_dir }}"
        state: directory

    - name: Copy docker-compose.yml to project directory
      copy:
        src: /path/to/your/docker-compose.yml
        dest: "{{ project_dir }}/docker-compose.yml"

    - name: Create and start containers
      docker_compose:
        project_src: "{{ project_dir }}"
        state: started
