yaml
---
- name: Fix duplicate vault-ids issue
  hosts: all
  become: yes
  
  tasks:
    - name: Get the vault file path
      shell: echo "{{ ansible_env.HOME }}/.vault_pass"
      register: vault_path
    
    - name: Backup the vault file
      copy:
        src: "{{ vault_path.stdout }}"
        dest: "{{ vault_path.stdout }}.bak"
    
    - name: Remove duplicate vault-ids
      shell: |
        vault cleanup -f
      changed_when: true
