
---
- name: Manage Openstack Plugins for Performance 
  hosts: all
  become: true
  
  tasks:
    - name: Ensure the Openstack Plugin is Updated
      apt:
        name: openstack-plugin
        update_cache: yes
      register: openstack_plugin_update

    - name: Check Openstack Plugin Version
      shell: openstack-plugin --version
      register: openstack_plugin_version_output

    - name: Notify of Plugin Update
      debug:
        msg: "Updated Openstack Plugin to version {{ openstack_plugin_update | json_query('\"changed\"') | int }}" 

    - name: Analyze Performance Issues
      shell: openstack-plugin --analyze-performance
      register: openstack_plugin_performance_analysis

    - name: Notify of Performance Analysis
      debug:
        msg: "Performance Analysis Complete: {{ openstack_plugin_performance_analysis | json_query('\"stdout\"') }}"
