
---
- name: Fix osx_defaults Invalid Value Error
  hosts: all
  gather_facts: no
  tasks:
  - name: Fix osx_defaults issue
    osx_defaults:
      domain: com.example.app
      key: preferences
      value:
        - some_value
    register: result
    ignore_errors: true

  - name: Retry osx_defaults with correct value
    osx_defaults:
      domain: com.example.app
      key: preferences
      value:
        - correct_value
    when: "'Invalid value. Expected value to be an array.' in result.msg"
