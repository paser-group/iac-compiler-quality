
- name: Create and manage GCE instance groups
  hosts: localhost
  connection: local

  tasks:
  - name: Set GCE Credentials
    google_auth:
      credentials_file: "/path/to/credentials.json"
      scopes:
        - 'https://www.googleapis.com/auth/cloud-platform'
    register: auth_result

  - name: Create Instance Group Manager
    gcp_compute_instance_group_manager:
      name: "my-instance-group-manager"
      base_instance_name: "my-instance-group"
      zone: "us-central1-a"
      state: present
    register: igm_result

  - name: Stop Instance Group Manager
    gcp_compute_instance_group_manager:
      name: "my-instance-group-manager"
      state: stopped
    when: igm_result.changed

  - name: Start Instance Group Manager
    gcp_compute_instance_group_manager:
      name: "my-instance-group-manager"
      state: started
    when: igm_result.changed
