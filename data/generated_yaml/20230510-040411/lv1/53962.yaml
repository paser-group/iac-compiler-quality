yaml
---
- hosts: all
  become: true
  tasks:
    - name: Install required package dependencies
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - python-pip
        - python3-pip

    - name: Install required python modules
      pip:
        name: "{{ item }}"
        state: present
      with_items:
        - psutil

    - name: Run Python script
      shell: python /path/to/script.py
      register: script_output

    - name: Check script output for errors
      fail:
        msg: "Unexpected exception: {{ script_output.stderr }}"
      when: "'Unexpected Exception' in script_output.stderr"
