
- name: Install SSH error handling script
  hosts: all
  become: true
  tasks:
    - name: Copy SSH error handling script
      copy:
        src: ssh_error_handling.py
        dest: /etc/ssh/
        mode: 0777

    - name: Enable SSH error handling
      lineinfile:
        state: present
        path: /etc/ssh/sshd_config
        regexp: '^\s*UsePAM\s+yes\s*$'
        insertafter: '^\s*UsePAM\s+yes\s*$'
        line: 'UsePAM no'
        backup: yes
