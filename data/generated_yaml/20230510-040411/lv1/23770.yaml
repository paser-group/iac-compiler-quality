yaml
---
- name: Connection from net_cli should wait for prompt even on error
  hosts: your_network_devices
  gather_facts: no
  tasks:
    - name: Configure netmiko connection
      ios_command:
        commands: show version
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ netmiko_username }}"
          password: "{{ netmiko_password }}"
          platform: "{{ netmiko_platform }}"
          transport: "{{ netmiko_transport }}"
          secret: "{{ netmiko_secret_password }}"
          use_keys: "{{ netmiko_use_keys }}"
          allow_agent: "{{ netmiko_allow_agent }}"
          timeout_socket: "{{ netmiko_timeout_socket }}"
      register: netmiko_response
      retries: 3
      delay: 10
      until: netmiko_response.failed == false
