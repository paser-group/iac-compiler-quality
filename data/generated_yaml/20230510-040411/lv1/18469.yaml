yaml
---
- name: Fix Multiprocess Issue on AWS Lambda
  hosts: localhost
  gather_facts: false
  vars:
    lambda_function_name: my_function
  tasks:
    - name: Update AWS Lambda runtime
      ec2_lambda:
        name: "{{ lambda_function_name }}"
        runtime: python2.7
      register: lambda_update_result

    - name: Install Dependencies
      command: "pip install ansible"
      when: lambda_update_result.changed

    - name: Run Ansible Playbook
      command: "ansible-playbook myplaybook.yml"
      when: lambda_update_result.changed
