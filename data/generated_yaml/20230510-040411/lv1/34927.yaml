
---
- hosts: localhost
  gather_facts: no
  tasks:
  - name: Install dependencies
    apt:
      name:
        - python
        - python-requests
        - python-gcauth
      state: present

  - name: Update gcloud SDK
    shell: curl https://sdk.cloud.google.com | bash
    become: yes

  - name: Add gcloud to PATH
    shell: echo "export PATH=$PATH:/root/google-cloud-sdk/bin/" >> /root/.bashrc
    become: yes

  - name: Authenticate with Google Cloud Platform
    shell: gcloud auth application-default login
    become: yes

  - name: Install libcloud
    pip:
      name: apache-libcloud
      state: present

  - name: Update the gce.py inventory plugin
    copy:
      src: /usr/local/lib/python2.7/dist-packages/ansible/contrib/inventory/gce.py
      dest: /usr/local/lib/python2.7/dist-packages/ansible/contrib/inventory/gce.py
    become: yes
