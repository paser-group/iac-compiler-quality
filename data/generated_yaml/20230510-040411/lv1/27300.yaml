
---
- name: Update ansible_pkg_mgr fact
  hosts: all
  become: true
  
  tasks:
    - name: Install mkosi package
      package:
        name: mkosi
        state: latest
        
    - name: Gather facts
      setup: 
        
    - name: Update ansible_pkg_mgr fact
      set_fact:
        ansible_pkg_mgr: dnf
      when: ansible_pkg_mgr == 'dnf' and 'mkosi' in ansible_facts.packages

    - name: Update ansible_pkg_mgr fact
      set_fact:
        ansible_pkg_mgr: yum
      when: ansible_pkg_mgr == 'yum' and 'mkosi' in ansible_facts.packages
