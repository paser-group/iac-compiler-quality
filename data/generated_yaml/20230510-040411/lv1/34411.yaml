
- hosts: windows
  gather_facts: no
  
  tasks:
    - name: Enable Firewall Service
      service:
        name: MpsSvc
        state: started
        enabled: yes
        
    - name: Ensure WinRM is allowed through firewall
      win_firewall:
        rule: allow
        direction: inbound
        protocol: tcp
        port: 5985
        
    - name: Debug win_firewall error
      win_shell: netsh advfirewall show currentprofile state
      register: output
      
    - debug:
        var: output.stdout_lines
