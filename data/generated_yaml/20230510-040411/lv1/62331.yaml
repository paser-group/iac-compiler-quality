
- name: Ensure Elastic IP address is absent
  hosts: your_host_name
  gather_facts: no

  tasks:
  - name: Get the allocation ID of the Elastic IP
    ec2_eip_facts:
      filters:
        public-ip: "{{ elastic_ip }}"

    register: eip_facts

  - name: Release Elastic IP
    ec2_eip:
      id: "{{ eip_facts.eips[0].id }}"
      state: absent
    when: eip_facts.eips | length > 0
