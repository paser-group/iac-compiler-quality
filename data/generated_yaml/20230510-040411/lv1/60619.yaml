
- name: Azure_RM Deployment
  hosts: localhost
  connection: local
  gather_facts: False
  vars:
    rg_name: "resource_group_name"
    deployment_name: "deployment_name"
    template_file_path: "/path/to/template/file.json"
    parameters_file_path: "/path/to/parameters/file.json"
  tasks:
    - name: Create Resource Group
      azure_rm_resourcegroup:
        name: "{{ rg_name }}"
        location: "{{ location }}"
      register: rg

    - name: Deploy Template
      azure_rm_deployment:
        resource_group_name: "{{ rg_name }}"
        deployment_mode: complete
        name: "{{ deployment_name }}"
        template_file: "{{ template_file_path }}"
        parameters_file: "{{ parameters_file_path }}"
      register: arm
      ignore_errors: yes

    - name: Show Deployment Error Details
      debug:
        var: arm.stderr
