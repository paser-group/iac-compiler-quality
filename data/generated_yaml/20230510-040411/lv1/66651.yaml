
- name: Asynchronous Multiple Tasks
  hosts: your_hosts
  gather_facts: False
  
  tasks:
  
    - name: Task 1
      async: 60
      poll: 10
      command: your_command
      
    - name: Task 2
      async: 60
      poll: 10
      command: your_command
      
    - name: Task 3
      async: 60
      poll: 10
      command: your_command
      
    - name: Task 4
      async: 60
      poll: 10
      command: your_command
      
    - name: Wait for all tasks to complete
      async_status:
        jid: "{{ item.ansible_job_id }}"
      loop: "{{ ansible_jobs }}"
      register: job_status
      until: job_status.finished
  
    - name: Final Task
      command: your_command
      when: job_status.results | map(attribute='ansible_job_id') | list | count < 4
      
