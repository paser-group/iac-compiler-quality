
---
- name: Create a Storage Account in Azure
  hosts: localhost
  connection: local
  tasks:
    - name: Create a Storage Account
      azure_rm_storageaccount:
        resource_group: my_resource_group
        name: my_storage_account
        account_type: Standard_LRS
        location: eastus
        tags:
          environment: test
      register: storage_account

    - name: Fail if Authorization Fails
      fail:
        msg: Authorization failed for Azure RM Storage Account module.
      when: "'AuthorizationFailed' in storage_account.stderr"
