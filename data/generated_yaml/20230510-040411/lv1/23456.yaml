
---
- name: Wait for network port on remote server
  hosts: remote_server
  become: true

  tasks:

    - name: Disable IPv6 on remote server
      sysctl:
        name: net.ipv6.conf.all.disable_ipv6
        value: 1
        state: present
      register: ipv6_disabled

    - name: Wait for port 80 to become available
      wait_for:
        host: "{{ inventory_hostname }}"
        port: 80
        timeout: 60
      when: ipv6_disabled.changed
