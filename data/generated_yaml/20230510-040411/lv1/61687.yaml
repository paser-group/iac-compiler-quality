
- name: Configure S3 bucket with default AWS KMS encryption key
  hosts: localhost
  gather_facts: false 
  
  tasks:
  - name: Create S3 bucket
    amazon.aws.aws_s3:
      name: "s3_bucket"
      state: present
      
  - name: Set default encryption for S3 bucket
    amazon.aws.aws_s3_bucket_encryption:
      bucket: "s3_bucket"
      default_customer_master_key_id: "aws:kms"
      state: present
      
  - name: Verify S3 bucket settings
    amazon.aws.aws_s3_bucket_info:
      bucket: "s3_bucket"
