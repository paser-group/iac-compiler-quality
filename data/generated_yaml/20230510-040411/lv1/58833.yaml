
- name: Fix s3_lifecycle prefix issue
  hosts: all
  tasks:
    - name: Get s3 bucket lifecycle configuration
      s3_lifecycle:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        bucket: "{{ s3_bucket }}"
      register: s3_lifecycle_config

    - name: Update s3 bucket lifecycle prefix
      s3_lifecycle:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        bucket: "{{ s3_bucket }}"
        rules: "{{ s3_lifecycle_config }}"
        prefix: "{{ s3_prefix }}"
        status: "{{ s3_status }}"
