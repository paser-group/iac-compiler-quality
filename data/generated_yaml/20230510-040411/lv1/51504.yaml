
---
- name: Fix ansible_processor_vcpus fact for containers
  hosts: all

  tasks:
    - name: Initialize fact variables
      set_fact:
        container_cpu: "{{ ansible_processor_vcpus }}"
      when: ansible_container_engine != ''

    - name: Set correct ansible_processor_vcpus fact
      set_fact:
        ansible_processor_vcpus: "{{ container_cpu }}"
      when: ansible_container_engine != ''

    - name: Debug ansible_processor_vcpus fact
      debug:
        var: ansible_processor_vcpus
