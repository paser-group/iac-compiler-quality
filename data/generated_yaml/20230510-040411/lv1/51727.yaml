
---
- name: Install Jinja 2.10 and fix Jinja error
  hosts: all
  gather_facts: true

  tasks:
  - name: Install Jinja 2.10
    yum:
      name: python3-jinja2
      state: present

  - name: Stop and disable Jinja auto escaping feature
    lineinfile:
      path: /etc/ansible/ansible.cfg
      regexp: '#force_templating'
      line: 'jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n,jinja2.ext.loopcontrols,jinja2.ext.with_'

  - name: Include hostvars vars
    include_vars:
      dir: "host_vars/{{ inventory_hostname }}"

  - name: Check if Jinja error is fixed
    debug:
      var: host_var_info
