
- hosts: localhost
  gather_facts: false

  vars:
    redis_cache_name: "myredis"
    redis_cache_location: "eastus"
    redis_cache_sku: "Basic"

  tasks:
  - name: Create Redis Cache Instance
    azure_rm_rediscache:
      resource_group: "{{ resource_group }}"
      name: "{{ redis_cache_name }}"
      location: "{{ redis_cache_location }}"
      sku: "{{ redis_cache_sku }}"
      wait: true
      state: present
    register: redis_cache_instance

  - name: Block Redis Cache Instance from provisioning operations
    azure_rm_rediscache:
      resource_group: "{{ resource_group }}"
      name: "{{ redis_cache_name }}"
      state: present
      disable_non_ssl_port: true
      minimum_tls_version: "1.2"

  - name: Show Redis Cache Instance state
    debug:
      var: redis_cache_instance
