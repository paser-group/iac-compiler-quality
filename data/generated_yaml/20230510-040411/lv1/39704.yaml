yaml
---
- name: Handle ugly DNF error when package not found
  hosts: servers
  become: true
  vars:
    dnf_package_name: "example_pkg"
  tasks:
  - name: Install the package using dnf module
    dnf:
      name: "{{ dnf_package_name }}"
      state: present
    register: dnf_result
    ignore_errors: true

  - name: Handle dnf result when package not found
    fail:
      msg: "The package {{ dnf_package_name }} could not be found in the DNF repository"
    when: "'No package' in dnf_result.stderr"
...
