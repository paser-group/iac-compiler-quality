yaml
---
- name: Reboot VM 
  hosts: localhost

  vars:
    vm_name: my_vm

  tasks:
  - name: Restart the VM
    vmware_guest:
      hostname: vcenter.example.com
      username: administrator@vsphere.local
      password: p@ssw0rd
      validate_certs: no
      datacenter: DC1
      folder: /vmfolder
      name: "{{ vm_name }}"
      power_state: restarted

  - name: Wait for connection
    wait_for:
      port: 22
      host: "{{ vm_name }}"
      delay: 10
      timeout: 120
