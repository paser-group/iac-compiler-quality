
---
- name: Create User
  hosts: server
  gather_facts: true

  tasks:

  - name: Create new user
    eos_user:
      name: john
      group: users
      state: present
      nopassword: yes
    register: user_creation_result

  - name: Handle user creation errors
    fail:
      msg: "Error creating new user: {{ user_creation_result.msg }}"
    when: user_creation_result.failed == true and user_creation_result.msg is defined
