
---
- hosts: localhost
  gather_facts: no

  tasks:
    - name: Create a new image with disk snapshot
      gcp_compute_image:
        name: gcp-instance-image
        project: your-project
        source_disk: your-source-disk

  vars:
    your-source-disk: "{{ gcp_compute_snapshot.results[0].name }}"
  
  - name: Create a new snapshot from a disk
    gcp_compute_snapshot:
      disk: your-disk
      name: your-snapshot
      project: your-project
