
---
- name: Copy files with win_robocopy and report access errors
  hosts: target_windows_host
  gather_facts: no
  vars:
    source_folder: "C:\\path\\to\\source\\folder"
    destination_folder: "C:\\path\\to\\destination\\folder"

  tasks:
  - name: Copy files with win_robocopy and report access errors
    win_robocopy:
      src: "{{ source_folder }}"
      dest: "{{ destination_folder }}"
      /mir: yes
      /r: 3
      /w: 5
      /np: no
      /tee: yes
      /log: "C:\\robocopy.log"
      /v: yes
      /sec: yes
      /secfix: yes
      register: robocopy_output
    
  - name: Report access errors if any
    fail:
      msg: "{{ robocopy_output.stderr }}"
    when: robocopy_output.stderr is defined
