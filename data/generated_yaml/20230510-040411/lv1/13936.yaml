yaml
---
- hosts: web_servers
  gather_facts: no
  become: yes  
  tasks:
    - name: Install Python2 on remote machines
      raw: yum install -y python2
      
    - name: Set up WinRM
      winrm_listener:
        state: started
        cert_thumbprint: "{{ cert_thumbprint }}"
        hostname: "{{ ansible_host }}"
        transport: ssl
        port: "{{ winrm_port }}"
        username: "{{ winrm_username }}"
        password: "{{ winrm_password }}"

    - name: Restart WinRM service
      win_service:
        name: winrm
        state: restarted
