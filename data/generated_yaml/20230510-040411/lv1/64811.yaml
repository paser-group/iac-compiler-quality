
---
- name: Fix "sudo: 1 incorrect password attempt - error on tasks with become: false" issue
  hosts: all
  become: true
  
  tasks:

    - name: Ensure sudoers.d is readable for sudoers
      file:
        path: /etc/sudoers.d
        state: directory
        mode: '0755'
        owner: root
        group: root

    - name: Add user to sudoers
      command: usermod -aG sudo {{ ansible_user }}
      become: true

    - name: Add sudoers config file
      copy:
        src: "sudoers_config_file"
        dest: "/etc/sudoers.d/sudoers_config_file"
        owner: root
        group: root
        mode: '0440'
      become: true
