
---
- name: Get EC2 Metadata Facts
  hosts: all
  gather_facts: true

  tasks:
    - name: Set EC2 instance facts
      ec2_metadata_facts:
        set_expiration: no
      register: ec2_facts

    - name: Print EC2 metadata facts
      debug:
        msg: "{{ ec2_facts.ansible_facts }}"

    - name: Fix role name ending with _expiration
      set_fact:
        role_name: "{{ playbook_dir.split('/')[-1] }}"
      when: "'_expiration' in role_name"
    
    - name: Print updated role name
      debug:
        msg: "Role name: {{ role_name }}"
