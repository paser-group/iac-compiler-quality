
---
- name: Fix s3 Bucket Error
  hosts: all

  tasks:
  - name: Install Required Packages
    become: true
    apt:
      name:
      - python
      - python-pip
      - python-setuptools
      - python-wheel

  - name: Install Boto3 Library
    become: true
    pip:
      name: boto3

  - name: Update botocore Library
    become: true
    pip:
      name: botocore --upgrade

  - name: Update s3cmd Library
    become: true
    pip:
      name: s3cmd --upgrade

  - name: Configure AWS CLI
    become: true
    command: aws configure

  - name: Create S3 Bucket
    become: true
    command: aws s3api create-bucket --bucket my-bucket-name --region my-region-name --create-bucket-configuration LocationConstraint=my-region-name

  - name: Copy Files to S3 Bucket
    become: true
    command: aws s3 cp /path/to/local/folder s3://my-bucket-name --recursive

  - name: Set Bucket Policy
    become: true
    command: aws s3api put-bucket-policy --bucket my-bucket-name --policy file:///path/to/policy.json
