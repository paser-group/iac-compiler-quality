
---
- hosts: your_host
  vars:
    vault_address: "https://your.hashicorp.vault.address"
    vault_token: "{{ lookup('env', 'VAULT_TOKEN') }}"
  tasks:
    - name: Get secret from Hashicorp vault
      shell: "vault read secret/{{ vault_secret }} | grep '{{vault_key}}'"
      register: secret

    - name: Check if secret exists
      fail:
        msg: "The secret '{{vault_secret}}' with the key '{{vault_key}}' does not exist in the vault!"
      when: secret.rc != 0
