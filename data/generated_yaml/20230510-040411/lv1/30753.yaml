yaml
---
- name: Fix ansible_service_mgr fact for sysvinit
  hosts: all
  gather_facts: yes

  tasks:
    - name: Check ansible_service_mgr fact for sysvinit version
      shell: "systemctl --version | head -n1"
      register: systemctl_version

    - name: Set ansible_service_mgr fact for sysvinit
      set_fact:
        ansible_service_mgr: sysvinit
      when: ansible_facts['systemd'] == false and systemctl_version.stdout|regex_search('^systemd')|bool == false
