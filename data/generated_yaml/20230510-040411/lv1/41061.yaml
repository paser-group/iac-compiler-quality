
- name: Set ansible_virtualization_role correctly on DigitalOcean droplets
  hosts: all
  gather_facts: True

  tasks:
  - name: Check if ansible_virtualization_role is set to host
    assert:
      that:
        - ansible_virtualization_role != "host"
    ignore_errors: True

  - name: Correct ansible_virtualization_role if necessary
    when: "'digital_ocean' in inventory_hostname"
    set_fact:
      ansible_virtualization_role: docker
