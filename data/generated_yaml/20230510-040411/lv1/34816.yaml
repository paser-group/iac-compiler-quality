yaml
---
- name: EC2 Group module error
  hosts: localhost
  gather_facts: False
  tasks:
    - name: Create the security group
      ec2_group:
        name: "{{ new_group_name }}"
        description: "AWS security group created by Ansible playbook"
        rules:
          - proto: tcp
            from_port: 22
            to_port: 22
            cidr_ip: 0.0.0.0/0
        region: "{{ region }}"
        state: present
      register: result
      ignore_errors: yes
    - name: Update the security group if it exists
      ec2_group:
        name: "{{ group_name }}"
        description: "AWS security group created by Ansible playbook"
        rules:
          - proto: tcp
            from_port: 22
            to_port: 22
            cidr_ip: 0.0.0.0/0
        region: "{{ region }}"
        state: present
      when: result is failed
