yaml
---
- name: Check Connection on ios_command
  hosts: network_devices
  gather_facts: no

  tasks:
    - name: Ping Device
      ios_ping:
        dest: "{{ inventory_hostname }}"
      register: ping_status
      ignore_errors: yes

    - name: Fix Connection Issue
      ios_command:
        commands:
          - show interfaces status | i down
        provider:
          host: "{{ inventory_hostname }}"
          username: "your_username"
          password: "your_password"
          authorize: yes
          auth_pass: "your_enable_password"
      when: ping_status.ping != 'failed'
