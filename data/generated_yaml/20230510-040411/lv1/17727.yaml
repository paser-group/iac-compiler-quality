
---
- name: Install azure package
  apt:
    name: python-pip
    state: latest

- name: Install azure python package
  pip:
    name: azure
    version: latest

- name: Configure Azure credentials
  azure_rm:
    client_id: "{{ lookup('env', 'AZURE_CLIENT_ID') }}"
    client_secret: "{{ lookup('env', 'AZURE_CLIENT_SECRET') }}"
    tenant: "{{ lookup('env', 'AZURE_TENANT') }}"
    subscription_id: "{{ lookup('env', 'AZURE_SUBSCRIPTION_ID') }}"

- name: Run Azure dynamic inventory
  azure_rm:
    all:
      true
  register: inv

- debug:
    var: inv['inventory_hostname']
