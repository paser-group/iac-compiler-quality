
---
- name: Gather port facts using os_port_facts module
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    openstack_auth_url: "{{ lookup('env', 'OS_AUTH_URL') }}"
    openstack_username: "{{ lookup('env', 'OS_USERNAME') }}"
    openstack_password: "{{ lookup('env', 'OS_PASSWORD') }}"
    openstack_project_name: "{{ lookup('env', 'OS_PROJECT_NAME') }}"
    openstack_port_name: "myport"
    openstack_port_filters:
      fixed_ips.ip_address: "10.0.0.1"
  tasks:
    - name: Gather port facts
      os_port_facts:
        auth:
          auth_url: "{{ openstack_auth_url }}"
          username: "{{ openstack_username }}"
          password: "{{ openstack_password }}"
          project_name: "{{ openstack_project_name }}"
        filters:
          name: "{{ openstack_port_name }}"
          {{ openstack_port_filters | to_nice_yaml }}
      register: port_facts

    - name: Debug port facts
      debug:
        var: port_facts
