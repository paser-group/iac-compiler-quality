
---
- name: Resize disk and restore VM using multiple SCSI controllers
  hosts: your_vmware_host
  gather_facts: no

  tasks:
    - name: Resize the disk of the virtual machine
      vmware_guest_disk:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        name: "{{ vmware_vm_name }}"
        datacenter: "{{ vcenter_datacenter }}"
        disk_size_gb: "{{ new_disk_size_gb }}"
        unit_number: "{{ unit_number }}"
        controller: "{{ controller_type }}"
        set_adapter_type: "{{ adapter_type }}"
        scsi_controller: "{{ scsi_controller }}"
        state: present
      delegate_to: localhost

    - name: Restore virtual machine from a snapshot
      vmware_guest_snapshot:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        name: "{{ vmware_vm_name }}"
        datacenter: "{{ vcenter_datacenter }}"
        snapshot_name: "{{ snapshot_name }}"
        state: reverted
      delegate_to: localhost
