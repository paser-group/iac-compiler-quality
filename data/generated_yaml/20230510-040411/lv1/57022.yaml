yaml
---
- name: Example Playbook for 'ansible_connection evaluated incorrectly when inside a loop' issue
  hosts: all
  vars:
    ansible_connection: ssh
  gather_facts: false
  tasks:
    - name: Set connection variable for each loop item
      set_fact:
        loop_connection: "{{ ansible_connection }}"
      loop:
        - item1
        - item2
    - name: Print loop connection variable
      debug:
        var: loop_connection
