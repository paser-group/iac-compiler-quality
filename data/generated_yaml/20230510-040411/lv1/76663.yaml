yaml
---
- name: Reboot remote machine
  hosts: your_host
  gather_facts: false
  tasks:
    - name: Reboot the machine
      reboot:
        reboot_timeout: 3600
        pre_reboot_delay: 0
        post_reboot_delay: 0
      register: reboot_status
      ignore_errors: true

    - name: Wait for the server to reboot
      wait_for_connection:
        delay: 10
        timeout: 600
      when: reboot_status is changed

    - name: Debugging connection upon reboot
      debug:
        var: ansible_connection
      delegate_to: localhost
      run_once: true
      when: ansible_verbosity == 4
