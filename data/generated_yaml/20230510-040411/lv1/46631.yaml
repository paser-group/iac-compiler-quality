
---
- name: Fix ansible errors during undercloud deployment
  hosts: undercloud_servers
  become: true

  tasks:
    - name: Check for ansible errors
      command: /usr/bin/ansible-playbook /path/to/undercloud.yml --syntax-check
      register: ansible_check

    - name: Fix ansible errors
      command: /usr/bin/ansible-playbook /path/to/undercloud.yml --check --diff
      when: "ansible_check.rc != 0"
