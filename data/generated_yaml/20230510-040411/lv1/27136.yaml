yaml
---
- name: Handle "unable to open shell" error in network modules
  hosts: all
  become: yes
  
  vars:
    ssh_known_hosts_file: "~/.ssh/known_hosts"
  
  tasks:
  - name: Check host in known_hosts file
    shell: |
      if ! grep -q "{{ inventory_hostname }}" {{ ssh_known_hosts_file }}; then
        ssh-keyscan "{{ inventory_hostname }}" >> {{ ssh_known_hosts_file }}
      fi
    register: check_hosts_file
    changed_when: check_hosts_file.stdout != ''
    
  - name: Execute network module
    <insert your network module task here>
