
---
- name: SSH Issue Playbook
  hosts: all
  gather_facts: no

  tasks:
    - name: Update ssh config
      lineinfile:
        path: /etc/ssh/ssh_config
        regexp: "{{ item.regexp }}"
        line: "{{ item.line }}"
        state: present
      with_items:
        - {regexp: '^#?BatchMode', line: 'BatchMode yes'}
        - {regexp: '^#?StrictHostKeyChecking', line: 'StrictHostKeyChecking no'}
        - {regexp: '^#?ServerAliveInterval', line: 'ServerAliveInterval 120'}

    - name: Restart SSH
      service:
        name: sshd
        state: restarted
