yaml
---
- name: Install Ansible via setup.py
  hosts: all
  become: true

  tasks:
    - name: Install prerequisites
      apt:
        name: python python-setuptools
        state: present

    - name: Ensure setuptools version is compatible
      pip:
        name: setuptools==49.6.0
        state: present

    - name: Clone Ansible repository
      git:
        repo: https://github.com/ansible/ansible.git
        dest: /opt/ansible

    - name: Install Ansible via setup.py
      command: /usr/bin/python /opt/ansible/setup.py install
