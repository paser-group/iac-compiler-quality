yaml
---
- name: Update Virt Net
  hosts: all
  become: true

  tasks:
    - name: Update Virt Net
      virt_net:
        name: virtnet1
        state: present
      register: virt_net_output
      check_mode: no

    - name: Report changes
      debug:
        var: virt_net_output

    - name: Raise error if change detected
      fail:
        msg: "Module is not idempotent - changes detected"
      when: virt_net_output.changed is defined and virt_net_output.changed == true
