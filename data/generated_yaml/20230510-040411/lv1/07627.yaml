yaml
---
- name: Fix symlink error with file module
  hosts: all
  tasks:
    - name: Remove existing symlink
      file:
        path: /path/to/target
        state: absent
        register: symlink_removed
      when: ansible_facts['file_type'] == 'symlink'

    - name: Create new symlink
      file:
        src: /path/to/source
        dest: /path/to/target
        state: link
      register: symlink_created

    - name: Check if symlink was successfully created
      debug:
        var: symlink_created.changed
