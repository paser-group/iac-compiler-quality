
- name: Playbook for Fixing Undefined Ansible Failed Task Issue
  hosts: all
  gather_facts: false
  tasks:
    - name: Looping Task
      debug:
        msg: "This task loops through an array"
      loop: "{{ [1, 2, 3, 4, 5] }}"
      register: loop_output

    - name: Failed Task
      fail:
        msg: "This task fails intentionally"
      when: loop_output.rc == 3

  rescue:
    - name: Rescue Task
      debug:
        msg: "Ansible failed task is now defined"
