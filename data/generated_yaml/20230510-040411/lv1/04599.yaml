
- name: authorized_keys bug traceback fix
  hosts: all
  tasks:
  - name: ensure authorized_keys file exists for user
    authorized_key:
      user: # ENTER USERNAME HERE
      state: present

  - name: ensure authorized_keys file has correct permissions for user
    file:
      path: "/home/{{ user }}/.ssh/authorized_keys"
      mode: "0600"
      owner: "{{ user }}"
      group: "{{ user }}"
      state: directory

  - name: add authorized keys to authorized_keys file
    authorized_key:
      user: # ENTER USERNAME HERE
      key: # ENTER PUBLIC KEY HERE
      state: present
