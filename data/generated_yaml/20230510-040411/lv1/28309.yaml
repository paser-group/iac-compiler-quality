
- name: Install and configure Arista modular switches (7500)
  hosts: switches
  vars:
    context_detected: true
 
  tasks:
  - name: Set context detecion mode
    arista.eos.command:
      commands:
        - default-context mode strict

  - name: Fix context detection
    when: context_detected == true
    arista.eos.command:
      commands:
        - no default-context mode strict
        - default-context mode permissive
  
  - name: Save configuration
    arista.eos.command:
      commands:
        - write memory
