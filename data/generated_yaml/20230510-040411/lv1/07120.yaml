
---
- hosts: your_host
  become: true
  tasks:
  - name: Check for available subscriptions
    rhn_check:
  - name: Add RHN Channel
    rhn_channel:
      name: "{{ channel_name }}"
      username: "{{ rhn_username }}"
      password: "{{ rhn_password }}"
  - name: Register system with RHN
    register: rhn_register
    rhn_register:
      username: "{{ rhn_username }}"
      password: "{{ rhn_password }}"
      name: "{{ server_name }}"
      profile_name: "{{ profile_name }}"
  - name: Install required package
    package:
      name: "{{ package_name }}"
      state: present
    when: "'{{ rhn_register.status }}' == 'ok'"
