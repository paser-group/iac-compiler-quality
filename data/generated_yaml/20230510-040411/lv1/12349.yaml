yaml
---
- name: Install Python 2.7 and dependencies
  hosts: all
  
  tasks:
    - name: Install required packages
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - python-devel
        - openssl-devel
        - libffi-devel
    
    - name: Download Python 2.7 and install
      get_url:
        url: https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz
        dest: /tmp/Python-2.7.18.tgz
        mode: '0644'
      become: yes
 
    - name: Extract and compile Python 2.7
      unarchive:
        src: /tmp/Python-2.7.18.tgz
        dest: /opt/
        remote_src: yes
        mode: '0755'
      become: yes

    - name: Make symbolic link to new Python
      file:
        src: /opt/Python-2.7.18/python
        dest: /usr/bin/python
        state: link
      become: yes
   
    - name: Install requests with pip for Python 2.7
      pip:
        name: requests
        executable: /usr/bin/python
      become: yes

    - name: Install ansible
      pip:
        name: ansible
        executable: /usr/bin/python
      become: yes

