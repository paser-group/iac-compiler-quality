
---
- name: ARM conditional check
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Check ARM condition
      azure_rm_deployment:
        state: present
        resource_group_name: "{{ resource_group_name }}"
        deployment_name: "{{ deployment_name }}"
      register: deployment

    - name: Fail if condition not met
      fail:
        msg: "Failed during ARM conditional check. Deployment gets completed at azure end. But module showing below error."
      when: deployment.changed == false
