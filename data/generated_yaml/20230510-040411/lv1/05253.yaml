
---
- name: EC2 ELB Bugfix
  hosts: all
  become: true
  
  tasks:
  - name: Update ec2_elb module
    block:
      - name: Copy updated module file
        copy:
          src: /path/to/updated/ec2_elb.py
          dest: /usr/share/ansible/plugins/modules/ec2_elb.py
          mode: 0644
      - name: Set proper ownership
        file:
          path: /usr/share/ansible/plugins/modules/ec2_elb.py
          owner: root
          group: root
    rescue:
      - name: Roll back changes
        copy:
          src: /path/to/original/ec2_elb.py
          dest: /usr/share/ansible/plugins/modules/ec2_elb.py
          mode: 0644
    vars:
      initial_state: enabled
