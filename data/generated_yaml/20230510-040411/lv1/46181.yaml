
---
- name: Install google-auth library
  hosts: all
  become: yes

  tasks:
  - name: Install google-auth
    pip:
      name: google-auth
      state: latest

- name: Authenticate with Google Cloud Platform credentials
  hosts: all
  become: yes

  tasks:
  - name: Activate service account credentials
    google.auth:
      credentials_file: path_to_credentials_file.json

  - name: Test authentication by listing GCP resources
    google.cloud.gcp_compute_instance_info:
      project: my-project
    register: result

  - name: Print resource list
    debug:
      var: result.instance_names

- name: Other tasks in playbook
  hosts: all
  become: yes

  tasks:
  # add your tasks here
