yaml
- name: Deploy Kubernetes resources
  hosts: kubernetes
  gather_facts: no

  tasks:
    - name: Surface resource discovery errors properly
      k8s_info:
        kind: pod
        namespace: default
        label_selectors:
          - app=myapp
      register: pods

    - name: Fail if any resources are missing
      fail:
        msg: "Missing resources: {{ pods.failed }}"
      when: pods.failed | count > 0
