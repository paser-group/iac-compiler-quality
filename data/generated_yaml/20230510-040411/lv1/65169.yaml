
---
- name: Fix 'Maximum sessions reached' error with imc_rest module
  hosts: your_host_name_here
  gather_facts: no

  vars:
    imc_url: your_imc_url_here
    imc_username: your_imc_username_here
    imc_password: your_imc_password_here

  tasks:
    - name: Create a session with IMC
      imc_rest:
        url: "{{ imc_url }}/imcrs"
        method: POST
        username: "{{ imc_username }}"
        password: "{{ imc_password }}"
        validate_certs: no

    - name: Perform your tasks with imc_rest module
      imc_rest:
        url: "{{ imc_url }}/imcrs"
        method: POST
        username: "{{ imc_username }}"
        password: "{{ imc_password }}"
        validate_certs: no

    - name: Logout from IMC Session
      imc_rest:
        url: "{{ imc_url }}/imcrs/session"
        method: DELETE
        validate_certs: no

