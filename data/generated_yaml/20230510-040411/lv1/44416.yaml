
- name: Fix azure_rm_virtualmachine error related to batches
  hosts: your_azure_vm_host
  gather_facts: no
  tasks:
    - name: Stop the Azure VM
      azure_rm_virtualmachine:
        resource_group: your_resource_group
        name: your_vm_name
        state: stopped
    
    - name: Update Azure VM
      azure_rm_virtualmachine:
        resource_group: your_resource_group
        name: your_vm_name
        update_password_enabled: false
        allocation_method: Dynamic
      register: vm_update_result
    
    - name: Start Azure VM
      azure_rm_virtualmachine:
        resource_group: your_resource_group
        name: your_vm_name
        state: running
      when: vm_update_result.changed
