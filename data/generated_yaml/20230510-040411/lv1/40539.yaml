
---
- name: F5 Big-IP Node Module Server Port Issue
  hosts: localhost
  gather_facts: False
  vars:
    server_name: "webserver"
    node_ip: "192.168.1.100"
    node_port: "80"
    bigip_server: "bigip.example.com"
    bigip_user: "admin"
    bigip_pass: "password"
  tasks:
    - name: Add node
      bigip_node:
        provider:
          server: "{{ bigip_server }}"
          user: "{{ bigip_user }}"
          password: "{{ bigip_pass }}"
        name: "{{ server_name }}"
        address: "{{ node_ip }}"
      register: node_output

    - name: Add node port
      bigip_node:
        provider:
          server: "{{ bigip_server }}"
          user: "{{ bigip_user }}"
          password: "{{ bigip_pass }}"
        name: "{{ server_name }}"
        address: "{{ node_ip }}"
        port: "{{ node_port }}"
      when: node_output.changed == True
