yaml
- hosts: localhost
  connection: local
  gather_facts: no
 
  vars:
    key_name: "{{ ansible_ssh_private_key_file.split('/')[-1] }}"

  tasks:
    - name: Deploy AWS Launch Configuration with InstanceProfileName
      ec2_lc:
        name: "{{ item.name }}"
        image_id: "{{ item.ami }}"
        instance_type: "{{ item.instance_type }}"
        key_name: "{{ item.key_name }}"
        security_groups: "{{ item.security_groups }}"
        instance_profile: "{{ item.instance_profile }}" # <- added this line
        assign_public_ip: "{{ item.assign_public_ip }}"
      register: ec2_lc_status
      with_items:
        - { name: 'my-lc', ami: 'ami-08f3d892de259504d', instance_type: 't2.micro', key_name: '{{ key_name }}', security_groups: 'sg-xxxxxxxxxx', instance_profile: 'my-instance-profile', assign_public_ip: true }
