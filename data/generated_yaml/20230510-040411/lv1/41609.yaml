yaml
- name: Example playbook
  hosts: all
  tasks:
    - name: Get facts
      setup:
        filter: '*'
      register: facts

    - name: Print facts
      debug:
        var: ansible_facts

    - name: Fail if facts are invalid
      assert:
        that:
          - "'ERROR! Attempt to read '{{ fact_name }}' returned invalid JSON'"
        fail_msg: "Invalid JSON in fact '{{ fact_name }}'"
      loop: "{{ query('dict', facts.ansible_facts) }}"
      loop_control:
        loop_var: fact_name
      when: "facts.ansible_facts[fact_name] == 'ERROR! Attempt to read fact returned invalid JSON'"
