yaml
- name: Register instance in EC2 ELB
  hosts: all
  gather_facts: true
  become: true
  vars:
    elb_name: my-elb
  tasks:
    - name: Check if instance is already registered with ELB
      ec2_instance_facts:
        region: us-east-1
        filters:
          "tag:Name": "{{ inventory_hostname }}"
      register: ec2_instance

    - name: Register instance with ELB if not already registered
      ec2_elb:
        state: present
        name: "{{ elb_name }}"
        instances: "{{ ec2_instance.instances[0].id }}"
      when: ec2_instance.instances | length > 0
