
---
- name: Ansible Playbook to simulate ec2_vol incorrect failure issue.
  hosts: localhost
  vars:
    aws_access_key: 'AWS_ACCESS_KEY_HERE'
    aws_secret_key: 'AWS_SECRET_KEY_HERE'
    instance_id: 'INSTANCE_ID_HERE'
    region: 'REGION_HERE'
    device_name: '/dev/sdf'
  tasks:
    - name: Create an EBS volume
      ec2_vol:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        instance: "{{ instance_id }}"
        device_name: "{{ device_name }}"
        region: "{{ region }}"
        size: 10
        volume_type: gp2
      register: ebs_volume

    - name: Attach EBS volume
      ec2_vol:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        instance: "{{ instance_id }}"
        device_name: "{{ device_name }}"
        volume_id: "{{ ebs_volume.volume_id }}"
        region: "{{ region }}"
        state: attached
