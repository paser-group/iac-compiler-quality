
- hosts: all
  become: true
  vars:
    repository: "deb http://archive.ubuntu.com/ubuntu bionic main"
  tasks:
    - name: Add apt key
      apt_key:
        url: "http://archive.ubuntu.com/ubuntu/project/ubuntu-archive-keyring.gpg"
        state: present
    - name: Add apt repository
      apt_repository:
        repo: "{{ repository }}"
        state: present
      register: result
    - name: Wait a few seconds
      pause:
        seconds: 5
      when: result.changed
    - name: Install packages from the new repository
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - package1
        - package2
