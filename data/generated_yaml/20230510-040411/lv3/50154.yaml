
- hosts: localhost
  vars:
    devices:
      - name: device1
        ip: 192.168.1.1
        port: 22
      - name: device2
        ip: 192.168.1.2
        port: 23
        
  tasks:
    - name: Execute tasks on remote devices
      include_tasks: tasks.yaml
      delegate_to: "{{ item.1 }}"
      with_subelements:
        - "{{ devices }}"
        - "{{ item.0 }}"
      vars:
        ssh_port: "{{ item.1.port }}"
      loop_control:
        label: "{{ item.0.name }}"
        