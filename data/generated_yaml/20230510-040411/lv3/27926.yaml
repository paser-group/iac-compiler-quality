
- name: Reproduce the nxos_vxlan_vtep_vni idempotent issue
  hosts: switch
  gather_facts: no

  tasks:
    - name: Add a new VNI to the overlay network
      nxos_vxlan_vtep_vni:
        vni: 10001
        vni_multisite_ingress_replication: true
        state: present
      register: result

    - name: Attempt to remove the same VNI from the overlay network
      nxos_vxlan_vtep_vni:
        vni: 10001
        state: absent
      register: result1

    - name: Remove the VNI from the overlay network with remove_idempotence parameter
      nxos_vxlan_vtep_vni:
        vni: 10001
        state: absent
        remove_idempotence: true
      register: result2
