
---
- name: Create EC2 metric alarm
  hosts: localhost
  gather_facts: no

  vars:
     period_min: 5m    # Not in seconds

  tasks:
    - name: Create alarm
      ec2_metric_alarm:
        state: present
        region: us-east-2
        namespace: AWS/EC2
        metric: CPUUtilization
        statistic: Average
        comparison: ">"
        threshold: 80
        period: "{{ period_min }}"
        evaluation_periods: 2
        unit: Count
        alarm_actions:
        - arn:aws:sns:us-east-1:XXXXXXXXXX:Test
      register: ec2_alarm

    - name: Debug output
      debug:
        var: ec2_alarm
