
- name: Installing IIS server on Win Server 2016 EC2 instance on AWS
  hosts: ec2_windows
  tasks:
    - name: Install Web Server IIS role
      win_feature:
        name: Web-Server
        state: present
      register: iis_feature

    - name: Install IIS Management Console
      win_feature:
        name: Web-Mgmt-Console
        state: present
      register: iis_mgmtconsole_feature

    - name: Add EC2 instance to public zone
      win_dns_client:
        state: present
        primary_dns_suffix: test-dns.com
        connection_specific_suffix: ec2.internal
      register: dns_result

    - name: check installed features
      debug:
        msg: "The Web-Server role is installed"
      when: iis_feature.changed == true
