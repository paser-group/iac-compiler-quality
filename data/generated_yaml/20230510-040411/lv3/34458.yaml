
- name: Check VPN Gateways with no tags
  hosts: localhost
  gather_facts: no
  tasks:
    - name: List VPN gateways
      ec2_vpc_vgw_facts:
        region: "{{ region }}"
        filters:
          "tag-key": absent
      register: output
      ignore_errors: yes
    - name: Display output
      debug:
        msg: "{{ output }}"

    - name: Throw error message if listing fails
      assert:
        that: "'Message: VPN Gateway not found!' in output.stderr" 
      failed_when: false
