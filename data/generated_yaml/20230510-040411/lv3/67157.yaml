
---
- name: Reproduce string_conversion_action=error breaks diff for copy/template
  hosts: localhost
  gather_facts: no

  tasks:
  - name: Create a file with non-ASCII characters
    copy:
      dest: /tmp/file.txt
      content: "Unicode characters: ðŸ˜Š"
      string_conversion_action: error

  - name: Copy the file using the copy module
    copy:
      src: /tmp/file.txt
      dest: /tmp/copied-file.txt

  - name: Run diff on the original and copied files
    diff:
      src: /tmp/file.txt
      dest: /tmp/copied-file.txt
