
- name: Create temporary file
  hosts: localhost
  tasks:
    - name: Create temporary file
      tempfile:
        path: /tmp
        state: file
        suffix: .tmp
        prefix: ansible_test
      register: temp_file

    - name: Write to temporary file
      lineinfile:
        path: "{{ temp_file.path }}"
        line: "This is a test line"
        backup: yes
      when: temp_file is defined and temp_file.changed

    - name: Delete temporary file
      file:
        path: "{{ temp_file.path }}"
        state: absent
