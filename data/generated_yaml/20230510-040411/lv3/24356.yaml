
---
- name: Create a Btrfs subvolume and snapshot
  hosts: localhost
  tasks:
    - name: Create a subvolume
      btrfs_subvol:
        path: /mnt/btrfs/
        subvol: subvol1/
        state: present
      
    - name: Create a snapshot of the subvolume
      btrfs_subvol:
        path: /mnt/btrfs/
        src: subvol1/
        dest: subvol1_snapshot/
        state: present
        read_only: true
    
    - name: Attempt to delete a read-only snapshot
      btrfs_subvol:
        path: /mnt/btrfs/
        src: subvol1_snapshot/
        state: absent
