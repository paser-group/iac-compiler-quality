
---

- hosts: windows_machines
  gather_facts: no

  tasks:

  - name: Check DNS resolver order
    win_dns_client:
      name_servers: "{{ item }}"
      state: present
    with_items:
      - 8.8.8.8
      - 4.4.4.4
    register: result
    failed_when: "'Maximum DNS servers exceeded' not in result.stdout_lines"

  - name: Print DNS resolver order
    debug:
      var: result

...
