
- name: Discovering Idempotency Issues with nxos_config on Nexus 5K with FEX
  hosts: switches
  gather_facts: no
  
  vars:
    fex_number: 101
    fex_description: "Test FEX"

  tasks:
    - name: Configure FEX with nxos_config module
      nxos_config:
        lines:
          - fex {{ fex_number }}
          - description {{ fex_description }}
        before:
          - show interface n1
        after:
          - show interface n1

    - name: Verify that FEX is configured correctly
      nxos_command:
        commands:
          - show fex
    
