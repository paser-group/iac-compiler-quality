
- name: Test for shell type vulnerability 
  hosts: localhost
  tasks:
   - name: Execute a command with default /bin/sh shell
     command: touch /tmp/shell-test.txt
     register: cmd_output
     changed_when: false
     ignore_errors: true 
   - name: Verify shell type error with bash shell
     shell: touch /tmp/shell-test.txt 
     args:
         executable: /usr/bin/bash
     register: cmd_output
     changed_when: false
     ignore_errors: true
   - name: Verify shell type error with csh shell
     shell: touch /tmp/shell-test.txt
     args:
         executable: /bin/csh
     register: cmd_output
     changed_when: false
     ignore_errors: true
   - name: Verify shell type error with fish shell
     shell: touch /tmp/shell-test.txt
     args:
         executable: /usr/bin/fish
     register: cmd_output
     changed_when: false
     ignore_errors: true
   - name: Fail if there was a shell type error
     fail:
       msg: "{{ inventory_hostname }}: Shell type error found, potentially exploitable" 
     when: cmd_output.rc != 0 
