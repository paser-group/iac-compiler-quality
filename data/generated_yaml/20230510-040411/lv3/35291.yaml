
---
- name: Test User Module Idempotency
  hosts: localhost
  gather_facts: False

  tasks:
  - name: Add a non-existing user
    user:
      name: testuser
      state: present
    register: result
    ignore_errors: True

  - name: Check if the module is idempotent
    assert:
      that: item.rc == 0
    loop: "{{ result.results }}"
