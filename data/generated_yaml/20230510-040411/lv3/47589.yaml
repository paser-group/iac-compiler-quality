
---
- name: Reuse local domain socket
  hosts: localhost
  become: yes

  # Create a local domain socket file
  - name: Create local domain socket file
    file:
      path: /tmp/ansible.sock
      state: touch
      mode: '0666'

  # Re-use the local domain socket file in the connection
  - name: Reuse local domain socket file
    connection: local
    vars:
      ansible_connection: "{{ 'ansible_connection' }}"
      ansible_shell_type: "{{ 'ansible_shell_type' }}"
      ansible_python_interpreter: "{{ 'ansible_python_interpreter' }}"
      ansible_become_method: "{{ 'ansible_become_method' }}"
      ansible_become_pass: "{{ 'ansible_become_pass' }}"
      ansible_user: "{{ 'ansible_user' }}"
      ansible_password: "{{ 'ansible_password' }}"
    become_user: root
    become_method: sudo

  # Ensure that the reset_history attribute throws a missing attribute error 
  - name: Test reset_history attribute
    debug:
      msg: "{{ connection.reset_history }}"
