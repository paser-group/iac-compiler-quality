
---
- name: Azure VM
  hosts: localhost
  vars:
    rg_name: my-resource-group
    vm_name: my-vm
    image_name: my_product_v1.0.0
    location: eastus
  tasks:
  - name: launch VM instance
    azure_rm_virtualmachine:
        resource_group: "{{ rg_name }}"
        name: "{{ vm_name }}"
        image:
            offer: "my_offer"
            publisher: "my_publisher"
            sku: "{{ image_name }}"
            version: latest
        location: "{{ location }}"
        admin_username: "azureuser"
        admin_password: "P@ssword!"
        state: started

  - name: poweroff VM instance
    azure_rm_virtualmachine:
        resource_group: "{{ rg_name }}"
        name: "{{ vm_name }}"
        state: stopped
