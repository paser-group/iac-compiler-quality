
---
- name: Create a role to test Ansible with_items and when condition
  hosts: localhost
  roles:
    - test_role

- name: Test the role in a play
  hosts: localhost
  gather_facts: False
  tasks:
    - name: Test with_items and when with some_var not defined
      debug:
        msg: "{{ item }}"
      with_items: [1, 2, 3, 4]
      when: some_var
    - name: Test with_items and when with some_var defined
      debug:
        msg: "{{ item }}"
      with_items: [5, 6, 7, 8]
      when: some_var is defined
