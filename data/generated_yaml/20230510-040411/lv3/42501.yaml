
- hosts: localhost
  gather_facts: no

  vars:
    endpoint_url: "http://{{minio_server_url}}:{{minio_server_port}}"

  tasks:

  - name: create S3 bucket
    s3_bucket:
      name: my-bucket
      state: present
      region: us-west-1
      endpoint_url: "{{endpoint_url}}"
      access_key: "{{access_key}}"
      secret_key: "{{secret_key}}"

  - name: get S3 bucket versioning
    s3_bucket_versioning:
      bucket: non-existent-bucket
      endpoint_url: "{{endpoint_url}}"
      access_key: "{{access_key}}"
      secret_key: "{{secret_key}}"
    register: versioning

  - debug:
      msg: "{{ versioning }}"
