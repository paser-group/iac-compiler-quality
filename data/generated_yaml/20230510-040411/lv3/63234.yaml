
- name: Test gcp_storage_bucket_access_control module bucket parameter bug
  hosts: localhost
  gather_facts: no

  vars:
    bucket_name: "test_bucket_name"

  tasks:
  - name: Create a Google Cloud storage bucket
    gcp_storage_bucket:
      name: "{{ bucket_name }}"
      project: "{{ gcp_project }}"
    register: bucket_creation

  - name: Set ACL of Google Cloud storage bucket
    gcp_storage_bucket_access_control:
      entity: "{{ gcp_entity_permission }}"
      role: "{{ gcp_role }}"
      bucket: "{{ bucket_name }}"
      project: "{{ gcp_project }}"
    register: bucket_acl

  - name: Print bucket name
    debug:
      var: bucket_name
