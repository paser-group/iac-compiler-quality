
- name: Test Ansible slack plugin callback
  hosts: localhost
  gather_facts: no

  vars:
    slack_webhook_url: "https://hooks.slack.com/services/T0123456789/B0123456789/abcdefghijklmnop"
    slack_channel: "#ansible-test"
    slack_username: "Ansible Bot"

  tasks:

  - name: Send Slack notification
    slack:
      token: "INVALID_TOKEN"
      channel: "{{ slack_channel }}"
      username: "{{ slack_username }}"
      text: "Testing Ansible slack plugin callback"
    register: slack_result
    ignore_errors: yes

  - name: Fail with message
    fail:
      msg: "Slack notification failed. {{ slack_result }}"
    when: "'404' in slack_result.msg"
