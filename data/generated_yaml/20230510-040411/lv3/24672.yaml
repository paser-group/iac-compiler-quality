
- hosts: localhost
  gather_facts: false
  
  vars:
    vcenter_server: example_vcenter.com
    vcenter_username: example_user
    vcenter_password: example_password
  
  tasks:
    - name: Connect to vcenter server
      vmware_connect:
        hostname: "{{ vcenter_server }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        
    - name: Create a new VM
      vmware_guest:
        name: "Example_VM"
        state: poweredon
        hardware:
          memory_mb: 2048
          num_cpus: 2
          
    - name: Take a snapshot of the new VM
      vmware_guest_snapshot:
        name: "Example_VM_Snapshot"
        vm_name: "Example_VM"
        
    - name: Remove the newly created VM
      vmware_guest:
        name: "Example_VM"
        state: absent
