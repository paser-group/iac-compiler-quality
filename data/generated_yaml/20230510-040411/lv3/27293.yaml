
- name: Test the get_url module for error 400
  hosts: localhost
  vars:
    url: "https://example.com/resource"
    user: "user123"
    password: "password123"
    headers:
      Authorization: "invalid_token"
  tasks:
    - name: Get resource with get_url
      get_url:
        url: "{{ url }}"
        dest: "/tmp/resource"
        user: "{{ user }}"
        password: "{{ password }}"
        headers: "{{ headers }}"
      register: result

    - name: Check response code
      fail:
        msg: "Expected a 400 response code from the server"
      when: result.status_code != 400
