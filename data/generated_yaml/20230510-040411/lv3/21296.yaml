
---
- hosts: target_hosts
  become: true
  tasks:
    - name: Check UFW status before applying the rule
      shell: ufw status verbose
      register: ufw_status_pre
    - name: Add a new UFW rule
      shell: ufw allow 22/tcp
    - name: Check UFW status after applying the rule
      shell: ufw status verbose
      register: ufw_status_post
    - name: Fail if UFW status did not change
      debug:
        msg: "UFW status did not change after applying the new rule"
      failed_when: ufw_status_pre == ufw_status_post
