
- hosts: vmware
  gather_facts: no
  tasks:
    - name: Create a portgroup with security policy set to false
      vmware_portgroup:
        datacenter_name: "{{ datacenter_name }}"
        cluster_name: "{{ cluster_name }}"
        portgroup_name: "{{ portgroup_name }}"
        security_policy: "{{ false }}"
      register: result_create
    - name: Check if security policy is set correctly
      vmware_portgroup:
        datacenter_name: "{{ datacenter_name }}"
        cluster_name: "{{ cluster_name }}"
        portgroup_name: "{{ portgroup_name }}"
      register: result_check
    - name: Fail the task if security policy is not set correctly
      assert:
        that: 
          - result.check.security_policy == false
        fail_msg: "Security policy not set to false"
