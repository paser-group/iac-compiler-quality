
---
- hosts: vmware-host
  gather_facts: False
  vars:
    vm_name: "{{ 'duplicate_name_vm' }}"
  tasks:
  - name: create VM1
    vmware_guest:
      hostname: '{{ inventory_hostname }}'
      username: '{{ vmware_username }}'
      password: '{{ vmware_password }}'
      validate_certs: no
      name: '{{ vm_name }}'
      state: present
      guest_id: '{{ vmware_guest_id }}'
      hardware:
        memory_mb: '{{ vmware_vm_memory_mb }}'
        num_cpus: '{{ vmware_vm_num_cpus }}'
        scsi: '{{ vmware_scsi }}'
      disks:
        disk1:
          size_gb: '{{ vmware_vm_disk_size_gb }}'
          type: '{{ vmware_vm_disk_type }}'

  - name: create VM2 with same name as VM1
    vmware_guest:
      hostname: '{{ inventory_hostname }}'
      username: '{{ vmware_username }}'
      password: '{{ vmware_password }}'
      validate_certs: no
      name: '{{ vm_name }}'
      state: present
      guest_id: '{{ vmware_guest_id }}'
      hardware:
        memory_mb: '{{ vmware_vm_memory_mb }}'
        num_cpus: '{{ vmware_vm_num_cpus }}'
        scsi: '{{ vmware_scsi }}'
      disks:
        disk1:
          size_gb: '{{ vmware_vm_disk_size_gb }}'
          type: '{{ vmware_vm_disk_type }}'
