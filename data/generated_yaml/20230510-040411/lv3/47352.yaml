
- name: Windows Domain Playbook
  hosts: windows

  tasks:
    - name: Create new domain user
      win_domain_user:
        name: non_idempotent_user
        state: present
        password: 'NonIdempotentUser@123'

    - name: Add the user to Domain Administrators group
      win_domain_group_membership:
        name: "Administrators"
        members:
          - "{{ inventory_hostname }}\\non_idempotent_user"
        state: present

    - name: Create a new organizational unit
      win_domain_ou:
        name: non_idempotent_ou
        state: present
        path: OU=NonIdempotentOU,DC=example,DC=com

    - name: Change the description of the OU
      win_domain_ou:
        name: non_idempotent_ou
        state: present
        path: OU=NonIdempotentOU,DC=example,DC=com
        description: "This is a new description."

