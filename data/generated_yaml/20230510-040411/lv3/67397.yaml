
---
- hosts: nxos_vm
  gather_facts: no

  tasks:
    - name: Upgrade NXOS
      nxos_install_os:
        image: "{{ nxos_version }}"
      ignore_errors: true

    - name: Run FullLoader
      nxos_loader:
        install_os: true
        provider: "{{ nxos_provider }}"

    - name: Check if NXOS is up
      wait_for:
        host: "{{ inventory_hostname }}"
        port: "{{ ssh_port }}"
        delay: 10
        timeout: 300 

  vars:
    nxos_provider: "{{ ansible_connection }}"
    nxos_version: "{{ ansible_distribution_version }}"

