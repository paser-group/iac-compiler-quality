
- name: Test WinRM sensitivity to network issues
  hosts: win_host
  gather_facts: no
  vars:
    command: "Get-Process"
    delay: 10
  tasks:
    - name: Execute command with delay
      win_command: "{{ command }}"
      register: result
      retries: 3
      delay: "{{ delay }}"
      retry_timeout: 30
      ignore_errors: yes
    - name: Handle ReadTimeout error
      meta: clear_host_errors
      when: result is failed and "'ReadTimeout' in result.msg"
