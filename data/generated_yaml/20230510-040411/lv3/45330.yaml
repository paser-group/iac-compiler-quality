
- name: Create Azure Container Registry
  hosts: localhost
  gather_facts: false
  vars:
    acr_name: "myregistry"
    resource_group: "myresourcegroup"
    location: "eastus"
  tasks:
    - name: Create Resource Group
      azure_rm_resourcegroup:
        name: "{{ resource_group }}"
        location: "{{ location }}"
      register: rg_result

    - name: Create Azure Container Registry
      azure_rm_containerregistry:
        name: "{{ acr_name }}"
        resource_group: "{{ resource_group }}"
        location: "{{ location }}"
        admin_enabled: true
        sku: Basic
      register: acr_result

    - name: Create Azure Container Registry again
      azure_rm_containerregistry:
        name: "{{ acr_name }}"
        resource_group: "{{ resource_group }}"
        location: "{{ location }}"
        admin_enabled: true
        sku: Basic
      register: acr_result_again

    - name: Check if resources were created successfully
      debug:
        var: acr_result.changed or acr_result_again.changed
