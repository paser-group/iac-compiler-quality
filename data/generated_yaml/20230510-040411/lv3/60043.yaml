
---
- hosts: localhost
  vars:
    mongo_host: "{{ inventory_hostname_short }}"
    mongo_port: "27017"
    mongo_db: "default_db_name"
  tasks:
    - name: Connect to MongoDB
      become: true
      community.mongodb.mongodb_user:
        database: "{{ mongo_db }}"
        username: "someuser"
        password: "somepw"
        auth_database: admin
        state: present
    - name: Test MongoDB connection
      become: true
      community.mongodb.mongodb_query:
        database: "{{ mongo_db }}"
        collection: "{{ mongo_db }}.somecollection"
        query: '{"_id":1}'
      register: result
    - name: Display result
      debug:
        msg: "{{ result }}"
