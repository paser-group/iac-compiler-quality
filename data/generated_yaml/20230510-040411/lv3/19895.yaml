
---
- name: Create VPC, Subnets and Launch Instance 
  hosts: localhost
  gather_facts: no
  
  tasks:
  - name: Create AWS VPC
    ec2_vpc_net:
      name: my_vpc
      cidr_block: 192.168.0.0/16
      state: present
      region: us-west-2
      
  - name: Create AWS Subnet
    ec2_vpc_subnet:
      state: present
      vpc_id: "{{ vpc.id }}"
      cidr: "192.168.1.0/24"
      region: us-west-2
          
  - name: Launch EC2 Instance in VPC with Subnet
    ec2:
      key_name: private_key
      group: default
      instance_type: t2.micro
      image: ami-d5a9bbb8
      wait: yes
      region: us-west-2
      vpc_subnet_id: "{{ subnet.id }}"
