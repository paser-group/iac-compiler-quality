
- name: Foreman authentication errors using callback plugin
  hosts: target_hosts
  gather_facts: no
  
  vars:
    foreman_username: "testuser"
    foreman_password: "testpassword"

  tasks:
  - name: Configure Foreman callback plugin
    foreman_callback:
      login: "{{ foreman_username }}"
      password: "{{ foreman_password }}"
      endpoint: "http://foreman.example.com/api"
    delegate_to: localhost
  
  - name: Deploy a package using Foreman callback plugin
    package:
      name: "mypackage"
      state: "installed"
      update_cache: yes
    ignore_errors: yes
    register: package_output
    
  - name: Print package output
    debug:
      var: package_output
