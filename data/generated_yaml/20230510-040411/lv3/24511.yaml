
- name: Create VM Snapshot
  vmware_guest_snapshot:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_user }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    datacenter: "{{ vm_datacenter }}"
    cluster: "{{ vm_cluster }}"
    vm_id: "{{ vm_id }}"
    snapshot_name: "{{ snapshot_name }}"
    state: "present"
  register: snapshot_result
    
- name: Verify Snapshot Status
  vmware_guest_snapshot:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_user }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    datacenter: "{{ vm_datacenter }}"
    cluster: "{{ vm_cluster }}"
    vm_id: "{{ vm_id }}"
    snapshot_name: "{{ snapshot_name }}"
    state: "list"
  register: snapshot_status

- name: Delete Snapshot
  vmware_guest_snapshot:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_user }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    datacenter: "{{ vm_datacenter }}"
    cluster: "{{ vm_cluster }}"
    vm_id: "{{ vm_id }}"
    snapshot_name: "{{ snapshot_name }}"
    state: "absent"
