
---
- hosts: localhost
  gather_facts: false

  tasks:
    - name: create a new ASG with ec2_asg module
      ec2_asg:
        name: my_asg
        launch_config_name: my_launch_config
        region: us-west-2
        load_balancers: ['my_lb']
        availability_zones: ['us-west-2a']
        max_size: 2
        min_size: 1
      register: asg_details

    - name: update the created ASG with new settings
      ec2_asg:
        name: my_asg
        availability_zones: ['us-west-2a', 'us-west-2b']
        launch_config_name: my_updated_launch_config
      when: asg_details.status != 'failed'
