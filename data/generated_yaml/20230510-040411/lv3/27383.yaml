
- name: Configure NTP on nxos switch
  hosts: nxos_switch
  connection: network_cli
  gather_facts: no
  vars:
    ntp_server: "10.0.0.1"
    source_interface: "Ethernet0/0"
    authentication_key: "7 012345678901234567890123456789012345678901234567890123456789"
    trusted_key: "1"
    
  tasks:
    - name: Configure NTP
      nxos_ntp:
        server: "{{ ntp_server }}"
        source_interface: "{{ source_interface }}"
        authentication_key: "{{ authentication_key }}"
        
      #Intentionally add syntax error by missing trusted_key parameter
      until: result is succeeded
      retries: 3
      delay: 10
      register: result

    - debug:
        var: result
