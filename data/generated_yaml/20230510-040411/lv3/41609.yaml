
---
- name: Test Ansible Fact Failure
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Run invalid facts.d script
      command: /path/to/facts.d/script
      register: fact_output
      ignore_errors: yes

    - name: Set fact to error string
      set_fact:
        invalid_fact: "{{ fact_output | default('Invalid JSON') }}"
      when: fact_output is failed
