
---
- name: Test Ansible EC2 Module for Windows Launch and Password Setting
  hosts: localhost
  gather_facts: no

  vars:
    instance_type: t2.micro
    image: ami-0b69ea66ff7391e80
    region: "us-east-1"
    count: 1
    key_name: ansible_test
    group: ec2_group
    subnet_id: subnet-abc1234
    ec2_password: "{{ lookup('password', '/dev/null length=20 chars=ascii_letters,digits,punctuation') }}"
    key_data: "Invalid-Key-Data"

  tasks:

    - name: Launch Windows EC2 instance with ec2_win_launch
      ec2_win_launch:
        instance_type: "{{ instance_type }}"
        image: "{{ image }}"
        region: "{{ region }}"
        count: "{{ count }}"
        key_name: "{{ key_name }}"
        group: "{{ group }}"
        subnet_id: "{{ subnet_id }}"
        ec2_password: "{{ ec2_password }}"
        key_data: "{{ key_data }}"
      register: ec2

    - debug: var=ec2
