
---
- name: GCP Auth Error Playbook
  hosts: localhost
  
  vars:
    project_id: <your_gcp_project_id>
  
  tasks:
    - name: Authenticate with GCP
      gcp_compute_auth:
        credentials_file: "/path/to/your/credentials_file.json"
        project_id: "{{ project_id }}"
      register: auth_result
    
    - name: Debug Auth Result
      debug:
        var: auth_result
    
    - name: Create GCE Instance
      gcp_compute_instance:
        name: "test-instance"
        machine_type: "f1-micro"
        disk_auto_delete: true
        zone: "us-central1-a"
        project_id: "{{ project_id }}"
        auth_file: "/path/to/your/credentials_file.json"
      register: instance_create_result
      when: auth_result.changed == false
    
    - name: Debug Instance Creation Result
      debug:
        var: instance_create_result
