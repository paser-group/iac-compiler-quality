
- name: Test Ansible module idempotency
  hosts: all
  
  tasks:
    - name: Configure nxos_igmp_snooping with default values
      nxos_igmp_snooping:
        state: enabled
        global: yes
      register: result1
    
    - name: Re-run nxos_igmp_snooping with default values
      nxos_igmp_snooping:
        state: enabled
        global: yes
      register: result2
      changed_when: false
    
    - name: Compare results for nxos_igmp_snooping with default values
      assert:
        that:
          - result1.stdout == result2.stdout
    
    - name: Configure nxos_igmp_snooping with non-default values
      nxos_igmp_snooping:
        state: enabled
        global: no
      register: result3
    
    - name: Re-run nxos_igmp_snooping with non-default values
      nxos_igmp_snooping:
        state: enabled
        global: no
      register: result4
      changed_when: false
    
    - name: Compare results for nxos_igmp_snooping with non-default values
      assert:
        that:
          - result3.stdout == result4.stdout
