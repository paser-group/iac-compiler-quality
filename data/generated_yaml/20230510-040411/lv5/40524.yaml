
- name: Test local action and privilege escalation
  hosts: localhost
  connection: local
  tasks:
    - name: Define local variable for config file path
      set_fact:
        config_file_path: "/etc/example.conf"
    - name: Define remote variable for sudo access
      set_fact:
        remote_sudo_required: yes
    - name: Update config file on remote host
      shell: "echo 'new_config_option = true' >> {{ config_file_path }}"
      when: remote_sudo_required
      become: yes
      become_method: sudo
      become_user: vault_localhost_sudo
      delegate_to: 127.0.0.1
