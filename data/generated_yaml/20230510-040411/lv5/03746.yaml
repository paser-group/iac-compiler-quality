
- hosts: localhost
  connection: local
  gather_facts: False

  vars:
    instance_properties:
      key_name: key_name
      image: ami_id
      instance_type: instance_type
      count: 1
      security_groups: security_group_id

  tasks:
    - name: create_ec2_instance
      ec2:
        instance_tags: {"Name": "test-instance"}
        region: us-west-2
        **{{ instance_properties }}**
      register: instance_output

    - name: check_changed_attribute
      fail:
        msg: 'Changed attribute is not false'
      when: instance_output.changed
