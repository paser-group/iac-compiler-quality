
- name: Git submodule error
  hosts: all

  tasks:
    - name: Clone with submodules
      git:
        repo: <repo_url>
        dest: <local_repo_path>
        clone: yes
        recursive: yes

    - name: Update submodules
      git:
        repo: <repo_url>
        dest: <local_repo_path>
        recursive: yes
        update: yes
        accept_hostkey: yes
        key_file: <ssh_private_key_file>  # Optional, if the repo requires SSH authentication

      register: result

    - name: Fail if submodule update fails
      fail:
        msg: 'Failed to initialize/update submodule'
      when: result.rc != 0
