
- name: Test memory allocation
  hosts: localhost
  vars:
    memory_size: 1024
    iterations: 10000
  tasks:
  - name: Allocate memory
    command: /usr/bin/perl -e 'for (1..{{iterations}}) {push(@a, "a" x {{memory_size}});}'

  - name: Deallocate memory
    command: /usr/bin/perl -e '@a=();'

  - name: Allocate memory with garbage collector
    command: /usr/bin/perl -e 'use Scalar::Util qw(weaken); my $a = 1; my $b = 1; weaken($a);'

  - name: Deallocate memory with garbage collector
    command: /usr/bin/perl -e 'undef $b;'
