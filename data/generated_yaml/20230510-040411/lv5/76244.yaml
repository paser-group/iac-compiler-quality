
- name: Test delegate_to with changing targets
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Define dynamic inventory
      add_host:
        name: "{{ item }}"
        groups: dynamic_targets
      with_items: "{{ dynamic_targets }}"
    
    - name: Run command on dynamic targets
      command: echo "Hello, {{ item }}"
      delegate_to: "{{ item }}"
      with_inventory_hostnames:
        - dynamic_targets
