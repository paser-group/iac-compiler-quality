
- name: Check and create temporary directory
  become: yes
  command: mkdir -p /tmp/.ansible
  when: ansible_user != 'root'

- name: Set ownership for temporary directory
  become: yes
  file:
    path: "/tmp/.ansible"
    owner: "{{ ansible_user }}"
    state: directory
  when: ansible_user != 'root'

- name: Execute tasks in temporary directory
  become: yes
  command: "cd /tmp/.ansible && {{ command }}"
  args:
    executable: /bin/bash
  when: ansible_user != 'root'
