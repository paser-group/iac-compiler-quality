
---
- name: Test pickle serialization and deserialization of module object
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Import services module for testing
      import: name=services

    - name: Pickle serialize module object
      set_fact:
        module_pickle: "{{ services | to_json | from_json }}"
        module_pickle_serialized: "{{ module_pickle | pickle }}"

    - name: Pickle deserialize module object
      set_fact:
        module_pickle_deserialized: "{{ module_pickle_serialized | unpickle }}"

    - name: Verify module object is intact
      assert:
        that:
          - module_pickle == module_pickle_deserialized
