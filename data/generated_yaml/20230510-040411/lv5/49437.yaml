
- host: localhost
  gather_facts: no

  tasks:
    - name: Create the credential
      tower_credentials:
        name: test-cred
        description: Test credential
        credential_type: machine
        username: testuser
        password: testpass
        security_token: ""
        organization: Default
      register: result_create

    - name: Re-create the credential
      tower_credentials:
        name: test-cred
        description: Test credential
        credential_type: machine
        username: testuser
        password: testpass
        security_token: ""
        organization: Default
      register: result_recreate

    - name: Verify the credential
      debug:
        msg: "The credentials are idempotent"
      when:
        - result_create.response.id == result_recreate.response.id
        - result_create.response.username == result_recreate.response.username
        - result_create.response.password == result_recreate.response.password
        - result_create.response.security_token == result_recreate.response.security_token
        - result_create.response.organization == result_recreate.response.organization
