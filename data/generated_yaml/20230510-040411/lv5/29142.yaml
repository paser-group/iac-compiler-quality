yaml
- name: Test gather_facts consistency
  hosts: all
  gather_facts: false
  tasks:
    - name: Gather facts repeatedly
      block:
        - set_fact:
            facts_result: "{{ hostvars[inventory_hostname].ansible_facts }}"
      loop: "{{ range(10) }}"
      register: gather_facts_output
    - name: Display gathered facts
      debug:
        var: gather_facts_output
    - name: Verify facts correctness
      assert:
        that:
          - "{{ gather_facts_output.results[0].ansible_loop_var.facts_result == gather_facts_output.results[1].ansible_loop_var.facts_result }}"
