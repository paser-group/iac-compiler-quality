
---
- hosts: localhost
  gather_facts: false
  tasks:
  - name: Test ansible-galaxy list error handling
    command:
      cmd: ansible-galaxy list --roles-path=/nonexistent
    register: output
    changed_when: false
    failed_when: "output.rc == 0"
    ignore_errors: yes

  - name: Fail the task
    fail:
      msg: "Ansible-galaxy list did not error when passed nonexistent directory"
    when: "'ERROR: The directory specified in 'roles_path' does not exist.' not in output.stderr_lines"
