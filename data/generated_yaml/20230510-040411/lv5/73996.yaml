
- name: Recursive function to manipulate data 
  hosts: localhost
  vars:
    data: "{{ range(1,100) | list }}" # large dataset
  tasks:
    - name: Process data recursively
      set_fact:
        temp_data: |-
          {% set new_data = [] %}
          {% for item in data %}
            {% if item <= 50 %}
              {% set dummy = new_data.append(item + 1) %}
            {% endif %}
          {% endfor %}
          {% if new_data %}
            {% set data = new_data %}
            {{ temp_data }}
          {% else %}
            {{ data }}
          {% endif %}
            recursive
