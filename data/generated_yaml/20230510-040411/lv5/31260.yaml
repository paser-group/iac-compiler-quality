
---
- name: Test fact cache
  hosts: all
  gather_facts: False

  tasks:
    - name: Gather system facts
      setup:
        gather_subset: "!all"

    - name: Assert fact cache is enabled
      assert:
        that:
          - ansible_facts_cacheable
          - ansible_facts_cacheable_fact_names

    - name: Configure fact cache
      set_fact:
        ansible_facts_cacheable: False
        ansible_facts_cacheable_fact_names: []

    - name: Assert fact cache is disabled
      assert:
        that:
          - not ansible_facts_cacheable
          - not ansible_facts_cacheable_fact_names
