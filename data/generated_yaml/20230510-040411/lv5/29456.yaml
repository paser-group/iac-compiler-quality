
- name: Test EC2 Instance Shutdown Behavior
  hosts: localhost
  gather_facts: no
  
  vars:
    ec2_shutdown_behavior: "stop"
  
  tasks:
    - name: Set EC2 instance-initiated Shutdown Behavior
      ec2:
        instance_ids: "{{ ec2_instance_id }}"
        instance_initiated_shutdown_behavior: "{{ ec2_shutdown_behavior }}"
      register: result
  
    - name: Verify the Instance Initiated Shutdown Behavior
      fail:
        msg: "EC2 instance-initiated shutdown behavior failed"
      when:
        - result is not defined
        - result.instance_initiated_shutdown_behavior != "{{ ec2_shutdown_behavior }}"
