yaml
- hosts: target_server
  become: yes
  tasks:

  - name: Verify if sshd is running
    service:
      name: sshd
      state: started
      enabled: yes

  - name: Test SSH connection using provided key and port number
    wait_for:
      port: 22
      host: "{{ inventory_hostname }}"
      timeout: 5
    become: false

  - name: Check SSH connectivity with supplied credentials
    ssh_connection:
      ssh_args: -o StrictHostKeyChecking=no
      ssh_private_key_file: "<provide path to SSH key>"
      port: 22
