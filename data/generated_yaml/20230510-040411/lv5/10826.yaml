
- name: Set SSH ControlPath configuration
  hosts: all
  gather_facts: false
  vars:
    ssh_control_path_dir: "/tmp/ssh"
    ssh_control_path_file: "ansible-ssh-%%C"
    ssh_control_path_mode: "0660"
    ssh_control_path_plaintext: "no"
    ssh_control_path_default: "yes"

  tasks:
    - name: Create SSH ControlPath directory
      file:
        path: "{{ ssh_control_path_dir }}"
        mode: "{{ ssh_control_path_mode }}"
        state: directory

    - name: Set SSH ControlPath configuration
      lineinfile:
        path: "/etc/ssh/ssh_config"
        regexp: "ControlPath"
        line: "ControlPath {{ ssh_control_path_dir }}/{{ ssh_control_path_file }}"
        state: present
