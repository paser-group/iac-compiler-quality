
- name: Create an EC2 instance
  ec2:
    region: us-west-2
    instance_type: t2.micro
    image: ami-0c55b159cbfafe1f0
    key_name: ec2_key
    count: 1
  register: ec2_result

- name: Create an RDS instance
  rds:
    region: us-west-2
    instance_name: test-instance
    db_type: postgres
    username: postgres
    password: mysecret
    allocated_storage: 10
  register: rds_result

- name: Create an EC2 RDS Postgres instance
  ec2_rds_postgres:
    ec2: "{{ ec2_result.instances[0] }}"
    rds: "{{ rds_result.instance }}"
  register: comp_result
