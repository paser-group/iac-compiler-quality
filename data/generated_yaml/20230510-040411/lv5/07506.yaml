
- name: Create the instance
  ec2:
    instance_type: t2.micro
    region: us-east-1
    image: ami-02758c53922cae61d
    state: present
    count: 1
    vpc_subnet_id: subnet-038baabb8c09ed17c
    assign_public_ip: yes
  register: instances

- name: Wait for host to come up
  wait_for:
    host: "{{ item.public_ip }}"
    port: 22
    delay: 5
    timeout: 300
  with_items: "{{ instances.instances }}"
