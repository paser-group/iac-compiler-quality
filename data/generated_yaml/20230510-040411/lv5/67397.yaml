
- name: Load custom module
  hosts: all
  tasks:
    - name: Copy custom module to remote machine
      copy:
        src: custom_module.py
        dest: /usr/lib/python2.7/site-packages/ansible/modules/
      delegate_to: localhost

    - name: Verify custom module loaded successfully
      command: ansible all -M /usr/lib/python2.7/site-packages/ansible/modules/ -m custom_module
      register: result
