
- name: "Add a security group rule with any protocol type"
  hosts: localhost
  gather_facts: no
  tasks:
    - name: "Add a security group rule with protocol type any"
      os_security_group_rule:
        name: "test-group"
        state: present
        direction: ingress
        protocol: any
        remote_ip_prefix: 0.0.0.0/0
        security_group_id: "{{ security_group_id }}"
        position: 1
        rule_exists:
          protocol: any
          remote_ip_prefix: 0.0.0.0/0
          ethertype: IPv4
      register: result

    - name: "Add a security group rule with non-any protocol type"
      os_security_group_rule:
        name: "test-group"
        state: present
        direction: ingress
        protocol: tcp
        port_range_min: 22
        port_range_max: 22
        remote_ip_prefix: 0.0.0.0/0
        security_group_id: "{{ security_group_id }}"
        position: 2
      when: result|failed
