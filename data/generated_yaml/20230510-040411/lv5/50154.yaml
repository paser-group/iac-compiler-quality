
- hosts: target_host
  gather_facts: false

  tasks:
  - name: Filter subelements
    set_fact:
      filtered_list: "{{ subelements | selectattr('some_attribute', 'defined') | list }}"
    vars:
      subelements:
      - name: item1
        some_attribute: 1
      - name: item2
        some_attribute: 2
      - name: item3
    ignore_errors: true

  - name: Include tasks
    include_tasks: some_task.yml
    delegate_to: "{{ output_host }}"
