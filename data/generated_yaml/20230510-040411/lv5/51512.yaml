
- name: Test Win_DSC PSCredential conversion error
  hosts: all
  tasks:
    - name: Create PSCredential dictionary
      set_fact:
        cred_dict: {'username': 'username', 'password': 'password'}
    
    - name: Create PSCredential object
      set_fact:
        cred_obj: "{{ lookup('pipe', 'powershell -command \"[pscredential]::new(\'\'\'{{ cred_dict.username }}\'\'\', (ConvertTo-SecureString \'\'\'{{ cred_dict.password }}\'\'\' -AsPlainText -Force))\"') }}"
    
    - name: Print PSCredential object
      debug:
        var: cred_obj
