
- name: Test user module for idempotency when user doesn't exist
  hosts: localhost
  gather_facts: no

  vars:
    username: non_existent_user

  tasks:
    - name: Ensure user is absent
      user:
        name: "{{ username }}"
        state: absent
      ignore_errors: yes
      
    - name: Check if user is present
      user:
        name: "{{ username }}"
      register: result
      ignore_errors: yes
      
    - name: Ensure user is absent
      user:
        name: "{{ username }}"
        state: absent
      ignore_errors: yes
      
    - name: Print output
      debug:
        var: result
