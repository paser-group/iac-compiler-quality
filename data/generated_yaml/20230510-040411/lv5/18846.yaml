
- name: Test shell and command modules
  hosts: all
  tasks:
    - name: Test command module
      command: echo hello
      register: cmd_output
      failed_when: cmd_output.rc != 0
      changed_when: false

    - name: Test shell module
      shell: echo hello
      register: shell_output
      failed_when: shell_output.rc != 0
      changed_when: false

    - name: Test complex command
      shell: |
        echo $PATH
        echo $HOME
      register: complex_output
      failed_when: complex_output.rc != 0
      changed_when: false

    - name: Test for environment variable errors
      shell: |
        echo $WRONG_VARIABLE
      register: err_output
      failed_when: err_output.rc == 0
      changed_when: false

    - name: Test for command injection
      shell: |
        echo {{ input_var }}
      register: inj_output
      failed_when: inj_output.rc == 0
      changed_when: false
      vars:
        input_var: "escaped-command` && echo hello`"
