
- name: Test random_mac filter
  hosts: localhost
  vars:
    valid_prefix_lengths:
      - 2
      - 4
  tasks:
    - name: Generate random MAC address with prefix length 2
      set_fact:
        mac_address: "{{ '00:' + '%02X' % item + ':00:00:00:00' | random_mac }}"
      loop: "{{ valid_prefix_lengths }}"
    - name: Validate MAC address with prefix length 2
      assert:
        that:
          - mac_address is match('00:([0-9A-Fa-f]{2}:){3}[0-9A-Fa-f]{2}')
    - name: Generate random MAC address with prefix length 4
      set_fact:
        mac_address: "{{ '00:11:' + '%02X' % item + ':00:00:00' | random_mac }}"
      loop: "{{ valid_prefix_lengths }}"
    - name: Validate MAC address with prefix length 4
      assert:
        that:
          - mac_address is match('00:11:([0-9A-Fa-f]{2}:){2}[0-9A-Fa-f]{2}')
