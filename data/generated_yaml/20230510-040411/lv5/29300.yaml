
- name: Test ec2_vpc_route_table bug
  hosts: localhost
  gather_facts: no
  vars:
    vpc_id: "vpc-xxxxxx"
    name_tag: "MyRouteTable"

  tasks:
  - name: Create a new route table with the 'Name' tag
    ec2_vpc_route_table:
      vpc_id: "{{ vpc_id }}"
      name_tag: "{{ name_tag }}"
      state: present
    register: table_creation_result

  - debug:
      msg: "{{ table_creation_result }}"

  - name: Attempt to create a duplicate route table with the same 'Name' tag
    ec2_vpc_route_table:
      vpc_id: "{{ vpc_id }}"
      name_tag: "{{ name_tag }}"
      state: present
    ignore_errors: yes
    register: table_creation_duplicate

  - debug:
      msg: "{{ table_creation_duplicate }}"
