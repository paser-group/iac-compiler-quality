
- name: Download and verify permissions of file
  hosts: <target_hosts>
  vars:
    - file_url: "http://example.com/example_file"
    - checksum: "sha256:12345abcde"
    - dest_file_path: "/tmp/example_file"
  tasks:
    - name: Download file using get_url with checksum and !force
      get_url:
        url: "{{ file_url }}"
        dest: "{{ dest_file_path }}"
        checksum: "{{ checksum }}"
        force: no
      register: download_output

    - name: Check permissions of transferred file
      file:
        path: "{{ dest_file_path }}"
        mode: "0644"     # update file to correct permissions
      when: download_output.changed == True
