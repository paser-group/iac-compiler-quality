
- name: Establish a WinRM connection to the Windows Server 2019 instance
  hosts: windows
  gather_facts: false
  vars:
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore
    ansible_user: "{{ winrm_username }}"
    ansible_password: "{{ winrm_password }}"
  tasks:
    - name: Check the connection by running a command
      win_shell: echo hello world
      register: command_output
    - name: Debug the output of the command
      debug:
        var: command_output.stdout_lines
      when: command_output.rc != 0
