
- name: Test pip module $PATH searching
  hosts: localhost
  become: True
  
  tasks:
    - name: Create virtual environment
      command: virtualenv /tmp/testenv
      
    - name: Install package without virtualenv_command arguments
      pip:
        name: requests
      
    - name: Activate virtual environment
      command: ". /tmp/testenv/bin/activate"
      
    - name: Install package with virtualenv_command arguments
      pip:
        name: requests
        virtualenv_command: /tmp/testenv/bin/python -m venv
      
    - name: Deactivate virtual environment
      command: "deactivate"
      
    - name: Remove virtual environment
      file:
        path: /tmp/testenv
        state: absent
