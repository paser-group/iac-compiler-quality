
- name: Test FortiOS httpapi for maximum recursion depth errors
  hosts: fortigate
  gather_facts: False
  tasks:
    - name: Make multiple calls to FORTiOS API endpoint
      uri:
        url: "https://{{ ansible_host }}/api/v2/cmdb/firewall/address"
        method: GET
        force_basic_auth: yes
        user: "{{ username }}"
        password: "{{ password }}"
        status_code: 200
        body_format: json
        validate_certs: no
        register: api_response
        loop: "{{ range(1,10) | list }}"
      register: results

    - debug:
        var: results
