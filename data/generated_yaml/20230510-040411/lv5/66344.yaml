
- name: Test k8s_scale Playbook for potential Ansible Bugs
  hosts: all
  become: yes

  tasks:
  - name: Install Kubernetes
    kubernetes:
      state: present

  - name: create a Kubernetes deployment
    kubernetes:
      state: present
      definition:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: nginx
        spec:
          replicas: 2
          selector:
            matchLabels:
              app: nginx
          template:
            metadata:
              labels:
                app: nginx
            spec:
              containers:
              - name: nginx
                image: nginx
                ports:
                - containerPort: 80

  - name: Scale up the Kubernetes deployment
    kubernetes:
      name: nginx
      namespace: default
      replicas: 4

  - name: Introduce error with code snippet
    debug:
      msg: "{{ item }}"
    with_items:
      - "{{ some_invalid_variable }}"
