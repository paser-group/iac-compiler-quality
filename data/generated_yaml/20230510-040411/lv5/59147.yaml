
- name: Test GCP Inventory plugin without service_account_email
  hosts: localhost
  gather_facts: no
  
  tasks:
    - name: Configure GCP Inventory plugin
      gcp_compute_inventory:
        credentials_file: "/path/to/credentials.json"
        host_filters:
          - name=default
        group_by:
          - zone
          - labels
        compose:
          ansible_host: name
          env: labels.env
          tags: labels.tags

    - name: Test for missing variable
      debug:
        var: hostvars['some_host'].gcp.unique_instance_id
