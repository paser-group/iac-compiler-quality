
---
- name: Test CloudFrontOriginAccessIdentityList
  hosts: localhost
  gather_facts: no

  vars:
    cloudfront_origin_access_identity_list: []

  tasks:
    - name: Create an empty CloudFrontOriginAccessIdentityList
      cloudfront_origin_access_identity_list:
        state: present
        cloudfront_origin_access_identity_list: "{{ cloudfront_origin_access_identity_list }}"
      register: result

    - name: Test if CloudFrontOriginAccessIdentityList is empty
      set_fact:
        empty: "{{ cloudfront_origin_access_identity_list | length == 0 }}"
      ignore_errors: true

    - name: Test cloudfront_origin_access_identity
      assert:
        that:
          - "false"
        msg: "cloudfront_origin_access_identity should not be accessible when CloudFrontOriginAccessIdentityList is empty"
      when: not empty and cloudfront_origin_access_identity_ref is defined
