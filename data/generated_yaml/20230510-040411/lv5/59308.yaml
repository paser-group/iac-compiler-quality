
- name: Test become command on Windows
  command: bash -c "sudo -u {{ansible_user}} echo hello"
  become: yes
  become_method: runas
  register: become_output

- name: Fail task if output contains error message
  fail:
    msg: "Unexpected error message: {{ become_output.stdout }}"
  when: "WindowsError" in become_output.stdout
