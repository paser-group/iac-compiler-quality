
---
- hosts: localhost
  roles:
    - role: test_role
  tasks:
    - set_fact:
        failed_task: "{{ ansible_failed_task }}"
    - fail:
        msg: "ansible_failed_task is undefined in role"
      when: failed_task is undefined
