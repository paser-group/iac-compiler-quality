
- name: Test command/shell module arguments parsing
  hosts: all
  gather_facts: no

  vars:
    test_command: 'echo {{ test_arg }}'
    test_args:
      - 'foo=bar'
      - '-a'
      - 'baz'
      - 'qux=3,4,5'
      - 'test="quoted text"'

  tasks:
    - name: Test command with key-value pair
      shell: "{{ test_command }}"
      vars:
        test_arg: "{{ item }}"
      with_items: "{{ test_args }}"

    - name: Test command with mixed arguments
      shell: "{{ test_command }} {{ item }}"
      vars:
        test_arg: 'hello'
      with_items:
        - 'world'
        - 'name=john'

    - name: Test command with escaped quotes
      shell: "{{ test_command }}"
      vars:
        test_arg: '{{"'"}}"{{item}}{{"'"}}"'
      with_items:
        - 'test="quote text"'

