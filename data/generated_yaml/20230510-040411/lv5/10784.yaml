
---
- name: Test Lookup module
  hosts: all
  vars:
    password_storage_path: "/tmp/password_storage"
  tasks:
    - name: Create directory
      file:
        path: "{{ password_storage_path }}"
        state: directory
    - name: Retrieve password and store in a file
      copy:
        content: "{{ lookup('password', '/dev/null length=30') }}"
        dest: "{{ password_storage_path }}/password"
        mode: '0600'
    - name: Remove directory
      file:
        path: "{{ password_storage_path }}"
        state: absent
