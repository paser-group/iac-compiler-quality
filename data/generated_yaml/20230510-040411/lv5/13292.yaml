
- name: Test invalid tags with fail module
  hosts: all
  tasks:
    - name: Execute task with invalid tag
      command: echo "Executing task with invalid tag"
      loop:
        - invalid-tag-1
        - invalid-tag-2
        - invalid-tag-3
      ignore_errors: yes
      register: result
    - name: Fail task with custom message if tag is invalid
      fail:
        msg: "Invalid tag '{{ item.item }}' supplied with --tags flag"
      loop: "{{ result.results }}"
      when: item.rc != 0
