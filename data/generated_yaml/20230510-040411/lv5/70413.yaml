
- name: Test dict2items and when condition in loops
  hosts: localhost
  gather_facts: no
  vars:
    test_dict:
      key1: value1
      key2: value2
  tasks:
    - name: Test dict2items in loop
      debug:
        msg: "{{ item }}"
      loop: "{{ test_dict | dict2items }}"
      register: result
      when: test_dict.key1 is defined
    
    - name: Test skipped loop task
      debug:
        msg: "This task should be skipped"
      loop: "{{ test_dict | dict2items }}"
      when: test_dict.key3 is not defined
      skip: true
