
- name: Establish connection and reuse local domain socket
  hosts: all
  gather_facts: false
  vars:
    usernames:
      - admin
      - root
    passwords:
      - pass123
      - rootpass
  tasks:
  - name: Loop over usernames and passwords
    connection: local
    become: true
    vars:
      ansible_connection: ssh
      ansible_ssh_user: '{{ item.0 }}'
      ansible_ssh_pass: '{{ item.1 }}'
    debug: msg='{{ connection.reset_history }}'
    with_cartesian:
      - '{{ usernames }}'
      - '{{ passwords }}'
