
---
- name: Test Ansible DNF module for RPM scriptlet errors
  hosts: localhost
  become: true
  tasks:
    - name: Install package
      dnf:
        name: test-package
        state: present
    - name: Verify warning message when RPM scriptlet error is present
      command: yum install --script test-package
      register: result
      failed_when: "'error: scriptlet failed' in result.stderr"
      changed_when: false
      ignore_errors: true
      warn: true
