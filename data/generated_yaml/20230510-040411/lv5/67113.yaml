
- name: Install package
  hosts: all
  become: true
  tasks:
    - name: Check if package needs to be installed
      command: "port installed {{ package }}"
      register: result
      changed_when: false
      failed_when: false
      ignore_errors: true
    - name: Install package
      command: "port install {{ package }}"
      when: result.rc != 0 or result.stdout.find('is not active') != -1
