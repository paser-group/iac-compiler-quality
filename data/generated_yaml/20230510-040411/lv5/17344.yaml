
---
- name: Test Openstack dynamic inventory
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Execute ansible-inventory command
      command: ansible-inventory -i inventory.py
      
    - name: Check generated inventory file
      assert:
        that:
          - "'abc' in groups"
          - "'xyz' in inventory_hosts"
          
    - name: Modify dynamic inventory script
      replace:
        path: inventory.py
        regexp: old_variable
        replace: default_variable
      
    - name: Scale up inventory 
      command: ansible-inventory -i inventory.py --list | sed 's/oldnode/newnode/g' >> inventory.py
