yaml
- name: Test Windows Firewall
  hosts: windows
  gather_facts: false
  vars:
    test_firewall_rules:
      - name: "Test Rule 1"
        action: "allow"
        description: "Allow inbound traffic on port 3389."
        direction: "in"
        localip: "any"
        port: "3389"
        protocol: "tcp"
      - name: "Test Rule 2"
        action: "allow"
        description: "Allow outbound traffic on port 80."
        direction: "out"
        localip: "any"
        port: "80"
        protocol: "tcp"
  tasks:
    - name: Add firewall rules
      win_firewall:
        policy: "block"
        state: "enabled"
        rule: "{{ item }}"
        permanent: true
      loop: "{{ test_firewall_rules }}"
    - name: Remove added firewall rules
      win_firewall_rule:
        name: "{{ item.name }}"
        action: "remove"
      loop: "{{ test_firewall_rules }}"
