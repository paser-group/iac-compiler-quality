
---
- name: Test vmware_guest_snapshot error messages using UUID
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Create snapshot using incorrect UUID
      vmware_guest_snapshot:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: False
        uuid: "{{ incorrect_uuid }}"
        state: present
      ignore_errors: yes
      register: result

    - name: Check for specific error message
      fail:
        msg: "Error message is not as expected."
      when: result | failed and "Cannot find virtual machine with uuid" not in result.msg
