
- hosts: all
  gather_facts: no
  become: yes
  vars:
    ansible_ssh_private_key_file: /path/to/key
    ansible_ssh_user: root
  tasks:
    - name: Ping the machines
      ping:
    - name: Check if authentication works
      command: echo "Successfully authenticated through SSH Keys"
      register: ssh_output
      ignore_errors: yes
    - debug:
        var: ssh_output
