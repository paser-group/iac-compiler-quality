
vars:
  netapp_domains:
    - domain1.example.com
    - domain2.example.com
  netapp_credentials:
    username: admin
    password: secret
  na_ontap_gather_facts_params:
    - system_id: 1
      version: 9.1
    - system_id: 2
      version: 9.3
  
tasks:
  - name: gather facts from NetApp domains
    na_ontap_gather_facts:
      hostname: "{{ item }}"
      username: "{{ netapp_credentials.username }}"
      password: "{{ netapp_credentials.password }}"
      system_id: "{{ item in netapp_domains }}"
      version: "{{ lookup('dict', na_ontap_gather_facts_params)['version'] }}"
    with_items: "{{ netapp_domains }}"
    async: 60
    poll: 5
    register: result
