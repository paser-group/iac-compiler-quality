
---
- name: Test ec2_instance module network interface spec
  hosts: localhost
  gather_facts: no

  vars:
    region: us-west-2
    ami_id: ami-0c55b159cbfafe1f0
    instance_type: t2.micro
    key_name: mykey
    subnet_id: <your_subnet_id>
    security_group_id: <your_security_group_id>

  tasks:
  - name: Launch EC2 instance
    ec2_instance:
      region: "{{ region }}"
      image_id: "{{ ami_id }}"
      instance_type: "{{ instance_type }}"
      key_name: "{{ key_name }}"
      count: 1
      network_interfaces:
        - device_index: 0
          subnet_id: "{{ subnet_id }}"
          security_group_ids: ["{{ security_group_id }}"]
          associate_public_ip_address: true
          groups:
            - default

  