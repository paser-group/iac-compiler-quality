
- name: Test sudo command with -u argument
  hosts: all
  tasks:
  - name: Execute sudo command with -u argument
    shell: "sudo su -u oracle"
    register: shell_result
    async: 20
    poll: 1
  - name: Check if command timed out
    async_status:
      jid: "{{ shell_result.ansible_job_id }}"
    register: job_result
    until: job_result.finished
    retries: 10
    delay: 5
  - name: Execute same sudo command without -u argument
    shell: "sudo su"
    register: shell_result
    async: 20
    poll: 1
  - name: Check if command timed out
    async_status:
      jid: "{{ shell_result.ansible_job_id }}"
    register: job_result
    until: job_result.finished
    retries: 10
    delay: 5
