
- hosts: localhost
  become: no
  vars:
    aws_access_key: ACCESS_KEY
    aws_secret_key: SECRET_KEY
    security_group_id: sg-01fb8c511493c2d68
  tasks:
    - name: Delete Security Group
      ec2_group:
        name: "MySecurityGroup"
        id: "{{ security_group_id }}"
        state: "absent"
        aws_access_key: "{{aws_access_key}}"
        aws_secret_key: "{{aws_secret_key}}"
      register: result
      ignore_errors: yes

    - name: Handle Error
      fail:
        msg: "Failed to delete security group, check the ec2_group module and Boto3 library."
      when: "result.rc != 0"
