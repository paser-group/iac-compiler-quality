
- name: Create a GCP instance with customized network configurations
  gcp_compute_instance:
    name: instance-1
    machine_type: n1-standard-1
    zone: us-west1-a
    network_interfaces:
    - network: "{{ custom_network }}"
      network_ip: 10.0.0.3

- name: Replace network configurations with default settings
  command: python /path/to/gcp_compute_instance.py --name instance-1 --network default

- name: Verify the customized network configuration still exists
  gcp_compute_instance:
    name: instance-1
  register: instance_info

- name: Fail the playbook if the customized network configuration was overwritten
  fail:
    msg: "Custom network configurations were overwritten"
  when: "instance_info.network_interfaces[0].network != custom_network"
