
- hosts: all
  gather_facts: true
  
  tasks:
    - name: Check available disk space
      stat:
        path: "/"
      register: disk_space_stats
      
    - name: Debug disk space stats
      debug:
        var: disk_space_stats
        
    - name: Check if disk space is full
      fail:
        msg: "System disk is full"
      when: disk_space_stats.stat_available_size < 5000000 # 5MB
