
- name: F5 bigip_device_facts 'unknown profile context error'
  hosts: f5_devices
  gather_facts: no

  tasks:

  - name: Collect device facts
    bigip_device_facts:
      hostname: "{{ inventory_hostname }}"
      username: "{{ f5_username }}"
      password: "{{ f5_password }}"
      validate_certs: no
    register: device_facts

  - debug:
      msg: "{{ device_facts }}"

  - assert:
      that:
        - device_facts is defined
        - device_facts['virtual-servers'] | length > 0

  # Execute bigip_device_facts module for a list of devices
  - include_tasks: bigip_device_facts.yml
    with_items: "{{ f5_device_list }}"
