
- name: Test mssql_db module for errors
  hosts: all
  vars:
    db_name: "{{ lookup('env', 'DATABASE_NAME') }}"
    db_user: "{{ lookup('env', 'DB_USER') }}"
    db_password: "{{ lookup('env', 'DB_PASSWORD') }}"
    db_host: "{{ lookup('env', 'DB_HOST') }}"
    db_port: "{{ lookup('env', 'DB_PORT') }}"
  tasks:
  - name: Test mssql_db command with different input combinations
    mssql_db:
      name: "{{ db_name }}"
      state: "{{ item.state }}"
      user: "{{ db_user }}"
      password: "{{ db_password }}"
      host: "{{ db_host }}"
      port: "{{ db_port }}"
      login_timeout: "{{ item.login_timeout }}"
      query_timeout: "{{ item.query_timeout }}"
      command_timeout: "{{ item.command_timeout }}"
      encrypt: "{{ item.encrypt }}"
      object_id: "{{ item.object_id }}"
      timeout: "{{ item.timeout }}"
      database_name: "{{ item.database_name }}"
      application_intent: "{{ item.application_intent }}"
      collation: "{{ item.collation }}"
      read_only_routing_list: "{{ item.read_only_routing_list }}"
      routing_master_port: "{{ item.routing_master_port }}"
      backup_path: "{{ item.backup_path }}"
      backup_name: "{{ item.backup_name }}"
      backup_checksum: "{{ item.backup_checksum }}"
    with_items:
    - { state: "present", login_timeout: 60, query_timeout: 120, command_timeout: 180, object_id: "", timeout: 300, database_name: "{{ db_name }}", application_intent: "", collation: "", read_only_routing_list: "", routing_master_port: "", backup_path: "", backup_name: "", backup_checksum: "", encrypt: "true" }
    - { state: "absent", login_timeout: 30, query_timeout: 60, command_timeout: 90, object_id: "test_id", timeout: 150, database_name: "", application_intent: "readonly", collation: "SQL_Latin1_General_CP1_CI_AS", read_only_routing_list: "", routing_master_port: "1433", backup_path: "", backup_name: "", backup_checksum: "", encrypt: "false" }
