
- hosts: target_hosts
  tasks:
    - name: Test sudo with incorrect password
      shell: sudo ls
      register: result
      ignore_errors: true
      
    - debug:
        msg: "Incorrect password attempt"

    - name: Test sudo with correct password
      shell: echo "password" | sudo -S ls
      when: 
        - "result.rc == 1"
      tags: test_mode
