
- name: Test cs_instance module with user_data and Python3
  hosts: localhost
  vars:
    my_token: '00000000-0000-0000-0000-000000000000'
    my_ssh_key: "{{ lookup('file', '/path/to/my/sshkey.pub') }}"
    my_cs_instance_user_data: "{{ lookup('file', '/path/to/my/userdata.sh') }}"
  tasks:
    - name: Launch CS instance with UserData using Python 3
      community.cloudstack.cs_instance:
        name: my_instance
        display_name: "My Instance"
        template: "My Template"
        zone: "My Zone"
        network: "My Network"
        keypair: "My Keypair"
        disk_offering: "My Disk Offering"
        service_offering: "My Service Offering"
        security_groups: "My Security Group"
        iso: "My ISO"
        hypervisor: "My Hypervisor"
        group: "My Group"
        project: "My Project"
        user_data: "{{ my_cs_instance_user_data }}"
        api_key: "{{ my_token }}"
        secret_key: "{{ my_token }}"
        ssh_key: "{{ my_ssh_key }}"
        python_interpreter: /usr/bin/python3
