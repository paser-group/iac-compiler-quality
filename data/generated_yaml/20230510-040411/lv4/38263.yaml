
- name: Create a new VMware Guest
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    name: my_vm
    state: poweredoff
  register: result

- name: Power on the VMware Guest
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    name: my_vm
    state: poweredon
  when: result.changed

- name: Check the permissions of the VMware Guest
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: no
    name: my_vm
    guest_username: some_user
    guest_password: some_password
    remote_object_id: 'vmware-vim-svc/com.vmware.vim.security.authmgr'

- name: Report any errors encountered during play execution
  debug: var=ansible_failed_task
  ignore_errors: true
