
---
- name: Change semaphore path 
  hosts: localhost
  
  tasks:
    - name: Modify Ansible configuration file 
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regex: '^(semaphore_path\s*=\s*)\S*(\s*\#*)?$'
        line: 'semaphore_path=/new/semaphore/path'
        
    - name: Verify new semaphore path 
      stat:
        path: /new/semaphore/path
      register: new_path
      
    - name: Check if new path is valid 
      assert:
        that: 
          - new_path.stat.exists == true
          - new_path.stat.isdir == true
          - new_path.stat.mode | int >= 700
