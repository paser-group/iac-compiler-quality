
- name: Test Empty Inventory Group Handling
  hosts: localhost
  tasks:
  - name: List inventory groups
    debug:
      var: groups

  - name: Create an empty inventory group
    add_host:
      name: "{{ inventory_dir }}/empty_inventory_group"
      groups:

  - name: Add host to the empty inventory group
    add_host:
      name: dummy
      groups: empty_inventory_group

  - name: Execute command using the empty inventory group
    ansible:
      inventory: "{{ inventory_dir }}/empty_inventory_group"
      module_name: ping

  - name: Assert that error is thrown
    fail:
      msg: "Expected error not thrown for empty inventory group"
    when: '"The empty inventory group was either not detected or not handled properly" not in result.stderr'
