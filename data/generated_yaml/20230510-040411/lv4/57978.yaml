
---
- hosts: localhost
  tasks:

  - name: Test Azure module subscription selection with multiple subscriptions
    azure_rm_virtualmachine:
      name: test
      resource_group: test_rg
      vm_size: Standard_DS1_v2
    register: result
    failed_when: result is not defined

  - name: Test Azure module behavior when subscription is incorrectly formatted
    azure_rm_resourcegroup:
      name: test_rg
      subscription_id: incorrect_subscription_id
    register: result
    failed_when: "result is not defined or (result is defined and result['changed'] == True)"
