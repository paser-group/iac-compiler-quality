
- hosts: localhost
  gather_facts: no
  vars:
    vault_password: "/path/to/vault/password/file"
    my_vault: "{{ lookup('vault', 'encrypted_string', vault_password=vault_password) }}"
  tasks:
    - name: Load vault password file
      include_vars:
        file: "{{ vault_password }}"
        name: vault_content
      register: vault_result
    - name: Fail if vault password file couldn't be loaded
      fail:
        msg: "Failed to load vault password file"
      when: vault_content is not defined
    - name: Print message if vault decryption was successful
      debug:
        msg: "Vault decryption was successful"
      when: my_vault is defined
