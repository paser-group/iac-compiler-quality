
- name: Change user password
  user:
    name: '{{username}}'
    password: '{{new_password | password_hash("sha256")}}'
    update_password: always

- name: Test new password
  shell: 'id'
  register: shell_output
  ignore_errors: yes
  environment:
    USER: '{{username}}'
    PASSWD: '{{new_password}}'
  
- name: Display output
  debug:
    msg: '{{shell_output}}'
