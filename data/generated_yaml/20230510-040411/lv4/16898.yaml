
- name: Test playbook for localhost targeting bug
  hosts: localhost

  tasks:
  - name: Add a new host
    add_host:
      name: new_host
      groups: new_group

  - name: Perform local action
    local_action:
      module: debug
      msg: "Performing local action"

  - name: Play 1
    debug:
      msg: "Play 1 - targeting {{ inventory_hostname }}"

  - name: Play 2
    debug:
      msg: "Play 2 - targeting {{ inventory_hostname }}"

- hosts: all

  tasks:
  - name: Debug target hosts
    debug:
      msg: "{{ inventory_hostname }} is in group {{ group_names }}"
