
- name: Create an EC2 instance
  hosts: localhost
  gather_facts: no
  vars:
    instance_type: t2.micro
    image: ami-0c55b159cbfafe1f0
    key_name: my-keypair
    security_group: my-security-group
    region: us-east-1
    spot_price: 0.02
  tasks:
  - name: Create EC2 instance
    ec2:
      instance_type: "{{ instance_type }}"
      image: "{{ image }}"
      key_name: "{{ key_name }}"
      security_group: "{{ security_group }}"
      region: "{{ region }}"
      spot_price: "{{ spot_price }}"
      user_data: |
        #!/bin/bash

        if [[ "{{ spot_price }}" != "null" ]]; then
          echo "$spot_price is not null."
        else
          echo "$spot_price is null."
        fi
      wait: yes
