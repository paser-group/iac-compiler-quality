
---
- name: Check if Ansible module is installed
  hosts: localhost
  tasks:
    - name: Check if Ansible module is installed
      ansible_ping:

- name: Create a User and Grant Privileges
  hosts: localhost
  tasks:
    - name: Add user
      mysql_user:
        name: "{{ db_username }}"
        password: "{{ db_password }}"
        login_user: "{{ db_superuser }}"
        login_password: "{{ db_superuser_password }}"

    - name: Grant privileges to the user
      mysql_user:
        name: "{{ db_username }}"
        priv: "{{ privs }}"
        login_user: "{{ db_superuser }}"
        login_password: "{{ db_superuser_password }}"

- name: Modify User Privileges
  hosts: localhost
  tasks:
    - name: Add privilege
      mysql_user:
        name: "{{ db_username }}"
        priv: "{{ new_priv }}"
        login_user: "{{ db_superuser }}"
        login_password: "{{ db_superuser_password }}"
        state: present
    
    - name: Revoke privilege
      mysql_user:
        name: "{{ db_username }}"
        priv: "{{ revoke_priv }}"
        login_user: "{{ db_superuser }}"
        login_password: "{{ db_superuser_password }}"
        state: absent
