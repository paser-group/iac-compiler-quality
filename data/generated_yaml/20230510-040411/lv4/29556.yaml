
- hosts: localhost
  gather_facts: no

  vars:
    gce_auth_kind: serviceaccount
    gce_service_account_email: "example@project-xyz.iam.gserviceaccount.com"
  
  tasks:
  - name: Ensure the GCE module uses specified service account
    gce:
     project_id: "my-project-123"
     zone: us-central1-a
     auth_kind: "{{ gce_auth_kind }}"
     service_account_email: "{{ gce_service_account_email }}"
    register: gce_output

  - name: Validate specified service account was used
    debug:
      msg: "GCE module used specified service account"
    when: gce_output.service_account == "{{ gce_service_account_email }}"
