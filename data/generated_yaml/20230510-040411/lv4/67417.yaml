
- name: Test if `get_url` sends incorrect `If-Modified-Since` header
  hosts: localhost
  gather_facts: no

  vars:
    url: "https://example.com"
    headers:
      If-Modified-Since: "<%= date %>"
  
  tasks:
    - name: Get the content of a webpage with the correct If-Modified-Since header
      get_url:
        url: "{{ url }}"
        dest: /tmp/example.html
        headers: "{{ headers }}"
  
    - name: Fail if If-Modified-Since header is incorrect
      assert:
        that: "'not_modified' in output"
 
   - debug: msg="If-Modified-Since header was {{ headers['If-Modified-Since'] }}"
