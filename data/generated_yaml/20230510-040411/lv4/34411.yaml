
- name: Test win_firewall
  hosts: windows

  tasks:
    - name: Open port 80
      win_firewall:
        rule: In
        name: Allow Web Traffic
        localport: 80
        enabled: yes
        state: present
      register: win_firewall_result_1
 
    - name: Check if port 80 is allowed
      win_firewall_rule:
        name: Allow Web Traffic
      register: win_firewall_result_2

    - name: Debugging
      debug:
        var: win_firewall_result_2.rule.enabled

    - name: Close port 80
      win_firewall:
        rule: In
        name: Allow Web Traffic
        localport: 80
        enabled: no
      register: win_firewall_result_3
     
    - name: Check if port 80 is denied
      win_firewall_rule:
        name: Allow Web Traffic
      register: win_firewall_result_4

    - name: Debugging
      debug:
        var: win_firewall_result_4.rule.enabled
