
- hosts: all
  gather_facts: true
  vars:
    counter: 0
  tasks:
    - name: Retrieve facts multiple times
      command: ansible localhost -m setup
      run_once: true
      with_sequence: "0..10"
      register: results
    - name: Verify fact cache consistency
      assert:
        that: counter == item.ansible_facts.ansible_processor_count
      with_items: "{{ results.results }}"
      loop_control:
        index_var: counter
  