
- name: Reboot VM and Run vmware_guest
  hosts: my_vmware
  tasks:
    - name: Reboot Virtual Machine
      vmware_guest:
        hostname: my_esx_host
        username: my_username
        password: my_password
        name: my_vm
        state: restarted
      async: 1
      poll: 0
    - name: Run vmware_guest Module
      vmware_guest:
        hostname: my_esx_host
        username: my_username
        password: my_password
        name: my_vm
        validate_certs: no
        wait_for_customization: no
        guest_id: ubuntu64Guest
        hardware:
          memory_mb: 2048
          num_cpus: 2
          scsi: paravirtual
        disk:
          size_gb: 20
          type: thin
        networks:
          - name: vmnet1
            ip: 192.168.60.10
            netmask: 255.255.255.0
            start_connected: yes
      register: vm_result
