
- name: Install RabbitMQ dependencies
  apt:
    name:
      - rabbitmq-server
      - python
      - python-pip
      - erlang-base
    state: present

- name: Create RabbitMQ user
  rabbitmq_user:
    user: "{{ username }}"
    password: "{{ password }}"
    tags: "{{ tags }}"
    configure_priv: "{{ configure }}"
    read_priv: "{{ read }}"
    write_priv: "{{ write }}"
    state: present

- name: Update RabbitMQ user password
  rabbitmq_user:
    user: "{{ username }}"
    password: "{{ new_password }}"
    tags: "{{ tags }}"
    configure_priv: "{{ configure }}"
    read_priv: "{{ read }}"
    write_priv: "{{ write }}"
    update_password: always

- name: Remove RabbitMQ user
  rabbitmq_user:
    user: "{{ username }}"
    state: absent
