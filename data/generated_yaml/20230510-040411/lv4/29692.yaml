
- name: Launch an EC2 instance with no image ID specified
  hosts: localhost
  gather_facts: False
  tasks:
    - name: Launch the instance
      ec2:
        key_name: test_key
        instance_type: t2.micro
        security_group: default
        count: 1
        region: us-east-1
      ignore_errors: True
    - name: Check if the instance is launched successfully
      command: aws ec2 describe-instances --query "Reservations[].Instances[].State.Name" --output text
      register: result
      failed_when: result.stdout_lines|length == 0
      ignore_errors: True
