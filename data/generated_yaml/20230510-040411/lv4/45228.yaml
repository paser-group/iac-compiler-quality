
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Gather EC2 metadata facts
      ec2_metadata_facts:

    - name: Print EC2 metadata facts and role name
      debug:
        var: ec2_metadata_aws_category

    - name: Check for incorrect role name
      debug:
        msg: "Incorrect role name!"
      when: '"_expiration" in ec2_metadata_aws_category.roles[0].name 
            and ec2_metadata_aws_category.roles[0].name != "{{ inventory_hostname }}_expiration"'
