
- name: Test sudo password handling
  become: true
  vars:
    sudo_password: "{{ random(20) }}"  # generate a random sudo password
  command: /bin/sh -c 'echo "[sudo] password for $USER:" && echo {{ sudo_password }} | sudo -S ls' 
  register: command_output
  until: '"Sorry, try again." not in command_output.stdout'
  retries: 3
  delay: 5
