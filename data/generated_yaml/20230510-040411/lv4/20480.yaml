
- name: Test playbook
  hosts: localhost
  become: yes

  tasks:
    - name: Start container
      docker_service:
        project_name: test
        definition: test.yml
        state: started
      register: result

    - name: Crash container
      docker_container:
        name: test
        state: absent
      register: result

    - name: Check for error message
      fail:
        msg: "Docker container failed to stop"
      when: "'failed' in result.msg"
