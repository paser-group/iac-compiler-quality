
- name: Create Vault file
  ansible.builtin.file:
    path: /tmp/secrets.yml
    state: touch
  vars:
    secret_value: "{{ lookup('password', '/dev/null length=20') }}" # generate a random password
- name: Encrypt sensitive data in the variable
  ansible.builtin.set_fact:
    encrypted_secret: "{{ secret_value | vault_encrypt('/tmp/secrets.yml', 'myvaultpass') }}"
