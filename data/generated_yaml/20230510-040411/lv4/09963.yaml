
---
- name: Create secret file
  hosts: localhost
  vars:
    password: "MyStrongPassword"
    secret: "MySecret"
  tasks:
  - name: Create file
    copy:
      content: "{{ secret }}"
      dest: "/tmp/secret.txt"

- name: Encrypt secret file
  hosts: localhost
  tasks:
  - name: Vault encrypt file
    command: ansible-vault encrypt /tmp/secret.txt --vault-password-file=<(echo "{{ password }}")
    
- name: Decrypt secret file
  hosts: localhost
  tasks:
  - name: Vault decrypt file
    command: ansible-vault decrypt /tmp/secret.txt --vault-password-file=<(echo "{{ password }}")
