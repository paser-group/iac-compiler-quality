
- name: Test any_errors_fatal with includes in roles
  hosts: all
  gather_facts: no

  tasks:
    - name: Play 1 - Include with any_errors_fatal=true
      include_role:
        name: test_role
        tasks_from: included_task.yml
      any_errors_fatal: true

    - name: Play 2 - Include with any_errors_fatal=false
      include_role:
        name: test_role
        tasks_from: included_task.yml
      any_errors_fatal: false

  post_tasks:
    - name: Check results
      assert:
        that:
          - play1_failed.rc == 2
          - play2_failed.rc == 0
