
---
- name: Test Copy Module with 'decrypt: no' option
  hosts: localhost
  gather_facts: no
  vars:
    src_dir: "/tmp/src_dir"
    dst_dir: "/tmp/dst_dir"
    file_name: "test.txt"
    file_content: "Test content"
    existing_file_path: "/tmp/dst_dir/test.txt"
  tasks:
    - name: Create source directory
      file:
        path: "{{ src_dir }}"
        state: directory
    - name: Create destination directory
      file:
        path: "{{ dst_dir }}"
        state: directory
    - name: Create existing file in the destination directory
      copy:
        content: "{{ file_content }}"
        dest: "{{ existing_file_path }}"
    - name: Copy file with 'decrypt: no' option
      copy:
        src: "{{ src_dir }}/{{ file_name }}"
        dest: "{{ dst_dir }}/{{ file_name }}"
        decrypt: no
      register: copy_result
    - name: Fail if copy operation fails
      fail:
        msg: "Copy operation failed"
      when: not copy_result.changed
