
---
- name: Test remote_user in httpapi
  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    host: <remote_device_IP>
    username: <username>
    password: <password>

  tasks:
  - name: Set remote_user to logged-in user
    httpapi:
      host: "{{ host }}"
      username: "{{ username }}"
      password: "{{ password }}"
      remote_user: "{{ lookup('env','USER') }}"
    register: result

  - name: Debug output
    debug:
      var: result
