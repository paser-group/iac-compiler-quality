
- name: Test F5 bigip_node module with server port
  hosts: localhost
  connection: local

  vars:
    server_ports:
      - "80"
      - "443"
    
  tasks:
    - name: Create F5 node with a server port
      bigip_node:
        provider:
          server: "{{ ansible_host }}"
          user: "{{ ansible_user }}"
          password: "{{ ansible_password }}"
          validate_certs: no
        name: "test-node"
        partition: "Common"
        host: "{{ ansible_host }}"
        address: "{{ ansible_host }}"
        server_port: "{{ item }}"
        description: "Test node with server port {{ item }}"
        state: present
      with_items: "{{ server_ports }}"

    - name: Delete F5 node with a server port
      bigip_node:
        provider:
          server: "{{ ansible_host }}"
          user: "{{ ansible_user }}"
          password: "{{ ansible_password }}"
          validate_certs: no
        name: "test-node"
        partition: "Common"
        host: "{{ ansible_host }}"
        address: "{{ ansible_host }}"
        server_port: "{{ item }}"
        state: absent
      with_items: "{{ server_ports }}"
