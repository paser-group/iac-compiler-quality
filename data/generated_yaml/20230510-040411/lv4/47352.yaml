
- name: Ensure Windows Domain is joined
  hosts: windows
  tasks:
  - name: Check if computer is joined to domain
    win_command: 'if ($env:USERDNSDOMAIN) { $true } else { $false }'
    register: is_joined

  - name: Join domain if not already joined
    win_domain:
      domain_admin_user: "someuser"
      domain_admin_password: "somepassword"
      domain_name: "somedomain.com"
      ou_path: "OU=Computers,DC=somedomain,DC=com"
      when: not is_joined.stdout
