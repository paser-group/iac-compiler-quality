
---
- name: Test Playbook
  hosts: all
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
      when: item.update_cache is defined
      with_items:
        - { update_cache: yes }
    
    - name: Install packages
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - package1
        - package2
        - package3
        - package4

    - name: Make directory with subdirectories
      file:
        path: "{{ item.path }}"
        state: directory
        recurse: yes
        mode: "{{ item.mode }}"
      with_items:
        - { path: '/var/tmp/dir1', mode: '0755' }
        - { path: '/var/tmp/dir2/dir3', mode: '0644' }
