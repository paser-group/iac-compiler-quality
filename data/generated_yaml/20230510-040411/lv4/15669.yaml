
- name: Set up two-node environment
  hosts: "{{ target_host }}"
  gather_facts: no
  vars:
    ansible_connection: winrm
    ansible_winrm_transport: kerberos
    ansible_winrm_kerberos_hostname_override: "{{ control_host }}"
    ansible_winrm_kerberos_service_name: HTTP
    ansible_winrm_kerberos_auhorization: true
  tasks:
    - name: Enable WinRM listener
      win_command: winrm quickconfig -q
      changed_when: false
    - name: Wait for node to come up
      win_ping: ~
