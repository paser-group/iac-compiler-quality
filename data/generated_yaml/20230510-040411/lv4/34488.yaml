yaml
---
- name: mysql_db module issue
  hosts: localhost
  vars:
    mysql_db: test_db
    mysql_user: test_user
    mysql_password: test_password
    extra_options_file: "{{ playbook_dir }}/extra-options.cnf"
    main_options_file: "{{ playbook_dir }}/main-options.cnf"
  tasks:
    - name: Create database using --defaults-extra-file
      mysql_db:
        name: "{{ mysql_db }}"
        state: present
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
        login_host: "{{ mysql_host }}"
        extra_opts: "--defaults-extra-file={{ extra_options_file }}"

    - name: Drop database using --defaults-extra-file
      mysql_db:
        name: "{{ mysql_db }}"
        state: absent
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
        login_host: "{{ mysql_host }}"
        extra_opts: "--defaults-extra-file={{ extra_options_file }}"

    - name: Create database using --defaults-file
      mysql_db:
        name: "{{ mysql_db }}"
        state: present
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
        login_host: "{{ mysql_host }}"
        extra_opts: "--defaults-file={{ main_options_file }}"

    - name: Drop database using --defaults-file
      mysql_db:
        name: "{{ mysql_db }}"
        state: absent
        login_user: "{{ mysql_user }}"
        login_password: "{{ mysql_password }}"
        login_host: "{{ mysql_host }}"
        extra_opts: "--defaults-file={{ main_options_file }}"
