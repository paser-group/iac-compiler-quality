
---
- name: Asynchronous task playbook
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Connect to the socket1 server
      async: 300
      poll: 60
      shell: 'nc -l -p 11223 > /dev/null < /dev/null'
      register: result1

    - name: Test the connection to socket1 server
      async: 300
      poll: 60
      shell: 'nc -z localhost 11223'
      register: result2
      until: result2.rc == 0
      retries: 10

    - name: Connect to the socket2 server
      async: 300
      poll: 60
      shell: 'nc -l -p 22334 > /dev/null < /dev/null'
      register: result3

    - name: Test the connection to socket2 server
      async: 300
      poll: 60
      shell: 'nc -z localhost 22334'
      register: result4
      until: result4.rc == 0
      retries: 10

    - name: Connect to the socket3 server
      async: 300
      poll: 60
      shell: 'nc -l -p 33445 > /dev/null < /dev/null'
      register: result5

    - name: Test the connection to socket3 server
      async: 300
      poll: 60
      shell: 'nc -z localhost 33445'
      register: result6
      until: result6.rc == 0
      retries: 10

    - name: Display results
      debug:
        var: item.stdout
      with_items:
        - result1
        - result2
        - result3
        - result4
        - result5
        - result6
