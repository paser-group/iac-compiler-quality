
---
- name: Test service module
  hosts: localhost
  vars:
    service_name: "nginx"
  tasks:
    - name: Restart service
      service:
        name: "{{ service_name }}"
        state: restarted
      register: output
    - name: Wait for service to come back up
      wait_for:
        host: "{{ ansible_host }}"
        port: 80
        delay: 10
        timeout: 300
      when: output is changed
    - name: Check service status
      assert:
        that: output is success
