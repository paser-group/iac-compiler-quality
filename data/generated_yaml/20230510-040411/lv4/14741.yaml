
- name: Test Playbook
  hosts: localhost
  become: yes

  vars:
    haproxy_bind: "0.0.0.0:80"

  tasks:
    - name: Configure HAProxy frontend
      haproxy:
        state: present
        listen: frontend
        mode: http
        balance: roundrobin
        option: httpchk
        server: server1 192.168.0.1:80 check
        server: server2 192.168.0.2:80 check
        bind: "{{ haproxy_bind }}"
        delegate_to: "{{ item }}"
      with_items:
        - host1
        - host2
