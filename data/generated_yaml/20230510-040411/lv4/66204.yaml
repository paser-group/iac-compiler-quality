
- name: Add new prefix to Netbox
  hosts: localhost
  vars:
    netbox_url: "http://<netbox_ip>/"
    netbox_token: "<netbox_api_token>"
    prefix_list: ["192.0.2.0/24"]
    prefix_family: "ipv4"
  
  tasks:
    - name: Add new prefix to Netbox
      netbox_prefix:
        url: "{{ netbox_url }}"
        token: "{{ netbox_token }}"
        prefix: "{{ prefix_list }}"
        family: "{{ prefix_family }}"
      register: add_prefix
  
    - name: Check if new prefix exists
      netbox_prefix_find:
        url: "{{ netbox_url }}"
        token: "{{ netbox_token }}"
        prefix: "{{ prefix_list }}"
        family: "{{ prefix_family }}"
      register: find_prefix
  
    - name: Verify if the new prefix was added successfully
      assert:
        that: add_prefix.changed == find_prefix.exists
  
