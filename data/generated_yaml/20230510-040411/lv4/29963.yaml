
- name: Test playbook for missing interpreter lines
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create dummy usermodule1
      copy:
        content: |
          # This is a dummy usermodule file with missing interpreter line
          name: dummyuser1
          uid: 1000
          groups: dummy
        dest: /tmp/usermodule1

    - name: Create dummy usermodule2
      copy:
        content: |
          # This is a dummy usermodule file with an invalid interpreter line
          #!/usr/bin/env bash -x
          name: dummyuser2
          uid: 1000
          groups: dummy
        dest: /tmp/usermodule2

    - name: Execute user module with dummy usermodules
      user:
        name: "{{ item }}"
      with_items:
        - "/tmp/usermodule1"
        - "/tmp/usermodule2"
