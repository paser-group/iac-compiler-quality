
- name: Check ansible_user_* facts consistency
  hosts: all
  gather_facts: true
  tasks:
    - name: Display all ansible_user_* facts
      debug:
        var: ansible_user_*

    - name: Set user_fact variable to ansible_user_* facts and display it
      set_fact:
        user_fact: "{{ ansible_user_* }}"
      loop: ["uid", "gid", "home", "shell", "name", "comment"]
      debug:
        var: user_fact

    - name: Assert that ansible_user_* facts are consistent
      assert:
        that:
        - ansible_user_uid == ansible_user_id
        - ansible_user_gid == ansible_user_group
        - ansible_user_home == ansible_user_dir
