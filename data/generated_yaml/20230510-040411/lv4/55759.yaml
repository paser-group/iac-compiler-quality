
- name: Create Azure Virtual Network Peering
  azure_rm_virtualnetworkpeering:
    name: "{{ peering_name }}"
    resource_group: "{{ resource_group }}"
    virtual_network_name: "{{ virtual_network_name }}"
    remote_virtual_network_id: "{{ remote_virtual_network_id }}"
    peering_mode: "{{ peering_mode }}"
    allow_forwarded_traffic: "{{ allow_forwarded_traffic }}"
    allow_gateway_transit: "{{ allow_gateway_transit }}"
    use_remote_gateways: "{{ use_remote_gateways }}"
  register: peering

- name: Check if Azure Virtual Network Peering was created successfully
  debug: var=peering
  when: peering.changed == true
