 yaml
---
- name: Detect bugs in ansible become and become_method functionality
  hosts: localhost
  become: true
  become_method: pbrun

  vars:
    become_configs:
      - become: false
        become_method: ''
      - become: true
        become_method: ''
      - become: true
        become_method: sudo
      - become: true
        become_method: su
      - become: true
        become_method: dzdo

  tasks:
    - name: Verify initial commands work without any become or become_method set
      command: whoami

    # Loop through each defined become configuration
    - name: Check commands via different become and become_method configs
      vars:
        become: "{{ item.become }}"
        become_method: "{{ item.become_method }}"
      command: whoami
      with_items: "{{ become_configs }}"
