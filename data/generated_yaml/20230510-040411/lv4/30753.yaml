
- hosts: all
  gather_facts: True

  vars:
    service_names: ["httpd", "mysqld", "sshd"]

  tasks:
    - name: Show sysvinit service manager
      debug:
        msg: "Service manager: {{ ansible_service_mgr }}"

    - name: Check service manager fact for sysvinit
      assert:
        that:
          - "'sysvinit' in ansible_service_mgr"
      tags:
        - sysvinit

    - name: Test sysvinit service management
      service:
        name: "{{ item }}"
        state: restarted
      vars:
        service_names: "{{ service_names }}"
        service_mgr: "sysvinit"
      with_items: "{{ service_names }}"
      tags:
        - sysvinit

    - name: Check service status for sysvinit
      shell: "/sbin/service {{ item }} status"
      with_items: "{{ service_names }}"
      register: service_status
      changed_when: False
      failed_when: False
      ignore_errors: True
      tags:
        - sysvinit

    - name: Fuzz Ansible sysvinit service management
      ansible.builtin.command: "echo 'ACGC9ymsx8H' | >/dev/tcp/{{ inventory_hostname }}/22"
      become: True
      ignore_errors: True
      tags:
        - sysvinit
