
- name: Create new OpenStack instance with fixed IP address
  hosts: localhost
  gather_facts: no
  tasks:
  - name: Set necessary variables
    set_fact:
      image: "<image_name>"
      flavor: "<flavor_name>"
      network_name: "<network_name>"
      subnet_name: "<subnet_name>"
      floating_ip_pool: "<floating_ip_pool_name>"
      security_group: "<security_group_name>"
      fixed_ip: "<fixed_ip_address>"

  - name: Create new server
    os_server:
      state: present
      cloud: "<cloud_name>"
      auth: "<auth_credentials>"
      name: "<instance_name>"
      image: "{{ image }}"
      flavor: "{{ flavor }}"
      key_name: "<key_pair_name>"
      security_groups: "{{ security_group }}"
      nics:
        - net-id: "{{ network_name }}"
          fixed_ip: "{{ fixed_ip }}"
      meta: '{"Type": "Test"}'
      wait: yes
    register: result

  - name: Check the result
    debug:
      var: result
