
- hosts: all
  vars:
    cache_age: 300
    vmware_cache_dir: /var/cache/vmware
    expected_output_file: expected_vmware_inventory_output.txt
  tasks:
    - name: Refresh VMware Inventory Cache
      shell: /usr/bin/vmware_inventory.py --refresh-cache --cache-age {{ cache_age }} --cache-dir {{ vmware_cache_dir }}
    - name: Verify Cache Content against Expected Output
      shell: /usr/bin/vmware_inventory.py --cache-dir {{ vmware_cache_dir }} > current_output_file && diff expected_output_file current_output_file
