
- hosts: all
  gather_facts: false
  vars:
    os_list:
      - centos7
      - centos8
      - ubuntu1604
      - ubuntu2004
  tasks:
    - name: Wait for connection
      wait_for_connection:
        connect_timeout: 60
    - name: Ensure correct interpreter
      assert:
        that:
          - ansible_python.version.major == 3
          - ansible_python.version.minor >= 7
    - name: OS-specific tasks
      block:
        - name: CentOS 7 specific task
          when: inventory_hostname == "{{os_list[0]}}"
          debug:
            msg: "{{ inventory_hostname }} task"
        - name: CentOS 8 specific task
          when: inventory_hostname == "{{os_list[1]}}"
          debug:
            msg: "{{ inventory_hostname }} task"
        - name: Ubuntu 16.04 specific task
          when: inventory_hostname == "{{os_list[2]}}"
          debug:
            msg: "{{ inventory_hostname }} task"
        - name: Ubuntu 20.04 specific task
          when: inventory_hostname == "{{os_list[3]}}"
          debug:
            msg: "{{ inventory_hostname }} task"
