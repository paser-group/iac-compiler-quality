
- name: Test Snow authentication with invalid credentials
  hosts: snow-server
  gather_facts: no
  tasks:

  - name: Authenticate with Snow
    snow:
      instance: "{{ snow_instance }}"
      username: "{{ snow_username }}"
      password: "{{ snow_password }}"
    register: auth_status

  - name: Run Snow CLI
    snow:
      instance: "{{ snow_instance }}"
      username: "{{ snow_username }}"
      password: "{{ snow_password }}"
      command: list
    when: auth_status | failed
