
- name: Configure port channel and feature
  hosts: switch
  gather_facts: no
  tasks:
    - name: Enable port channel feature
      nxos_feature:
        name: port-channel
        state: enabled
      when: "'port-channel' not in ansible_net_system_options['enabled_features']"

    - name: Configure port channel
      nxos_portchannel:
        name: Po1
        members: "{{ item.members }}"
        state: present
      with_items:
        - { name: 'Port-channel configuration', members: ['Ethernet1/1','Ethernet1/2','Ethernet1/3'] }
