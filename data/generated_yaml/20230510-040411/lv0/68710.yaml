
- name: Example playbook
  hosts: all
  tasks:
    - name: Task with loop
      command: "{{ item }}"
      loop:
        - echo "Task 1 completed"
        - echo "Task 2 failed" && exit 1
        - echo "Task 3 completed"
      register: result
      ignore_errors: true

    - name: Handle errors
      block:
        - name: Failed task
          debug:
            msg: "The following task failed: {{ result.results | rejectattr('rc', 'eq', 0) | map(attribute='item') | list | join(', ') }}"
          rescue:
        - name: Undefined task
          debug:
            msg: "The failed task was not found."
