
- name: Create VLAN
  nxos_vlan:
    vlan_id: "{{ vlan_id }}"
    vlan_name: "{{ vlan_name }}"
    state: present
    mode: "{{ mode }}"
  register: result

- name: Check if VLAN has been created
  debug:
    msg: "VLAN {{ vlan_id }} already exists."
  when: not result.changed

- name: Configure VLAN properties
  nxos_vlan:
    vlan_id: "{{ vlan_id }}"
    state: "{{ state }}"
    vlan_name: "{{ vlan_name }}"
    mode: "{{ mode }}"
  when: result.changed
