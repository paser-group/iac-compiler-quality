
- name: Create EC2 group if it does not exist
  hosts: localhost
  gather_facts: no
  vars:
    existing_group: some-group
    new_group: new-group
    
  tasks:
    - name: Check if group already exists
      ec2_group_facts:
        filters:
          group-name: "{{ existing_group }}"
      register: ec2_group_result
      ignore_errors: yes
      
    - name: Create EC2 group only if it does not exist
      ec2_group:
        name: "{{ new_group }}"
        description: "Example EC2 group"
        vpc_id: "vpc-1234abcd"
      when: ec2_group_result.groups | length == 0
