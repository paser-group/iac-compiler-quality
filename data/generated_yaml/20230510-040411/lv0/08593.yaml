
- name: Add authorized key
  authorized_key:
    user: some_user
    key: "{{ item }}"
  with_items: "{{ authorized_keys | default([]) }}"
  when: authorized_keys is defined and authorized_keys | length > 0

- name: Ensure authorized_keys is not empty
  fail:
    msg: "authorized_keys cannot be empty"
  when: authorized_keys is defined and authorized_keys | length == 0
