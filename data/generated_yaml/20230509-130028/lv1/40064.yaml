
---
- name: Configure IOS devices
  hosts: ios_devices
  gather_facts: no
  vars:
    ios_config:
      - set system login user ansible authentication encrypted-password "{{ ansible_vault_password }}"
  tasks:
    - name: Gather IOS running config
      ios_command:
        commands:
          - show running-config
      register: running_config
    - name: Configure IOS devices
      ios_config:
        lines: "{{ ios_config }}"
      when: ios_config not in running_config.stdout_lines
