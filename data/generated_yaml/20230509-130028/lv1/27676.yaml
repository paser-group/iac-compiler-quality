yaml
---
- name: Ensure nxos_vtp_password is idempotent while removing
  hosts: all
  gather_facts: no
  
  tasks:
    - name: Remove nxos_vtp_password
      nxos_vtp_password:
        password: "{{ vtp_password }}"
        state: absent
      register: remove_result
      ignore_errors: yes

    - name: Ensure nxos_vtp_password is idempotent and throws no errors
      nxos_vtp_password:
        password: "{{ vtp_password }}"
        state: present
      when: remove_result.changed == False or remove_result is failed
