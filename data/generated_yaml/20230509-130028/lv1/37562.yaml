yaml
---
- name: Install Foreman callback plugin
  hosts: all
  tasks:
    - name: Install necessary dependencies
      apt:
        name:
          - python
          - python-dev
          - ruby-full
          - rubygems
          - gcc
          - make
          - libssl-dev
          - libffi-dev
        state: present

    - name: Install the Foreman callback plugin
      pip:
        name: foreman_callback
      become: yes

    - name: Configure Foreman callback plugin
      lineinfile:
        dest: "/etc/ansible/ansible.cfg"
        regexp: "^callback_whitelist\\s*=\\s*foreman"
        line: "callback_whitelist = foreman"
      become: yes
