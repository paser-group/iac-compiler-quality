
- name: Create VMware port group
  hosts: localhost
  gather_facts: no
  vars:
    port_group_name: "{{ item.name }}"
    vlan_id: "{{ item.vlan }}"
  tasks:
    - name: Create VMware port group with specific VLAN ID
      vmware_portgroup:
        hostname: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ ansible_password }}"
        portgroup_name: "{{ port_group_name }}"
        vlan_id: "{{ vlan_id }}"
      delegate_to: localhost
      register: create_pg_result
    - name: Debug info for create result
      debug:
        var: create_pg_result

- name: Modify VMware port group
  hosts: localhost
  gather_facts: no
  vars:
    port_group_name: "{{ item.name }}"
    vlan_id: "{{ item.vlan }}"
  tasks:
    - name: Modify VMware port group with specific VLAN ID
      vmware_portgroup:
        hostname: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ ansible_password }}"
        portgroup_name: "{{ port_group_name }}"
        vlan_id: "{{ vlan_id }}"
      delegate_to: localhost
      register: modify_pg_result
    - name: Debug info for modify result
      debug:
        var: modify_pg_result

- name: Delete VMware port group
  hosts: localhost
  gather_facts: no
  vars:
    port_group_name: "{{ item.name }}"
  tasks:
    - name: Delete VMware port group
      vmware_portgroup:
        hostname: "{{ inventory_hostname }}"
        username: "{{ ansible_user }}"
        password: "{{ ansible_password }}"
        portgroup_name: "{{ port_group_name }}"
        state: absent
      delegate_to: localhost
      register: delete_pg_result
    - name: Debug info for delete result
      debug:
        var: delete_pg_result
