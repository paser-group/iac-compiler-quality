
---
- name: Testing fortios_vpn_ipsec_phase1 module
  hosts: all
  gather_facts: false

  tasks:
    - name: Define password-3 variable
      set_fact:
        password_3: "{{ lookup('password', '/dev/null') }}"

    - name: Configure VPN phase1
      fortios_vpn_ipsec_phase1:
        ip_version: 4
        name: test-tunnel
        phase1_name: PSK
        psksecret: "{{ password_3 }}"
      register: result

    - name: Fail if unknown type error is triggered
      fail:
        msg: "Unknown type error triggered: {{ result.msg }}"
      when: "'unknown type' in result.msg"
