
---
- name: Test Command Module for Error Handling
  hosts: all
  gather_facts: false

  tasks:
    - name: Execute a failing command
      command: 'pg_basebackup -h myhost -U repuser'
      register: command_output
      failed_when: "'FATAL:  number of requested standby connections exceeds max_wal_senders' not in command_output.stderr"

    - name: Print command output
      debug:
        var: command_output.stdout_lines
