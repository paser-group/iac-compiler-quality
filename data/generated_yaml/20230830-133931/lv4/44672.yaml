
- name: Run privileged command with ios_command
  hosts: all
  gather_facts: no
  tasks:
    - name: Enable privilege exec mode if not detected
      ios_command:
        commands: enable
        authorize: yes
      delegate_to: localhost
      register: enable_output

    - name: Run ios_command with privileged mode
      ios_command:
        commands: show running-config
        authorize: yes
      delegate_to: "{{ inventory_hostname }}"
