
- hosts: all
  gather_facts: false
  tasks:
    - name: Create vault password file
      copy:
        content: "dummy_password"
        dest: "/tmp/.vault_password"
        mode: "0600"

    - name: Create vault sample file
      copy:
        content: "secret_data"
        dest: "/tmp/vault_sample_file"

    - name: Encrypt file using ansible-vault
      shell: ansible-vault encrypt /tmp/vault_sample_file --vault-password-file=/tmp/.vault_password
      register: result
      ignore_errors: true

    - name: Print stdout
      debug:
        var: result.stdout_lines

    - name: Remove temporary files
      file:
        path: "/tmp/"
        state: absent
