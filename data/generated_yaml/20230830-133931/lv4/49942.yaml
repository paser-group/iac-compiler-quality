
---
- name: Verify PROVISION bug in Ansible compiler
  hosts: all
  gather_facts: false

  tasks:
    - name: Create dummy test file
      shell: touch /tmp/test.txt
      delegate_to: "{{ inventory_hostname }}"

    - block:
        - name: Include role1
          include_role:
            name: role1

      rescue:
        - name: Delete test file
          file:
            path: /tmp/test.txt
            state: absent
          delegate_to: "{{ inventory_hostname }}"

  handlers:
    - name: Handle PROVISION bug
      command: "{{ command_to_run }}"
