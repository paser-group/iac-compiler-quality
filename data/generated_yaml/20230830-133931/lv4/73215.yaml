---
- name: Check service state on Docker nodes
  hosts: all
  gather_facts: yes

  tasks:
    - name: Set network details
      set_fact:
        network_subnet: "10.1.1.0/24"
        network_gateway: "10.1.1.254"

    - name: Generate inventory file
      template:
        src: inventory.j2
        dest: inventory

    - name: Verify connectivity
      ping:

    - name: Get service facts
      service_facts:

    - name: Print service state
      debug:
        msg: "Service state: {{ ansible_facts.services['tomcat.service'].state }}"

    - name: Set incorrect service state
      set_fact:
        ansible_facts:
          services:
            tomcat.service:
              state: "stopped"
      delegate_to: localhost

    - name: Print incorrect service state
      debug:
        msg: "Incorrect service state: {{ ansible_facts.services['tomcat.service'].state }}"