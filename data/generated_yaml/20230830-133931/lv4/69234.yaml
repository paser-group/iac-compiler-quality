---
- name: Generate inventory file
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create inventory file
      copy:
        content: |
          [web]
          ubuntu1 ansible_host=10.1.1.1 ansible_user=root
          alpine1 ansible_host=10.1.1.2 ansible_user=root
          centos1 ansible_host=10.1.1.3 ansible_user=root
          redhat1 ansible_host=10.1.1.4 ansible_user=root

- name: Create Pulp repository
  hosts: web
  gather_facts: false
  tasks:
    - name: Create Pulp repository
      pulp_repo:
        name: '{{ inventory_hostname }}'
        add_export_distributor: true  # Potential bug trigger point
        state: present
        validate_certs: false
        client_cert: /root/.pulp/user-cert.pem
        repo_type: rpm
        relative_url: '{{ inventory_hostname }}'