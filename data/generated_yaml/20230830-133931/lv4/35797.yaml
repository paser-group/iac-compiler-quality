---
- name: Configure interface for access_vlan aggregate
  hosts: all
  gather_facts: false

  tasks:
    - name: Create VLAN configuration
      nxos_vlan:
        vlan_id: "{{ item.vlan }}"
        state: present
      loop:
        - vlan: 6
        - vlan: 15

    - name: Configure interface for access_vlan aggregate
      nxos_l2_interface:
        aggregate:
          - name: "{{ item.name }}"
            mode: "{{ item.mode }}"
            access_vlan: "{{ item.vlan }}"
        provider: "{{ connection }}"
      loop:
        - name: eth1/1
          mode: access
          vlan: 6
        - name: eth1/2
          mode: access
          vlan: 15