
- name: Test Ansible Compiler Bugs
  hosts: all
  gather_facts: no

  tasks:
    - name: Create symlink path with space
      file:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        state: link
      with_items:
        - { src: "/tmp/symlink/foo", dest: "/tmp/symlink space/bar" }
        - { src: "/tmp/symlink space/baz", dest: "/tmp/symlink/qux" }

    - name: Generate malformed unicode strings for inventory
      file:
        path: "{{ item }}"
        state: touch
      with_items:
        - "/tmp/inv/inv1/\xed\xb9\x98"
        - "/tmp/inv/inv2/\xed\xa0\xbd"
        - "/tmp/inv/inv3/\xed\xbc\x90"
        - "/tmp/inv/inv4/\xed\xa0\xbc"

    - name: Trigger negative cache timeout bug
      setup:
        filter: '{{ item }}'
      with_items:
        - 'ansible_all_ipv4_addresses'
        - 'ansible_all_ipv6_addresses'
        - 'ansible_hostname'
        - 'ansible_facts["ansible_os_family"]'
