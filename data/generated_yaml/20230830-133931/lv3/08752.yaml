
---
- name: Test Ansible Vault Decrypt Bug
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a test file
      ansible.builtin.file:
        path: "/tmp/testfile"
        state: touch

    - name: Encrypt the test file
      ansible.builtin.command:
        cmd: "ansible-vault encrypt /tmp/testfile --vault-password-file={{ inventory_dir }}/password_file"
      register: encrypt_output

    - name: Decrypt the test file
      ansible.builtin.command:
        cmd: "ansible-vault decrypt /tmp/testfile --vault-password-file={{ inventory_dir }}/password_file"
      register: decrypt_output

    - name: Print decrypt output
      debug:
        var: decrypt_output

    - name: Fail the playbook intentionally
      fail:
        msg: "This playbook is used to test Ansible Vault Decrypt Bug"
