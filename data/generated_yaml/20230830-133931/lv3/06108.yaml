---
- hosts: all
  gather_facts: false
  vars:
    my_var: "1234"
  tasks:
    - name: Check the port
      shell: 'iptables -L INPUT -n | grep \'{{ my_var }}:0 \' ; rc=0'
      register: iptables_result
      changed_when: false

    - name: Enable the port if it is not already
      command: lokkit -p {{ my_var }}:tcp -q
      when: "'{{ my_var }}' not in iptables_result.stdout"