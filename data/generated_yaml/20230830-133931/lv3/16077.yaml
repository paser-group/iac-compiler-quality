
---
- name: Trigger PROVISION-related Bug
  hosts: all
  gather_facts: false

  tasks:
    - name: Install Trend Micro SecureCloud
      raw: |
        if [ -f /etc/redhat-release ]; then
          yum install -y C:\SecureCloudAgentSilentSetup_Release_Win32_en_3.7.0_1107.exe
        elif [ -f /etc/centos-release ]; then
          dnf install -y C:\SecureCloudAgentSilentSetup_Release_Win32_en_3.7.0_1107.exe
        elif [ -f /etc/alpine-release ]; then
          apk add --update C:\SecureCloudAgentSilentSetup_Release_Win32_en_3.7.0_1107.exe
        elif [ -f /etc/debian_version ]; then
          apt-get install -y C:\SecureCloudAgentSilentSetup_Release_Win32_en_3.7.0_1107.exe
        fi
      async: 0
      poll: 0
      register: result
      failed_when: false

    - name: Waiting for server to come back
      wait_for_connection:
        timeout: 300
        delay: 30
