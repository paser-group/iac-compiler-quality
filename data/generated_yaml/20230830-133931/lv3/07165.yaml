
---
- name: Execute command with sudo
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Check if sudo password is required
      command: grep -q '^%wheel.*NOPASSWD:.*ALL' /etc/sudoers
      register: sudoers_check
      changed_when: false
      failed_when: sudoers_check.rc != 0

    - name: Trigger sudo password prompt
      shell: echo "Testing the password prompt" | sudo -S echo "success"
      changed_when: false
      args:
        warn: false
