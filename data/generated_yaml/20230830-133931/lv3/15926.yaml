
---
- name: Bug Finder Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set condition variable to 'ok'
      set_fact:
        condition: ok

    - name: Include tasks file with a nested block
      include_tasks: inc.yml
      when: condition == 'nok'

- name: Nested Block
  hosts: all
  gather_facts: false

  tasks:
    - name: block 2
      fail:
        msg: 'this should not run'

    - block:
        - name: block 2.1
          fail:
            msg: 'this should not run'
      when: condition != 'nok'
