---
- name: Ansible Latent Bug Explorer
  hosts: all
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        user: root
      - name: alpine1
        ip: 10.1.1.2
        user: root
      - name: centos1
        ip: 10.1.1.3
        user: root
      - name: redhat1
        ip: 10.1.1.4
        user: root

  tasks:
    - name: Ensure the existence of the inventory file
      copy:
        content: |
          [nodes]
          {% for node in nodes %}
          {{ node.name }} ansible_host={{ node.ip }} ansible_user={{ node.user }}
          {% endfor %}
        dest: /tmp/inventory
        mode: '0644'

    - name: Ping all nodes
      ansible.builtin.ping:

    - name: Execute arbitrary command
      ansible.builtin.command: "echo Hello, {{ node.name }}!"
      loop: "{{ nodes }}"
      loop_control:
        loop_var: node