---
- hosts: all
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distribution: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distribution: alpine
      - name: centos1
        ip: 10.1.1.3
        distribution: centos
      - name: redhat1
        ip: 10.1.1.4
        distribution: redhat

  tasks:
    - name: Install required packages
      package:
        name: "{{ item.package }}"
        state: present
        update_cache: yes
      loop:
        - { package: "{{ node.distribution }}-package" }
      delegate_to: "{{ item.ip }}"
      when: item.distribution != ansible_distribution