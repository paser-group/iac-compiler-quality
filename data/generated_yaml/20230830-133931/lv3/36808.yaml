
---
- name: Test Playbook
  hosts: localhost
  gather_facts: false
  
  vars:
    csv_content: |
      name,age,department
      John,25,IT
      Jane,30,HR
      Alex,35,Finance
      Lisa,28,Marketing
 
  tasks:
    - name: Create CSV file
      copy:
        content: "{{ csv_content }}"
        dest: "/tmp/test.csv"
        
    - name: Lookup all names using csvfile
      set_fact:
        names: "{{ lookup('csvfile', '/tmp/test.csv', format='named', delimiter=',')['name'] }}"
        
    - name: Debug names
      debug:
        var: names
