- name: "Create a network"
  hosts: localhost
  gather_facts: false
  tasks:
    - name: "Create network"
      docker_network:
        name: node-net
        ipam:
          config:
            - subnet: 10.1.1.0/24
              gateway: 10.1.1.254

- name: "Provision Docker nodes"
  hosts: all
  gather_facts: false
  tasks:
    - name: "Create Docker containers"
      docker_container:
        name: "{{ inventory_hostname }}"
        image: "{{ item.image }}"
        state: started
        networks:
          - name: node-net
            ipv4_address: "{{ item.ip }}"
      loop:
        - { image: "ubuntu", ip: "10.1.1.1" }
        - { image: "alpine", ip: "10.1.1.2" }
        - { image: "centos", ip: "10.1.1.3" }
        - { image: "redhat", ip: "10.1.1.4" }