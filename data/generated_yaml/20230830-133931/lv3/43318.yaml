
---
- name: Check if package is installed
  hosts: all
  gather_facts: false

  vars:
    package_to_install: "pinentry"
    package_to_check: "pinentry-mac"

  tasks:
    - name: Install package if not installed
      block:
        - name: Check if package is installed
          command: "port installed {{package_to_check}}"
          register: installed_packages
          failed_when: false
          changed_when: false

        - name: Install package if not installed
          command: "port install {{package_to_install}}"
          when: "'{{package_to_check}}' not in installed_packages.stdout"
      rescue:
        - name: Print error message
          debug:
            msg: "Failed to check the package status"

...

