- name: Create VLANs
  hosts: all
  gather_facts: false

  vars:
    vlan_id: "100"
    vlan_name: "VLAN_100"

  tasks:
    - name: Check VLAN existence
      ios_vlans:
        vlan_id: "{{ vlan_id }}"
        state: query
      register: vlan_check_result

    - name: Debug VLAN check
      debug:
        var: vlan_check_result

    - name: Create VLAN
      ios_vlans:
        vlan_id: "{{ vlan_id }}"
        vlan_name: "{{ vlan_name }}"
        state: "{{ 'present' if vlan_check_result.json.result else 'absent' }}"