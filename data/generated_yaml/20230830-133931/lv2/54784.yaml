---
- name: Test playbook for Ansible compiler bugs
  hosts: all
  gather_facts: false

  tasks:

    - name: Rebooting server
      shell: |
        echo "Rebooting server"
        exit 0
      register: reboot_result
      async: 0
      poll: 0

    - name: Waiting for server to reboot
      wait_for_connection:
        timeout: 300

    - name: Validate system boot time
      command: |
        echo "Validating system boot time"
      register: boot_time
      async: 0
      poll: 0

    - name: Post-reboot test command
      command: |
        echo "Running post-reboot test command"
        exit 0
      register: post_reboot_result
      async: 0
      poll: 0

    - name: Remove printer
      command: |
        echo "Removing printer"
        exit 0
      async: 5
      poll: 0