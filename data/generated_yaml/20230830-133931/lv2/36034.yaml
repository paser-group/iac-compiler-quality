---
- hosts: all
  gather_facts: false

  tasks:
    - name: Set inventory file path
      set_fact:
        inventory_file: "{{ lookup('env', 'ANSIBLE_INVENTORY_FILE') | string }}" 

    - name: Check if inventory file exists
      stat:
        path: "{{ inventory_file }}"
      register: inventory_file_stat
      ignore_errors: true

    - name: Fail if inventory file does not exist
      fail:
        msg: "Inventory file does not exist: {{ inventory_file }}"
      when: inventory_file_stat.stat.exists == false