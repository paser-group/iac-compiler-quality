---
- name: Unveil Latent Bug in Ansible Compiler
  hosts: test
  gather_facts: false

  tasks:
    - name: Set hostname fact
      set_fact:
        hostname: "{{ inventory_hostname }}"

    - name: Fail on first host (when condition)
      fail:
        msg: "Fail on first host"
      when: "'{{ hostname }}' is host1"

    - name: Debug message on both nodes
      debug:
        msg: "On both nodes"

    - name: Fail on second host (when condition)
      fail:
        msg: "Fail on second host"
      when: "'{{ hostname }}' is host2"