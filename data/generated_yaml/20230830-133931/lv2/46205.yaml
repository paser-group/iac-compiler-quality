- name: Check service status
  hosts: all
  gather_facts: false

  tasks:
    - name: Reloading Service on {{ ansible_hostname }}
      service:
        name: "{{ item }}"
        state: reloaded
      with_items: "{{ lookup('env', 'SERVICE_NAMES') | default([]) }}"
      tags:
        - reload

    - name: Checking the service status {{ ansible_hostname }}
      service:
        name: "{{ item }}"
        state: started
      with_items: "{{ lookup('env', 'SERVICE_NAMES') | default([]) }}"
      tags:
        - status