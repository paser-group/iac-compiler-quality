---
- name: Discover Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  vars:
    inventory_file: "{{ playbook_dir }}/inventory.ini"

  tasks:
    - name: Create inventory file
      copy:
        content: |
          [nodes]
          ubuntu1 ansible_host=10.1.1.1 ansible_user=root ansible_password=pass
          alpine1 ansible_host=10.1.1.2 ansible_user=root ansible_password=pass
          centos1 ansible_host=10.1.1.3 ansible_user=root ansible_password=pass
          redhat1 ansible_host=10.1.1.4 ansible_user=root ansible_password=pass
        dest: "{{ inventory_file }}"
        mode: 0644

    - name: Include inventory file
      include_vars: "{{ inventory_file }}"

    - name: Include the role
      include_role:
        name: 'purge_fs'
      delegate_to: "{{ groups['nodes'][0] }}"
      run_once: true

    - name: Raise an error if run on the wrong host
      fail:
        msg: "The role was run on the wrong host."
      delegate_to: "{{ groups['nodes'][1] }}"
      run_once: true