---
- name: Unveil Latent Ansible Compiler Bug
  hosts: all
  gather_facts: false

  tasks:
    - name: Define variables
      vars:
        network_name: "node-net"
        subnet_cidr: "10.1.1.0/24"
        gateway_ip: "10.1.1.254"
        nodes:
          - name: "ubuntu1"
            ip: "10.1.1.1"
            os: "ubuntu"
          - name: "alpine1"
            ip: "10.1.1.2"
            os: "alpine"
          - name: "centos1"
            ip: "10.1.1.3"
            os: "centos"
          - name: "redhat1"
            ip: "10.1.1.4"
            os: "redhat"

    - name: Create network
      docker_network:
        name: "{{ network_name }}"
        state: present
        subnet: "{{ subnet_cidr }}"
        gateway: "{{ gateway_ip }}"

    - name: Create Docker containers
      docker_container:
        name: "{{ item.name }}"
        state: started
        image: "{{ item.os }}"
        networks:
          - name: "{{ network_name }}"
            ipv4_address: "{{ item.ip }}"
      loop: "{{ nodes }}"

    - name: Test type-related bug
      debug:
        var: "{{ var_name }}"

    - name: Clean up
      docker_container:
        name: "{{ item.name }}"
        state: absent
      loop: "{{ nodes }}"

    - name: Remove network
      docker_network:
        name: "{{ network_name }}"
        state: absent