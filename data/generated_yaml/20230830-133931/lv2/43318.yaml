- name: Install pinentry port
  hosts: all
  gather_facts: false

  tasks:
    - name: Check if pinentry is installed
      shell: port installed | grep pinentry
      register: pinentry_installed
      changed_when: false

    - name: Install pinentry port
      shell: |
        if [[ "{{ pinentry_installed.stdout }}" != *pinentry-mac* ]]; then
          sudo port install pinentry
        fi
      changed_when: pinentry_installed.stdout != "*pinentry-mac*"