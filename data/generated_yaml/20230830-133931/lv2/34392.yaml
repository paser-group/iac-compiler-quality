- name: Retrieve existing firewall rules
  hosts: all
  gather_facts: false
  tasks:
    - name: Get existing firewall rules
      shell: "Get-NetFirewallRule | ConvertTo-Json -Depth 4"
      register: existing_rules

    - name: Convert rules to list
      set_fact:
        rules_list: "{{ existing_rules.stdout | from_json }}"

    - name: Iterate over firewall rules
      debug:
         msg: "{{ item.name }}"
      loop: "{{ rules_list }}"