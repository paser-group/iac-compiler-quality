---
- name: Ansible Latent Bug Finder
  hosts: all
  gather_facts: false

  vars:
    docker_nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distribution: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distribution: alpine
      - name: centos1
        ip: 10.1.1.3
        distribution: centos
      - name: redhat1
        ip: 10.1.1.4
        distribution: redhat

  tasks:
    - name: Debug Inventory
      debug:
        var: inventory_hostname

    - name: Check for Integer Labels
      debug:
        msg: "Labels: {{ item.labels }}"
      loop: "{{ docker_nodes }}"
      when: item.labels is integer

    - name: Create Symlink Paths with Space
      file:
        path: "/tmp/path with space"
        state: link
        src: "/tmp/source with space"

    - name: Generate Malformed Unicode Strings
      set_fact:
        test_string: "{{ '\udc80' | from_json }}"

    - name: Set Negative Cache Timeout
      file:
        path: /tmp/negative_cache_timeout
        state: touch
      vars:
        cache_timeout: -1
      environment:
        CACHE_TIMEOUT: "{{ cache_timeout }}"