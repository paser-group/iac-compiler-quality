---
- name: Check and enable port
  hosts: all
  gather_facts: false

  tasks:
    - name: Check if port is open
      shell: 'iptables -L INPUT -n | grep ":1234"'
      register: iptables_result
      changed_when: false
      ignore_errors: true

    - name: Enable the port if it is not already
      shell: 'lokkit -p 1234:tcp -q'
      when: iptables_result.stdout | int > 0
      changed_when: false