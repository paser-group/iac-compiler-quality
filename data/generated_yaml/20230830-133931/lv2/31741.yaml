
- name: Generate SSH keys
  hosts: all
  gather_facts: false
  vars:
    ssh_key_dir: "{{ lookup('env', 'HOME') }}/.ssh"
    ssh_private_key: "{{ ssh_key_dir }}/id_rsa"
    ssh_public_key: "{{ ssh_key_dir }}/id_rsa.pub"

  tasks:
    - name: Ensure SSH keys directory exists
      file:
        path: "{{ ssh_key_dir }}"
        state: directory
        mode: '0700'

    - name: Generate SSH key pair
      openssh_keypair:
        path: "{{ ssh_private_key }}"
        type: rsa
        size: 2048
        force: no

    - name: "Display public key"
      shell: cat {{ ssh_public_key }}
