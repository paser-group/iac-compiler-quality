- hosts: all
  gather_facts: no

  vars:
    network_name: "node-net"
    subnet_cidr: "10.1.1.0/24"
    gateway_ip: "10.1.1.254"
    node_ips:
      - { name: "ubuntu1", ip: "10.1.1.1", distribution: "ubuntu" }
      - { name: "alpine1", ip: "10.1.1.2", distribution: "alpine" }
      - { name: "centos1", ip: "10.1.1.3", distribution: "centos" }
      - { name: "redhat1", ip: "10.1.1.4", distribution: "redhat" }

  tasks:
    - name: Create network
      docker_network:
        name: "{{ network_name }}"
        state: present

    - name: Create subnet
      docker_subnetwork:
        network: "{{ network_name }}"
        name: "{{ network_name }}"
        cidr: "{{ subnet_cidr }}"

    - name: Create gateway
      docker_gateway:
        network: "{{ network_name }}"
        name: "{{ network_name }}-gateway"
        ip: "{{ gateway_ip }}"

    - name: Create nodes
      docker_container:
        name: "{{ item.name }}"
        image: "{{ item.distribution }}"
        state: started
        detach: yes
        network_mode: "{{ network_name }}"
        networks:
          "{{ network_name }}":
            ipv4_address: "{{ item.ip }}"
      loop: "{{ node_ips }}"