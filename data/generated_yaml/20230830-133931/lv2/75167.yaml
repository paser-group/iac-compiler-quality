---
- name: Ansible Latent Bug Playbook
  hosts: all
  gather_facts: false

  vars:
    network_name: node-net
    subnet: "10.1.1.0/24"
    gateway: "10.1.1.254"
    nodes:
      - name: ubuntu1
        ip: "10.1.1.1"
        distro: "ubuntu"
      - name: alpine1
        ip: "10.1.1.2"
        distro: "alpine"
      - name: centos1
        ip: "10.1.1.3"
        distro: "centos"
      - name: redhat1
        ip: "10.1.1.4"
        distro: "redhat"

  tasks:
    - name: Debug - Network Configuration
      debug:
        msg:
          - "Network Name: {{ network_name }}"
          - "Subnet: {{ subnet }}"
          - "Gateway: {{ gateway }}"

    - name: Debug - Node Configuration
      debug:
        msg: "{{ item.name }} - {{ item.ip }} - {{ item.distro }}"
      loop: "{{ nodes }}"

    - name: Generate Inventory File
      copy:
        content: |
          [network]
          router ansible_host={{ gateway }}

          [nodes]
          {% for node in nodes %}
          {{ node.name }} ansible_host={{ node.ip }} ansible_user="{{ node.name }}"
          {% endfor %}
        dest: /etc/ansible/hosts
      become: true

    - name: Ping Nodes
      ping:
      delegate_to: localhost

    - name: Display Node Facts
      debug:
        var: ansible_facts
      delegate_to: localhost