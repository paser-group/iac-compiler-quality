- name: Test Ansible Latent Bugs
  hosts: all
  gather_facts: false

  tasks:
    - name: Prepare inventory
      set_fact:
        inventory: |
          [ubuntu]
          ubuntu1 ansible_host=10.1.1.1

          [alpine]
          alpine1 ansible_host=10.1.1.2

          [centos]
          centos1 ansible_host=10.1.1.3

          [redhat]
          redhat1 ansible_host=10.1.1.4

    - name: Generate latent bugs
      block:
        - name: Simulate type-related bug 1
          debug:
            msg: "{{ item | upper }}"
          loop: "{{ inventory.redhat }}"

        - name: Simulate type-related bug 2
          debug:
              msg: "{{ item.whatever }}"
          loop: "{{ inventory.centos }}"

        - name: Simulate type-related bug 3
          debug:
            msg: "{{ item | int }}"
          loop: "{{ inventory.alpine }}"
      
      rescue:
        - name: Debug exception
          debug:
            var: ansible_failed_result