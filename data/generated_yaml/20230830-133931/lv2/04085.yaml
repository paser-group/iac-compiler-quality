---
- name: Ansible Latent Bug Finder
  hosts: all
  gather_facts: False
  vars:
    subnet: 10.1.1
    gateway: 10.1.1.254

  tasks:
    - name: Create network interface
      network_cli:
        hostname: "{{ inventory_hostname }}"
        command: physical
        transport: network_cli
        interface: "{{ ansible_default_ipv4.interface }}"
        state: up
        address: "{{ subnet }}.{{ ansible_play_hosts.index(inventory_hostname) + 1 }}/24"
        gateway: "{{ gateway }}"
      register: network_result

    - name: Debug network result
      debug:
        var: network_result