- name: Test conditional with_items
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Set a complex variable
      set_fact:
        my_variable:
          - "{{ {'key1': 'value1'} }}"
          - "{{ ['item1', 'item2'] }}"

    - name: Perform action based on variable type
      debug:
        msg: "Variable type is string"
      when: my_variable | type_debug == 'string'

    - name: Perform action based on variable type
      debug:
        msg: "Variable type is list"
      when: my_variable | type_debug == 'list'