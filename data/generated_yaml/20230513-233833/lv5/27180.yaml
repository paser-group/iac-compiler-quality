
---
- hosts: all
  gather_facts: false
  tasks:
    - name: Define two Jinja lists with common and unique elements
      set_fact:
        list1: [1, 2, 3, 4]
        list2: [3, 4, 5, 6]

    - name: Calculate intersection of two Jinja lists and store result in variable
      set_fact:
        jinja_intersection: "{{ list1 | intersection(list2) }}"

    - name: Calculate intersection of Python lists and store result in variable
      set_fact:
        python_intersection: "{{ list(list1 | intersect(list2)) }}"

    - name: Compare the two intersection results
      fail:
        msg: |
          The Jinja intersection filter and Python intersection produce different results.
          The Jinja result: {{ jinja_intersection }}
          The Python result: {{ python_intersection }}
      when: jinja_intersection != python_intersection
