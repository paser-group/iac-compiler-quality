
- name: Set up read-only policy
  iam_policy:
    state: present
    name: read-only-policy
    policy_json: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "autoscaling:Describe*",
              "ec2:Describe*"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "cloudwatch:Get*",
              "cloudwatch:List*",
              "cloudwatch:Describe*"
            ],
            "Resource": "*"
          }
        ]
      }

- name: Create IAM role
  iam_role:
    name: test
    assume_role_policy_document: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Principal": {
              "Service": "ec2.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
          }
        ]
      }
    policy_name: read-only-policy
