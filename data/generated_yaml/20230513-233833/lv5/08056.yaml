
---
- name: Check Docker API version
  hosts: docker_nodes
  gather_facts: no
  become: yes
  
  tasks:
  - name: Register client version
    shell: docker version --format '{{.Client.Version}}'
    register: client_version
  
  - debug:
      msg: "{{ inventory_hostname }} client version is {{ client_version.stdout }}"

  - name: Register server version
    shell: docker version --format '{{.Server.Version}}'
    register: server_version
  
  - debug:
      msg: "{{ inventory_hostname }} server version is {{ server_version.stdout }}"
  
  - name: Check that client and server versions match
    assert:
      that: client_version.stdout == server_version.stdout
