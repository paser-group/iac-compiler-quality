
- hosts: test_nodes
  vars:
    socket: /tmp/ansible_test.sock

  tasks:

  - name: Synchronous task 1
    command: echo "Executing synchronous task 1"

  - name: Asynchronous task 1
    async: 10
    poll: 5
    command: echo "Executing asynchronous task 1"
    register: result_1

  - name: Synchronous task 2
    command: echo "Executing synchronous task 2"

  - name: Asynchronous task 2
    async: 10
    poll: 5
    command: echo "Executing asynchronous task 2"
    register: result_2

  - name: Last task
    command: echo "Executing last task"
    async: 10
    poll: 5
    register: result_last

  - name: Check last task result
    debug:
      var: result_last.returncode
