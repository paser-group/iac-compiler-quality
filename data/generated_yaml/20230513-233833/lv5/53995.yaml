
- name: Initialize the Azure Provider
  azure_rm_init:
    subscription_id: <subscription_id>
    client_id: <client_id>
    secret: <client_secret>
    tenant: <tenant_id>

- name: Fetch VMs by Tag
  hosts: localhost
  gather_facts: False
  vars:
    tag_name: "<tag_name>"
    tag_value: "<tag_value>"
  tasks:
    - name: Fetch VM facts using Azure_rm_virtualmachine_facts module
      azure_rm_virtualmachine_facts:
        resource_group: <resource_group>
        tags:
            - name: "{{ tag_name }}"
              value: "{{ tag_value }}"
      register: vm_facts

    - name: Debug Azure VM facts
      debug:
        var: vm_facts
