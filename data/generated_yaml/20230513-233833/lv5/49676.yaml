
- name: Test s3_bucket module for the requester_pays bug
  hosts: all
  vars:
    s3_bucket_name: example_bucket
  tasks:
    - name: Create an S3 bucket
      s3_bucket:
        name: "{{ s3_bucket_name }}"
        region: us-west-2
        requester_pays: true
        state: present
      register: create_bucket_result

    - name: Fail the playbook if requester_pays is not False
      fail:
        msg: "Requester pays configuration was not set to false"
      when: create_bucket_result.s3_bucket.requester_pays != False
