
- name: Test get_url module with FTP authentication
  hosts: all
  gather_facts: no

  tasks:
    - name: List available files with ftp module
      ftp:
        hostname: example.com
        port: 21
        user: ftp_user
        password: ftp_password
        mode: passive
      register: ftp_files

    - name: Download file with get_url module
      get_url:
        url: ftp://ftp_user:ftp_password@example.com/file.txt
        dest: /tmp/file.txt
      register: downloaded_file

    - name: Check if file downloaded successfully
      command: "ls /tmp/file.txt"
      register: file_exists
      failed_when: file_exists.rc != 0

    - name: Test uri module with FTP authentication
      uri:
        url: ftp://example.com/file.txt
        ftp_username: ftp_user
        ftp_password: ftp_password
        method: GET
      register: uri_download

  handlers:
    - name: Cleanup downloaded file
      file:
        path: /tmp/file.txt
        state: absent
