
- name: Create target group
  elb_target_group:
    name: my-target-group
    region: us-west-2
    port: 80
    protocol: http
    vpc_id: vpc-123456

- name: Attach EC2 instance to target group
  elb_target_group:
    name: my-target-group
    targets:
      - id: i-1234567890abcdef0
        port: 80

- name: Create application load balancer
  elb_application_lb:
    name: my-load-balancer
    subnets:
      - subnet-12345678
      - subnet-87654321
    listeners:
      - protocol: HTTP
        port: 80
        action:
          type: forward
          target_group_arn: arn:aws:elasticloadbalancing:us-west-2:111122223333:targetgroup/my-target-group/1234567890abcdef

- name: Register a target with the application load balancer
  elb_application_lb_target:
    target_group_arn: arn:aws:elasticloadbalancing:us-west-2:111122223333:targetgroup/my-target-group/1234567890abcdef
    targets:
      - id: i-1234567890abcdef0

- name: Deregister a target with the application load balancer
  elb_application_lb_target:
    target_group_arn: arn:aws:elasticloadbalancing:us-west-2:111122223333:targetgroup/my-target-group/1234567890abcdef
    targets:
      - id: i-1234567890abcdef0

- name: Delete the application load balancer
  elb_application_lb:
    state: absent
    name: my-load-balancer
