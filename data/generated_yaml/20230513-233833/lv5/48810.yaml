
- name: Create log group with retention and set permissions
  hosts: node1
  gather_facts: no

  tasks:
    - name: Create log group
      cloudwatchlogs_log_group:
        name: test-group
        state: present
      register: log_group
      
    - name: Set retention to 30 days
      cloudwatchlogs_log_group:
        name: test-group
        state: present
        retention_days: 30
        
    - name: Change log group permissions
      cloudwatchlogs_log_group:
        name: test-group
        state: present
        policy_document: |
          {
            "Version": "2012-10-17",
              "Statement": [
              {
                "Effect": "Allow",
                "Principal": "*",
                "Action": "logs:CreateLogStream",
                "Resource": "arn:aws:logs:us-west-2:123456789012:log-group:test-group:*"
              }]
          }

