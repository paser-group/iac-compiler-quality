
- name: Test net_cli connection using expect
  hosts: all
  gather_facts: no

  tasks:
    - name: Create SSH Connection
      expect:
        command: ssh {{ inventory_hostname }}
        responses:
          'Are you sure you want to continue connecting': "yes\n"
          'password for': "{{ password }}\n"
        echo: yes
        timeout: 5

    - name: Wait for prompt to appear or timeout
      expect:
        command: ""
        echo: no
        timeout: 5

