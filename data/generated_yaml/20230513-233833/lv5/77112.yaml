
---
- name: Test KubeVirt module import
  hosts: all
  become: true
  tasks:
    - name: Import KubeVirt module
      import_role:
        name: kubevirt.kubevirt

    - name: Create basic virtual machine
      kubevirt_vm:
        name: test
        namespace: default
        vm: |
          apiVersion: kubevirt.io/v1alpha3
          kind: VirtualMachine
          metadata:
            name: test
          spec:
            domain:
              devices:
                disks:
                  - name: containerdisk
                    volumeName: containerdisk
                interfaces:
                  -
                    bridge: {}
                  - name: default
                    masquerade: {}
              resources:
                requests:
                  memory: 64M
              cpu:
                cores: 1
            volumes:
              - containerDisk:
                  image: kubevirt/cirros-registry-disk-demo:latest
                name: containerdisk
