
- name: Test RabbitMQ policy priority
  hosts: node1
  gather_facts: no
  vars:
    rabbitmq_policy:
      name: test-policy
      priority: 10
      vhost: /
      pattern: ".*"
      definition:
        ha-mode: "all"
  tasks:
    - name: Create RabbitMQ policy
      rabbitmq_policy:
        policy: "{{ rabbitmq_policy }}"
        state: present
      register: policy_built
    - name: Verify RabbitMQ policy
      rabbitmq_policy:
        policy: "{{ rabbitmq_policy }}"
        state: present
      when: policy_built.changed
