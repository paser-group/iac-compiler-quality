
# Target all Ubuntu nodes in the inventory file
- hosts: ubuntu

  tasks:
  - name: Install package using apt module with Python 3
    become: yes
    apt:
      name: mypackage
      state: present
      update_cache: yes
    vars:
      ansible_python_interpreter: /usr/bin/python3
    register: result

  # Check for any cache errors
  - name: Verify cache is up to date
    fail:
      msg: Unable to update cache
    when: result.cache_update_failed == true
