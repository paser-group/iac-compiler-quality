
---
- name: Gather facts from NetApp Cluster
  hosts: all
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Install required python modules
      apt:
        name: python3-nacl, python3-requests
        state: present
      become: true

    - name: Gather Facts
      na_ontap_gather_facts:
        hostname: "{{ ansible_host }}"
        username: "{{ netapp_username }}"
        password: "{{ netapp_password }}"
        validate_certs: False
        timeout: 600

    - name: Save Facts
      copy:
        content: "{{ ansible_facts }}"
        dest: /opt/ansible/facts/facts.json
      delegate_to: localhost
