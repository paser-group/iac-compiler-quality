
- name: Test winrm connection with PowerShell command
  hosts: target_node
  tasks:
    - name: Test winrm connection
      win_command: powershell.exe -command "[NSValue]::Initialize()"
      register: result
    - name: Check for error
      fail:
        msg: "+[NSValue initialize] error occurred"
      when: "'+[NSValue initialize] error' in result.stdout"
