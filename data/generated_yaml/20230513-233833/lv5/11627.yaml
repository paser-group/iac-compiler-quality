
- name: Test profile_tasks.py module
  hosts: all
  gather_facts: False
  vars:
    assertion_file: assertion_msg.txt
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Test profile_tasks.py
      profile_tasks:
        display_skipped_hosts: false
        callback_whitelist: profile_tasks
      register: profile_result

    - name: Assert callback_whitelist
      fail:
        msg: "{{ lookup('file', assertion_file) }}"
      when: '"callback_whitelist: profile_tasks" not in profile_result.stdout_lines or "display_skipped_hosts: False" not in profile_result.stdout_lines'
