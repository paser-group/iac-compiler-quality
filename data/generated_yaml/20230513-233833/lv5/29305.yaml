
---
- name: Test Netscaler module
  hosts: all
  vars:
    vip_name: "vip01"
    ip_addr: "1.1.1.1"
    backup_ip: "2.2.2.2"
    timeout: "3"
  tasks:
    - name: Create netscaler lb vserver
      netscaler_lb_vserver:
        nsip: 10.1.1.1
        nitro_user: "{{ lookup('env','NS_USER') }}"
        nitro_pass: "{{ lookup('env','NS_PASS') }}"
        nitro_protocol: "{{ lookup('env','NS_PROTOCOL') }}"
        nitro_timeout: "{{ lookup('env','NS_TIMEOUT') }}"
        validate_certs: no
        vservername: "{{ vip_name }}"
        servicetype: SSL
        ipv46: "{{ ip_addr }}"
        port: 443
        backupip: "{{ backup_ip }}"
        listenpolicy: CLIENT.IP.SRCIP
        listenpriority: 101
        listenstate: ENABLED
        sessiontimeout: "{{ timeout }}"
      register: output
    - name: Display output
      debug: var=output.stdout_lines
