
# Install required packages
- name: Install required packages
  apt:
    name:
      - certbot
      - python3-certbot-nginx
    state: present
  become: true

# Create a sample LetsEncrypt certificate
- name: Create sample LetsEncrypt certificate
  shell: |
    certbot certonly --webroot --agree-tos --non-interactive --email webmaster@example.com -w /var/www/html -d example.com
  become: true

# Retrieve the value of the 'cert_days' attribute
- name: Retrieve cert_days attribute
  command: |
    openssl x509 -enddate -noout -in /etc/letsencrypt/live/example.com/fullchain.pem | sed 's/notAfter=//'
  register: cert_expiry
