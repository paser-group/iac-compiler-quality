
- name: Generate SSH keypair
  hosts: node1
  tasks:
  - name: Generate SSH keypair
    ansible.posix.ssh_keypair:
      path: /home/user/.ssh/id_rsa_test
  - name: Copy SSH key to remote nodes
    ansible.posix.copy:
      src: /home/user/.ssh/id_rsa_test.pub
      dest: /home/user/.ssh/authorized_keys
    delegate_to: "{{ item }}"
    with_items: "{{ groups['all'] }}"

- name: Test SSH Connection
  hosts: all
  tasks:
  - name: Ping remote nodes
    ping:
