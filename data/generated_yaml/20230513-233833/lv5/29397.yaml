
---
- name: Create S3 buckets
  hosts: localhost
  gather_facts: no
  
  vars:
    aws_access_key: "{{ lookup('env', 'AWS_ACCESS_KEY_ID') }}"
    aws_secret_key: "{{ lookup('env', 'AWS_SECRET_ACCESS_KEY') }}"
    region: "{{ lookup('env', 'AWS_REGION') | default('us-east-1') }}"

  tasks:
  - name: Create bucket without encryption
    s3:
      aws_access_key: "{{ aws_access_key }}"
      aws_secret_key: "{{ aws_secret_key }}"
      region: "{{ region }}"
      bucket: my-bucket
      
  - name: Create bucket with encryption
    s3:
      aws_access_key: "{{ aws_access_key }}"
      aws_secret_key: "{{ aws_secret_key }}"
      region: "{{ region }}"
      bucket: my-encrypted-bucket
      encryption: 'AES256'
