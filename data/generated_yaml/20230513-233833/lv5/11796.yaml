
- name: Test sudo module for robustness
  hosts: all
  gather_facts: no
  tasks:
    - name: Run command with privilege escalation
      command: sudo ls
      register: result
      async: 30
      poll: 10
    - name: Wait for password prompt
      wait_for:
        port: 22
        host: "{{ inventory_hostname }}"
        state: stopped
        delay: "{{ 5 | random }}"
        timeout: 30
      ignore_errors: yes
