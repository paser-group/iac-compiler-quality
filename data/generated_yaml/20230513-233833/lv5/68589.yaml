
---
- name: Testing the Ansible 'setup' module
  hosts: win-host
  gather_facts: False
  tasks:
    - name: Gathering custom facts using the 'setup' module
      setup:
        gather_subset:
          - custom
        filter: ansible_local
      register: custom_facts

    - name: Displaying custom facts
      debug:
        msg: "{{ custom_facts }}"

    - name: Checking for exception errors
      fail:
        msg: "Exception error thrown during fact-gathering"
      when: custom_facts.failed == True
