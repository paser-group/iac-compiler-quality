
- name: Install Python 3
  apt:
    name: python3
    state: present

- name: Launch cloud server with user_data payload
  cs_instance:
    state: present
    name: server-1
    image_id: 'ami-0c55b159cbfafe1f0'
    group: webserver
    user_data: >
      #!/bin/bash
      echo "test payload"
    wait: yes
  register: cs_instance_result

- name: Print user_data value
  debug:
    msg: "{{ cs_instance_result.user_data }}"

- name: Check if user_data value matches expected value
  assert:
    that:
      - cs_instance_result.user_data == "#!/bin/bash\necho \"test payload\"\n"
