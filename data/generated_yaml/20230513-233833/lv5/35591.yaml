
---
- name: Create managed image
  azure_rm_manageddisk:
    resource_group: myResourceGroup
    name: myManagedDisk
    source: /subscriptions/{subscription_id}/resourceGroups/{resource_group}/providers/Microsoft.Compute/disks/{disk_name}
    disk_size_gb: 256
    location: eastus
  register: managed_disk

- name: Create VM from managed image
  azure_rm_virtualmachine:
    resource_group: myResourceGroup
    name: myVM
    image:
      id: "{{ managed_disk.id }}"
    vm_size: Standard_DS1_v2
    admin_username: azureuser
    admin_password: Password.12345678
    location: eastus
  register: vm
