
- name: Test playbook for environment variables evaluated as templates
  hosts: all
  become: true
  tasks:
    - name: Install template packages
      apt:
        name: ['python3-jinja2']
        state: present

    - name: Set environment variable
      set_fact:
        my_var: "{{ansible_hostname}}"

    - name: Attempt to use environment variable as template
      template:
        src: /dev/null
        dest: /tmp/environment_variable_test.txt
      register: result

    - name: Output result
      debug:
        var: result
