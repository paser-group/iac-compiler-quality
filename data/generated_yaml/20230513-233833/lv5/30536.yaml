
- name: Test replace module with regex patterns
  hosts: all
  become: true

  vars:
    - regex_patterns:
        - "(\d{3})\d{3}-\d{4}" # Social Security Number pattern
        - "^(\d{1,3}\.){3}\d{1,3}$" # IPv4 pattern
        - "(?=.*[A-Z]).{8,}" # Password policy pattern (8+ Characters, at least one uppercase)

  tasks:
    - name: Replace text using regex pattern 1
      replace:
        path: /etc/myfile.txt
        regexp: "{{ regex_patterns[0] }}"
        replace: "REPLACED"
      register: replace_result_1

    - name: Replace text using regex pattern 2
      replace:
        path: /etc/myfile.txt
        regexp: "{{ regex_patterns[1] }}"
        replace: "REPLACED"
      register: replace_result_2

    - name: Replace text using regex pattern 3
      replace:
        path: /etc/myfile.txt
        regexp: "{{ regex_patterns[2] }}"
        replace: "REPLACED"
      register: replace_result_3

    - name: Verify replace module and regex patterns worked as expected
      assert:
        that:
          - replace_result_1 is succeeded
          - replace_result_2 is succeeded
          - replace_result_3 is succeeded
