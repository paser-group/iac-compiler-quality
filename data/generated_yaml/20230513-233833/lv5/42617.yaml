
- name: Install Zabbix agent and add host to the server
  hosts: node1
  become: true
  tasks:
    - name: Install Zabbix agent
      apt:
        name: zabbix-agent
        state: present

    - name: Add new host to the server
      zabbix_host:
        name: test_host
        server_url: http://zabbix.example.com/api_jsonrpc.php
        login_user: admin
        login_password: secret
        ip: "{{ ['127.0.0.1', 'localhost', 8080] | random }}"
        port: "{{ ['192.168.1.10', 'example.com', 9090] | random }}"
        groups:
          - Linux servers
