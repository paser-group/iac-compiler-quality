
---
- name: Undercloud deployment playbook
  hosts: all
  tasks:
    - name: Check system requirements
      assert:
        that:
          - item in ansible_facts.packages
          - service is running
      vars:
        required_packages:
          - package1
          - package2
        required_services:
          - service1
          - service2

    - name: Error handling
      command: /path/to/script
      register: command_output
      failed_when: "'error' in command_output.stderr"

    - name: Log error message
      lineinfile:
        line: "{{ command_output.stderr }}"
        path: /path/to/error/log
