
---
- name: Lookup Error handling test
  hosts: all
  vars:
    my_dict:
      key1: val1
      
  tasks:
  - name: Test Lookup
    set_fact: 
      my_var: "{{ lookup('dict', {'key': 'val'}, errors='ignore', default='not found') }}"
    register: lookup_result
    ignore_errors: True

  - name: Fail on Lookup Error
    fail:
      msg: "Lookup Error Encountered
    when: lookup_result.failed
