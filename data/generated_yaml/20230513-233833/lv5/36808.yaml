
- name: Install required packages for CSV lookup
  apt:
    name:
      - python3
      - python3-pip
    update_cache: yes

- name: Install required packages for CSV lookup
  pip:
    name:
      - pandas
      - numpy

- name: Generate CSV file
  command: touch /tmp/{{ item }}.csv
  with_items:
    - data1
    - data2
    - data3 

- name: Add data to CSV file
  blockinfile:
    path: /tmp/{{ item.filename }}.csv
    block: "{{ item.data }}"
  with_items:
    - { filename: 'data1', data: 'a,b,c\nd,e,f' }
    - { filename: 'data2', data: 'x,y\nz,1' }
    - { filename: 'data3', data: '1,2,3\n4,5,6' }

- name: Test CSV lookup module with invalid argument
  ignore_errors: yes
  debug:
    msg: "{{ lookup('csvfile', '/tmp/data4.csv') }}"
