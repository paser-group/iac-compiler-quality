
- name: Clone repository with submodules and update them
  git:
    repo: "{{ repo_url }}"
    dest: "{{ ansible_user_dir }}/repo"
    version: "{{ repo_version }}"
    recursive: yes
    clone: yes
    force: yes
    accept_hostkey: yes
    key_file: "{{ ssh_key }}"
    username: "{{ git_username }}"
    password: "{{ git_password }}"
  register: result

- name: Check if there were any errors
  fail:
    msg: "Error occurred: {{ result.stderr }}"
  when: result.failed
