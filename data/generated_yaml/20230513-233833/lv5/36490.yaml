
---
- name: Test iptables module for TCP flags bug
  hosts: all
  become: true

  tasks:
    - name: Install iptables
      apt:
        name: iptables
        state: present

    - name: Block traffic with specific TCP flags
      iptables:
        chain: INPUT
        protocol: tcp
        tcp_flags: SYN,ACK,FIN,RST
        jump: DROP

    - name: Test iptables rule
      wait_for:
        port: 22
        timeout: 1
        state: refused
