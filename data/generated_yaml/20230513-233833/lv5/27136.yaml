
- name: Add new host key to known_hosts
  hosts: all
  become: true
  gather_facts: false

  tasks:
  - name: Add new host key
    lineinfile:
      dest: "~/.ssh/known_hosts"
      line: "{{ lookup('pipe', 'ssh-keyscan -t rsa ' + inventory_hostname) }}"
      create: true

- name: Connect to network module
  hosts: all
  gather_facts: false
  tasks:
  - name: Execute network connectivity test
    network_test:
      app_port: 22
      proto:
        - tcp
