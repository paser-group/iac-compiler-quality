yaml
- name: Create a nested dictionary
  vars:
    nested_dict: {}
  loop: '{{ range(1, depth + 1)|list }}'
  set_fact:
    nested_dict: '{ "{{ _ | join("\": {\"", "\": {}}}") }}'
  vars:
    _:
      - "{{ depth | int }}"
      - >-
        {{
          map("regex_replace", "^", "nested_dict.") |
            regex_replace(".", "_") | list
        }}
