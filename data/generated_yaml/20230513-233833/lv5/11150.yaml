
- name: Test SSH connection
  hosts: all
  vars:
    ansible_user: "{{ ssh_user }}"
    ansible_ssh_private_key_file: "{{ ssh_private_key }}"
  tasks:
    - name: Test SSH connection
      raw: echo 'testing connection'
      register: output
    - name: Check for SSH error
      fail:
        msg: "SSH error: {{ output.stdout }}"
      when: "'The output was:' in output.stdout"
