
- hosts: all
  tasks:
    - name: Create cache directory
      file:
        path: "{{ ansible_env.HOME }}/.ansible/tmp/vcache"
        state: directory
        mode: '0775'
      register: cache_dir_result

    - name: Set cache plugin
      set_fact:
        ansible_cache_plugin: jsonfile

    - name: Generate cache data
      ping:

    - name: Remove cache directory
      file:
        path: "{{ ansible_env.HOME }}/.ansible/tmp/vcache"
        state: absent
      when: cache_dir_result is changed
