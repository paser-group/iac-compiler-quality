
- name: Create VMKernel interface
  vmware_vmkernel:
    hostname: "{{ esxi_hostname }}"
    username: "{{ esxi_username }}"
    password: "{{ esxi_password }}"
    datacenter_name: "{{ datacenter_name }}"
    esxi_hostname: "{{ esxi_hostname }}"
    portgroup_name: "{{ portgroup_name }}"
    ip_address: "{{ ip_address }}"
    subnet_mask: "{{ subnet_mask }}"
  register: vmkernel_interface

- name: Verify VMKernel interface
  assert:
    that:
      - "'changed' in vmkernel_interface"
      - "vmkernel_interface.changed == True"
      - "vmkernel_interface.state == 'present'"
      - "vmkernel_interface.label == '{{ portgroup_name }}'"
      - "vmkernel_interface.ip_config.ip_address == '{{ ip_address }}'"
      - "vmkernel_interface.ip_config.subnet_mask == '{{ subnet_mask }}'"
