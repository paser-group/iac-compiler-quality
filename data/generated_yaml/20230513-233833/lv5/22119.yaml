
---
- name: test hashi_vault errors
  hosts: all
  vars:
    secret_path: secret/does_not_exist
  tasks:
    - name: Attempt to fetch secret from HashiCorp Vault
      hashi_vault:
        path: "{{ secret_path }}"
        register: secret_content
        state: present
      ignore_errors: true
  
    - fail:
        msg: "Secret not found error expected."
      when: "'not found' not in secret_content.msg"
