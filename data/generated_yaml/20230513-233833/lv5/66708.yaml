
---
- name: Testing ec2.py dynamic inventory
  hosts: localhost
  connection: local
  tasks:
    - name: Create a dynamic inventory using ec2.py
      ec2:
        regions: "{{ lookup('ini', 'aws_regions/type=ec2 file=ec2.ini')['aws_regions'] }}"
        profile: "{{ lookup('ini', 'profile/type=boto file=ec2.ini')['profile'] }}"
        key_name: "{{ lookup('env','AWS_EC2_KEY_NAME')}}"
        group: "{{ lookup('env', 'AWS_EC2_SECURITY_GROUP')}}"
        vpc_subnet_id: "{{ lookup('env', 'AWS_EC2_SUBNET_ID')}}"
        instance_type: "{{ lookup('env', 'AWS_EC2_INSTANCE_TYPE')}}"
        count: "{{ lookup('env', 'AWS_EC2_INSTANCE_COUNT')}}"
        image: "{{ lookup('env', 'AWS_EC2_AMI_ID')}}"
        wait: yes
        exact_count: "{{ lookup('env', 'AWS_EC2_INSTANCE_COUNT')}}"
        assign_public_ip: no
      register: ec2_output

    - name: Debug ec2 instances
      debug:
        var: ec2_output
