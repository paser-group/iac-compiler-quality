
- name: create or update security group
  os_security_group:
    cloud: "{{ cloud }}"
    state: present
    auth: "{{ auth }}"
    security_group_name: my-test-sg
    description: test security group

- name: add rule to security group
  os_security_group_rule:
    cloud: "{{ cloud }}"
    state: present
    auth: "{{ auth }}"
    security_group_name: my-test-sg
    direction: ingress
    protocol: tcp
    port_range_min: 22
    port_range_max: 22
    remote_ip_prefix: 0.0.0.0/0

- name: add same rule to security group
  os_security_group_rule:
    cloud: "{{ cloud }}"
    state: present
    auth: "{{ auth }}"
    security_group_name: my-test-sg
    direction: ingress
    protocol: any
    remote_ip_prefix: 0.0.0.0/0
