
---
- name: create IAM policy
  hosts: all
  tasks:
    - name: create iam policy
      iam_policy:
        name: my_policy
        policy: |
          {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": "s3:*",
                "Resource": "*"
              }
            ]
          }

    - name: create role
      iam_role:
        name: my_role
        state: present

    - name: attach-policy
      iam_policy_attach:
        policy_arn: "{{ iam_policy_arn }}"
        role: my_role
