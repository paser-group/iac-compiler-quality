
---
- hosts: all
  gather_facts: False
  tasks:
  - name: Create instance group
    gcp_compute_instance_group_manager:
      name: my-instance-group
      state: present
      size: 1
      base_instance_name: my-instance
      zone: us-central1-a
      project: my-gcp-project
      auth_kind: serviceaccount
      service_account_file: /path/to/service/account.json
    register: create_group

  - name: debug create group
    debug:
      var: create_group

  - name: Delete instance group
    gcp_compute_instance_group_manager:
      name: my-instance-group
      state: absent
      zone: us-central1-a
      project: my-gcp-project
      auth_kind: serviceaccount
      service_account_file: /path/to/service/account.json
    register: delete_group

  - name: debug delete group
    debug:
      var: delete_group
