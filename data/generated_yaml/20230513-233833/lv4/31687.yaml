
- name: Test for Ansible authorized_key module bug
  hosts: all
  become: true
  
  tasks:
  - name: Install the authorized_key module
    command: ansible-galaxy install ansible.posix.openssh
    
  - name: Generate an SSH key pair
    shell: ssh-keygen -t rsa -f /root/.ssh/id_rsa -q -N ""
    
  - name: Add public key to authorized keys
    authorized_key:
      user: root
      key: "{{ lookup('file', '/root/.ssh/id_rsa.pub') }}"
