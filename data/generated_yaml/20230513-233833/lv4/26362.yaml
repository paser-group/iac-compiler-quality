yaml
- hosts: all
  tasks:
  - name: create group with all error servers
    group_by:
      key: error_servers
      when: <condition for generating error>
    
  - name: generate errors on all servers in the group
    debug:
      msg: "Error occured."
    when: inventory_hostname in groups['error_servers']
      
  - name: clear error state
    clear_host_errors:
      hostnames: "{{ groups['error_servers'] }}"
