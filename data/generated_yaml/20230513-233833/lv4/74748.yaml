yaml
- name: Start and enable SSH service
  become: true
  service:
    name: sshd
    state: started
    enabled: true

- name: Set up sshd_config file
  become: true
  copy:
    src: /path/to/sshd_config
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: 0644

- name: Copy authorized_keys file
  become: true
  copy:
    src: /path/to/authorized_keys
    dest: /home/{{ ansible_user }}/authorized_keys
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0600

- name: Test SSH connection
  gather_facts: no
  hosts: node1,node2,node3
  tasks:
    - name: Run command
      command: ssh {{ inventory_hostname }}
      ignore_errors: true
