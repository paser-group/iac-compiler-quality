
- name: Test ec2_ami_copy module
  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    src_image_id: ami-004d7c5e7de95a9d0
    dest_region: us-east-1
    tag_key: Name
    tag_value: My AMI
    wait_timeout: 300
    wait_delay: 5

  tasks:
    - name: Copy AMI with tag_equality and wait
      ec2_ami_copy:
        source_region: "{{ inventory_hostname }}"
        source_image_id: "{{ src_image_id }}"
        region: "{{ dest_region }}"
        wait: yes
        wait_timeout: "{{ wait_timeout }}"
        wait_delay: "{{ wait_delay }}"
        tag_equality:
          key: "{{ tag_key }}"
          value: "{{ tag_value }}"
      register: result

    - name: Print result
      debug:
        var: result
