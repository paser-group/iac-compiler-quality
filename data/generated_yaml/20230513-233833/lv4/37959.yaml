
---
- hosts: node1,node2
  gather_facts: no
  vars:
    bucket_name: "<bucket_name>"
    aws_access_key: "<aws_access_key>"
    aws_secret_key: "<aws_secret_key>"
    src_file: "<local_file_path>"
    dest_file: "<local_file_path>"
  tasks:
    - name: Copy file from local to S3
      s3_sync:
        bucket: "{{ bucket_name }}"
        file_root: "{{ src_file }}"
        mode: push
        permission: public-read
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
      register: s3_copy_result

    - name: Download file from S3
      s3_sync:
        bucket: "{{ bucket_name }}"
        file_root: "{{ dest_file }}"
        mode: pull
        permission: public-read
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
      register: s3_download_result

    - name: Display result
      debug:
        var: s3_download_result
