yaml
# Define variables required for connection to GCP
vars:
  project_id: "<project_id>"
  zone: "<zone>"
  credentials_file: "<path_to_service_account_file>"

# Define parameters required for the instance
vars:
  instance_name: "my-instance"
  instance_description: "Ansible created instance"
  machine_type: "n1-standard-1"

# Create instance template with network parameter as a non-default network
- name: Create instance template with non-default network
  gce_instance_template:
    name: "{{ instance_name }}"
    description: "{{ instance_description }}"
    network:
      name: "my-network"
  register: instance_template

# Check if instance is running by performing gcp_compute_disk lookup
- name: Get instance status
  gcp_compute_disk:
    filters:
      - name = "{{ instance_name }}"
  register: instance_status

# Return instance status
- name: Return instance status
  debug:
    var: instance_status.disks[0].status
