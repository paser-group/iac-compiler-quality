
- name: Test playbook for azurerms_securitygroup comma-separated IP address prefixes
  hosts: all
  become: true

  tasks:
  - name: Create new security group
    azure_rm_securitygroup:
      name: test-security-group
      resource_group: test-resource-group
      location: eastus
      rules:
        - access: Allow
          description: Allow all traffic from comma-separated IP address prefix 10.1.1.0/24
          destination_address_prefix: "*"
          destination_port_range: "*"
          direction: Inbound
          priority: 200
          protocol: "*"
          source_address_prefix: "10.1.1.0/24"

  - name: Apply new security rule
    azure_rm_securitygroup_rule:
      security_group: test-security-group
      resource_group: test-resource-group
      name: allow-traffic
      state: present
    ignore_errors: yes
