
- hosts: node1
  gather_facts: no
  tasks:
    - name: Create a new VMware Guest machine
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        folder: "{{ folder }}"
        name: "{{ guest_name }}"
        template: "{{ guest_template }}"
        hardware:
          memory_mb: "{{ memory }}"
          num_cpus: "{{ cpus }}"
          disk:
            - size_gb: "{{ disk_size }}"
              type: "{{ disk_type }}"
        networks:
          - name: "{{ network }}"
            ip: "{{ ip_addr }}"
            netmask: "{{ netmask }}"
            gateway: "{{ gateway }}"
        state: powered_on
      delegate_to: localhost
      
    - name: Remove the VMware Guest machine
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        folder: "{{ folder }}"
        name: "{{ guest_name }}"
        state: absent
      delegate_to: localhost
