
---
- name: Test Ansible Netscaler module authentication and JSON decoding
  hosts: netscaler
  vars:
    netscaler_host: "{{ inventory_hostname }}"
    netscaler_username: "admin"
    netscaler_password: "password"
  tasks:
    - name: Login to Netscaler device
      netscaler_login:
        nitro_user: "{{ netscaler_username }}"
        nitro_pass: "{{ netscaler_password }}"
        nitro_hostname: "{{ netscaler_host }}"
      register: result

    - debug: var=result

    - name: Get JSON response from Netscaler device
      netscaler_save_config:
        nitro_user: "{{ netscaler_username }}"
        nitro_pass: "{{ netscaler_password }}"
        nitro_hostname: "{{ netscaler_host }}"
        nitro_resource: nsconfig
      register: result

    - debug: var=result

    - name: Test JSON decoding errors
      command: echo 'invalid json' | python -m json.tool
      register: result_json

    - debug: var=result_json

