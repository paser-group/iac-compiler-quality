
---
- name: Check Ansible installation and required modules
  hosts: all
  tasks:
    - name: Check if Ansible is installed
      shell: pip show ansible
      register: ansible_installed
      ignore_errors: true

    - name: Install Ansible using pip 
      command: pip install ansible
      when: "'No distributions found' in ansible_installed.stderr"

    - name: Check if required modules are installed
      pip:
        name:
          - paramiko
          - PyYAML
        state: present

    - name: Print success message
      debug:
        msg: "Ansible and its required modules are successfully installed."
