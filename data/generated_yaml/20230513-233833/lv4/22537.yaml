yaml
- name: Set up ELB and EC2 instances
  hosts: localhost
  tasks:
    - ec2:
        key_name: my-keypair
        group: default
        instance_type: t2.micro
        image: ami-xxxxxxxx
        wait: yes
        count: 2
        vpc_subnet_id: subnet-xxxxxxxx
        assign_public_ip: true
        register: ec2_instances
    - name: Register Instances with ELB
      ec2_elb_lb:
        name: my-lb
        state: present
        instances: '{{ ec2_instances.instances }}'
