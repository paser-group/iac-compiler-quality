
---
- name: Verify Updated IAM username
  hosts: all
  tasks:
  - name: Get IAM username
    aws_iam_user_facts:
      username: "{{ ansible_aws_ec2_instance_id }}"
    register: iam_username
  - name: Fail the task if username not updated
    fail:
      msg: "IAM username not updated."
    when:
      - "'new_username' not in iam_username.user.login_profile"
  - name: Succeed task
    debug:
      msg: "IAM username updated successfully."
    when:
      - "'new_username' in iam_username.user.login_profile"
