
- name: Test delegate_to and changing parameters
  hosts: all
  tasks:
    - name: Change file 1 on host 1
      file:
        state: touch
        path: /tmp/created_by_host1_file1
      register: check_changed

    - name: Change file 2 on host 2
      file:
        state: touch
        path: /tmp/created_by_host2_file2
      delegate_to: "{{ groups['all'][1] }}"
      when: check_changed.changed

    - name: Change file 3 on host 3
      file:
        state: touch
        path: /tmp/created_by_host3_file3
      delegate_to: "{{ groups['all'][2] }}"
      when: check_changed.changed
