
---
- name: Set EC2 Tags
  hosts: ec2-instances
  become: true

  tasks:

  - name: Set Tags
    ec2_tag:
      aws_access_key: "{{ aws_access_key }}"
      aws_secret_key: "{{ aws_secret_key }}"
      region: "{{ region }}"
      resource: "{{ item.id }}"
      tags:
        Name: "{{ item.hostname }}"
        Project: "{{ project_name }}"
      state: {{ item.tags_state | default('present') }}
    with_items:
      - "{{ ec2_instances.instances }}"
