
- name: Get service facts
  hosts: all
  gather_facts: yes
  become: true
  
  tasks:
    - name: Retrieve the service facts
      service_facts:

    - name: Ensure the service is running
      debug:
        msg: "Service {{ item.key }} is {{ 'running' if item.value.state == 'running' else 'not running'}}"
      loop: "{{ ansible_facts.services }}"
