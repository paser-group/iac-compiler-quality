
- name: Test Slack Notification
  hosts: all
  gather_facts: false

  vars:
    slack_token: "{{ lookup('env', 'SLACK_TOKEN') }}"
    slack_channel: "#general"
    message: "This is a test message from Ansible."

  tasks:
    - name: Verify Slack Notification Configuration
      slack:
        token: "{{ slack_token }}"
        channel: "{{ slack_channel }}"
        msg: "Testing Slack Notification Configuration"
      register: slack_notification

    - name: Send Test Message to Slack Channel
      slack:
        token: "{{ slack_token }}"
        channel: "{{ slack_channel }}"
        msg: "{{ message }}"
      when: slack_notification.success and slack_notification.status_code == 200
