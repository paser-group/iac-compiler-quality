
---
- name: Test server parameters with API calls
  hosts: all
  gather_facts: no
  tasks:
    - name: Test API calls with different --server parameters
      command: curl -X GET -H 'Authorization: Bearer abc123' --server {{ item }} https://api.example.com/users
      loop:
        - "https://api.example.com"
        - "https://disabled.example.com"
        - "https://invalidprefix.example.com"
      register: api_results
      failed_when: api_results.rc != 0
