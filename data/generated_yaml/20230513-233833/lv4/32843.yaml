
- name: CloudWatch Event Rule Test
  hosts: all
  become: yes

  vars:
    event_name: my_event
    event_description: my_event_description

  tasks:
    - name: Install AWS CLI toolkit
      apt:
        name: awscli
        state: present

    - name: Create CloudWatch Event rule
      cloudwatchevent_rule:
        name: "{{ event_name }}"
        state: present
        description: "{{ event_description }}"
        schedule_expression: "rate(5 minutes)"
      register: cw_event

    - name: Print event name and description
      debug:
        var: cw_event.rule

    - name: Delete CloudWatch Event rule
      cloudwatchevent_rule:
        name: "{{ event_name }}"
        state: absent
