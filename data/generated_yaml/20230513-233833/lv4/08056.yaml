
---
- name: Check compatibility between Docker server and client versions
  hosts: all
  gather_facts: no

  tasks:
    - name: Retrieve Docker server version
      docker_version:
        client_timeout: 10
      register: docker_version

    - name: Check if server version is compatible
      fail:
        msg: "Incompatible Docker server version: {{ docker_version.server_version }}. The client version is {{ inventory_hostname }}."
      when: not docker_version.server_version.startswith("{{ required_docker_version }}")
