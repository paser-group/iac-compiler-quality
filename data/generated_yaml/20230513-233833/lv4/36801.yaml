
- name: Configure SVI for VLAN
  hosts: nxos_devices
  gather_facts: no

  tasks:
  - name: Define VLAN configuration
    nxos_vlan:
      vlan_id: "{{ vlan_id }}"
      state: present
    register: vlan

  - name: Define VRF configuration
    nxos_vrf:
      vrf: "{{ vrf }}"
      state: present
    register: vrf

  - name: Configure SVI
    nxos_interface:
      interface: "{{ svi_interface }}"
      svi: yes
      ip_address: "{{ svi_ip_address }}"
      vlan: "{{ vlan_id }}"
      vrf: "{{ vrf }}"
      ipv6_address_autoconfig: "{{ svi_ipv6_autoconfig }}"
      state: present
      check_mode: yes
    when: vlan.changed or vrf.changed
