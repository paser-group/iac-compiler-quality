
- name: Play to test selective callbacks in lineinfile
  hosts: all

  tasks:
    - name: Edit file using lineinfile module
      lineinfile:
        path: /tmp/file.txt
        line: "Hello, World!"
      register: result

    - name: Print result
      debug:
        var: result

  # Only execute selective callbacks on hosts where the specified file is present
  callbacks:
    - include: 'default'
    - include: 'tasks/selective_callback.yml'
      when: inventory_hostname in groups['node1']
