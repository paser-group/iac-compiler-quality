
---
- name: Create VM Snapshot
  hosts: all
  gather_facts: no
  vars:
    vm_name: invalid_vm_name
    snapshot_name: test_snapshot
    # Invalid UUID
    vm_uuid: "12345678-abcd-efgh-ijkl-mnopqrstuvwx"
  tasks:
  - name: Create a VM snapshot
    vmware_guest_snapshot:
      hostname: "{{ inventory_hostname }}"
      username: "{{ vmware_user }}"
      password: "{{ vmware_password }}"
      validate_certs: no
      name: "{{ vm_name }}"
      snapshot_name: "{{ snapshot_name }}"
      uuid: "{{ vm_uuid }}"
    register: create_snapshot
    ignore_errors: true
  - name: Check if the snapshot creation failed with 'VM not found' error
    assert:
      that:
        - create_snapshot is failed
        - create_snapshot.msg is search('Unable to locate Virtual Machine') or 
          create_snapshot.msg is search('No Virtual Machine found')
