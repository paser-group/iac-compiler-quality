
---
- name: Provision EC2 instance with user-data script
  hosts: localhost
  vars:
    spot_price: null #specify the required spot price
    instance_tags:
      Name: "Test Instance"
      Environment: "Development"
  
  tasks:
  - name: Creating EC2 Instance
    ec2:
      key_name: mykeypair #specify the SSH key pair name
      instance_type: t2.micro #specify the instance type
      image: ami-0c94855ba95c71c99 #specify the desired AMI image id
      region: us-east-1 #specify the region
      vpc_subnet_id: subnet-0d8f74e35274cd6d9 #specify the VPC subnet id
      group_id: sg-05fa1c976d7c9dbca #specify the security group id
      instance_tags: "{{ instance_tags }}"
      spot_price: "{{ spot_price }}"
      user_data: | 
        #!/bin/bash
        echo "Hello World!" # user-data script that will run on the instance
    register: ec2_instance

  - name: Debugging EC2 instance
    debug:
      msg: "{{ ec2_instance }}"

