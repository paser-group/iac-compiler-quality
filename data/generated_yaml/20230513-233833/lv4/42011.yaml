
---
- name: Create a new VM uisng template
  hosts: node1
  gather_facts: no
  vars:
    template_name: "ubuntu-20.04-template"
    vm_name: "test-vm"
    datastore: "datastore1"
  tasks:
    - name: Create VM from Template
      vmware_guest:
        hostname: vcenter_server_ip
        username: vcenter_username
        password: vcenter_password
        validate_certs: no
        name: "{{ vm_name }}"
        template: "{{ template_name }}"
        datacenter: "Datacenter"
        disk:
        - size_gb: 20
          type: thin
        hardware:
          memory_mb: 1024
          num_cpus: 1
        guest_id: ubuntu64Guest
        datastore: "{{ datastore }}"
        state: present
      register: vm_created
      
    - name: Debug VM creation results
      debug: var=vm_created
