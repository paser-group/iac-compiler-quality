
---
- name: 'playbook for acl module bug'
  hosts: all
  become: true

  tasks:
    - name: 'Set default entries with state=present and default=yes'
      acl:
        name: '{{ inventory_hostname }}'
        entity: '{{ inventory_hostname }}'
        type: 'user'
        perms: 'rwx'
        state: 'present'
        default: 'yes'
        recursive: 'yes'

    - name: 'Remove default entries with state=absent and default=yes'
      acl:
        name: '{{ inventory_hostname }}'
        entity: '{{ inventory_hostname }}'
        type: 'user'
        perms: 'rwx'
        state: 'absent'
        default: 'yes'
        recursive: 'yes'

    - name: 'Check if any default entries are missing'
      acl:
        name: '{{ inventory_hostname }}'
        entity: '{{ inventory_hostname }}'
        type: 'user'
        perms: 'rwx'
        default: 'yes'
        state: 'absent'
        recursive: 'yes'
      failed_when: "'No default entries to remove' not in acl.stdout"
