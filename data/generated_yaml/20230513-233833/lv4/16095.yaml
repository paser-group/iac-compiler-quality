
---
- name: Test ec2.py with multiple filters
  hosts: all
  gather_facts: false
  vars:
    ec2_filters:
      - {"tag:Name": "node*"}
      - {"instance-state-name": "running"}
      - {"instance-type": "t1.micro"}
      - {"placement-group-name": "group*"}
      - {"subnet-id": "subnet-1234567", "vpc-id": "vpc-1234567"}
      - {"tag:Name": "ec2_instance_with_a_long_name___ToTestEc2PythonScriptItIs_RunningOrNot___"}
      - {"tag:Environment": "dev", "tag:Name": "bastion"}
      - {"instance-type": "t2.micro"}
      - {"state": "available"}
      - {"instance-state-name": "terminated"}
  tasks:
    - name: Retrieve ec2 instances
      ec2:
        filters: "{{ item }}"
      register: ec2_inventory
      with_items: "{{ ec2_filters }}"
    - name: Display ec2 inventory
      debug: msg="{{ ec2_inventory }}"
