
---
- name: Verify service manager
  hosts: all
  gather_facts: true

  tasks:
    - name: Check ansible_service_mgr
      debug:
        var: ansible_service_mgr

    - name: Determine actual service manager
      shell: systemctl --version
      register: svc_mgr

    - name: Check if ansible_service_mgr matches actual service manager
      fail:
        msg: "ansible_service_mgr {{ ansible_service_mgr }} does not match actual service manager {{ svc_mgr.stdout }}"
      when: ansible_service_mgr != svc_mgr.stdout_lines[0]
