
- name: Check cache age checking in VMware inventory script
  hosts: vmware_hosts
  gather_facts: no
  tasks:
    - name: Update inventory cache
      vmware_inventory:
        cache_plugin: "{{cache_plugin}}"
        cache_hostname: "{{inventory_hostname}}"
        cache_age: 3600
        cache_port: "{{cache_port}}"
        cache_username: "{{cache_username}}"
        cache_password: "{{cache_password}}"
      register: inventory_update
    
    - name: Validate inventory cache
      assert:
        that:
          - "'127.0.0.1' in inventory_update.cache['vmware_inventory'][0].addresses"
        msg: "Could not validate inventory cache"
