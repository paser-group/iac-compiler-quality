
- name: Download multipart S3 object to specified folder
  hosts: all
  gather_facts: no
  vars:
    aws_access_key: "<aws_access_key>"
    aws_secret_key: "<aws_secret_key>"
    bucket_name: "<bucket_name>"
    object_key: "<object_key>"
    dest_folder: "/folder"

  tasks:
  - name: Create destination folder if it does not exist
    file:
      path: "{{ dest_folder }}"
      state: directory
    become: yes
    become_user: root
  - name: Download multipart S3 object
    s3:
      mode: download
      access_key: "{{aws_access_key}}"
      secret_key: "{{aws_secret_key}}"
      bucket: "{{bucket_name}}"
      object: "{{object_key}}"
      dest: "{{dest_folder}}"
      validate_certs: no
      rgw_s3_auth_version: "2"
      s3_retries: 3
