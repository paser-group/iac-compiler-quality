
---
- name: Detect PyConfig.h file
  hosts: all
  become: true
  tasks:
    - name: Install dependencies
      apt:
        name: "{{ item }}"
      with_items:
        - python-dev
        - build-essential
        - libssl-dev

    - name: Check if PyConfig.h file exists
      stat:
        path: "/usr/include/python2.7/pyconfig.h"
      register: pyconfig

    - name: Fail if PyConfig.h file not found
      fail:
        msg: "Pyconfig.h file not found"
      when: not pyconfig.stat.exists
