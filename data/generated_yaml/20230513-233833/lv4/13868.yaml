
- name: Test with_url lookup
  hosts: all
  tasks:
    - name: Download and install package
      apt:
        name: "{{ item }}"
        state: present
      with_url:
        - http://archive.ubuntu.com/ubuntu/pool/universe/s/sl/
        - http://archive.ubuntu.com/ubuntu/pool/main/g/gcc-7/
      register: result
    - name: Run command
      command: "echo 'Result: {{ result }}'"
    - name: Modify file
      lineinfile:
        path: "/etc/hosts"
        line: "{{ hostvars[item].ansible_host }}    {{ item }}"
      with_inventory_hostnames:
        all
