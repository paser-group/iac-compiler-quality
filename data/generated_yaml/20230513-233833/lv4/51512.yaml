
- name: Configure xFailoverCluster xCluster
  hosts: windows_servers
  gather_facts: no

  vars:
    username: ansible
    password: password  # change this value

  tasks:
    - name: Configure xFailoverCluster xCluster resource
      win_dsc:
        resource_name: xFailoverCluster
        module_name: xFailoverCluster
        clustername: ClusterName
        node1: node1
        node2: node2
        ensure: present
        authentication: PSCredential
        username: "{{ username }}"
        password: "{{ password }}"
      register: dsc_result

    - name: Debug module output
      debug:
        var: dsc_result

    - name: Check for errors
      fail:
        msg: "Error occurred in authentication process"
      when: "'exception' in dsc_result"
