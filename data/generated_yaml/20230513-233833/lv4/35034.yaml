
- name: Create and Describe VPC Endpoints 
  hosts: all
  gather_facts: no
  vars:
    region: "us-east-1"
  tasks:
    - name: Create a VPC Endpoint
      ec2_vpc_endpoint:
        state: present
        region: "{{ region }}"
        service_name: "com.amazonaws.us-east-1.s3"
        vpc_id: "vpc-123456"
        subnet_ids: ["subnet-abcdef"]
        security_group_ids: ["sg-789012"]
        route_table_ids: ["rt-345678"]
      register: create_endpoint_result

    - name: Describe VPC Endpoint
      ec2_vpc_endpoint_info:
        region: "{{ region }}"
        vpc_endpoint_ids: ["{{ create_endpoint_result.vpc_endpoint_id }}"]
      register: describe_endpoint_result

    - debug:
        var: describe_endpoint_result
