
- name: Test iptables module tcp_flags parameter
  hosts: all
  become: true
  tasks:
    - name: allow TCP packets with SYN flag
      iptables:
        chain: INPUT
        protocol: tcp
        tcp_flags: SYN
        jump: ACCEPT
      register: syn_result

    - name: print iptables output for syn packet rule
      debug:
        var: syn_result

    - name: allow TCP packets with SYN+ACK flags
      iptables:
        chain: INPUT
        protocol: tcp
        tcp_flags: SYN,ACK
        jump: ACCEPT
      register: syn_ack_result

    - name: print iptables output for syn_ack packet rule
      debug:
        var: syn_ack_result

    - name: allow TCP packets with FIN flag
      iptables:
        chain: INPUT
        protocol: tcp
        tcp_flags: FIN
        jump: ACCEPT
      register: fin_result

    - name: print iptables output for fin packet rule
      debug:
        var: fin_result
