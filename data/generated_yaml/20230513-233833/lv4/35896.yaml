
---
- name: Stress-test playbook
  hosts: all
  gather_facts: false

  tasks:
    - name: Launch multiple processes
      shell: |
        for i in {{ range(1,10) | list }}; do 
          dd if=/dev/urandom of="$i" bs=1M count=50 &
        done
      async: 50
      poll: 0

    - name: Allocate large memory space
      shell: |
        stress --vm-bytes {{ 10 * 1024 * 1024 * 1024 }} --vm-keep -m 1 &
      async: 50
      poll: 0
