
- name: Check URI
  hosts: localhost
  gather_facts: False
  tasks:
    - name: Get http status code of a URL
      uri:
        url: http://example.com
        return_content: yes
      register: result

    - name: Write response to a file
      local_action:
        module: copy
        content: "{{ result.status }}"
        dest: /tmp/myfile.txt

    - name: Fail if the response code is not 200
      fail:
        msg: "Failed because the URL returned a {{ result.status }} error code"
      when: result.status != 200
