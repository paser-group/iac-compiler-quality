
---
- name: Play to prevent race condition with fact cache and smart fact gathering
  hosts: all
  serial: 1

  tasks:
    - name: Gather facts
      setup:
    
    - name: Cache facts
      action:
        module: fact_caching
        cacheable: true
        path: /tmp/fact_cache
    
    - name: Use cached facts
      debug:
        var: ansible_all_ipv4_addresses
