
---
- name: Configure network and update WinRM
  hosts: all
  become: true
  gather_facts: false

  vars:
    ansible_connection: winrm
    ansible_winrm_transport: ntlm
    ansible_winrm_server_cert_validation: ignore

  tasks:
    - name: Configure network
      network_cli:
        lines:
          - netsh interface ipv4 set address "Ethernet" static {{ ansible_host }} 255.255.255.0 10.1.1.254
  - name: Install Chocolatey
      win_chocolatey:
        name: chocolatey
        state: present
    - name: Update WinRM
      win_chocolatey:
        name: winrm
        state: latest
      environment:
        chocolateyProxyLocation: http://{{ ansible_host }}:3128

