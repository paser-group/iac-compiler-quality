
- name: Assign an IAM policy to a user
  community.aws.iam_policy:
    name: policy
    policy_document:
      Version: '2012-10-17'
      Statement:
        - Effect: Allow
          Action:
            - ec2:* 
          Resource: "*"

- name: Modify IAM Policy parameters and test policy enforcement
  community.aws.iam_policy:
    name: policy
    policy_document:
      Version: '2012-10-17'
      Statement:
        - Effect: Allow
          Action:
            - ec2:Create*
          Resource: "*"

- name: Launch an EC2 instance and check IAM policy enforcement
  community.aws.ec2:
    key_name: ansible_ssh_key
    instance_type: t2.micro
    image: ami-04b9e92b5572fa0d1
    wait: true
    state: running
  when: "ansible_play_batch_index == 0"
