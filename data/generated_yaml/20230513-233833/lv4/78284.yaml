yaml
- name: Test machine account Authentication for GCP
  hosts: localhost
  tasks:
    # ensure that gcp python modules are installed
    - name: Install GCP modules
      pip:
        name: google-auth google-auth-oauthlib google-auth-httplib2 google-cloud-storage
        state: present

    # set GCP environment variables needed for authentication
    - name: Set GCP environment variables
      set_fact: 
        credentials_file: "/path/to/gcp/credentials.json" # path to service account key with necessary GCP roles to perform operations against the GCP projects
        project_id: "my_project" # <my_project> is the desired project id

    # test machine account authentication against GCP with inventory plugin
    - name: Test machine account authentication against GCP with inventory plugin
      inventory_plugin:
        plugin: gcp_compute
        auth_kind: machineaccount
        project_id: "{{ project_id }}"
        service_account_file: "{{ credentials_file }}"
