
---
- hosts: docker_nodes
  become: true
  vars:
    service_name: "webapp"
    network_name: "my_network"
  tasks:
  - name: Create network
    docker_network:
      name: "{{ network_name }}"
  - name: Create service
    docker_service:
      name: "{{ service_name }}"
      image: "nginx"
      network: "{{ network_name }}"
  - name: Start service
    docker_service:
      name: "{{ service_name }}"
      state: started
  - name: Try to start a non-existent service
    docker_service:
      name: "non-existent"
      state: started
    ignore_errors: yes
  - name: Stop service
    docker_service:
      name: "{{ service_name }}"
      state: stopped
  - name: Try to stop a stopped service
    docker_service:
      name: "{{ service_name }}"
      state: stopped
    ignore_errors: yes
  - name: Remove service
    docker_service:
      name: "{{ service_name }}"
      state: absent
  - name: Remove network
    docker_network:
      name: "{{ network_name }}"
