
---
- name: nxos_install_os_errors playbook
  hosts: nxos_devices
  gather_facts: no
  vars:
    ansible_connection: nxapi  # or cli
  tasks:
    - name: Install OS on nxos devices
      nxos_command:
        commands:
          - install all kickstart bootflash:nxos.7.0.3.I7.3.bin system bootflash:nxos.7.0.3.I7.3.bin
      register: install_output
      ignore_errors: true
      when: ansible_connection == "nxapi"

    - name: Install OS on nxos devices
      nxos_install_os:
        host: "{{ inventory_hostname }}"
      register: install_output
      ignore_errors: true
      when: ansible_connection == "cli"

    # Log any errors that occur during OS installation
    - name: Log errors during OS installation
      debug:
        var: install_output
