
- hosts: all
  tasks:
    - name: Check DescribeSubnet operation
      ec2_vpc_subnet_facts:
        region: "{{ region }}"
        subnet_ids: "{{ subnet_id }}"
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
      register: subnet
      ignore_errors: yes

    - name: Fail if RequestLimitExceeded error is caught
      fail:
        msg: "RequestLimitExceeded error was detected."
      when: "'aws_request_limit_exceeded' in subnet.msg"
