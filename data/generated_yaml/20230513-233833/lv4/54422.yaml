
---
- name: Test gcp_iam_service_account_module
  hosts: all
  gather_facts: no
  
  vars:
    project_id: "my-project"
    service_account_email: "my-service-account@my-project.iam.gserviceaccount.com"
  
  tasks:
    - name: Get service account info
      gcp_iam_service_account_info:
        project: "{{ project_id }}"
        email: "{{ service_account_email }}"
      register: service_account_info
  
    - name: Create service account
      gcp_iam_service_account:
        project: "{{ project_id }}"
        service_account_name: "{{ service_account_email }}"
        account_id: "my-service-account"
        display_name: "My Service Account"
      when: not service_account_info.service_account
