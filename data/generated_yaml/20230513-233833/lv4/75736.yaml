
- name: Test sudo with password
  hosts: all
  become: true
  gather_facts: no
  tasks:
    - name: Test sudo with password
      debug:
        msg: "Sudo with password should prompt for password"
      become: true
      become_method: sudo
      ignore_errors: yes
    - name: Test sudo password error
      shell: echo "sudo is available" 
      become: true
      become_method: sudo
      register: result
      ignore_errors: yes
    - name: Check sudo password error
      debug:
        msg: "Sudo password error detected - {{ item }}"
      with_items: "{{ result.stderr_lines }}"
      when: "'incorrect password' in item"
