
---
- hosts: all
  gather_facts: false
  vars:
    any_errors_fatal: false
  tasks:
    - name: Perform an operation that may fail
      shell: some_command
      register: result
      ignore_errors: true
      any_errors_fatal: "{{ any_errors_fatal }}"
    - name: Set any_errors_fatal dynamically
      set_fact:
        any_errors_fatal: true
        when: "result.rc != 0"
