
---
- hosts: all
  tasks:
    - name: Install Slack callback plugin
      pip:
        name: 'ansible-callback-slack'
        state: present

    - name: Configure Slack callback plugin
      ansible.builtin.set_fact:
        slack_webhook_url: '<<SLACK_WEBHOOK_URL>>'
        slack_channel: '<<SLACK_CHANNEL>>'
        slack_username: '<<SLACK_USERNAME>>'
        slack_icon_emoji: '<<SLACK_ICON_EMOJI>>'
      vars:
        slack_webhook_url: ''
        slack_channel: ''
        slack_username: ''
        slack_icon_emoji: ''

    - name: Test Slack callback plugin
      shell: echo 'Testing Slack callback plugin'
      register: msg

      notify: 
        - Slack Notification

  handlers:
    - name: Slack Notification
      slack:
        text: "{{ msg.stdout }}"
        webhook_url: "{{ slack_webhook_url }}"
        channel: "{{ slack_channel }}"
        username: "{{ slack_username }}"
        icon_emoji: "{{ slack_icon_emoji }}"
