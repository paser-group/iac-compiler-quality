
---
- name: Discover bugs in the vmware_guest module
  hosts: all
  gather_facts: no
  vars:
    vm_hostname: "myVM"
    vm_name: "ansible-vm"
    vm_folder: "ansible_folder"
    vm_datastore: "ansible_datastore"
    vm_disk_size_gb: 16
    vm_cpus: 1
    vm_memory_mb: 512
    vm_template: "ubuntu_template"
    vm_network_name: "VM Network"
 
  tasks:
  - name: Create a VMware guest
    vmware_guest:
      hostname: "{{ vm_hostname }}"
      username: "{{ vm_username }}"
      password: "{{ vm_password }}"
      folder: "{{ vm_folder }}"
      name: "{{ vm_name }}"
      datastore: "{{ vm_datastore }}"
      disk_size_gb: "{{ vm_disk_size_gb }}"
      num_cpus: "{{ vm_cpus }}"
      memory_mb: "{{ vm_memory_mb }}"
      template: "{{ vm_template }}"
      network_name: "{{ vm_network_name }}"
      permission: "invalid_permission"  # Generate a permission error 
    register: vmware_guest_output
    check_mode: no
    
  - name: Inspect the debug msg
    debug:
      var: vmware_guest_output
    
  - name: Forcefully fail the playbook
    fail:
      msg: "The playbook failed as expected. Please check the debug output to identify the error"
    
