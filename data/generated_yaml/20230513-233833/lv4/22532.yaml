
---
- name: Test esg_asg module for bugs
  hosts: all
  gather_facts: no

  tasks:
  - name: Create ASG
    ec2_asg:
      region: "{{ aws_region }}"
      group_name: "{{ asg_name }}"
      availability_zones: "{{ zones }}"
      launch_config_name: "{{ lc_name }}"
      min_size: "{{ min_size }}"
      max_size: "{{ max_size }}"
      desired_capacity: "{{ desired_capacity }}"
      state: present
    delegate_to: "{{ item }}"
    with_items: "{{ groups['esg'] }}"

  - name: Delete ASG
    ec2_asg:
      region: "{{ aws_region }}"
      name: "{{ asg_name }}"
      state: absent
    delegate_to: "{{ item }}"
    with_items: "{{ groups['esg'] }}"
