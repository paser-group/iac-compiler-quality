
- name: Ansible playbook to uncover role parameter comparison error
  hosts: all
  remote_user: root
  gather_facts: no
  vars:
    network: node-net
    node1: 10.1.1.1
    node2: 10.1.1.2
    node3: 10.1.1.3
  tasks:
  - name: Create a sample comparison test environment
    block:
    - name: Create inventory
      template:
        src: inventory.j2
        dest: inventory
    - name: Create group vars
      block:
      - name: Create roles for nodes
        block:
        - name: Create roles directory
          file:
            path: roles
            state: directory
        - name: Create role for node_1
          file:
            path: roles/node_1
            state: directory
        - name: Create role for node_2
          file:
            path: roles/node_2
            state: directory
        - name: Create role for node_3
          file:
            path: roles/node_3
            state: directory
        - name: Assign roles to nodes
          set_fact:
            node_1_role: ['worker', 'db_server']
            node_2_role: ['web_server']
            node_3_role: ['worker', 'web_server']
      - name: Create group vars directory
        file:
          path: group_vars
          state: directory
      - name: Create group vars for nodes
        block:
        - name: Create group_vars for node_1
          template:
            src: group_vars.j2
            dest: group_vars/node_1.yaml
        - name: Create group_vars for node_2
          template:
            src: group_vars.j2
            dest: group_vars/node_2.yaml
        - name: Create group_vars for node_3
          template:
            src: group_vars.j2
            dest: group_vars/node_3.yaml
    rescue:
    - name: Clean up if any task fails
      block:
      - name: Remove inventory
        file:
          path: inventory
          state: absent
      - name: Remove group vars
        file:
          path: group_vars
          state: absent
      - name: Remove roles
        file:
          path: roles
          state: absent
