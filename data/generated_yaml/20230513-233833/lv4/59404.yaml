
- name: Task to execute command that returns an error
  hosts: all
  gather_facts: no
  tasks:
    - name: Execute a failing command
      command: "{{ command }}"
      register: command_output
      failed_when: command_output.rc != 0

- name: Task to verify error message handling by Ansible
  hosts: all
  gather_facts: no
  tasks:
    - name: Fail task if error message is incorrect
      fail:
        msg: "Ansible failed to correctly handle ERROR message in output"
      when: "'ERROR' in command_output.stderr_lines"
