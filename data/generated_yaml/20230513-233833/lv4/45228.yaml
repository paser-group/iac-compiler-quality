
- name: Retrieve EC2 Metadata
  hosts: all
  gather_facts: no
  tasks:
    - name: Get EC2 instance metadata
      ec2_metadata_facts:
        aws_secret_key: "{{ secret_key }}"
        aws_access_key: "{{ access_key }}"
      register: ec2_metadata
    - name: Display role name
      debug:
        var: ec2_metadata.iam_info.InstanceProfileArn.split("/")[-1]
