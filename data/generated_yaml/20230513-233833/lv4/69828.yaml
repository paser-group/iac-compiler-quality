
---
- name: Check WinRM connectivity on localized Windows Server 2012R2
  hosts: win2012r2
  gather_facts: no
  tasks:
    - name: Install pywinrm
      pip:
        name: pywinrm
        state: present

    - name: Set WinRM transport to credssp
      set_fact:
        ansible_connection: credssp

    - name: Execute command on Windows Server 2012R2
      win_command: echo "WinRM connectivity test successful" >> C:\test.log
      register: result
      failed_when: result.rc != 0

  vars:
    ansible_user: username
    ansible_password: password
    ansible_port: 5986
    ansible_winrm_transport: credssp
    ansible_winrm_server_cert_validation: ignore

  vars_files:
    - /path/to/credentials.yml

  inventory:
    win2012r2:
      hosts:
        target1:
          ansible_host: 10.1.1.1
          ansible_winrm_locale: fi-FI
        target2:
          ansible_host: 10.1.1.2
          ansible_winrm_locale: ru-RU
        target3:
          ansible_host: 10.1.1.3
          ansible_winrm_locale: en-US
