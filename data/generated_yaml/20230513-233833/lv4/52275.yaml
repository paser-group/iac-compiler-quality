
- hosts: all
  become: true
  tasks:
    - name: Install virtualenv module
      pip:
        name: virtualenv

    - name: Create a virtual environment
      virtualenv:
        path: "/example/virtualenv"
        virtualenv_command: "virtualenv --python=/usr/bin/python3.6 --no-site-packages"

    - name: Install a package in the virtual environment
      pip:
        name: ansible
        virtualenv: "/example/virtualenv"
        virtualenv_python: "/example/virtualenv/bin/pip"

    - name: Execute a command in the virtual environment
      command: |
        source /example/virtualenv/bin/activate
        ansible --version
