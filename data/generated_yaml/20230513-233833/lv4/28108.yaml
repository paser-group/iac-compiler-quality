
---
- name: Test WinRM connection
  hosts: windows
  gather_facts: no
  vars:
    ansible_connection: winrm
    ansible_winrm_server_cert_validation: ignore

  tasks:
  - name: Execute long-running command
    win_shell: |
      $i=1 
      while($true) { 
        Write-Host "Iteration: $i" 
        $i++ 
        Start-Sleep -seconds 10 
      }
    register: winrm_output
    ignore_errors: true
