
- name: Set up GCP Inventory plugin with no service account email
  hosts: localhost
  tasks:
    - name: Copy GCP credential file to local machine
      fetch:
        src: "/path/to/gcp/credential/file"
        dest: "{{ playbook_dir }}"

    - name: Set environment variable for credential file
      environment:
        GOOGLE_APPLICATION_CREDENTIALS: "{{ playbook_dir }}/credential_file.json"

    - name: Remove service account email from credential file
      replace:
        path: "{{ playbook_dir }}/credential_file.json"
        regexp: '"client_email": ".*?"'
        replace: '"client_email": ""'

- name: Test GCP Inventory plugin with no service account email
  hosts: all
  gather_facts: false
  tasks:
    - name: Ping all hosts
      ping:
