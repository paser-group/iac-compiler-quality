
---
- name: Check if instances are ready
  hosts: all
  become: true
  vars:
    asg_name: "my-asg"
  tasks:
  - name: Gather ASG info
    ec2_asg_info:
      name: "{{ asg_name }}"
    register: asg_info

  - name: Wait for instances to be ready
    wait_for:
      timeout: 900
      delay: 10
      host: "{{ asg_info['instances'][0]['private_ip_address'] }}"
      port: 22
