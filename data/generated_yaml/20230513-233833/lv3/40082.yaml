
- name: Testing dynamic inventory issue
  hosts: all
  gather_facts: no
  tasks:
    - add_host:
        name: "{{ item }}"
        groups: "test-group"
      with_items: "{{ lookup('env', 'INVENTORY') }}"
      when: "'INVENTORY' in lookup('env', '')"
    - debug:
        var: groups['test-group']

  pre_tasks:
    - name: Check if file present in remote machine
      stat:
        path: "/etc/machine-id"
      register: path_status

  vars:
    inventory: "{{ lookup('env','INVENTORY_FILE') }}"
  
  #
  # ... Other tasks related to the playbook
  #
