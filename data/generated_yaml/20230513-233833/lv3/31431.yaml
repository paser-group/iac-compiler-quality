
---
- name: Encrypt file with Vault
  hosts: all
  tasks:
    - name: Create file
      file:
        path: /tmp/secret.txt
        state: touch
        mode: '0600'
    - name: Add secret
      lineinfile:
        path: /tmp/secret.txt
        line: 'supersecret'
    - name: Encrypt file
      shell: ansible-vault encrypt /tmp/secret.txt --passphrase secret-key
      args:
        chdir: /tmp
        executable: /bin/bash
