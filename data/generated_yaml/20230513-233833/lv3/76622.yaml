
---
- name: Test OpenStack Inventory Plugin
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate OpenStack Dynamic Inventory
      os_server:
        state: present
        auth:
          auth_url: <auth_url>
          username: <username>
          password: <password>
          project_name: <project_name>
          project_domain_id: <project_domain_id>
          user_domain_id: <user_domain_id>
        image: <image_name>
        flavor: <flavor_name>
        name: <server_name>
        key_name: <keypair_name>
        network: <network_name>
        scheme: <url_scheme>
        region_name: <region_name>
      register: os_inventory

    - name: Print OpenStack Dynamic Inventory
      debug:
        var: os_inventory

    - name: Execute task with retrieved inventory
      ping:
      delegate_to: "{{ item }}"
      with_items: "{{ groups['openstack_instances'] }}"

  