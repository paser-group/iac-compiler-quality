
---
- name: Testing gather_facts propagation issues
  hosts: all
  gather_facts: false
  tasks:
    - name: Get the hostname of remote hosts
      command: hostname
      register: remote_hostname

    - name: Print the remote hostname
      debug:
        var: remote_hostname.stdout

    - name: Gather remote facts
      setup:

    - name: Print the IP address of the remote hosts
      debug:
        var: ansible_all_ipv4_addresses

    - name: Testing gather_facts propagation
      debug:
        msg: "{{ hostvars[item]['ansible_all_ipv4_addresses'] }}"
      with_items: "{{ groups['all'] }}"
