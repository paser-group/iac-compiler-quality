
- name: "Grant priviliges to user in postgres"
  hosts: node1
  become: true
  vars:
    dbname: "testdb"
    username: "testuser"
    privs: "ALL"
  tasks:
  - name: "Grant all access to user"
    postgresql_privs:
      db: "{{dbname}}"
      user: "{{username}}"
      privs: "{{privs}}"
    register: grant_output
  - debug:
      var: grant_output

# Remove priviliges 
- name: "Remove priviliges from user in postgres"
  hosts: node2
  become: true
  vars:
    dbname: "testdb"
    username: "testuser"
    privs: "SELECT"
  tasks:
  - name: "Remove selective access from user"
    postgresql_privs:
      db: "{{dbname}}"
      user: "{{username}}"
      privs: "{{privs}}"
    register: grant_output
  - debug:
      var: grant_output

# Backup priviliges 
- name: "Backup priviliges in postgres"
  hosts: node3
  become: true
  vars:
    dbname: "testdb"
    username: "testuser"
    privs: "BACKUP"
  tasks:
  - name: "Backup only priviliges to user"
    postgresql_privs:
      db: "{{dbname}}"
      user: "{{username}}"
      privs: "{{privs}}"
    register: grant_output
  - debug:
      var: grant_output
