
- name: Provision and Manage Security Groups in AWS
  hosts: localhost
  vars:
    aws_access_key: "ACCESS_KEY"
    aws_secret_key: "SECRET_KEY"
    region: "us-east-1"
    security_group_name: "my-security-group"
  tasks:
    - name: Create Security Group
      local_action:
        module: ec2_group
        name: "{{ security_group_name }}"
        description: "security group for my app"
        region: "{{ region }}"
        rules:
          - proto: tcp
            from_port: 22
            to_port: 22
            cidr_ip: 0.0.0.0/0
          - proto: tcp
            from_port: 80
            to_port: 80
            cidr_ip: 0.0.0.0/0
    - name: Add Security Group Rule by Group Name
      local_action:
        module: ec2_group_rule
        name: "{{ security_group_name }}"
        region: "{{ region }}"
        proto: tcp
        from_port: 443
        to_port: 443
        group_name: "{{ security_group_name }}"
