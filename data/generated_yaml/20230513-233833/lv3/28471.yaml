yaml
---
- hosts: localhost
  gather_facts: True

  tasks:
  - name: Create a new VM
    vmware_guest:
      hostname: '{{ vcenter_hostname }}'
      username: '{{ vcenter_username }}'
      password: '{{ vcenter_password }}'
      name: '{{ vm_name }}'
      template: '{{ template_name }}'
      datacenter: '{{ datacenter_name }}'
      folder: '{{ folder_name }}'
      disk:
        - size_gb: '{{ disk_size_gb }}'
          type: '{{ disk_type }}'
      networks:
        - name: '{{ network_name }}'
      hardware:
        memory_mb: '{{ memory }}'
        num_cpus: '{{ num_cpus }}'
      state: present

  - name: Gather facts of created VM
    vmware_vm_facts:
      hostname: '{{ vcenter_hostname }}'
      username: '{{ vcenter_username }}'
      password: '{{ vcenter_password }}'
      vm_id: '{{ vm_name }}'
