
---
- name: Testing Ansible Vault
  hosts: node1
  gather_facts: no

  vars:
    sensitive_message: "This is a secret message"

  tasks:

  - name: Create sensitive file
    copy:
      content: "{{ sensitive_message }}"
      dest: /tmp/sensitive.txt

  - name: Encrypt sensitive file with default password
    command: ansible-vault encrypt /tmp/sensitive.txt 

  - name: Print encrypted sensitive file
    command: cat /tmp/sensitive.txt

  - name: Decrypt sensitive file using vault password file
    command: ansible-vault decrypt /tmp/sensitive.txt --vault-password-file /path/to/missing_vault_password.txt
