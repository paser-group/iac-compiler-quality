
- name: Execute PowerShell Script with credential
  hosts: windows
  become: yes

  tasks:
    - name: Copy PowerShell script to remote host
      win_copy:
        src: /path/to/ps/script
        dest: C:\Users\Administrator\script.ps1
        
    - name: Execute PowerShell script with credential
      win_shell: |
        Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force
        $username = "Administrator"
        $password = ConvertTo-SecureString "<password>" -AsPlainText -Force
        $cred = New-Object System.Management.Automation.PSCredential ($username, $password)
        C:\Users\Administrator\script.ps1
      args:
        executable: powershell.exe
        stdin: $cred
