
---
- name: Replicate azure_rm_containerregistry idempotence bug
  hosts: all
  gather_facts: False

  tasks:
  - name: Create Azure Container Registry
    azure_rm_containerregistry:
      resource_group: resource_group_name
      name: test_registry
      admin_enabled: true
      sku: basic
      state: present
    register: acr_created

  - name: Set admin_enabled to false
    azure_rm_containerregistry:
      resource_group: resource_group_name
      name: test_registry
      admin_enabled: false
      sku: basic
      state: present
    when: acr_created is not defined or acr_created.changed
