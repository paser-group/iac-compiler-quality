
---
- name: Recreate IPTables Quoting Issue
  hosts: node1
  become: true

  tasks:
    - name: Add a rule to IPTables chain
      iptables:
        chain: INPUT
        protocol: tcp
        destination_port: 22
        jump: ACCEPT
        # This parameter would cause the issue to occur 
        # as it incorrectly quotes the -I parameter
        rule: -I 'INPUT 1' -s 1.2.3.4/32 -p tcp -m tcp --dport 22 -j ACCEPT

    - name: Remove the added rule from IPTables chain
      iptables:
        chain: INPUT
        protocol: tcp
        destination_port: 22
        jump: ACCEPT
        # This removes the rule that was added in the previous step
        rule: -D INPUT -s 1.2.3.4/32 -p tcp -m tcp --dport 22 -j ACCEPT
