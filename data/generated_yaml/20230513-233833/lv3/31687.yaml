
---
- name: Recreate authorized_key module bug
  hosts: all
  become: true

  vars:
    public_key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDXtCfWmSGHIOWzjPtyd+xXPYLlK53PMnjCZJLhtGPgc4r1GABW/jhtFh2v5UNRdCmeE6A6+tVTFUd4J0K4RSQaJTgF3c7XkxSrZC6XBUmmVjVxDzGGECO4y8G1JVgUaEA6xZDsDcW06ELbMi5GF4WQ5NlJdmQsSpAfWN2Hrq2xaWafMCw86Wz5vCgW7uF5d9th8gFn0SJGcCce/zncRcDUU7y4PSyvEKWfCXmXSZqW9PnTFyE7LhXfgKxgACZxOm9erePDQy5tfOCNSYpWvNisiAxFdTBgOjZ6W1dKQ1dP4MvAh/Ul1IRJGQsQWyx/2AfsbL1UJTG6+CQG9/uQZ user@example.com"

  tasks:
    # Recreating Ansible 2.4 authorized_key module bug
    - name: Add SSH key via authorized_key module
      authorized_key:
        key_options: 'no-port-forwarding'
        key: "{{ public_key }}"
        path: "{{ ansible_user_home }}/.ssh/authorized_keys"
        state: present
