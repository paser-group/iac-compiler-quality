
---
- hosts: localhost
  gather_facts: no

  vars:
    key_name: my_key
    image: ubuntu
    flavor: m1.small
    security_group: default

  tasks:
    - name: Launch instances
      os_server:
        auth:
          auth_url: "http://keystone_host:5000/v2.0"
          username: "admin"
          password: "admin"
          project_name: "admin"
          project_domain_name: "Default"
          user_domain_name: "Default"
        name: "{{ item }}_test_vm"
        key_name: "{{ key_name }}"
        image: "{{ image }}"
        flavor: "{{ flavor }}"
        security_groups: "{{ security_group }}"
        wait: yes
        count: 3
      with_sequence: start=1 end=3
