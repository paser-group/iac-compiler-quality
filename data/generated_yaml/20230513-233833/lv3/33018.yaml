
---
- name: Bitbucket Clone Provisioning with SSH
  hosts: all
  become: yes

  vars:
    ssh_user: "{{ lookup('env', 'SSH_USER') }}"
    ssh_private_key_path: "{{ lookup('env', 'SSH_PRIVATE_KEY_PATH') }}"

  tasks:
  - name: Clone bitbucket repository with SSH key
    become: true
    git:
      repo: "ssh://git@bitbucket.org/<username>/<repository-name>.git"
      dest: /tmp/bitbucket-repo-with-ssh
      version: master
      accept_hostkey: yes
      key_file: "{{ ssh_private_key_path }}"
      clone: yes
      update: yes
