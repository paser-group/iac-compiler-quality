
- name: Create VM with mem_reservation set to 0
  hosts: node1
  gather_facts: no
  vars:
    vm_name: test_vm
    datastore: datastore1
    mem_reservation: 0
  vars_prompt:
    - name: "vm_username"
      prompt: "Enter a username for the VM"
      private: no
  tasks:
    - name: Create Virtual Machine with mem_reservation set to 0
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        datastore: "{{ datastore }}"
        name: "{{ vm_name }}"
        folder: "{{ folder_name }}"
        hardware:
          memory_mb: "{{ vm_memory_size }}"
          mem_reservation: "{{ mem_reservation }}"
        networks:
          - name: "{{ network_name }}"
        operating_system_id: "{{ vm_guest_id }}"
        state: poweredon
      register: vm

    - name: Display virtual machine info
      debug:
        var: vm
