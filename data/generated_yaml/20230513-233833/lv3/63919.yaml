
---
- name: Recreating 'lineinfile: error creating file without directory path' issue
  hosts: all
  gather_facts: no
  tasks:
    - name: Creating directory for file
      file:
        path: /tmp/test
        state: directory
      register: dir_created
    - name: Creation of a file without directory path
      touch:
        path: /tmp/newfile.txt
    - name: Add line to file without directory path
      lineinfile:
        path: "/tmp/newfile.txt"
        line: "# Test line"
      register: line_added
      ignore_errors: yes
    - name: Debug output
      debug:
        var: line_added
