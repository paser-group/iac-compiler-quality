
---
- hosts: all
  become: yes

  tasks:
  - name: Create Nova Keypair
    os_keypair:
      auth:
        auth_url: https://example.com:5000
        username: "{{ username }}"
        password: "{{ password }}"
        project_name: "{{ project_name }}"
        project_domain_name: "{{ project_domain_name }}"
        user_domain_name: "{{ user_domain_name }}"
      name: "{{ keypair_name }}"
      public_key_file: "{{ pub_key_path }}"
      user_id: "{{ user_id }}"
    register: keypair_output

  - name: Delete Nova Keypair
    os_keypair:
      auth:
        auth_url: https://example.com:5000
        username: "{{ username }}"
        password: "{{ password }}"
        project_name: "{{ project_name }}"
        project_domain_name: "{{ project_domain_name }}"
        user_domain_name: "{{ user_domain_name }}"
      name: "{{ keypair_name }}",
      user_id: "{{ user_id }}"
      state: absent
