yaml
---
- name: Check SSH connections on remote nodes
  hosts: all
  gather_facts: false

  tasks:
  - name: Check SSH connection on remote nodes
    command: ssh -o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=5 {{ inventory_hostname }} exit
    register: ssh_status
    ignore_errors: true

  - name: Report SSH connection status
    debug:
      msg: "SSH connection failed to node '{{ inventory_hostname }}' with error code '{{ ssh_status.rc }}' and error message '{{ ssh_status.stderr }}'"
    when: ssh_status.rc != 0
