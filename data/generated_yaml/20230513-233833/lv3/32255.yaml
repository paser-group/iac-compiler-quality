
---
- name: Testing max_fail_percentage parameter
  hosts: all
  gather_facts: no

  vars:
    max_fail_percentage: 50

  tasks:
    - name: Simulating failure with script
      shell: "/bin/sh -c 'if [ $((RANDOM % 6)) -eq 0 ]; then exit 1; fi'"

    - name: print hosts
      debug:
        msg: "{{ inventory_hostname }}"

  max_fail_percentage_action: ignore_errors
