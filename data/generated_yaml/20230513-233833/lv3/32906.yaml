
---

- hosts: node1,node2,node3
  gather_facts: false

  tasks:
    - name: Copy a file to the nodes
      copy:
        src: "/tmp/file.txt"
        dest: "/tmp/file.txt"
    - name: Check the contents of the file
      shell: 'cat /tmp/file.txt'
      register: file_contents

  - name: Print the contents of the file
      debug:
        msg: "{{ file_contents.stdout_lines }}"

- hosts: node1,node2,node3
  gather_facts: false
  become: yes

  tasks:
    - name: Restart a service
      service:
        name: apache2
        state: restarted
      when: not inventory_hostname == 'node2'
