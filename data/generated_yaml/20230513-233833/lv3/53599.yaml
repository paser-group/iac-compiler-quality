
---
- name: Test ec2_instance module
  hosts: localhost
  gather_facts: no
  vars:
    image_id: ami-0c55b159cbfafe1f0
    instance_type: t2.micro
  tasks:
  - name: Create a new EC2 instance with invalid network-interface specification
    ec2_instance:
      key_name: ansible
      region: us-east-1
      image_id: "{{ image_id }}"
      instance_type: "{{ instance_type }}"
      network_interfaces:
        - device_index: 0
          subnet_id: subnet-12345678
          groups: sg-12345678
          delete_on_termination: true
      wait: true
      count: 1
    register: ec2
  - name: Print debug message if the EC2 instance creation failed
    debug:
      var: ec2
    failed_when: ec2 is failed
