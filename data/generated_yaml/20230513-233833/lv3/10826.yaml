
---
- name: SSH ControlPath should not be overridden by default
  hosts: all
  gather_facts: False

  tasks:
    # Set the default ControlPath by overriding the ansible_ssh_common_args parameter
  - name: Override ControlPath by default
    set_fact:
      ansible_ssh_common_args: "-o ControlPath=/tmp/ansible-ssh-%%h-%%p-%%r"

    # Execute an SSH command to a remote machine, which utilizes the ControlPath settings applied above
  - name: Test SSH connection with ControlPath by default
    shell: ssh -o ControlMaster=no -o ControlPath=none {{ inventory_hostname }}
    register: result

  - debug: var=result.stdout_lines
