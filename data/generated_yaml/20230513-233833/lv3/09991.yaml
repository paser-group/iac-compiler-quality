
---
- hosts: all
  become: true
  tasks:
    - name: Clone ansible repo
      git:
        repo: 'https://github.com/ansible/ansible.git'
        dest: '/opt/ansible'
        version: stable-2.9

    - name: Install dependencies
      raw: |
        apt-get update
        apt-get install -y python3-venv libffi-dev python-dev libssl-dev python3-dev build-essential git autoconf libtool

    - name: Set up Ansible environment
      shell: |
        source /opt/ansible/hacking/env-setup
        export SOME_VAR=
      environment:
        ANSIBLE_NOCOLOR: '1'
