
---
- name: Azure Virtual Network Peering Bug Fuzzing
  hosts: localhost
  gather_facts: False

  tasks:
  - name: Create Virtual Network 1
    azure_rm_virtualnetwork:
      resource_group: myResourceGroup
      name: myVirtualNetwork1
      address_prefixes: "10.0.0.0/16"
      location: westus

  - name: Create Virtual Network 2
    azure_rm_virtualnetwork:
      resource_group: myResourceGroup
      name: myVirtualNetwork2
      address_prefixes: "10.1.0.0/16"
      location: eastus

  - name: Create Virtual Network Peering
    azure_rm_virtualnetworkpeering:
      resource_group: myResourceGroup
      virtual_network_name: myVirtualNetwork1
      remote_virtual_network_id: "/subscriptions/{{ subscription_id }}/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVirtualNetwork2"
      allow_virtual_network_access: true
      allow_forwarded_traffic: false
      allow_gateway_transit: true
      use_remote_gateways: false
