
---
- hosts: all
  become: true
  vars:
    spot_price: null # set to null to avoid error
  tasks:
    - name: "Provision EC2 instance"
      ec2:
        key_name: "demokey"
        instance_type: "t2.micro"
        image: "ami-0c94855ba95c71c99"
        wait: yes
        region: "us-east-1"
        count: 1
        spot_price: "{{ spot_price }}"
        user_data: |
          #!/bin/bash
          echo "Hello, World!"
    - name: "Display instance metadata"
      debug:
        msg: "{{ item.public_ip }}"
      with_items:
        - "{{ ec2.instances }}"

