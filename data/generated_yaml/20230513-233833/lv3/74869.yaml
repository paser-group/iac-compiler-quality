
---
- name: Discover network interface and gateway
  hosts: all
  gather_facts: yes
  vars:
    network_interface: "{{ ansible_default_ipv4.interface }}" 
  tasks:
    - name: Verify network default gateway via a shell command
      shell: ip route | head -1 | cut -d' ' -f3
      register: gateway_address

    - name: Debug gateway IP
      debug: var=gateway_address.stdout_lines

    - name: Verify interface IP
      shell: ip addr show {{ network_interface }} scope global | grep inet | awk '{print $2}' | cut -d'/' -f1
      register: interface_address

    - name: Debug interface IP
      debug: var=interface_address.stdout_lines
