
---
- name: Create RHN Channel
  hosts: all
  become: true
  vars:
    rhn_username: <username>
    rhn_password: <password>
    rhn_channel_name: rhn_channel_test
    rhn_channel_label: Test
  tasks:
    - name: Register with RHN
      rhn_register:
        username: "{{ rhn_username }}"
        password: "{{ rhn_password }}"
        baseurl: https://rhn.redhat.com /XMLRPC
        name: "{{ inventory_hostname }}"
        hostname: "{{ inventory_hostname }}"
        channels:
          - "{{ rhn_channel_name }}"
        force_register: true
      register: rhn_registration

    - name: Create an RHN Channel
      rhn_channel:
        state: present
        name: "{{ rhn_channel_name }}"
        label: "{{ rhn_channel_label }}"
        summary: "{{ rhn_channel_name }}"
        description: "{{ rhn_channel_name }}"
        username: "{{ rhn_username }}"
        password: "{{ rhn_password }}"
      register: rhn_channel_creation

    - name: Print Registered Systems Report
      rhn_check:
        username: "{{ rhn_username }}"
        password: "{{ rhn_password }}"
        baseurl: https://rhn.redhat.com /XMLRPC
