
---
- name: Sample playbook to recreate ansible_connection evaluation issue
  hosts: all
  become: true
  tasks:
    - name: execute command on all hosts
      command: "echo 'Hello from {{ inventory_hostname }}'"
      loop:
        - "{{ groups['all'][0] }}"
        - "{{ groups['all'][1] }}"
        - "{{ groups['all'][2] }}"
      when: item in groups['all']
      loop_control:
        loop_var: ansible_host

