
---
- name: Demonstrate incorrect ansible_processor_vcpus fact for containers
  hosts: all
  gather_facts: true

  tasks:
  - name: Display ansible_processor_vcpus fact for all hosts
    debug: var=ansible_processor_vcpus

  - name: Creating a container with limited CPU cores
    docker_container:
      name: c1
      image: ubuntu:latest
      state: started
      cpu_shares: 10

  - name: Display ansible_processor_vcpus fact for the container
    vars:
      ansible_connection: docker
      ansible_host: c1
    debug: var=ansible_processor_vcpus
