
---

- name: Ensure connectivity to MSSQL Server
  hosts: all
  gather_facts: no

  vars:
    server: 10.1.1.1
    port: 1433
    database: test_db
    user: test_user
    password: test_password

  tasks:

  - name: Install pymssql
    apt:
      name: python-pymssql
      state: present

  - name: Verify MSSQL Server connection
    mssql_db:
      server: "{{ server }}"
      port: "{{ port }}"
      database: "{{ database }}"
      login_password: "{{ user }}:{{ password }}"
      login_host: "{{ ansible_host }}"
      state: dump
