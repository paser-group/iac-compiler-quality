
---
- name: Playbook to reproduce register variable issue with --check option
  hosts: all
  gather_facts: false
  tasks:

  - name: installing python for testing
    raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
    register: output
    changed_when: false

  - name: Register variable test
    command: "ls /not/existing/dir"
    register: result
    failed_when: false

  - name: Display output
    debug:
      var: output.stdout_lines

  - name: Display Result
    debug:
      var: result.stdout_lines
    when: result|success
