
---
- name: Set EC2 tags
  hosts: tag_nodes
  gather_facts: no
  tasks:
    - name: Set EC2 tags
      ec2_tag:
        resource: "{{ item.id }}"
        region: "{{ inventory_hostname.split('.')[1] }}"
        tags:
          Name: "{{ item.name }}"
      with_items: "{{ ec2_instance_info.instances }}"
  vars:
    ec2_instance_info: "{{ query('ec2_instance_info', region='{{ inventory_hostname.split('.')[1] }}') }}"
