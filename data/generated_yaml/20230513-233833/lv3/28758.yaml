
# win_shortcut_idempotency.yml
---

- name: Ensure Windows shortcut idempotency
  hosts: windows
  become: true
  vars:
    shortcut_name: 'Example Shortcut'
    shortcut_src: 'c:\Program Files\Example\example.exe'
    shortcut_dest: 'C:\Users\Public\Desktop\Example Shortcut.lnk'
    shortcut_arguments: '-a arg1 -b arg2'
    shortcut_description: 'This is an example shortcut.'
    shortcut_hotkey: ''
    shortcut_icon_file: ''
    shortcut_icon_index: ''
    shortcut_state: 'present'

  tasks:

  - name: create shortcut
    win_shortcut:
      name: '{{ shortcut_name }}'
      src: '{{ shortcut_src }}'
      dest: '{{ shortcut_dest }}'
      arguments: '{{ shortcut_arguments }}'
      description: '{{ shortcut_description }}'
      hotkey: '{{ shortcut_hotkey }}'
      icon_file: '{{ shortcut_icon_file }}'
      icon_index: '{{ shortcut_icon_index }}'
      state: '{{ shortcut_state }}'
    when: not(ansible_win_shortcut.exists(name=shortcut_name, src=shortcut_src, dest=shortcut_dest, arguments=shortcut_arguments,description=shortcut_description, hotkey=shortcut_hotkey, icon_file=shortcut_icon_file, icon_index=shortcut_icon_index)))

  - name: delete shortcut
    win_shortcut:
      name: '{{ shortcut_name }}'
      src: '{{ shortcut_src }}'
      dest: '{{ shortcut_dest }}'
      arguments: '{{ shortcut_arguments }}'
      description: '{{ shortcut_description }}'
      hotkey: '{{ shortcut_hotkey }}'
      icon_file: '{{ shortcut_icon_file }}'
      icon_index: '{{ shortcut_icon_index }}'
      state: 'absent'
    when: ansible_win_shortcut.exists(name=shortcut_name, src=shortcut_src, dest=shortcut_dest, arguments=shortcut_arguments,description=shortcut_description, hotkey=shortcut_hotkey, icon_file=shortcut_icon_file, icon_index=shortcut_icon_index)
