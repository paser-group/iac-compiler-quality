
---
- name: Ansible MAKE Error Playbook
  hosts: all
  gather_facts: no
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
  - name: Install dependencies
    become: yes
    apt:
      name: "{{ item }}"
    with_items:
      - git
      - python3
      - python3-dev
      - python3-setuptools
      - python3-pip
      - build-essential
  - name: Clone Ansible Git repository
    git:
      repo: https://github.com/ansible/ansible.git
      dest: /opt/ansible
      version: stable-2.10
  - name: Configure Ansible
    shell: ./configure
    args:
      chdir: /opt/ansible
  - name: Modify Makefile to expose bug
    shell: sed -i 's/-DNCCLIENT_ENABLED/-DFATAL_SHOULDNT_HAVE_THIS/g' Makefile
    args:
      chdir: /opt/ansible
  - name: Build Ansible with MAKE errors
    shell: make
    args:
      chdir: /opt/ansible
