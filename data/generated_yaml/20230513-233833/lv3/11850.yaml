
---
- name: Playbook to expose shell module issue
  hosts: all
  gather_facts: no

  tasks:
    - name: Execute command with non-zero exit code
      shell: /path/to/command
      register: cmd_output
      ignore_errors: true
    
    - name: Execute command with zero exit code
      shell: /path/to/success/command
      register: success_cmd_output

    - name: Fail if non-zero exit code is not returned
      fail:
        msg: "Non-Zero exit code not returned"
      when: cmd_output.rc != 0
