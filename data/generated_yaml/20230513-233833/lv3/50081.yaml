
---
- name: Ansible Playbook for recreating rds_instance error with PerformanceInsightsEnabled
  hosts: all
  gather_facts: no

  tasks:
    - name: Create an RDS Database Instance
      rds_instance:
        command: create
        region: us-east-1
        instance_name: test-db
        instance_type: db.t2.micro
        allocated_storage: 5
        engine: MySQL
        username: testuser
        password: testpassword
        PerformanceInsightsEnabled: "{{ item }}"
      with_items:
        - true
        - false

    - name: Finalize the RDS Database Instance
      rds_instance:
        command: modify
        region: us-east-1
        instance_name: test-db
        apply_immediately: yes
        PerformanceInsightsEnabled: "{{ item }}"
      with_items:
        - true
        - false
