
---
- name: Test playbook
  hosts: all
  gather_facts: no
  vars:
    user: testuser
    password: badpassword
  tasks:
  - name: Attempt authentication using bad password
    expect:
      command: ssh {{ user }}@{{ inventory_hostname }}
      responses:
        (?i)password: "{{ password }}"
    register: output
  - debug: var=output
