
---
- name: recreate apt_repository performance issue
  hosts: node1,node2,node3
  become: true
  tasks:
    - name: Install apt-transport-https
      apt:
        name: apt-transport-https
        state: present

    - name: Add repository URL to sources.list
      apt_repository:
        repo: "deb {{ url }} focal main"
        state: present
        update_cache: yes
      vars:
        url: http://archive.ubuntu.com/ubuntu

      loop: "{{ range(10)|list }}"

    - name: Update the apt cache
      apt:
        update_cache: yes

    - name: Install a sample package
      apt:
        name: htop
        state: present
  ...
