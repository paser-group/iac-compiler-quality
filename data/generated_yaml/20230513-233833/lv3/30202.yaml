
- name: Create EC2 security groups
  hosts: localhost
  gather_facts: False
  vars:
    groups:
      - name: default
        description: Default group
        rules:
          - proto: tcp
            from_port: 22
            to_port: 22
            cidr_ip: 0.0.0.0/0
          - proto: tcp
            from_port: 80
            to_port: 80
            cidr_ip: 0.0.0.0/0
      - name: default
        description: Another default group
        rules:
          - proto: all
            cidr_ip: 0.0.0.0/0
  tasks:
    - name: Create security group
      ec2_group:
        name: "{{ item.name }}"
        description: "{{ item.description }}"
        region: "{{ region }}"
        rules: "{{ item.rules }}"
        vpc_id: "{{ vpc_id }}"
      with_items: "{{ groups }}"
