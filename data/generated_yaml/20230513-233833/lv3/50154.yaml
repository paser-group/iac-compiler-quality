
---
- name: Demonstrate subelements filter bug
  hosts: all
  gather_facts: false
  tasks:
    - name: Set variables
      set_fact:
        outer_list:
          - inner_list:
              - item1
              - item2
          - inner_list:
              - item3
              - item4

    - name: Include tasks with subelements filter
      include_tasks: subelements_task.yml
      delegate_to: "{{ item }}"
      with_items:
        - "{{ groups['node1'] }}"
        - "{{ groups['node2'] }}"
        - "{{ groups['node3'] }}"

    - name: Output variables for debugging
      debug:
        var:
          outer_list
