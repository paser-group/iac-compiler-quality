
- name: Recreate Azure RM virtual machine batch error
  hosts: localhost
  gather_facts: false

  vars:
    vm_name: testvm
    location: eastus
    storage_account: teststorageaccount
    admin_username: testuser
    admin_password: "{{ lookup('env', 'AZURE_PASSWORD') }}"

  tasks:
    - name: Creating a virtual machine
      azure_rm_virtualmachine:
        resource_group: testrg
        name: "{{ vm_name }}"
        vm_size: Standard_DS1_v2
        admin_username: "{{ admin_username }}"
        admin_password: "{{ admin_password }}"
        network_interface_names: testnsg
        os_disk_name: testosdisk
        os_disk_caching: ReadWrite
        storage_account_name: "{{ storage_account }}"
        os_type: linux
        image:
          offer: UbuntuServer
          publisher: Canonical
          sku: '18.04-LTS'
          version: latest
        location: "{{ location }}"
