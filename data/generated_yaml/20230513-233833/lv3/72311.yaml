
---
- name: Test Ping and SSH
  hosts: all
  gather_facts: no

  tasks:

  - name: Ping Test
    ping:

  - name: Connection Test
    raw: ssh -o StrictHostKeyChecking=no -o ControlMaster=no -o ExitOnForwardFailure=yes -o PasswordAuthentication=no -o "ConnectTimeout=3" -o "ControlPersist=60s" -o "PubkeyAuthentication=yes" ${SSH_USER}@{{ inventory_hostname }} id && echo -e '\033[0;32mHost is reachable and SSH authentication is working.\033[0m' || echo -e  '\033[0;31mHost is down or SSH authentication failed.\033[0m'
