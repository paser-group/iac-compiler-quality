
---
- name: Ansible Redis Fact Cache Issue Playbook
  hosts: all
  gather_facts: true
  vars:
    ansible_fact_caching: redis
    ansible_redis_fact_cache_database: 0
    ansible_redis_fact_cache_host: "{{ inventory_hostname }}"
    ansible_redis_fact_cache_key_prefix: "ansible_fact_cache"
  tasks:
  - name: Test Ansible Redis Fact Cache with --flush-cache flag
    ansible.builtin.command: ansible-playbook playbook.yml --flush-cache
    register: flush_cache_result
    environment:
      PYTHONUNBUFFERED: "1"
    changed_when: ansible_facts_cacheable
  - name: Display the results
    debug:
      msg: "{{ flush_cache_result.stdout_lines }}"
