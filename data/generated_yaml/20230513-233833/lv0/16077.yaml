
import winrm

def run_winrm_command_async():
    # Define remote host details
    host = 'remote_host'
    username = 'username'
    password = 'password'
    
    # Create a WinRM session with the remote host
    session = winrm.Session(host, auth=(username, password))
    
    # Define command to execute remotely
    command = 'dir'
    
    # Run the command asynchronously on the remote host
    return session.run_ps_async(command, ['IgnoreErrors'])

# Execute the WinRM command asynchronously
winrm_task = run_winrm_command_async()

# Wait for the Async task to complete
result = winrm_task.receive()

# Check if the Async task failed
if winrm_task.status == 'failed' and type(winrm_task.error) == winrm.transport.winrm_transport.WinRMTransportError:
    print('Async task failed with WinRMTransportError even when ignore_errors is set to true')
else:
    print('Async task completed successfully')
