
- name: Install packages with apt
  apt:
    name: "{{ item }}"
    state: present
  loop: "{{ packages }}"
  when: ansible_pkg_mgr == 'apt'
  with_items: "{{ packages }}"
  become: true

- name: Install packages with yum
  yum:
    name: "{{ item }}"
    state: present
  loop: "{{ packages }}"
  when: ansible_pkg_mgr == 'yum'
  with_items: "{{ packages }}"
  become: true
