yaml
- name: Reboot if required
  win_reboot:
  register: reboot
- name: Wait for the reboot to complete
  win_wait_for:
    path: '{{ ansible_env.windir }}\\notepad.exe'
    state: present
  when: reboot.changed
  # Increase the reboot timeout to 1200 sec (20 mins)
  failed_when: reboot.failed or reboot.rc != 0 and reboot.elapsed > 1200
  changed_when: reboot.changed
  no_log: true
