
- hosts: web_servers
  become: yes
  any_errors_fatal: true

  tasks:
    - name: Install Apache web server
      apt:
        name: apache2
        state: present

    - name: Configure Apache
      template:
        src: /etc/apache2/apache2.conf.j2
        dest: /etc/apache2/apache2.conf
        owner: root
        group: root
        mode: 0644
      notify: restart apache

  rescue:
    - name: Handle unexpected errors
      mail:
        to: admin@example.com
        subject: "Error on {{ inventory_hostname }}"
        body: "An unexpected error occurred during the playbook run on {{ inventory_hostname }}"

  always:
    - name: Clean up temp files
      file:
        path: /tmp/file.txt
        state: absent
