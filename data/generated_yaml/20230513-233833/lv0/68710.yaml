
- hosts: all
  gather_facts: no
  tasks:
    - name: Loop through items in list
      loop:
        - item1
        - item2
        - item3
      register: loop_results
      ignore_errors: yes
     
    - name: Test for failure in loop results
      set_fact:
        loop_failed: "{{ loop_results.results | selectattr('failed', 'defined') | list }}"
     
    - name: Handle loop failure
      block:
        - debug:
            msg: "Loop passed successfully."
      rescue:
        - name: Handle exception
          debug:
            msg: "Loop failed: {{ ansible_failed_task }}"
