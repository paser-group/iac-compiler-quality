
- name: Fetch EC2 metadata facts
  ec2_metadata_facts:

- name: Get role name
  set_fact:
    role_name: "{{ ansible_ec2_instance_profile.split('/')[-1] }}"

- name: Remove _expiration suffix from role name
  set_fact:
    role_name: "{{ role_name.split('_expiration')[0] }}"
  when: '_expiration' in role_name

- name: Print role name
  debug:
    var: role_name
