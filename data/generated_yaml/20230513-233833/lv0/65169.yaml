yaml
- name: Example playbook
  hosts: imc
  gather_facts: no
  
  vars:
    imc_host: 192.168.1.100
    imc_username: admin
    imc_password: password
  
  tasks:
    - name: Connect to IMC
      imc_rest:
        host: "{{ imc_host }}"
        username: "{{ imc_username }}"
        password: "{{ imc_password }}"
        validate_certs: no
        register: imc_session
  
    - name: Do something
      imc_rest:
        host: "{{ imc_host }}"
        username: "{{ imc_username }}"
        password: "{{ imc_password }}"
        validate_certs: no
        headers:
          sessionkey: "{{ imc_session.session.cookie }}"
        method: GET
        path: /rest/version
        register: result
  
    - name: Disconnect from IMC
      imc_rest:
        host: "{{ imc_host }}"
        username: "{{ imc_username }}"
        password: "{{ imc_password }}"
        validate_certs: no
        headers:
          sessionkey: "{{ imc_session.session.cookie }}"
        method: DELETE
