
- name: Resize disk
  vmware_guest_disk:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ datacenter }}"
    folder: "{{ folder }}"
    name: "{{ vm_name }}"
    disk_size_gb: "{{ new_size_gb }}"
    unit_number: "{{ unit_number }}"
    scsi_controller: "{{ controller_num }}"
    state: present

- name: Restore VM
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ datacenter }}"
    folder: "{{ folder }}"
    name: "{{ vm_name }}"
    template: "{{ template_name }}"
    datastore: "{{ datastore }}"
    disk:
       - size_gb: "{{ disk_size }}"
         type: "{{ disk_type }}"
         controller_type: "{{ controller_type }}"
         datastore: "{{ datastore }}"
         unit_number: "{{ unit_number }}"
         scsi_controller: "{{ controller_num }}"
    networks:
       - name: "{{ network_name }}"
    hardware:
       memory_mb: "{{ memory_mb }}"
       num_cpus: "{{ num_cpus }}"
       scsi: "{{ scsi }}"
  state: poweredon
