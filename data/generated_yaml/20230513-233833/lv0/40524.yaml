
- name: Playbook with local_action
  hosts: remotehost
  become: yes
  tasks:
    - name: Set local environment variables
      set_fact:
        my_var: "my value"
      local_action: shell echo "{{ my_var }}" > /tmp/my_var_file

    - name: Copy local file to remote host
      copy:
        src: /tmp/my_var_file
        dest: /tmp/my_var_file
      delegate_to: localhost
      run_once: true
      become: yes
