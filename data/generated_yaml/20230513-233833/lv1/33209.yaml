yaml
- name: Change Password and Verify Login
  hosts: all
  become: true

  tasks:
    - name: Change the password
      user:
        name: username
        password: "{{ new_password }}"
      failed_when: false

    - name: Verify new password
      command: echo "login successful"
      become_user: username
      register: result

    - name: Check if new password is working
      assert:
        that: "'login successful' in result.stdout"
        msg: "Password change failed"
