yaml
---
- name: Fix "maximum recursion depth exceeded in __instancecheck__" error in FortiOS httpapi
  hosts: all
  gather_facts: false
  vars:
    httpapi_package_state: present
  tasks:
    - name: Install FortiOS httpapi module
      pip:
        name: fortiosapi
        state: "{{ httpapi_package_state }}"

    - name: Verify the issue is resolved
      fortios:
        host: "{{ inventory_hostname }}"
        username: admin
        password: password
        https: true
        verify_cert: false
        register: result
      ignore_errors: yes
      changed_when: false
      when: result.rc != 1
