
- name: Ansible Galaxy - Resolve Unexpected Exception
  hosts: localhost
  gather_facts: no
  vars:
    galaxy_command: ansible-galaxy

  tasks:
    - name: Install Ansible Galaxy
      pip:
        name: ansible-galaxy

    - name: Run Ansible Galaxy Command
      command: "{{ galaxy_command }} install -r requirements.yml"
      register: galaxy_output

    - name: Check for an error
      fail:
        msg: "{{ galaxy_output.stdout_lines }}"
      when:
        # Check if the command failed:
        - "'ERROR!' in galaxy_output.stderr and 'Unexpected Exception' in galaxy_output.stderr"
        # Check if this specific error occurred:
        - "'bool' object is not subscriptable" in galaxy_output.stderr
