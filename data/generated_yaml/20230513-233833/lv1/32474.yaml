
- name: Install ansible and update package keys
  hosts: all
  become: yes
  tasks:
    - name: Add EPEL repo key
      rpm_key:
        key: https://download.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
        state: present
    
    - name: Add Ansible repo key
      rpm_key:
        key: https://releases.ansible.com/ansible/RPM-GPG-KEY-ansible-release.pub
        state: present
    
    - name: Add EPEL repository
      yum_repository:
        name: epel
        description: EPEL YUM repo
        baseurl: https://dl.fedoraproject.org/pub/epel/7/$basearch/
        gpgcheck: yes
        gpgkey: https://download.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
        state: present
    
    - name: Add Ansible repository
      yum_repository:
        name: ansible
        description: Ansible YUM repo
        baseurl: https://releases.ansible.com/ansible/rpm/release/epel-7-x86_64/
        gpgcheck: yes
        gpgkey: https://releases.ansible.com/ansible/RPM-GPG-KEY-ansible-release.pub
        state: present
    
    - name: Ensure latest version of ansible is installed
      yum:
        name: ansible
        state: latest
