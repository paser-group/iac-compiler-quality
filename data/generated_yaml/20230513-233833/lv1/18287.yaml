yaml
---
- hosts: all
  gather_facts: no
  tasks:
    - name: Ping all hosts
      ping:
      ignore_errors: True
      register: ping_result
    
    - name: Handle unreachable hosts
      fail:
        msg: "{{ item.invocation.module_args.host }} unreachable"
      when: "'UNREACHABLE' in ping_result.msg"
      with_items: "{{ ping_result.results }}"
