
---
- name: Deploying VMware content from template
  hosts: all
  gather_facts: false

  vars:
    template_name: "my_template"

  tasks:
    - name: Check if folder exists
      vmware_content_library_folder_info:
        hostname: "{{ vmware_hostname }}"
        username: "{{ vmware_username }}"
        password: "{{ vmware_password }}"
        folder: "{{ vmware_folder }}"
      register: folder_info

    - name: Deploy template
      vmware_content_deploy_template:
        hostname: "{{ vmware_hostname }}"
        username: "{{ vmware_username }}"
        password: "{{ vmware_password }}"
        template: "{{ template_name }}"
        folder_id: "{{ folder_info.folder_id }}"
        validate_certs: false
      delegate_to: localhost
