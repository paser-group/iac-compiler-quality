
---
- name: Dependency variable resolution error fix
  hosts: localhost
  vars:
    http_proxy: http://proxy.example.com:8080
  tasks:
    - name: Install package dependencies
      shell: |
        apt-get update
        DEBIAN_FRONTEND=noninteractive apt-get install -y \
        build-essential \
        python-dev \
        python-pip
      environment:
        http_proxy: "{{ http_proxy }}"
      become: true

    - name: Install Python packages
      shell: |
        pip install -r requirements.txt
      environment:
        http_proxy: "{{ http_proxy }}"
      become: true
