yaml
---
- name: Provision VM in NSX-T on VMC
  hosts: ansible-host
  gather_facts: false
  vars:
    vm_name: my_vm
    vm_template: my_template
    vm_folder: vm_folder_name
    vm_datastore: datastore1
    vm_networks:
      - network_name: nsx-t-network
  tasks:
    - name: Create folder for VM
      vmware_folder:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        folder_name: "{{ vm_folder }}"
        state: present
      delegate_to: localhost
    
    - name: Provision VM from template
      vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        folder: "{{ vm_folder }}"
        name: "{{ vm_name }}"
        template: "{{ vm_template }}"
        datacenter: "{{ datacenter }}"
        datastore: "{{ vm_datastore }}"
        networks: "{{ vm_networks }}"
      delegate_to: localhost

