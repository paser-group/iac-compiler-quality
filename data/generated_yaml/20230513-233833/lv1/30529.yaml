
---
- name: Gather NX-OS Facts
  hosts: nxos-switches
  gather_facts: no

  tasks:
  - name: Validate facts
    nxos_facts:
      gather_subset: all
    register: facts
    ignore_errors: yes

  - name: Exit if gather fails
    fail:
      msg: "{{ facts | to_nice_json }}"
    when: facts.failed

  - name: Print gathered facts
    debug:
      var: facts

  - name: Do something else
    # Add another task here to remediate the issue if you have one
