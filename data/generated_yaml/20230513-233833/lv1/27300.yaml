yaml
---
- name: Correct ansible_pkg_mgr fact after mkosi installation
  hosts: all
  become: true
  
  tasks:
    - name: Update ansible_pkg_mgr fact
      set_fact:
        ansible_pkg_mgr: apt
      when: ansible_pkg_mgr == "apt" and ("mkosi" in ansible_facts.packages)

    - name: Update ansible_pkg_mgr fact
      set_fact:
        ansible_pkg_mgr: dnf
      when: ansible_pkg_mgr == "dnf" and ("mkosi" in ansible_facts.packages)

    - name: Update ansible_pkg_mgr fact
      set_fact:
        ansible_pkg_mgr: pacman
      when: ansible_pkg_mgr == "pacman" and ("mkosi" in ansible_facts.packages)
