yaml
---
- name: Update docker swarm services
  hosts: swarm_manager_node
  gather_facts: false

  tasks:

  - name: Stop services with common prefix
    docker_swarm_service:
      state: stopped
      name: "{{ item }}"
    loop:
      - service1
      - service2
      - service3

  - name: Start updated services
    docker_swarm_service:
      state: started
      name: "{{ item.name }}"
    loop:
      - { name: service1_updated, image: image1_updated }
      - { name: service2_updated, image: image2_updated }
      - { name: service3_updated, image: image3_updated }
