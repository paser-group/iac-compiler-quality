
- name: Set osx_defaults values
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Set default value to an empty array
      osx_defaults:
        key: path/to/defaults/key
        type: array
        value: []
      register: defaults_output

    - name: Add new value to the array
      osx_defaults:
        key: path/to/defaults/key
        type: array
        value: "{{ item }}"
      loop: "{{ new_value | default([]) }}"
      when: item not in defaults_output.stdout_lines
