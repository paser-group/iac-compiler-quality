
- hosts: all
  become: true

  tasks:
    - name: Install package using DNF module
      dnf:
        name: my-package
        state: present
      register: dnf_output
      ignore_errors: true

    - name: Check for RPM scriptlet errors
      fail:
        msg: "RPM scriptlet errors found. See dnf_output.stderr for details."
      when: dnf_output.rc != 0 and "RPM scriptlet errors" in dnf_output.stderr_lines[-1]
