yaml
---

- name: Stop a Windows service
  hosts: windows_servers
  gather_facts: no

  vars:
    service_name: YourServiceName

  tasks:

  - name: Check if the service exists
    win_service:
      name: "{{ service_name }}"
      state: query
    register: service_query

  - name: Stop the service
    win_service:
      name: "{{ service_name }}"
      state: stopped
    when: service_query.exists == True

  - name: Fail if the service does not exist
    fail:
      msg: "The {{ service_name }} service does not exist on the target machine."
    when: service_query.exists == False

...
