
---
- name: Backport fix for interpreter discovery
  hosts: all
  gather_facts: false

  tasks:
    - name: Clone Ansible repository
      git:
        repo: https://github.com/ansible/ansible.git
        dest: /tmp/ansible

    - name: Checkout stable-2.12 branch
      git:
        repo: https://github.com/ansible/ansible.git
        dest: /tmp/ansible
        version: stable-2.12

    - name: Cherry-pick https://github.com/ansible/ansible/pull/77371
      command: git cherry-pick 4f945133

    - name: Install Ansible with fix
      command: pip install /tmp/ansible

    - name: Verify interpreter discovery fix
      command: ansible --version
