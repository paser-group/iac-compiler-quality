
- name: Execute Azure ARM template deployment
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Check if ARM deployment succeeded
      azure_rm_deployment_facts:
        resource_group_name: "{{ resource_group_name }}"
        name: "{{ deployment_name }}"
      register: deployment_status
    - name: Fail if deployment did not succeed
      fail:
        msg: "ARM deployment failed with {{ deployment_status.failed }} errors"
      when: deployment_status.failed != 0
