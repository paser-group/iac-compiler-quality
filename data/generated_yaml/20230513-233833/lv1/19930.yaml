
- hosts: all
  become: true
  vars:
    python_version: python3
  tasks:
  - name: Install Python dependencies
    apt:
      name: "{{ item }}"
      state: present
    with_items:
    - python-pip
    - python3-pip
    - python-dev
    - python3-dev
    - libssl-dev
  - name: Install requests module
    pip:
      name: requests
      executable: "{{ python_version }}"
  - name: Type error with python3 when using basic Authentication with open_url
    uri:
      url: "{{ url }}"
      headers:
        Authorization: "Basic {{ auth }}"
      method: "{{ method }}"
      status_code: "[200,201,202,203]"
      body_format: json
      body: "{{ body }}"
      validate_certs: no
    register: response
  - name: Debug response
    debug:
      var: response
