
---
- name: mysql_db import action fails when database does not exist fix
  hosts: all
  become: true
  tasks:
    - name: Check if the database exists
      mysql_db:
        login_user: root
        login_password: "{{ db_password }}"
        login_host: localhost
        name: "{{ db_name }}"
        state: dump
      register: check_db

    - name: Create the database if it doesn't exist
      mysql_db:
        login_user: root
        login_password: "{{ db_password }}"
        login_host: localhost
        name: "{{ db_name }}"
        state: present
      when: check_db.changed
