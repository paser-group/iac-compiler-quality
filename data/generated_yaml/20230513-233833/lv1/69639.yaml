
---
- hosts: [your_target_hosts]
  gather_facts: true
  
  vars:
    helm_chart_name: [your_helm_chart_name]
    helm_chart_version: [your_helm_chart_version]

  tasks:
    - name: Install helm
      become: true
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - apt-transport-https
        - ca-certificates
        - curl
        - gnupg-agent
        - software-properties-common
      when: ansible_os_family == 'Debian' or ansible_os_family == 'Ubuntu'
      
    - name: Install Helm
      become: true
      command: "{{ item }}"
      with_items:
        - curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
      
    - name: Add Helm Repository
      become: true
      command: "{{ item }}"
      with_items:
        - helm repo add stable https://charts.helm.sh/stable
      
    - name: Update the Helm Repository
      become: true
      command: "helm repo update"
      
    - name: Install the Chart using Helm
      become: true
      community.kubernetes.helm:
        host: "{{ item }}"
        chart:
          name: "{{ helm_chart_name }}"
          version: "{{ helm_chart_version }}"
        state: present
      with_items:
        - [your_target_host_1]
        - [your_target_host_2]
