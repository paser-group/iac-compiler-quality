yaml
- name: AWS S3 Module Error
  hosts: localhost
  vars:
    version_id: "{{ lookup('env', 'VERSION_ID') }}"
    bucket_name: 'my-bucket'
    object_key: 'path/to/my/file.txt'
  tasks:
    - name: Get Object Info
      aws_s3:
        bucket: "{{ bucket_name }}"
        object: "{{ object_key }}"
        version_id: "{{ version_id }}"
        mode: 'stat'
      register: object_info

    - name: Restore Object From Version
      aws_s3:
        bucket: "{{ bucket_name }}"
        object: "{{ object_key }}"
        version_id: "{{ version_id }}"
        mode: 'restore'
      when: object_info['version'] is none
