
---
- name: Playbook to fix WinRM connection issue
  hosts: all
  gather_facts: false

  tasks:
  - name: Check for ignored templating error in hostvars
    debug:
      msg: "Ignored templating error exists in hostvars"
    when: "'ignored_error' in hostvars[inventory_hostname]"

  - name: Fix WinRM Connection plugin
    win_rm:
      winrm_transport: credssp
      credssp_disable_tlsv1_2: true
      credssp_send_cbt: false
    vars:
      ansible_winrm_transport: credssp
      ansible_credssp_disable_tlsv1_2: true
      ansible_credssp_send_cbt: false
