
- name: Set default values on macOS
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Add new array key to defaults
      command: "defaults write {{ item.path }} {{ item.key }} -array-add '{{ item.value }}'"
      with_items:
        - { path: "/Users/{{ ansible_user }}/.ssh/config", key: "Host", value: "example" }
    - name: Verify new key was added
      command: "defaults read {{ item.path }} {{ item.key }}"
      with_items:
        - { path: "/Users/{{ ansible_user }}/.ssh/config", key: "Host" }
  become: true
