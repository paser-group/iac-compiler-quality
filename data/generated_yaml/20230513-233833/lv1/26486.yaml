
---
- name: Fix idempotency error with virt_net module
  hosts: your_hosts_here
  tasks:
    - name: Create virtual network
      virt_net:
         name: my_network
         state: present
         ip_address: 192.168.1.1/24
         mode: route
      register: network_created

    - name: Delete virtual network if it was created
      virt_net:
         name: my_network
         state: absent
      when: not network_created.changed
