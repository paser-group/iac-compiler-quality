yaml
---
- name: Create an EC2 security group
  hosts: localhost

  vars:
    aws_access_key: "your_aws_access_key"
    aws_secret_key: "your_aws_secret_key"
    region: "us-west-1"
    group_name: "my-group"
    group_description: "My security group for EC2 instances"
    vpc_id: "vpc-xxxxxx"
    rules:
      - proto: "tcp"
        from_port: 22
        to_port: 22
        cidr_ip: "0.0.0.0/0"

  tasks:
    - name: Set AWS access credentials
      set_fact:
        ec2_access_key: "{{ aws_access_key }}"
        ec2_secret_key: "{{ aws_secret_key }}"
        region: "{{ region }}"

    - name: Create EC2 security group
      ec2_group:
        name: "{{ group_name }}"
        description: "{{ group_description }}"
        vpc_id: "{{ vpc_id }}"
        region: "{{ region }}"
        rules: "{{ rules }}"
        purge_rules: yes
        purge_rules_egress: yes
        ec2_access_key: "{{ ec2_access_key }}"
        ec2_secret_key: "{{ ec2_secret_key }}"
