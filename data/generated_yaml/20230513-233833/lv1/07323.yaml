
---
- name: RabbitMQ Policy Prioritization 
  hosts: rabbitmq_servers
  
  tasks:
    - name: Install rabbitmq priority queue plugin 
      become: true
      apt:
        name: rabbitmq-plugins
        state: present

    - name: Configure RabbitMQ Policy
      become: true
      rabbitmq_policy:
        vhost: /
        name: prioritize
        pattern: "^mypattern"
        priority: 10
        apply_to: queues
        state: present
