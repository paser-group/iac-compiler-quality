
---
- name: Configure Jenkins for correct Facter information
  hosts: jenkins-server
  become: yes

  tasks:
    - name: Install python-jenkins library
      apt:
        name: python-jenkins
        state: latest

    - name: Update facter cache
      command: facter --cache
      become: yes

    - name: Configure Jenkins to use the correct Facter installation
      lineinfile:
        path: /etc/default/jenkins
        regexp: '^JENKINS_JAVA_OPTIONS'
        line: 'JENKINS_JAVA_OPTIONS="$JENKINS_JAVA_OPTIONS -Djava.awt.headless=true -Dhudson.model.DirectoryBrowserSupport.CSP= -Dorg.jenkinsci.plugins.durabletask.BourneShellScript.HEARTBEAT_CHECK_INTERVAL=300 -Dfacter.path=/usr/local/bin/facter"'

    - name: Restart Jenkins service
      service:
        name: jenkins
        state: restarted
