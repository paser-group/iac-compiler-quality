yaml
- name: Create AWS EC2 spot instance requests
  hosts: localhost
  gather_facts: false
  vars:
    spot_price: "0.01" # Enter the spot price you want to bid

  tasks:
  - name: Create spot instance request
    ec2_instance:
      name: "Spot instance"
      instance_type: "t2.micro"
      spot_price: "{{ spot_price }}"
      image_id: "ami-0d382e80be7ffdae5"
      key_name: "your_keypair_name"
      count: 1
      assign_public_ip: true
      region: "us-east-1"
      wait: no
      group_id: sg-xxxxxxxxxxxxxxx
    register: ec2_spot

  - name: Print spot request ID
    debug: var=ec2_spot.spot_instance_request_ids

  - name: Wait for instances to start
    wait_for:
      delay: 10
      timeout: 300
      host: "{{ item.public_ip }}"
      port: 22
      state: started
    with_items: "{{ ec2_spot.instances }}"
