yaml
---
- name: Run a command and report if it failed
  hosts: all
  become: true
  
  tasks:
    - name: Run a command and register output
      shell: "{{ cmd }}"
      register: cmd_output
      ignore_errors: true
      
    - name: Print output of command
      debug:
        var: cmd_output.stdout_lines
      
    - name: Fail task if command returned non-zero exit code
      fail:
        msg: "Command failed with exit code {{ cmd_output.rc }}"
      when: cmd_output.rc != 0
