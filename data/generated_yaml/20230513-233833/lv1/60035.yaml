
- name: Playbook to handle any_errors_fatal with loops
  hosts: all
  gather_facts: yes
  
  tasks:
    - name: Failure generator
      command: /bin/false
      register: result
      loop:
        - 0
        - 1
        - 2
        - 3

      ignore_errors: true
      any_errors_fatal: true

    - name: Print failed items
      debug:
        var: item
      loop_control:
        label: "{{ 'Failed item #' + (loop.index0|string)}}"
      when: result is failed
