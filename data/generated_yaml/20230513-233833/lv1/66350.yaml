yaml
---
- hosts: all
  become: true

  tasks:
  - name: Add OS security group rule
    os_security_group_rule:
      auth:
        auth_url: "{{ auth_url }}"
        project_name: "{{ project_name }}"
        username: "{{ username }}"
        password: "{{ password }}"
      state: present
      security_group_id: "{{ security_group_id }}"
      direction: "{{ direction }}"
      ethertype: "{{ ethertype }}"
      protocol: "{{ protocol }}"
      port_range_min: "{{ port_range_min }}"
      port_range_max: "{{ port_range_max }}"
      remote_ip_prefix: "{{ remote_ip_prefix }}"
    when: "'rule already exists' not in result.stderr"
