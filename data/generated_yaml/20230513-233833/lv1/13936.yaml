
- name: Fix WinRM issue on Windows machine
  hosts: windows
  gather_facts: false
  tasks:
    - name: Check if WinRM service is running
      win_service:
        name: winrm
        state: started
        start_mode: auto
      register: winrm_service_status

    - name: Start WinRM service if not running
      win_service:
        name: winrm
        state: started
        start_mode: auto
      when: winrm_service_status.state == 'stopped'
