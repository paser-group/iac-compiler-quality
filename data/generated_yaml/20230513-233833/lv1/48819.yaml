yaml
---
- name: Add SSH key to authorized_keys file
  hosts: all
  become: true

  tasks:
    - name: Create SSH directory if needed
      become: true
      file:
        path: "{{ ansible_env.HOME }}/.ssh"
        state: directory
        mode: '0700'

    - name: Add SSH key
      authorized_key:
        user: "{{ ansible_user }}"
        state: present
        key: "{{ lookup('file', ansible_env.HOME + '/.ssh/id_rsa.pub') }}"
