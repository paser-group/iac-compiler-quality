
---
- name: Configure User Home Directory Ownership
  hosts: localhost
  gather_facts: true
  vars:
    username: "your_username_here"
    home_dir_owner: "your_owner_here"
    home_dir_group: "your_group_here"

  tasks:
  - name: Set ownership on user's home directory
    become: yes
    become_user: root
    file:
      path: /home/{{ username }}
      owner: "{{ home_dir_owner }}"
      group: "{{ home_dir_group }}"

  - name: Run ansible-pull command as the specified user
    become: true
    become_user: "{{ username }}"
    command: "ansible-pull -U https://github.com/user/repo.git"

  - name: Set ownership on user's home directory after ansible-pull completion
    become: yes
    become_user: root
    file:
      path: /home/{{ username }}
      owner: "{{ home_dir_owner }}"
      group: "{{ home_dir_group }}"

  tags:
    - user_module
