
---
- hosts: all
  tasks:
    - name: Clone repository
      git:
        repo: repo_url
        dest: /repo/path
        ssh_opts:
          '-o': 'StrictHostKeyChecking=no'
        update: yes
        version: master
      register: git_clone

    - name: Add known hosts
      command: ssh-keyscan {{ git_clone.repo.split(':')[0] }} >> ~/.ssh/known_hosts

    - name: Checkout master branch
      git:
        repo: repo_url
        dest: /repo/path
        version: master
        accept_hostkey: yes
