
---
- hosts: your_vmware_server
  gather_facts: no

  vars:
    template_name: your_template_name
    datastore_name: your_datastore_name
    guest_hostname: your_guest_hostname
    disk_name: your_disk_name
    disk_size_gb: your_disk_size_gb

  tasks:
  - name: Create a new virtual machine from a template
    vmware_guest:
      hostname: "{{ vcenter_hostname }}"
      username: "{{ vcenter_username }}"
      password: "{{ vcenter_password }}"
      validate_certs: no
      name: "{{ guest_hostname }}"
      template: "{{ template_name }}"
      datastore: "{{ datastore_name }}"
      disk:
        - size_gb: "{{ disk_size_gb }}"
          type: thin
          state: present
          datastore: "{{ datastore_name }}"
          scsi_controller: 0
          scsi_type: paravirtual
          filename: "{{ disk_name }}.vmdk"
      hardware:
        memory_mb: 1024
        num_cpus: 1
      networks:
        - name: "{{ guest_network }}"
          ip: "{{ guest_ip }}"
          netmask: "{{ guest_netmask }}"
          gateway: "{{ guest_gateway }}"
          type: static
    delegate_to: localhost
