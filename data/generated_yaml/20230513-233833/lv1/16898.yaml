
- name: Playbook to resolve localhost targeting issue
  hosts: localhost

  tasks:
    - name: Add new host
      add_host:
        name: "{{ new_host }}"
        ansible_host: "{{ new_host_ip }}"

    - name: Do local action
      local_action: command some_command

    - name: Task1
      debug:
        msg: "This is task 1"

    - name: Task2
      debug:
        msg: "This is task 2"
      delegate_to: "{{ new_host }}"
