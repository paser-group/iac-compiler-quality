yaml
---
- name: Fix ansible_default_ipv4 variable
  hosts: all
  tasks:
    - name: Fix ipv4 variable in ansible facts
      set_fact:
        ansible_default_ipv4:
          address: "{{ ansible_default_ipv4.address }}"
          broadcast: "{{ ansible_default_ipv4.broadcast }}"
          netmask: "{{ ansible_default_ipv4.netmask }}"
          network: "{{ ansible_default_ipv4.network }}"
          interface: "{{ ansible_default_ipv4.interface }}"
          macaddress: "{{ ansible_default_ipv4.macaddress }}"
          mtu: "{{ ansible_default_ipv4.mtu }}"
          type: "{{ ansible_default_ipv4.type }}"
          has_broadcast: "{{ ansible_default_ipv4.has_broadcast|default(True) }}"
          prefixlen: "{{ ansible_default_ipv4.prefixlen|default(ansible_default_ipv4.netmask|prefixlen) }}"
    - name: Check if ipv4 is fixed
      debug:
        var: ansible_default_ipv4
      failed_when: "'127.0.0.1' not in ansible_default_ipv4.address"
