yaml
---
- name: Fix ansible_user_* facts inconsistencies
  hosts: all
  become: true
  gather_facts: true
  
  tasks:
    - name: Set correct ansible_user_* fact for su
      set_fact:
        ansible_user_dir: "/home/{{ ansible_user }}"
        ansible_user_shell: "/bin/bash"
      when: ansible_become_method == "su"

    - name: Set correct ansible_user_* fact for sudo
      set_fact:
        ansible_user_dir: "/home/{{ ansible_user }}"
        ansible_user_shell: "/bin/bash"
      when: ansible_become_method == "sudo"
