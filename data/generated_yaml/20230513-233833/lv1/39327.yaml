
- name: Run batch file using win_command
  hosts: your_host
  gather_facts: no

  tasks:
  - name: Run batch file
    win_command: C:\path\to\your\batch\file.bat
    args:
      chdir: C:\path\to\your\working\directory
      creates: C:\path\to\your\output\file.log
    register: output

  - name: Configure memory limits
    win_shell: |
      cmd.exe /c "setx /m PYTHONOPTIMIZE %PYTHONTWOPTIMIZE%"
      cmd.exe /c "setx /m PYTHONIOENCODING %PYTHONIOENCODING%"
      cmd.exe /c "setx /m PYTHONPATH %PYTHONPATH%;"C:\your\python\directory\";"
      cmd.exe /c "setx /m TEMP %TMP%"
      cmd.exe /c "setx /m TMP %TMP%"
    args:
      creates: C:\path\to\your\memory\file.log

  - name: Check output
    debug:
      msg: "{{ output.stdout_lines }}"
