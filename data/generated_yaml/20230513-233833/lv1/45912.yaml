
---
- name: WinRM Connection Issue Resolution
  hosts: all
  gather_facts: no
  
  tasks:

  - name: Install PyWinRM package
    win_package:
      path: https://github.com/diyan/pywinrm/archive/master.zip
      state: present

  - name: Set WinRM service startup type to automatic
    win_service:
      name: winrm
      start_mode: auto
      
  - name: Check WinRM service status
    win_service:
      name: winrm
      state: started

  - name: Add WinRM Trusted Hosts
    win_shell: Set-Item wsman:\localhost\Client\TrustedHosts -Value "*" -Force
    
  - name: Test WinRM Connection
    win_ping:
