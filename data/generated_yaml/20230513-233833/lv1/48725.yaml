
---
- name: Get Azure Virtual Machine Facts
  hosts: localhost
  tasks:
    - name: Gather Azure Virtual Machine Facts
      azure_rm_virtualmachine_facts:
        resource_group: my_resource_group  # Replace with your resource group name
      register: vm_facts

    - name: Check If Any VMs Were Found
      fail:
        msg: "No virtual machines were found in resource group {{vm_facts.resource_group}} or no virtual machines in running state"
      when:
        - vm_facts.virtual_machines is undefined
        - vm_facts.virtual_machines | length == 0
