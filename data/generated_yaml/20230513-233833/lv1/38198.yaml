yaml
---
- name: Create a security group with a rule
  hosts: localhost
  gather_facts: false

  vars:
    resource_group: "my_resource_group"
    vm_name: "my_vm"
    network_security_group_name: "my_security_group"
    security_group_rules:
      - name: "Allow SSH"
        priority: 100
        protocol: Tcp
        source_address_prefix: "10.0.0.0/24,192.168.1.0/24"
        destination_address_prefix: "*"
        destination_port_range: "22"

  tasks:
    - name: Create security group
      azure_rm_securitygroup:
        resource_group: "{{ resource_group }}"
        name: "{{ network_security_group_name }}"
        rules: "{{ security_group_rules }}"
      register: security_group

    - name: Verify the results
      debug:
        var: security_group
