yaml
- hosts: all
  gather_facts: false
  tasks:
    - name: Ensure ~/.ssh exists
      become: true
      file:
        path: "~/.ssh"
        state: directory

    - name: Add the remote host to the known_hosts file
      become_user: "{{ ansible_ssh_user }}"
      known_hosts:
        path: "{{ ssh_dir }}/known_hosts"
        name: "{{ ansible_ssh_host }}"
        state: present
        hash_host: yes

      vars:
        ssh_dir: "{{ lookup('env', 'HOME') }}/.ssh"
