
---
- name: Gather Nexus device facts using nxos_facts module
  hosts: nexus_device
  gather_facts: no

  tasks:
    - name: Gather device facts using NXAPI transport
      nxos_facts:
        transport: nxapi
      register: nxapi_facts
      ignore_errors: yes

    - name: Gather device facts using CLI transport
      nxos_facts:
        transport: cli
      register: cli_facts
      ignore_errors: yes

    - name: Log any errors encountered
      debug:
        msg: "{{ item.msg }}"
      loop:
        - "{{ nxapi_facts }}"
        - "{{ cli_facts }}"
      when: item.failed == true
