yaml
---
- name: Create a new virtual machine
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Clone a template
      vmware_guest:
        hostname: <vcenter_hostname>
        username: <vcenter_username>
        password: <vcenter_password>
        validate_certs: False
        name: <vm_name>
        template: <template_name>
        datacenter: <datacenter_name>
        folder: /<vm_folder>
        disk:
          - size_gb: <disk_size_in_gb>
            type: <disk_type>
        hardware:
          memory_mb: <memory_in_mb>
          num_cpus: <num_cpus>
          scsi: <scsi_controller_type>
        networks:
          - name: <network_name>
            type: <network_type>
        state: poweredon
      register: new_vm
      
    - name: Wait for the guest to be reachable
      wait_for:
        host: "{{ new_vm.instance.ip }}"
        port: 22
        timeout: 300
