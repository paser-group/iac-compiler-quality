yaml
---
- name: Ensure Chocolatey is installed
  hosts: all
  gather_facts: false

  tasks:
    - name: Install Chocolatey
      win_chocolatey:
        name: chocolatey
        state: present
      register: choco_installer

    - name: Verify Chocolatey installation
      win_command: C:\ProgramData\chocolatey\bin\choco.exe --version
      register: choco_version
      changed_when: false
      failed_when: false

    - name: Get Chocolatey version
      set_fact:
        choco_version: "{{ choco_version.stdout }}"

    - name: Show Chocolatey version after installation
      debug:
        var: choco_version.stdout

    - name: Install package using Chocolatey
      win_chocolatey:
        name: package_name
        state: latest

      vars:
        useEnhancedExitCodes: false

