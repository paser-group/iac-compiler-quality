
---
- hosts: all
  gather_facts: false
  tasks:
    - name: Run ansible-inventory command
      shell: ansible-inventory --list --toml
      register: inventory_output
      ignore_errors: true

    - name: Debug output
      debug:
        var: inventory_output

    - name: Fail if unexpected exception
      fail:
        msg: "Unexpected exception: {{ inventory_output.stderr }}"
      when: inventory_output.rc != 0
