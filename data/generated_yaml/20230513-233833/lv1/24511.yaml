
- name: Take Snapshots of a Virtual Machine
  hosts: all
  gather_facts: yes
  vars:
    vm_name: "my_vm"
    snapshots:
      - name: "snapshot1"
        state: "present"
      - name: "snapshot2"
        state: "present"
      - name: "snapshot3"
        state: "present"
  tasks:
    - name: Create VM snapshot
      vmware_guest_snapshot:
        hostname: '{{ vcenter_hostname }}'
        username: '{{ vcenter_username }}'
        password: '{{ vcenter_password }}'
        datacenter: '{{ datacenter_name }}'
        folder: '{{ vm_folder }}'
        name: '{{ vm_name }}'
        snapshot_name: '{{ item.name }}'
        state: '{{ item.state }}'
      with_items:
        - '{{ snapshots }}'
