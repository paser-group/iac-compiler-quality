yaml
---

- name: Update S3 bucket policy
  hosts: localhost
  gather_facts: no
  
  tasks:
  
  - name: Generate S3 bucket policy
    set_fact:
      s3_bucket_policy: |
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "AllowGetObject",
              "Effect": "Allow",
              "Principal": {
                "AWS": "YOUR-IAM-PRINCIPLE-ARN-HERE"
              },
              "Action": [
                "s3:GetObject"
              ],
              "Resource": "arn:aws:s3:::YOUR-BUCKET-NAME-HERE/*"
            }
          ]
        }
        
  - name: Set S3 bucket policy
    s3_bucket:
      name: YOUR-BUCKET-NAME-HERE
      policy: "{{ s3_bucket_policy }}"
      mode: replace
      
