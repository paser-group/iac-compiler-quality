
---
- name: Configure error logging
  hosts: all
  become: true
  tasks:
  - name: Update rsyslog configuration
    copy:
      src: /etc/rsyslog.conf
      dest: /etc/rsyslog.conf.bak
    notify: Restart rsyslog

  - name: Create new rsyslog configuration file
    blockinfile:
      path: /etc/rsyslog.conf
      block: |
        $ModLoad imuxsock
        $ModLoad imklog
        $ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
        $FileOwner syslog
        $FileGroup adm
        $FileCreateMode 0640
        $DirCreateMode 0755
        $Umask 0022
        $WorkDirectory /var/spool/rsyslog
        $IncludeConfig /etc/rsyslog.d/*.conf

        # Add this line to display full error messages (up to 10KB)
        $MaxMessageSize 10k

  handlers:
  - name: Restart rsyslog
    service:
      name: rsyslog
      state: restarted
