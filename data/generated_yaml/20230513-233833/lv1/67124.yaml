
---
- name: Check WinRM Connection Issues
  hosts: windows
  gather_facts: false

  tasks:
  - name: Run ping command in remote windows machine
    win_ping:
    
  - name: Verify python version
    register: python_version
    raw: "$env:PYTHON_VERSION = $pythonVersion = python --version 2>&1;$pythonVersion"
    
  - name: Display python version
    debug:
      var: python_version.stdout_lines
    
  - name: Display Ansible version
    debug:
      var: ansible_version.full
    
  - name: Install winrm package and dependencies
    win_pip:
      name: pywinrm
      extra_args: "--trusted-host pypi.python.org --trusted-host pypi.org --trusted-host files.pythonhosted.org"
    
  - name: Run win_ping_module with winrm connection
    win_ping:
