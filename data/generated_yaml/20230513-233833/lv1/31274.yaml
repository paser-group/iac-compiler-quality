
- name: Fix AWS Exception Bug
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
  - name: Ensure Boto3 is installed
    pip:
      name: boto3
      state: latest

  - name: Fix AWS Exception Bug
    shell: sed -i "/\[defaults\]/a\ansible_python_interpreter=/usr/bin/python3" /etc/ansible/ansible.cfg
    become: yes
    become_method: sudo

  - name: Fix AWS Exception Bug
    lineinfile:
      path: /etc/hosts
      line: 127.0.0.1 localhost
      state: present
      create: yes
      insertafter: "# The following lines are desirable for IPv6 capable hosts\n"

  - name: Test AWS Connection
    ec2_instance_facts:
      region: us-west-2
    register: instance_facts

  - name: Print AWS Instance Facts
    debug:
      var: instance_facts

