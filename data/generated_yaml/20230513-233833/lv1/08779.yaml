
---
- name: Manage apt repositories
  hosts: all
  become: yes

  tasks:
  - name: Add apt repository
    apt_repository:
      repo: "{{ item.repo }}"
      state: present
      update_cache: yes
    with_items:
      - { repo: 'deb http://example.com/ubuntu {{ ansible_distribution_release }} main' }

  - name: Ensure apt cache is up to date
    apt:
      update_cache: yes

  - name: Install apt packages from new repository
    apt:
      name: "{{ item }}"
      state: latest
    loop:
      - package1
      - package2
      - package3
