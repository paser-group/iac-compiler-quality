
---
- name: Configure Firewalld
  hosts: all
  become: true

  tasks:
  - name: Turn off firewalld with the firewalld module
    firewalld:
      state: disabled
    ignore_errors: yes

  - name: Turn off firewalld with iptables
    shell: iptables -F && iptables -X && iptables -t nat -F && iptables -t nat -X && iptables -t mangle -F && iptables -t mangle -X && iptables -P INPUT ACCEPT && iptables -P FORWARD ACCEPT && iptables -P OUTPUT ACCEPT && iptables-save > /etc/sysconfig/iptables
    when: fw_offline is undefined or not fw_offline

  - name: Restart firewalld
    firewalld:
      state: restarted
    ignore_errors: yes
