
---
- name: Playbook to troubleshoot SSH errors
  hosts: all
  gather_facts: false
  
  tasks:
    - name: Print SSH verbose output
      shell: 'ssh -v -o LogLevel=DEBUG3 user@host'
      register: ssh_output
      ignore_errors: true
    
    - name: Analyze SSH output for errors
      debug:
        var: ssh_output.stderr_lines
      when: "'Permission denied' in ssh_output.stderr_lines or 'Unable to connect' in ssh_output.stderr_lines"
