yaml
---
- name: Memory issue with include_tasks
  hosts: all
  become: true

  vars:
    ansible_version: "2.10.3"

  tasks:
    - name: Install required packages
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - python3
        - python3-pip

    - name: Create virtual environment
      pip:
        name: virtualenv
        state: present
      environment:
        HOME: /root
      tags:
        - virtualenv

    - name: Create a Python virtual environment
      command: virtualenv --python=python3 /opt/venv/
      args:
        creates: /opt/venv/
      tags:
        - virtualenv

    - name: Activate virtual environment
      command: source /opt/venv/bin/activate
      args:
        creates: /opt/venv/bin/activate
      tags:
        - virtualenv

    - name: Install ansible in virtual environment
      pip:
        name: ansible=={{ ansible_version }}
        state: present

    - name: Run include_tasks
      include_tasks: /path/to/tasks.yml
