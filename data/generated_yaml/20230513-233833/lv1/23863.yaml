
- name: Troubleshoot WinRM Error 101 Issue
  hosts: windows_hosts
  vars:
    ansible_connection: winrm
    ansible_winrm_transport: ntlm
    ansible_winrm_server_cert_validation: ignore
  tasks:
    - name: Install PowerShell v7
      win_chocolatey:
        name: powershell-core
        state: latest
      become: yes
    - name: Restart Windows Remote Management Service
      win_service:
        name: WinRM
        state: restarted
      become: yes
    - name: Test WinRM Connection
      win_ping:
      become: yes
