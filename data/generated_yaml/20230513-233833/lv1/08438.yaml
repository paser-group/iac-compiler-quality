yaml
---
- name: Ensure main tasks file exists in role directories
  hosts: all
  gather_facts: true 
  tasks:
    - name: Loop through all roles in roles directory
      find:
        paths: ~/roles
        recurse: yes
        file_type: directory
        patterns: "*"
      register: directory_list
    
    - name: Ensure the main tasks file exists
      fail:
        msg: "Role directory {{ item.path }} doesn't contain a main tasks file"
      when: not (item.path + "/tasks/main.yml") | exists
      with_items: "{{ directory_list.files }}"
