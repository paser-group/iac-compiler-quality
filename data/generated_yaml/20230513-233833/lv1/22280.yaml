yaml
---
- name: Fix dict parsing issue - regression
  hosts: all
  become: yes

  tasks:
  - name: Check for Python version
    ansible.builtin.shell: python --version
    register: py_version

  - name: Install latest version of Python
    ansible.builtin.yum:
      name: python3
      state: latest
    when: "'Python 3' not in py_version.stdout"

  - name: Update pip
    ansible.builtin.yum:
      name: python3-pip
      state: latest

  - name: Install required packages
    ansible.builtin.pip:
      name: "{{ item }}"
    with_items:
      - pyyaml
      - yaml
