
---
- name: Openstack inventory listing of errored nodes
  hosts: localhost
  tasks:
  - name: Gather OpenStack inventory nodes
    os_server_facts:
      cloud: my-cloud-name
    register: servers

  - name: List errored nodes
    debug:
      msg: "{{ item.name }}"
    when: item.internal_ipv4 == '' and item.status == 'ERROR'
    with_items:
      - "{{ servers.openstack_servers }}"
