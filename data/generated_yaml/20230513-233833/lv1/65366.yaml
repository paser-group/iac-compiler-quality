
---
- name: Fix ANSIBLE_DUPLICATE_YAML_DICT_KEY error
  hosts: all
  become: true
  
  tasks:
    - name: Check for duplicate YAML keys 
      blockinfile:
        path: /etc/ansible/ansible.cfg
        block: |
          [defaults]
          yaml_duplicate_dict_key: ignore
      when: ansible_distribution == 'Ubuntu'

    - name: Restart Ansible service
      service:
        name: ansible
        state: restarted
