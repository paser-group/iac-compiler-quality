
- name: Install necessary packages
  hosts: all
  become: true

  tasks:
  - name: Update apt index
    apt:
      update_cache: yes

  - name: Install OpenSSH client
    apt:
      name: openssh-client
      state: present

  - name: Install Python 2.x
    apt:
      name: python
      state: present

- name: Configure SSH for Ansible
  hosts: all
  become: true

  tasks:
  - name: Copy SSH private key to remote host
    copy:
      src: /path/to/private_key
      dest: /home/user/.ssh/id_rsa
      owner: user
      group: user
      mode: '0600'

  - name: Copy SSH public key to remote host
    copy:
      src: /path/to/public_key
      dest: /home/user/.ssh/id_rsa.pub
      owner: user
      group: user
      mode: '0600'

- name: Run Ansible Playbook
  hosts: all
  become: true

  tasks:
  - name: Execute Ansible playbook
    ansible-playbook:
      playbook: /path/to/playbook
      remote_user: user
      become: true
      become_method: sudo
      ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'
