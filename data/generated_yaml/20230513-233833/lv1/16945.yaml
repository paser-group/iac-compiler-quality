
---
- name: Fix "Can't add group to itself" error
  hosts: all
  become: true

  tasks:
    - name: Update /etc/group file
      lineinfile:
        path: /etc/group
        regexp: '{{ item.regexp }}'
        line: '{{ item.line }}'
      loop:
        - { regexp: '^({{ group_name }}):.+:(.*)$', line: '\\1:x:\\2:{{ item.1 }},{{ item.2 }},{{ item.3 }},{{ item.4 }},{{ item.5 }},{{ item.6 }},{{ item.7 }},{{ item.8 }},{{ item.9 }},{{ item.10 }}' }
        - { regexp: '^({{ group_name }}):.+:(.*)$', line: '\\1:x:\\2:{{ item.1 }},{{ item.2 }},{{ item.3 }},{{ item.4 }},{{ item.5 }},{{ item.6 }},{{ item.7 }},{{ item.8 }},{{ item.9 }},{{ item.10 }},{{ item.11 }}' }
