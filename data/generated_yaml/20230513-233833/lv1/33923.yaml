
---
- name: Replace non-ascii characters in GCE image name
  hosts: all
  tasks:
    - name: Replace non-ascii characters in GCE image name
      shell: echo "{{ gce_image_name }}" | iconv -f utf8 -t ascii//translit
      register: new_gce_image_name
    - name: Update GCE image name
      gce_image:
        project_id: "{{ project_id }}"
        image_name: "{{ gce_image_name }}"
        state: present
        description: "{{ gce_image_description }}"
        family: "{{ gce_image_family }}"
        visibility: "{{ gce_image_visibility }}"
        boot_disk_size_gb: "{{ gce_image_boot_disk_size_gb }}"
        source_disk: "{{ gce_image_source_disk }}"
        source_image: "{{ new_gce_image_name.stdout }}"
