
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    resource_group: "<resource-group-name>"
    nic_name: "<network-interface-card-name>"
    nsg_name: "<network-security-group-name>"

  tasks:
    - name: Get NSG ID for the Default security group
      azure_rm_securitygroup_info:
        resource_group: "{{ resource_group }}"
        name: Default
      register: nsg_info

    - name: Create a Network Interface Card
      azure_rm_networkinterface:
        resource_group: "{{ resource_group }}"
        name: "{{ nic_name }}"
        virtual_network_name: "<virtual-network-name>"
        subnet_name: "<subnet-name>"
        public_ip_name: "<public-ip>"
        security_group: "{{ nsg_info.id }}"
      register: nic_resp
