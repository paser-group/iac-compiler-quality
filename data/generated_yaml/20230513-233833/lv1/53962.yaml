
---
- hosts: all
  become: yes
  vars:
    required_python_packages:
      - python
      - python-dev
      - python-pip
      - python-setuptools
      - python-wheel
  tasks:
    - name: Install necessary package dependencies
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - gcc
        - python
        - python-dev
        - libffi-dev
        - libssl-dev
        - python-pip
        - python-setuptools
        - python-wheel
    - name: Check if required python packages are installed
      pip:
        name: "{{ required_python_packages }}"
        state: present
    - name: Try to fix the issue
      command: python -m pip install --upgrade pip
