
---
- name: Ensure that IAM password policy conforms to group/aws module defaults
  hosts: all
  become: true
  
  tasks:
    
    - name: Retrieve the IAM password policy
      iam_password_policy_facts:
      register: policy
      
    - name: Update the IAM password policy
      iam_password_policy:
        allow_users_to_change_password: "{{ policy.allow_users_to_change_password }}"
        minimum_password_length: "{{ policy.minimum_password_length }}"
        require_lowercase_characters: "{{ policy.require_lowercase_characters }}"
        require_numbers: "{{ policy.require_numbers }}"
        require_symbols: "{{ policy.require_symbols }}"
        require_uppercase_characters: "{{ policy.require_uppercase_characters }}"
        max_password_age: "{{ policy.max_password_age }}"
        password_reuse_prevention: "{{ policy.password_reuse_prevention }}"
        hard_expiry: "{{ policy.hard_expiry }}"
      register: policy_updated
      
    - name: Print the updated IAM password policy
      debug:
        var: policy_updated
