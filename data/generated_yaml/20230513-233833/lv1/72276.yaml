
---
- name: AnsibleVaultFormatError Issue Fix Playbook
  hosts: all
  become: true
  vars:
    vault_password: "my_vault_passw0rd"

  tasks:
  - name: Update pip package list
    pip:
      name: pip
      state: latest

  - name: Install cryptography package
    pip:
      name: cryptography
      state: latest

  - name: Decrypt the secret file
    command: ansible-vault decrypt secrets.yml --vault-password-file=<(echo "{{ vault_password }}")
    ignore_errors: yes

  - name: Display the contents of secret file
    debug:
      msg: "{{ lookup('file', 'secrets.yml') }}"

  - name: Encrypt the secret file
    command: ansible-vault encrypt secrets.yml --vault-password-file=<(echo "{{ vault_password }}")
    ignore_errors: yes

  - name: Display the contents of encrypted secret file
    debug:
      msg: "{{ lookup('file', 'secrets.yml') }}"
