
---
- name: Configure EC2 VPC Profile
  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    aws_profile: "my_aws_profile"

  tasks:
  - name: Configure EC2 VPC Profile
    ec2_vpc:
      region: "{{ region }}"
      aws_access_key: "{{ aws_access_key }}"
      aws_secret_key: "{{ aws_secret_key }}"
      subnet_id: "{{ subnet_id }}"
      security_group_id: "{{ security_group_id }}"
    register: ec2_vpc_result
    when: aws_profile is not defined
  
  - name: Configure EC2 VPC Profile with AWS Profile Parameter
    ec2_vpc:
      region: "{{ region }}"
      profile: "{{ aws_profile }}"
      subnet_id: "{{ subnet_id }}"
      security_group_id: "{{ security_group_id }}"
    register: ec2_vpc_profile_result
    when: aws_profile is defined
