
---

- name: Slack notification module error test playbook
  hosts: all
  gather_facts: no

  tasks:

  - name: Install required packages
    apt:
      name:
        - python3-pip
        - python3-dev
        - build-essential
      state: present
    become: true

  - name: Install Slack SDK
    pip:
      name: slack-sdk
      state: present

  - name: Test Slack notification module
    slack:
      token: "{{ lookup('env', 'SLACK_TOKEN') }}"
      msg: "{{ lookup('env', 'SLACK_MSG') }}"
      username: "{{ lookup('env', 'SLACK_USERNAME') }}"
      icon_url: "{{ lookup('env', 'SLACK_ICON_URL') }}"
      link_names: "{{ lookup('env', 'SLACK_LINK_NAMES') }}"
      channel: "{{ lookup('env', 'SLACK_CHANNEL') }}"
      attachment:
        - color: "{{ lookup('env', 'SLACK_ATTACHMENT_COLOR) }}"
          fallback: "{{ lookup('env', 'SLACK_ATTACHMENT_FALLBACK') }}"
          title: "{{ lookup('env', 'SLACK_ATTACHMENT_TITLE') }}"
          title_link: "{{ lookup('env', 'SLACK_ATTACHMENT_TITLE_LINK') }}"
          text: "{{ lookup('env', 'SLACK_ATTACHMENT_TEXT') }}"
          fields:
            - title: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_TITLE') }}"
              value: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_VALUE') }}"
              short: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_SHORT') }}"
            - title: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_TITLE') }}"
              value: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_VALUE') }}"
              short: "{{ lookup('env', 'SLACK_ATTACHMENT_FIELDS_SHORT') }}"
      color: "{{ lookup('env', 'SLACK_COLOR') }}"
      footer: "{{ lookup('env', 'SLACK_FOOTER') }}"
      footer_icon: "{{ lookup('env', 'SLACK_FOOTER_ICON') }}"
      ts: "{{ lookup('env', 'SLACK_TS') }}"
      validate_certs: "{{ lookup('env', 'SLACK_VALIDATE_CERTS') }}"
    register: slack_result

  - name: Debug Slack result
    debug:
      var: slack_result

...
