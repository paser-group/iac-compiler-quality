
- name: Test playbook for 'dict object has no attribute' error
  hosts: all
  gather_facts: no

  tasks:
  - name: Variable with complex conditional
    set_fact:
      my_dict: "{{ {'a': 1, 'b': 'two', 'c': [1, 2, 3], 'd': {'e': [4, 5, 6]}} }}"
      my_var: "{{ my_dict['d']['e'][2] }}"

  - name: Task with complex conditional and unconventional syntax
    command: "{{ item }}"
    with_items: "{{ ['echo {{ my_var | default(omit) }}', 'ls {{ my_var | default("nonexistent") }}'] }}"

  - name: Include task with conditional that should not execute
    include_tasks: tasks/some_other_task.yml
    when: my_dict.no_such_key is defined

  - name: Task with unexpected input type
    command: "echo {{ my_dict | default(omit) | list }}"

  - name: Task that should fail with 'dict object has no attribute'
    command: "echo {{ my_dict.no_such_key }}"

  - name: Task with unconventional jinja2 template syntax
    template:
      src: templates/{{ 'file.txt.j2' if my_dict.a == 1 else 'file2.txt.j2' }}
      dest: /tmp/output.txt

  - name: Shell task with unexpected command syntax
    shell: %echo 'Hello, Ansible!'
    args:
      executable: /bin/bash
