
---
- name: Test any_errors_fatal with roles
  hosts: all
  gather_facts: no

  roles:
    - name: role1
      any_errors_fatal: true

  tasks:
    - name: check if any errors occurred
      debug:
        msg: "Task failed."
      failed_when: false

    - name: fire an error
      command: non_existing_command
      register: cmd_output
      ignore_errors: yes
      failed_when: cmd_output.rc != 0

  post_tasks:
    - name: check if any errors occurred
      debug:
        msg: "Task failed in post_tasks section."
      failed_when: false
