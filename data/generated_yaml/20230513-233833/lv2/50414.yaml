
---
- hosts: all
  gather_facts: no

  tasks:
  - name: Retry docker_container on 500 error
    docker_container:
      name: test_container
      image: invalid-image
      state: started
      pull: true
      retry_timeout: 30
      retry_delay: 5
      when: "'500' not in docker_image.stdout"
      register: docker_container_output

  - name: Print the output
    debug:
      msg: "{{ docker_container_output }}"

  - name: Remove the container
    docker_container:
      name: test_container
      state: absent
