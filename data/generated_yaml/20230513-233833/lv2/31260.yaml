
- name: Enable fact cache in inventory
  hosts: all
  gather_facts: false

  vars:
    fact_cache_type: 'jsonfile'

  tasks:
    - name: Setup fact cache
      setup:
        cache_plugin: "{{ fact_cache_type }}"
        cache_connection: '/tmp/{{ inventory_hostname }}'
        cache_timeout: 3600
        fact_path: "/etc/ansible/facts.d/{{ inventory_hostname }}.fact"

    - name: Retrieve a fact cache
      set_fact:
        tmp_fact: "{{ lookup('cache', fact_path) }}"

    - name: Display retrieved fact cache
      debug:
        var: tmp_fact
