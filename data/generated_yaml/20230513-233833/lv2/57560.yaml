
- hosts: all
  gather_facts: false
  
  tasks:
    - name: Start service and wait indefinitely for it to start
      service:
        name: my_service
        state: started
      async: 99999
      poll: 0
      
    - name: Try to connect to the service
      wait_for:
        host: 10.1.1.4
        port: 8888
        state: started
        delay: 5
        timeout: 10
      async: 60
      poll: 5
      
    - name: Stop service
      service:
        name: my_service
        state: stopped
      async: 99999
      poll: 0
