yaml
---
- name: Test Ansible 'when: some_var is defined' with_items loop issue
  hosts: all
  gather_facts: no
  tasks:
    - name: Create a dictionary with unexpected input
      set_fact:
        test_dict:
          - unexpected_key: "unexpected_value"
          - null_key: null
          - bool_key: true
          - int_key: "{{ 2 + 3 }}"
          - float_key: 123.45
          - list_key: [1, 2, 3]
          - empty_list_key: []
    - name: Test unexpected input in with_items loop
      debug:
        msg: "{{ item }}"
      with_items:
        - "{{ test_dict }}"
    - name: Test using `when: some_var is defined` in a role
      include_role:
        name: test_role
      vars:
        some_var: "defined"
    - name: Test using `when: some_var is defined` in a play
      debug:
        msg: "{{ some_var }}"
      when: some_var is defined
