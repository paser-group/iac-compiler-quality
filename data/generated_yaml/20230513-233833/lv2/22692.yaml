
- name: EC2 Spot Request
  hosts: localhost
  connection: local
  gather_facts: no
  vars:
    instance_type: t2.micro
    key_name: ansible
    image_id: ami-0c55b159cbfafe1f0
    security_group: sg-0123456789abcdef
    subnet_id: subnet-0123456789abcdef
    block_duration_minutes: 60
    spot_price: 0.005
    launch_specification:
      ImageId: "{{ image_id }}"
      InstanceType: "{{ instance_type }}"
      KeyName: "{{ key_name }}"
      SecurityGroupIds: ["{{ security_group }}"]
      SubnetId: "{{ subnet_id }}"

  tasks:
    - name: Create spot request
      ec2:
        wait: "{{ wait | default(False) }}"
        count: "{{ count | default(1) }}"
        spot_price: "{{ spot_price }}"
        instance_type: "{{ instance_type }}"
        key_name: "{{ key_name }}"
        image_id: "{{ image_id }}"
        security_group: "{{ security_group }}"
        subnet_id: "{{ subnet_id }}"
        block_duration_minutes: "{{ block_duration_minutes }}"
        launch_specification: "{{ launch_specification }}"
      register: ec2

      ignore_errors: yes
