
- name: Test CPU count facts on ARM
  hosts: all
  gather_facts: true

  tasks:
    - name: Print CPU count fact
      debug:
        msg: "CPU count is {{ ansible_processor_count }}"
      when: ansible_processor == "ARM"

    - name: Execute command
      command: /bin/echo "This node has {{ ansible_processor_count }} CPUs."

    - name: Set fact value
      set_fact:
        cpu_count: "{{ ansible_processor_count * 2 }}"
      when: ansible_processor == "ARM"

    - name: Print new CPU count fact
      debug:
        msg: "New CPU count is {{ cpu_count }}."
      when: ansible_processor == "ARM"

    - name: Fail if CPU count fact is incorrect
      fail:
        msg: "Incorrect CPU count fact value."
      when: ansible_processor == "ARM" and cpu_count != 2

    - name: Print success message
      debug:
        msg: "CPU count fact test passed!"
      when: ansible_processor == "ARM" and cpu_count == 2
