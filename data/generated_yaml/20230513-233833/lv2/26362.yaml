
- hosts: all
  gather_facts: false
  tasks:
    - name: Generate an error on all servers
      command: >
        echo "Error occurred on {{ inventory_hostname }}"
      register: cmd_output
      failed_when: true

    - name: Clear the error state
      clear_host_errors:
        when: "'FAILED' in hostvars[item]['ansible_failed_task']"
      with_items:
        - "{{ groups['all'] }}"
