
- hosts: all
  vars:
    firewall_name: "test-firewall"
    source_range: "0.0.0.0/0"
  tasks:
  - name: Create a GCE firewall rule
    gce_net:
      project_id: "my-project-id"
      name: "{{ firewall_name }}"
      rules:
      - action: "allow"
        source_ranges:
        - "{{ source_range }}"
        protocol: "tcp"
        ports:
        - "80"
    register: firewall_creation_result

  - name: Update a GCE firewall rule
    gce_net:
      project_id: "my-project-id"
      name: "{{ firewall_name }}"
      rules:
      - action: "deny"
        src_ips: "{{ source_range }}"
        protocol: "udp"
        ports:
        - "8080"
    register: firewall_update_result

  - name: Debugging output
    debug:
      var: firewall_update_result
