
---
- name: Test ec2_group with ELB rule
  hosts: node1
  become: yes
  vars:
    group_id: sg-123456789
    elb_name: my-elb

  tasks:
    - name: Add rule to security group using ELB
      ec2_group:
        name: "{{ group_id }}"
        region: us-west-2
        rule:
          proto: tcp
          from_port: 80
          to_port: 80
          cidr_ip: 0.0.0.0/0
          load_balancer_name: "{{ elb_name }}"
          state: present

    - name: Update rule on security group using ELB
      ec2_group:
        name: "{{ group_id }}"
        region: us-west-2
        rule:
          proto: tcp
          from_port: 80
          to_port: 80
          cidr_ip: 0.0.0.0/0
          load_balancer_name: "{{ elb_name }}"
          state: present

    - name: Remove rule from security group using ELB
      ec2_group:
        name: "{{ group_id }}"
        region: us-west-2
        rule:
          proto: tcp
          from_port: 80
          to_port: 80
          cidr_ip: 0.0.0.0/0
          load_balancer_name: "{{ elb_name }}"
          state: absent

    - name: Add rule with unconventional syntax
      ec2_group:
        name: "{{ group_id }}"
        region: us-west-2
        rule:
          proto - tcp
          from_port: 22
          to_port: 22
          cidr_ip - 0.0.0.0/0
          state: present

    - name: Add rule with unexpected input
      ec2_group:
        name: "{{ group_id }}"
        region: us-west-2
        rule:
          proto: icmp
          from_port: 0
          to_port: 255
          cidr_ip: 0.0.0.0/0
          state: present
          description: "{{ notdefined }}"
