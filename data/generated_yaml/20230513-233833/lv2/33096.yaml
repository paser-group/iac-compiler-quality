
---
- name: Test playbook for OpenStack security group rules deletion
  hosts: all
  become: true

  tasks:
  - name: Delete security group rules with invalid parameters
    os_security_group_rule:
      state: absent
      security_group: 'invalid_group_name'
      direction: 'invalid_direction'
      protocol: 'invalid_protocol'
      remote_ip_prefix: 'invalid_ip_prefix'
      ethertype: 'invalid_ethertype'
      region_name: 'invalid_region_name'
      validate_certs: 'invalid_validate_certs'
    ignore_errors: yes

  - name: Delete default security group rules
    os_security_group_rule:
      state: absent
      security_group: 'default'
      direction: '{{ item }}'
      remote_ip_prefix: '0.0.0.0/0'
    with_items:
      - egress
      - ingress

  - name: Delete non-existent security group rules
    os_security_group_rule:
      state: absent
      security_group: 'non_existent_group'
      direction: 'ingress'
      protocol: 'tcp'
      port_range_min: 80
      port_range_max: 8080
      remote_ip_prefix: '10.1.1.4/32'
