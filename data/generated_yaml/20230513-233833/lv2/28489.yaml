
- name: Test gcp_healthcheck variables
  hosts: all
  become: true
  vars:
    healthy_threshhold: "{{ ['-1', '0'] | random }}"
    unhealthy_threshhold: "{{ ['101', '102'] | random }}"
  tasks:
    - name: Set invalid healthy_threshhold
      gcp_healthcheck:
        healthy_threshhold: "{{ healthy_threshhold }}"
        unhealthy_threshhold: "{{ unhealthy_threshhold }}"
      register: output
      ignore_errors: true
    - name: Fail if error occurred
      fail:
        msg: "Error occurred while setting invalid threshold values for gcp_healthcheck"
      when: "'ERROR!' in output.stderr"
