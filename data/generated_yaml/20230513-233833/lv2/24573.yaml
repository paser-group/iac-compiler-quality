
- name: iam_cert gives Boto is required for this module error
  hosts: node1
  gather_facts: no
  tasks:
  
  - name: Install Boto via apt module
    apt:
      name: python-boto
      state: present
    register: result
      
  - name: Debug the installation of Boto
    debug:
      var: result
      
  - name: Update the apt cache
    apt:
      update_cache: yes
      
  - name: Add apt-key for CloudFront distribution
    apt_key:
      url: https://cloudfront.amazonaws.com/bootstrap/3.0/apt/lambda.boto3.pubkey
    register: result
      
  - name: Debug the added apt-key
    debug:
      var: result
      
  - name: Install boto3 and iaas_server_certificate classes
    pip:
      name: "boto3==1.7.0 botocore==1.10.0"
    register: result
      
  - name: Debug the installation of boto3 and iaas_server_certificate
    debug:
      var: result
      
  - name: Provide AWS credentials to boto3
    aws_access_key_module:
      access_key_id: "AKIAXXXYYZZZ"
      secret_access_key: "T9lM3s+PAaTt3NtpL0c3x5m4lt9NAc5CI49AXXXY"
      region: "us-west-2"
    register: result
      
  - name: Register the iam certificate
    iam_cert:
      key_file: "/path/to/key.pem"
      cert_file: "/path/to/cert.pem"
      cert_name: "MyTestCert"
    register: result
      
  - name: Debug the registered iam certificate
    debug:
      var: result

