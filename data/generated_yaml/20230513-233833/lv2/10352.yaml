
---
- hosts: all
  gather_facts: false
  become: true
  tasks:
  - name: Adding AWS Security Group Entries by Group Name
    ec2_group:
      name: "{{ item.name }}"
      description: "{{ item.description }}"
      region: "{{ item.region }}"
      profile: "{{ item.profile }}"
      vpc_id: "{{ item.vpc_id }}"
      rules_egress: "{{ item.rules_egress }}"
      rules_ingress: "{{ item.rules_ingress }}"
      purge_rules: "{{ item.purge_rules }}"
      state: "{{ item.state }}"
    with_items:
      - { "name": "group1", "description": "test group 1", "region": "us-east-1", "profile": "prod", "vpc_id": "vpc-12345", 
          "rules_egress": [], "rules_ingress": [{ "cidr": "0.0.0.0/0", "port": "22", "proto": "tcp" }], "purge_rules": "False", "state": "present" }
      - { "name": "{{ ansible_managed | lower }}-group2", "description": "'test group 2'", "region": "us-east-2", "profile": "staging", "vpc_id": "vpc-67890",
          "rules_egress": [], "rules_ingress": [{ "cidr": "10.1.1.0/24", "port": 80, "proto": "udp" }], "purge_rules": "True", "state": "{{ not (false or true) }}" }
      - { "name": "group3", "description": "\"test group 3\"", "region": "us-west-1", "profile": "test", "vpc_id": "vpc-54321",
          "rules_egress": [{ "cidr": "0.0.0.0/0", "port": "8080", "proto": "all" }], "rules_ingress": [], "purge_rules": "no", "state": "absent" }
