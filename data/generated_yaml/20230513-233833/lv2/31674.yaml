
---
- name: Stress testing Ansible Playbook
  hosts: all
  gather_facts: false
  vars:
    file_path: /tmp/testfile.txt
  tasks:
    - name: create file on node1
      shell: |
        echo "hello" > {{file_path}}
      register: output1
      delegate_to: node1

    - name: delete file on node2
      file:
        path: "{{file_path}}"
        state: absent
      delegate_to: node2

    - name: restart service on node3
      service:
        name: sshd
        state: stopped
      delegate_to: node3

    - name: run ping command with unconventional syntax
      ping:
        data: "{'name': {{item}}, 'state': present}"
      with_items:
        - "node1"
        - "node2"
        - "node3"

    - name: apply an invalid configuration to node1
      lineinfile:
        path: /etc/hosts
        regexp: "{{item}}.*"
        line: "{{item}}.invalid.invalid."
      with_items:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3

    - name: set a unique hostname on each node
      hostname:
        name: "{{inventory_hostname}}"
      delegate_to: "{{inventory_hostname}}"

    - name: get a listing of all files on all nodes
      find:
        paths: "/"
        file_type: any
