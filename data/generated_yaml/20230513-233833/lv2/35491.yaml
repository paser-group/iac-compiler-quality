
---
- name: Creating VMKernel interface using vmware_vmkernel module
  hosts: node1
  
  become: yes
  
  gather_facts: no

  tasks:
  - name: Ensure that vmkernel interface is deleted first
    vmware_vmkernel:
      hostname: 10.1.1.1
      username: root
      password: vmware
      datacenter_name: datacenter
      cluster_name: cluster
      esxi_hostname: node1.example.com
      name: vmk0
      state: absent

  - name: Testing unconventional syntax
    vmware_vmkernel:
      hostname: 10.1.1.2
      username: "{{ item }}"
      password: "{{ item }}"
      datacenter_name: datacenter
      cluster_name: cluster
      esxi_hostname: node1.example.com
      name: vmk0.{{ item }}
      state: present
    loop: 
      - '!'
      - '\$'

  - name: Testing unexpected inputs
    vmware_vmkernel:
      hostname: 10.1.1.3
      username: root
      password: vmware
      datacenter_name: datacenter
      cluster_name: cluster
      esxi_hostname: node1.example.com
      name: "{{ lookup('env', 'HOME') }}"
      state: present

  - name: Testing edge cases
    vmware_vmkernel:
      hostname: 10.1.1.1
      username: root
      password: vmware
      datacenter_name: "{{ 1/0 }}"
      cluster_name: cluster
      esxi_hostname: node1.example.com
      name: vmk0
      state: present

  - name: Successfully created vmkernel interface on node1
    debug:
      msg: "VMKernel interface created on {{ inventory_hostname }}"
