
---
- name: Ansible Playbook for testing template with_dict issue
  hosts: all
  gather_facts: no

  tasks:
    - name: Define variables
      vars:
        var1: "{{ foo.bar }}"
        var2: "{{ bar.baz }}"
        dict1: {
          'key1': var1,
          'key2': var2,
          'key3': '{{ undefined_var }}',
          'key4': '{{ item }}'
        }

    - name: Execute with_dict
      debug:
        msg: "Value of {{ item.key }} is {{ item.value }}"
      with_dict: "{{ dict1 }}"
