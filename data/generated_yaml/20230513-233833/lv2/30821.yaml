
- name: Unarchive module stress test playbook
  hosts: all
  gather_facts: no
  
  tasks:
  
  - name: Unarchive - incorrect file path
    unarchive:
      src: /path/to/archive.zip
      dest: /tmp/
      remote_src: yes
    register: unarchive_output
    ignore_errors: yes

  - name: Fail if src file not found
    fail:
      msg: "Source file not found"
    when: unarchive_output is failed
  
  - name: Unarchive - incorrect dest path
    unarchive:
      src: /path/to/archive.zip
      dest: /some/non/existent/directory/
      remote_src: yes
    register: unarchive_output
    ignore_errors: yes

  - name: Fail if dest file path is not valid
    fail:
      msg: "Dest file path is not valid"
    when: unarchive_output is failed
  
  - name: Unarchive - incorrect file type
    unarchive:
      src: /path/to/not/an/archive.txt
      dest: /tmp/
      remote_src: yes
    register: unarchive_output
    ignore_errors: yes

  - name: Fail if file type is not valid
    fail:
      msg: "File type is not valid"
    when: unarchive_output is failed
  
  - name: Unarchive - incorrect remote_src path
    unarchive:
      src: /path/to/archive.zip
      dest: /tmp/
      remote_src: /incorrect/path
    register: unarchive_output
    ignore_errors: yes

  - name: Fail if remote_src path is not valid
    fail:
      msg: "Remote_src path is not valid"
    when: unarchive_output is failed
  
  - name: Unarchive - missing src parameter
    unarchive:
      dest: /tmp/
      remote_src: yes
    register: unarchive_output
    ignore_errors: yes
    connection: local
  
  - name: Fail if src parameter is missing
    fail:
      msg: "Src parameter is missing"
    when: unarchive_output is failed
  
  - name: Unarchive - missing dest parameter
    unarchive:
      src: /path/to/archive.zip
      remote_src: yes
    register: unarchive_output
    ignore_errors: yes
  
  - name: Fail if dest parameter is missing
    fail:
      msg: "Dest parameter is missing"
    when: unarchive_output is failed
  
  - name: Unarchive - invalid file permission mode
    unarchive:
      src: /path/to/archive.zip
      dest: /tmp/
      remote_src: yes
      mode: invalid_mode
    register: unarchive_output
    ignore_errors: yes
  
  - name: Fail if file permission mode is invalid
    fail:
      msg: "File permission mode is invalid"
    when: unarchive_output is failed
