
- name: Let's Encrypt certificate validation
  hosts: all
  gather_facts: false
  tasks:
  - name: Attempt certificate validation with no 'Not after' date found
    shell: letsencrypt certonly --standalone --preferred-challenges http --agree-tos --no-eff-email --rsa-key-size 2048 --email test@test.com -d example.com
    register: result
    ignore_errors: true
  - name: Check if validation incorrectly passes
    assert:
      that:
        - "'No valid IP addresses found' not in result.stdout"
        - "'Congratulations' not in result.stdout"
