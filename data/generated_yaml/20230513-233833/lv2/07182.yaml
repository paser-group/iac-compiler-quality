
---
- name: Synchronize module issue with rsync_path
  hosts: all
  gather_facts: false
  tasks:
    - name: Copy file with rsync and custom ssh port, using quirky syntax
      synchronize:
        mode: push
        src: /opt/data/example.txt
        dest: "{{ item }}:/tmp/"
        rsync_path: "sudo /usr/bin/rsync"
        ssh_opts: "-oPort=9999 -oUserKnownHostsFile=/dev/null -oStrictHostKeyChecking=no"
      with_items:
        - node1
        - node2
        - node3

    - name: Execute command with filter plugin and unexpected input
      command: "echo The IP address of node2 is {{ hostvars['node2']['ansible_default_ipv4']['address'] | length}}"
