
---
- name: Test playbook for GitHub issue #123
  hosts: all
  gather_facts: no

  tasks:
    - name: Create VLAN with more than 6 interfaces
      command: |
        /usr/bin/python -c "
        interface_list = ['eth0', 'eth1', 'eth2', 'eth3', 'eth4', 'eth5', 'eth6', 'eth7']
        vlan_id = 1234
        interfaces = ' '.join(interface_list)
        command = f'ip link add link {interfaces} name {interfaces}-vlan{vlan_id} type vlan id {vlan_id}'
        print(command)
        "
      register: output
      ignore_errors: true

    - name: Show output
      debug:
        var: output.stdout_lines

    - name: Remove VLAN with more than 6 interfaces
      command: |
        /usr/bin/python -c "
        vlan_id = 1234
        interface_list = ['eth0', 'eth1', 'eth2', 'eth3', 'eth4', 'eth5', 'eth6', 'eth7']
        interfaces = ' '.join(interface_list)
        command = f'ip link delete {interfaces}-vlan{vlan_id}'
        print(command)
        "
      register: output
      ignore_errors: true

    - name: Show output
      debug:
        var: output.stdout_lines
