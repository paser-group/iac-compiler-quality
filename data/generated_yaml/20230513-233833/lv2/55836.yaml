
- hosts: all
  gather_facts: no

  tasks:
    - name: Create Azure Web App
      azure_rm_webapp:
        resource_group: "{{ item.resource_group }}"
        name: "{{ item.name }}"
        plan: "{{ item.plan }}"
        state: "{{ item.state | default('present') }}"
      register: result
      with_items:
        - { resource_group: "my-resource-group", name: "my-app", plan: "F1", state: "present" }
        - { resource_group: "my-resource-group", name: "my-app-1", plan: "B1", state: "present", tags: { key1: "value1", key2: "value2" } }
        - { resource_group: "my-resource-group", name: "my-app-2", plan: "S1", state: "absent" }
        - { resource_group: "my-resource-group", name: "my-app-3", plan: [], state: "present" }
        - { resource_group: "{{ non_existent_variable }}", name: "my-app-4", plan: "F1", state: "present" }

    - name: Print Azure Web App result
      debug:
        var: result
