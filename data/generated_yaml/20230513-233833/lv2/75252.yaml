yaml
- name: Test playbook for privilege elevation issue
  hosts: all
  gather_facts: false
  become: true
  become_method: sudo
  vars:
    username: "{{ 'testuser' }}"
    password: "{{ 'testpass' }}"
  tasks:
    - name: Test connection to all hosts using SSH and password authentication
      connection: ssh
      ssh_user: "{{ username }}"
      ssh_pass: "{{ password }}"
      become: true
      become_method: enable
      become_user: root
      register: ssh_result
      ignore_errors: true
    - debug:
        var: ssh_result
    - name: Disable elevated privileges
      become: false
      become_method: sudo
      become_user: "{{ username }}"
      command: "exit"
