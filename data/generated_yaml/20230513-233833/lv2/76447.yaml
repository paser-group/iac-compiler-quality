
---
- name: Test playbook for multiple inventory files and variable resolution
  hosts: all
  gather_facts: true

  vars:
    common_var: "common variable"
    first_var: "first variable"
    second_var: "second variable"

  tasks:
    - name: Print variables
      debug:
        var: common_var

    - name: Include inventory files
      include_vars:
        file: inventories/all.yml

      include_vars:
        file: inventories/{{ inventory_hostname }}.yml

    - name: Print variables again
      debug:
        var: common_var

    - name: Print first variable
      debug:
        var: first_var

    - name: Print second variable
      debug:
        var: second_var

    - name: Print undefined variable (should fail)
      debug:
        var: undefined_var
