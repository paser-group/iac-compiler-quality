
---
- name: Test Playbook for ssh error status
  hosts: all
  become: true
  vars:
    ssh_command: "ssh -V"
  tasks:
    - name: Execute the ssh command and store the outputs
      shell: "{{ ssh_command }} 2>&1 | tee /tmp/ssh_log.txt"
      register: ssh_output
    - name: Parse the output to check for error status
      command: grep -i "error" /tmp/ssh_log.txt
      register: error_output
      ignore_errors: yes
    - name: Print the output
      debug:
        var: error_output.stdout_lines
