yaml
- name: Create Network Interface with Default NSG
  hosts: node1
  gather_facts: no
  tasks:
  - name: Create Network Security Group
    azure_rm_networksecuritygroup:
      resource_group: MyResourceGroup
      name: MyNSG
      location: eastus
      tags:
        test: playbook
      state: present
  - name: Create Network Interface
    azure_rm_networkinterface:
      resource_group: MyResourceGroup
      name: MyNetInterface
      location: eastus
      security_group: MyNSG
      enable_accelerated_networking: yes
      enable_ip_forwarding: yes
      ip_configurations:
      - name: ipconfig1
        private_ip_address_allocation: static
        private_ip_address: "{{ hostvars['node2']['ansible_default_ipv4']['address'] }}"
        subnet: MySubnet
        primary: true
      tags:
        test: playbook
      state: present
