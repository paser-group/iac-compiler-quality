
- name: Win Firewall
  hosts: windows
  gather_facts: no

  tasks:

  - name: Enable firewall rule
    win_firewall:
      rule: "{{ item.rule }}"
      direction: "{{ item.direction }}"
      remote_ip: "{{ item.remote_ip }}"
      local_port: "{{ item.local_port }}"
      protocol: "{{ item.protocol }}"
      state: "{{ item.state }}"
    with_items:
      - { rule: "Test Rule", direction: "in", remote_ip: "10.1.1.1", local_port: "80", protocol: "tcp", state: "present" }
      - { rule: "Test Rule-2", direction: "out", remote_ip: "10.1.1.2", local_port: "3000", protocol: "udp", state: "present" }
      - { rule: "", direction: "in", remote_ip: "", local_port: "", protocol: "", state: "" }
      - { rule: "Test' Rule", direction: "in", remote_ip: "10-1-1-3", local_port: "80", protocol: "tcp", state: "present" }
      - { rule: "Test Rule", direction: "in", remote_ip: "10.1.1.1", local_port: "80", protocol: "tcp", state: "absent" }

  - name: Disable all firewall rules
    win_firewall:
      profile: all
      state: "{{ item.state }}"
      display_name: "{{ item.display_name }}"
    with_items:
      - { state: "present", display_name: "Test Rule" }
      - { state: "absent", display_name: "Test Rule-2'" }
