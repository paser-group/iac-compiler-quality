
- name: Test playbook for persisting value in a variable
  hosts: all
  tasks:
    - blockinfile:
        path: /etc/hosts
        block: |
          {{ var | default('value') }}
      vars:
        var: overridden_value
    - assert:
        that:
          - "'overridden_value' in hostvars[inventory_hostname]['vars']"
