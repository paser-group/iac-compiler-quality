
- name: Ansible snow modules authentication issue stress test playbook
  hosts: all
  become: true

  tasks:
  - name: Install Snow authentication module dependencies
    apt:
      name: "{{ item }}"
      state: present
    with_items:
      - python3-snow-auth

  - name: Configure SSO / ADFS Authentication
    snow_authenticate:
      user: "{{ lookup('env', 'USER') }}"
      password: "{{ vault_snow_password }}"
      url: "https://snow.example.com"
      snow_table: "x_snow_table"
      snow_username_column: "username"
      snow_password_column: "password"
      sso: "true"
      adfs: "true"
      idp_certificate: |
        -----BEGIN CERTIFICATE-----
        MIIDdzCCAl+gAwIBAgIJAI0N5sErCrpUMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNV
        BAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRAwDgYDVQQHEwdBcml6b25hMREwDwYD
        VQQKEwhBcml6b25hIEx0ZDAeFw0yMTA0MDkxNTQ2NDhaFw0zMTA0MDkxNTQ2NDha
        MEUxCzAJBgNVBAYTAlVTMRAwDgYDVQQIEwdBcml6b25hMRAwDgYDVQQHEwdBcml6
        b25hMREwDwYDVQQKEwhBcml6b25hIEx0ZDCCASIwDQYJKoZIhvcNAQEBBQADggEP
        ADCCAQoCggEBAID2LgiJPPmAe93OOsmOwyfcWCOadouez5NsoDaN5H40z/pNNnQ9
        gmXzZLr2iuK6KoyIdqJlF0gZzGzG/vTf8vmmD4rOvaz51HcX+o3Zv/wV8o8vy6me
        Y+CJnjK4QyaI8S0QOxWzamkqH1oFeVKOc6tiIrJWhxbuA0OLzNM8+M5zo0B7NWpE
        WoarLtr0XqPv4PY7hhPbKskxkSfDpAJa5OveDG83KDzG/olboSDu3Dl3iudfPcXN
        7Gq9elAqczV4A4r6nQ+/DJUYjICKw70Eaqxvcgw1CFaGBsYwExpTVVQG1xVcCL4X
        fXfYTPpHCs9fECX7RurBnEjXIQ0R4ET4RU0CAwEAAaM5MDcwCwYDVR0PBAQDAgXg
        MBMGA1UdJQQMMAoGCCsGAQUFBwMBMHAGA1UdEQQpMCeHBH8AAAGHBAAAAAEwHwYD
        VR0jBBgwFoAUej93Q4MrKCtUUlgv0U4pkz/+cTQwRQYDVR0fBD4wPDA6oDigNoY0
        aHR0cDovL2NybC5hdXRoZW50aWNhdGlvbi5jb20vQXV0aG9yaXphdGlvbkxpbmVO
        YXRDQS5jcmwwDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBSPKU9Tqy0gE+Wf0ng8
        kskyoKOWODAfBgNVHSMEGDAWgBRPp4cKNJhh9FGq3e0MOmDoH9F3NDAKBggqhkjO
        PQQDAwNpADBmAjEA2WfdcTgDWxA9xdDNDLLxQ21ZqbK+4zfSHVt/tKPOOI7hnCCp
        kum2KxAgqpS5KozsACHzO0bqMtl1vr5VQzvtdeXzYPVjAv7u5LcozQQT9av+Ifi5
        KzQEmezlHmN6A1Wn3xJUPphgU2K/G9wt3+wL
        -----END CERTIFICATE-----
