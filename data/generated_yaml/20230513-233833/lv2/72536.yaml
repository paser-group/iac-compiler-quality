
---
- name: Test playbook for Vault Password Client configuration
  hosts: all
  gather_facts: false
  vars:
    invalid_port: "65536"
    invalid_client_path: "/invalid/client/path/somewhere"
    invalid_protocol: "ftp"
    invalid_username: "admin:"
    invalid_password: "&amp;password"
    invalid_confirmation_password: "&sentinel"
  tasks:
    - name: Define invalid client port
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_port = ){{ vault_password_client_port }}$'
        line: 'vault_password_client_port = {{ invalid_port }}'

    - name: Define invalid client path
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_executable = ){{ vault_password_client_executable_path }}$'
        line: 'vault_password_client_executable = {{ invalid_client_path }}'

    - name: Define invalid protocol
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_protocol = ){{ vault_password_client_protocol }}$'
        line: 'vault_password_client_protocol = {{ invalid_protocol }}'

    - name: Define invalid username
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_username = ){{ vault_password_client_username }}$'
        line: 'vault_password_client_username = {{ invalid_username }}'

    - name: Define invalid password
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_password = ){{ vault_password_client_password }}$'
        line: 'vault_password_client_password = {{ invalid_password }}'

    - name: Define invalid confirmation password
      lineinfile:
        path: /etc/ansible/ansible.cfg
        regexp: '^(vault_password_client_confirmation_password = ){{ vault_password_client_confirmation_password }}$'
        line: 'vault_password_client_confirmation_password = {{ invalid_confirmation_password }}'

    - name: Check if Ansible can start
      ping:

    - name: Check whether the Vault password client is accessible
      shell: "{{ vault_password_client_executable_path }} --ping"
      register: ping_result

    - name: Debug output of ping command
      debug:
        var: ping_result
