
- name: Script finished while get share connection close error stress test
  hosts: all
  become: true

  tasks:
    - name: Create a file on the nodes
      shell:
        cmd: "echo '{{ item }}' > /tmp/test.txt"
      with_items: "{{ range(5) | list }}{{ ['', 'a'*32000] | random }}"

    - name: Read the file on the nodes
      shell: cat /tmp/test.txt
      with_items: "{{ range(5) | list }}{{ ['', 'a'*32000] | random }}"

    - name: Remove the file from the nodes
      shell: rm /tmp/test.txt
      with_items: "{{ range(5) | list }}{{ ['', 'a'*32000] | random }}"

    - name: Restart samba service
      service:
        name: samba
        state: restarted
      with_items: "{{ range(5) | list }}{{ ['', 'a'*32000] | random }}"
