yaml
---
- name: Test for Modules shell and command
  hosts: all
  gather_facts: false

  tasks:
  - name: Incorrect command syntax
    command: <invalid-syntax>

  - name: Command with a single-quote in argument
    command: 'echo '\''test'\'''

  - name: Command with a double-quote in argument
    command: "echo 'test\"'

  - name: Command with backslashes in argument
    command: 'echo \\'test\\''

  - name: Incorrect shell syntax
    shell: <invalid-syntax>

  - name: Command with a single-quote in argument
    shell: 'echo '\''test'\'''

  - name: Shell with a double-quote in argument
    shell: "echo 'test\"'

  - name: Shell with backslashes in argument
    shell: 'echo \\'test\\''

  - name: Fail if command returns non-zero return code
    command: /bin/false
    register: command_result
    ignore_errors: yes
    failed_when: "'MODULE FAILURE' not in command_result.msg"

  - name: Fail if shell returns non-zero return code
    shell: /bin/false
    register: shell_result
    ignore_errors: yes
    failed_when: "'MODULE FAILURE' not in shell_result.msg"
