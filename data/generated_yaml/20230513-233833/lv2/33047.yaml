
- name: Test network module with debug logs
  hosts: all
  gather_facts: false
  vars:
    port: 22
    user: user
    password: password123
  tasks:
    - name: Test a persistent SSH connection
      ssh_connection:
        user: "{{ user }}"
        password: "{{ password }}"
        port: "{{ port }}"
        timeout: 60
        persistent: true
        debug: true
      register: result

    - name: Terminate the persistent SSH connection
      ssh_connection:
        user: "{{ user }}"
        password: "{{ password }}"
        port: "{{ port }}"
        timeout: 60
        persistent: false
        debug: true
