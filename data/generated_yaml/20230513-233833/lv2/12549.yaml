
- name: Test certificate errors
  hosts: all
  vars:
    proxy_server: "http://10.1.1.5:3128"
  tasks:
  - name: Install required packages
    apt:
      name:
        - python-requests
        - python-ndg-httpsclient
        - python-pyasn1
        - ca-certificates
      state: present
  - name: Fetch data from an HTTPS website via proxy
    uri:
      url: https://www.google.com
      method: GET
      return_content: yes
      validate_certs: no
      force_basic_auth: yes
      user: "some_user"
      password: "some_password"
      headers:
        Accept-Language: "en-US"
      proxy_server: "{{ proxy_server }}"
  - name: Verify certificate of HTTPS website via proxy
    uri:
      url: https://www.google.com
      method: HEAD
      validate_certs: yes
      force_basic_auth: yes
      user: "some_user"
      password: "some_password"
      headers:
        Accept-Language: "en-US"
      proxy_server: "{{ proxy_server }}"
