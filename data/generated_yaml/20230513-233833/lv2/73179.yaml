yaml
---
- name: Test for disk full
  hosts: all
  tasks:
    - name: Check disk usage
      shell: df -h
      register: disk_usage

    - name: Fail if disk full
      fail:
        msg: "Disk is Full!"
      when: disk_usage.stdout_lines|select('match', '100%').list|length > 0
