
---
- name: Gather custom facts for Windows targets
  hosts: windows
  gather_facts: no
  vars:
    custom_facts:
      fact1: "Hello World!"
      fact2: "{{ hostvars[inventory_hostname]['ansible_os_family'] }}"
      fact3: "{{ ansible_date_time.date }}"
      fact4: "{{ 1/0 }}"

  tasks:
    - name: Handling exceptions
      block:
        - name: Gathering custom facts
          setup:
            filter: "{{ item }}"
          with_items: "{{ custom_facts | dict2items }}"
      rescue:
        - name: Exception occurred
          debug:
            var: ansible_failed_result.exception
