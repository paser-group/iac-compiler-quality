
---
- name: Test Playbook for gce module errors
  hosts: all
  vars:
    - project_id: "test-project"
    - zone: "us-west1-a"
    - credentials_file: "path/to/credentials.json"
  tasks:
    - name: Install GCP SDK
      apt:
        pkg:
          - python3
          - python3-dev
          - python3-pip
      become: yes
    - name: Install the GCP SDK
      pip:
        name: "google-auth google-auth-oauthlib google-auth-httplib2 google-cloud-sdk"
        executable: /usr/bin/pip3
      become: yes
  
    - name: Sample task using the gce module
      gcp_compute_instance:
        name: "test-instance"
        zone: "{{ zone }}"
        machine_type: "f1-micro"
        image_family: "ubuntu-1804-lts"
        boot_disk_size_gb: 10
        project_id: "{{ project_id }}"
        auth_kind: "client_secret"
        credentials_file: "{{ credentials_file }}"
      register: result
    - name: Print the output of the gce module
      debug:
        var: result
    - name: Configure SSH for instances
      vars:
        ssh_user: ubuntu
        ssh_key_private_file: "/path/to/id_rsa"
        ssh_key_public_file: "/path/to/id_rsa.pub"
      files:
        path: "/home/{{ ssh_user }}/.ssh"
        src: "{{ ssh_key_private_file }}"
        mode: '0600'
      become: yes

    - name: Remove SSH key from the nodes
      command: "rm -f '/home/{{ ssh_user }}/.ssh/{{ ssh_key_public_file.split('/')[-1] }}'"
      become: yes
