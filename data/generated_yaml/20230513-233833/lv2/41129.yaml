
- hosts: all
  become: true
  gather_facts: false
  vars:
    npm_version: 6.14.15
  tasks:
    # Install specific npm version
    - name: Install npm
      apt:
        name: npm={{ npm_version }}
        state: present
      register: install_npm_output

    # Verify npm version
    - name: Verify npm version
      command: npm -v
      register: npm_version_output

    - debug:
        var: npm_version_output.stdout

    # Test npm install with non-existing package
    - name: Test npm install with non-existing package
      command: npm install some-non-existing-package
      register: non_existing_package_output
      ignore_errors: yes

    - debug:
        var: non_existing_package_output.stderr_lines

    # Test npm outdated
    - name: Test npm outdated
      command: npm outdated
      register: outdated_packages_output

    - debug:
        var: outdated_packages_output.stdout_lines

    # Test npm doctor
    - name: Test npm doctor
      command: npm doctor
      register: npm_doctor_output

    - debug:
        var: npm_doctor_output.stderr_lines

    # Test npm config get
    - name: Test npm config get
      command: npm config get
      register: npm_config_output

    - debug:
        var: npm_config_output.stdout_lines

    # Test npm audit
    - name: Test npm audit
      command: npm audit --audit-level high
      register: npm_audit_output

    - debug:
        var: npm_audit_output.stderr_lines

    # Test npm update
    - name: Test npm update
      command: npm update
      register: npm_update_output

    - debug:
        var: npm_update_output.stderr_lines

    # Test npm uninstall
    - name: Test npm uninstall
      command: npm uninstall some-non-existing-package
      register: npm_uninstall_output
      ignore_errors: yes

    - debug:
        var: npm_uninstall_output.stderr_lines
