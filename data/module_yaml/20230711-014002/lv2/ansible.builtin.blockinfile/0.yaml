---
- name: Test blockinfile module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Insert a byte string text block into a file
      ansible.builtin.blockinfile:
        path: /tmp/test_file
        block: |2-
          b"This is a byte string test block\nInserted by Ansible"
        marker: "### ANSIBLE MANAGED BLOCK ###"
      register: result
      ignore_errors: true

    - name: Debug result
      ansible.builtin.debug:
        var: result

    - name: Remove the inserted text block from the file
      ansible.builtin.blockinfile:
        path: /tmp/test_file
        state: absent
        marker: "### ANSIBLE MANAGED BLOCK ###"
      register: result
      ignore_errors: true