---
- name: Ansible Test Playbook - Blockinfile
  hosts: all 
  gather_facts: False

  vars:
    marker_str: '# {mark} ANSIBLE BLOCKINFILE CONTENT'
    insert_str: 'Write content here'

  tasks:
  # Run module tests on ubuntu1
  - name: '[ubuntu1] Initial setup blockinfile'
    ansible.builtin.blockinfile:
      path: /home/ubuntu/test.txt
      create: true
      block: 'test data'
      marker: "{{ marker_str }}"
      insertafter: BOF
    delegate_to: ubuntu1

  # Run module tests on alpine1
  - name: '[alpine1] Initial setup blockinfile'
    ansible.builtin.blockinfile:
      path: /home/alpine/test.txt
      create: true
      block: 'test data'
      marker: "{{ marker_str }}"
      insertafter: BOF
    delegate_to: alpine1

  # Run module tests on centos1
  - name: '[centos1] Initial setup blockinfile'
    ansible.builtin.blockinfile:
      path: /home/centos/test.txt
      create: true
      block: 'test data'
      marker: "{{ marker_str }}"
      insertafter: BOF
    delegate_to: centos1
  
  # Run module tests on redhat1
  - name: '[redhat1] Initial setup blockinfile'
    ansible.builtin.blockinfile:
      path: /home/redhat/test.txt
      create: true
      block: 'test data'
      marker: "{{ marker_str }}"
      insertafter: BOF
    delegate_to: redhat1

  # Test case based on heuristic 'Create configuration values that incorporate both bytes and strings.'
  - name: "Heuristic Test Case - Create configuration values that incorporate both bytes and strings"
    ansible.builtin.blockinfile:
      path: /home/{{ ansible_hostname }}/test.txt
      block: !unsafe '{{ insert_str }}'