---
- name: Test Ansible apt_repository module for type-related bugs via mixed case sensitivity
  hosts: ubuntu1
  gather_facts: False
  tasks:
    - name: Ensure the required python package for apt module is there
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)

    - name: Add an apt repository with lowercase state
      ansible.builtin.apt_repository:
        repo: 'deb http://archive.ubuntu.com/ubuntu bionic main'
        state: present
        install_python_apt: yes
      register: lowercase_result

    - name: Add an apt repository with uppercase state
      ansible.builtin.apt_repository:
        repo: 'deb http://archive.ubuntu.com/ubuntu bionic main'
        state: PRESENT
        install_python_apt: yes
      register: uppercase_result
      ignore_errors: yes

    - name: Assert that adding a repository with lowercase and uppercase state are marked as different
      assert:
        that:
          - 'lowercase_result is changed'
          - 'uppercase_result is failed'
        fail_msg: "Test Failed - 'state' parameter should be case-sensitive."
        success_msg: "Test Passed - 'state' parameter is case-sensitive."

    - name: Remove the introduced apt repository, if there any
      ansible.builtin.apt_repository:
        repo: 'deb http://archive.ubuntu.com/ubuntu bionic main'
        state: absent