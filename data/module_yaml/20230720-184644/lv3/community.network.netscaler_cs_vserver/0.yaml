---
- name: Configure Netscaler CS Vserver
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: admin
    nitro_pass: admin
    nitro_protocol: http
    nitro_timeout: 10

  tasks:
    - name: Create Netscaler CS Vserver
      community.network.netscaler_cs_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        name: "vserver1"
        state: present
        comment: "This is a test vserver"
        servicetype: "HTTP"
        port: 80
        ipmask: "255.255.255.0"
        ipv46: "10.1.1.1"
        backupvserver: "bkup_vserver"
        cacheable: true
        cookietimeout: 180
        domainname: "example.com"
        httpprofilename: "http_profile"
        whm_enabled: true
        whm_config:
          - bindpoint: "VIP"
            port: 8080
            protocol: "TCP"
            weight: 10
          - bindpoint: "VIP"
            port: 8443
            protocol: "TCP"
            weight: 20

    - name: Create Backup Vserver
      community.network.netscaler_cs_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        name: "bkup_vserver"
        state: present
        comment: "This is a backup vserver"
        servicetype: "HTTP"
        port: 81
        ipmask: "255.255.255.0"
        ipv46: "10.1.1.2"

    # Additional tasks for validation or other tests