---
- name: Apply patch files using ansible.posix.patch module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Apply patch file
      ansible.posix.patch:
        dest: /tmp/file.txt
        src: /tmp/patch.diff
        state: "{{ state }}"
        backup: "{{ backup }}"
        ignore_whitespace: "{{ ignore_whitespace }}"
        remote_src: "{{ remote_src }}"
        strip: "{{ strip }}"
        basedir: "{{ basedir }}"
        binary: "{{ binary }}"
      register: result

    - debug:
        var: result

    - name: Verify patch applied
      ansible.builtin.shell: cat /tmp/file.txt
      register: patch_content

    - debug:
        var: patch_content.stdout

    # Add more tasks if necessary

  vars:
    state: absent
    backup: yes
    ignore_whitespace: yes
    remote_src: yes
    strip: "2"
    basedir: "/tmp"
    binary: no