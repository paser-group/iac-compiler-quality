- name: Test playbook for community.general.proxmox_snap module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required packages
      package:
        name: python3-pexpect
        state: present

    - name: Create configuration values with bytes and strings
      set_fact:
        api_host: "{{ '10.1.1.1' | b64encode }}"
        api_password: "{{ 'password' }}"
        api_token_id: "{{ 'token_id' }}"
        api_token_secret: "{{ 'token_secret' | b64encode }}"
        api_user: "{{ 'admin' }}"
        description: "{{ 'Snapshot description' }}"
        force: "{{ true }}"
        hostname: "{{ 'proxmox.example.com' }}"
        snapname: "{{ 'snapshot_name' }}"
        state: "{{ 'present' }}"
        timeout: "{{ 60 }}"
        unbind: "{{ false }}"
        validate_certs: "{{ true }}"
        vmid: "{{ '100' }}"
        vmstate: "{{ true }}"

    - name: Show configuration values
      debug:
        var: item
      loop:
        - api_host
        - api_password
        - api_token_id
        - api_token_secret
        - api_user
        - description
        - force
        - hostname
        - snapname
        - state
        - timeout
        - unbind
        - validate_certs
        - vmid
        - vmstate

    - name: Test community.general.proxmox_snap module
      community.general.proxmox_snap:
        api_host: "{{ api_host }}"
        api_password: "{{ api_password }}"
        api_token_id: "{{ api_token_id }}"
        api_token_secret: "{{ api_token_secret }}"
        api_user: "{{ api_user }}"
        description: "{{ description }}"
        force: "{{ force }}"
        hostname: "{{ hostname }}"
        snapname: "{{ snapname }}"
        state: "{{ state }}"
        timeout: "{{ timeout }}"
        unbind: "{{ unbind }}"
        validate_certs: "{{ validate_certs }}"
        vmid: "{{ vmid }}"
        vmstate: "{{ vmstate }}"