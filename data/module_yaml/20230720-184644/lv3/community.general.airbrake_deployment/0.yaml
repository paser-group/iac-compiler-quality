---
- name: Test Playbook
  hosts: localhost
  gather_facts: false
  
  vars:
    airbrake_env: "{{ lookup('env', 'AIRBRAKE_ENV') | default('production') }}"
    airbrake_project_id: 123456
    airbrake_project_key: "{{ vault_airbrake_project_key }}"
    airbrake_repo: myapp
    airbrake_revision: v1.0
    airbrake_url: https://notify.airbrake.io
    airbrake_user: admin
    airbrake_validate_certs: true
    airbrake_version: 2.3.1

  tasks:
    - name: Include required Ansible Galaxy collections
      include_collections:
        - community.general

    - name: Install airbrake_deployment requirements
      community.general.airbrake_deployment:
        env: "{{ airbrake_env }}"
        project_id: "{{ airbrake_project_id }}"
        project_key: "{{ airbrake_project_key }}"
        repo: "{{ airbrake_repo }}"
        revision: "{{ airbrake_revision }}"
        url: "{{ airbrake_url }}"
        user: "{{ airbrake_user }}"
        validate_certs: "{{ airbrake_validate_certs }}"
        version: "{{ airbrake_version }}"
      register: result

    - name: Print airbrake_deployment result
      debug:
        var: result