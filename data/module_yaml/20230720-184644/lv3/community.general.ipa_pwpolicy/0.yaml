---
- name: Test IPA Password Policy
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set Password Policy
      community.general.ipa_pwpolicy:
        failinterval: "{{ interval | default('24h') }}"
        group: "admins"
        historylength: "{{ length | default('5') }}"
        ipa_host: "ipa-server.example.com"
        ipa_pass: "password"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 60
        ipa_user: "admin"
        lockouttime: '300'
        maxfailcount: "{{ max_fail_count | default('3') }}"
        maxpwdlife: "{{ max_life | default('90d') }}"
        minclasses: "{{ min_char_classes | default('3') }}"
        minlength: "8"
        minpwdlife: 1h  # Intentionally omitting quotes to expose type-related bugs
        priority: "per-user"
        state: present
        validate_certs: true

  vars:
    interval: "24h"
    length: "5"
    max_fail_count: "3"
    max_life: "90d"
    min_char_classes: "3"