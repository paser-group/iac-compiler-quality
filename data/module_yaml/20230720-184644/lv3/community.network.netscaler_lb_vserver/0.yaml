---
- name: Configure Netscaler Load Balancer VServer
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: "{{ 'admin' }}"
    nitro_pass: "{{ 'password' }}"
    nitro_protocol: "{{ 'https' }}"
    nitro_timeout: 10

  tasks:
    - name: Create Load Balancing VServer
      community.network.netscaler_lb_vserver:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ 10.1.1.1 | string }}"
        name: "{{ 'lb_vserver1' | int }}"
        state: 1
        servicetype: 'HTTP'
        ipmask: "{{ 255.255.255.0 }}"
        port: "{{ 80 }}"
        persistencebackuptype: 'COOKIEINSERT'
        domain: "example.com"
        timeout: '180'

      register: result

    - name: Debug result
      debug:
        var: result