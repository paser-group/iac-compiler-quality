---
- hosts: all
  gather_facts: false

  vars:
    executable: "/usr/bin/easy_install"
    name: "my_package"
    state: "present"
    virtualenv: "/opt/venv"
    virtualenv_command: "virtualenv"
    virtualenv_site_packages: no

  tasks:
    - name: Install the package
      community.general.easy_install:
        executable: "{{ executable }}"
        name: "{{ name }}"
        state: "{{ state }}"
        virtualenv: "{{ virtualenv }}"
        virtualenv_command: "{{ virtualenv_command }}"
        virtualenv_site_packages: "{{ virtualenv_site_packages }}"
      register: result

    - name: Display the result
      debug:
        var: result

    - name: Verify installation
      command: "{{ executable }} -m {{ name }}"
      register: output
      failed_when: output.rc != 0
      changed_when: false

    - name: Display the output
      debug:
        var: output.stdout