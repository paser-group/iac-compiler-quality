---
- name: Test Playbook for avi_poolgroupdeploymentpolicy module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Create PoolGroupDeploymentPolicy
      community.network.avi_poolgroupdeploymentpolicy:
        controller: "https://{{ controller }}/api"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        name: "MyPoolGroupDeploymentPolicy"
        state: present
        rules:
          - name: "{{ 'Rule1' | int }}"
            index: "{{ '1' | int }}"
            enable: "{{ true | string }}"
            pools:
              - pool_ref: "/api/pool/MyPool1"
                weight: "{{ 1 | string }}"
            labels:
              - key: "{{ 'label1' | b64encode }}"
                value: "{{ 'value1' }}"
          - name: "{{ 'Rule2' | int }}"
            index: "{{ '2' | int }}"
            enable: "{{ true | string }}"
            pools:
              - pool_ref: "/api/pool/MyPool2"
                weight: "{{ 1 | string }}"
            labels:
              - key: "{{ 'label2' | b64encode }}"
                value: "{{ 'value2' }}"
      register: result

    - name: Debug result
      debug:
        var: result