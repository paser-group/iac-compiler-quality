- name: Manipulate entries in Consul key/value store
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set a key/value entry with bytes value
      community.general.consul_kv:
        host: "{{ host }}"
        port: "{{ port }}"
        scheme: "{{ scheme }}"
        key: "/mykey"
        value: !unsafe "{{ my_bytes_value }}"
      when: flag_bytes | bool

    - name: Set a key/value entry with string value
      community.general.consul_kv:
        host: "{{ host }}"
        port: "{{ port }}"
        scheme: "{{ scheme }}"
        key: "/mykey"
        value: "{{ my_string_value }}"
      when: not flag_bytes | bool

  vars:
    host: "localhost"
    port: 8500
    scheme: "http"
    flag_bytes: true
    my_bytes_value: "hello world"  # This will trigger a type-related bug
    my_string_value: "hello world"