---
- name: Test influxdb_query module
  hosts: localhost
  connection: local
  gather_facts: False

  vars:
    influxdb_host: "10.1.1.1"
    influxdb_port: "{{ '8086' | int }}"
    influxdb_username: "{{ 'admin' | to_bytes }}"
    influxdb_password: "{{ 'password' | to_bytes }}"
    influxdb_database: "mydb"

  tasks:
    - name: Query data from InfluxDB
      community.general.influxdb_query:
        hostname: "{{ influxdb_host }}"
        port: "{{ influxdb_port }}"
        username: "{{ influxdb_username }}"
        password: "{{ influxdb_password }}"
        database_name: "{{ influxdb_database }}"
        query: "SELECT * FROM measurement"
      register: result

    - name: Display query result
      debug:
        var: result