---
- name: Update backend configuration of OpenDJ
  hosts: localhost
  gather_facts: false

  vars:
    backend: "userRoot"
    hostname: "localhost"
    name: "db-cache-percent"
    opendj_bindir: "/opt/opendj/bin"
    password: "admin123"
    passwordfile: "/tmp/password-file"
    port: "389"
    state: "present"
    username: "admin"
    value: "50"

  tasks:
    - name: Create a temporary password file
      copy:
        content: "{{ password }}"
        dest: "{{ passwordfile }}"
      when: not passwordfile is file

    - name: Update the backend configuration
      community.general.opendj_backendprop:
        backend: "{{ backend }}"
        hostname: "{{ hostname }}"
        name: "{{ name }}"
        opendj_bindir: "{{ opendj_bindir }}"
        password: "{{ password }}"
        passwordfile: "{{ passwordfile }}"
        port: "{{ port }}"
        state: "{{ state }}"
        username: "{{ username }}"
        value: "{{ value }}"
      register: result

    - name: Display the result
      debug:
        var: result