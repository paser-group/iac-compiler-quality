---
- name: Test Ansible Latent Type-Related Bugs (LDAP Search)
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Test Case 1 - LDAP Search with byte attributes
      community.general.ldap_search:
        server_uri: ldap://{{ inventory_hostname }}
        bind_dn: "{{ ldap_bind_dn }}"
        bind_pw: "{{ ldap_bind_pw }}"
        dn: "{{ ldap_dn }}"
        filter: "(objectClass=*)"
        attrs:
          - attribute1: "{{ ldap_attr1 | to_bytes }}"
          - attribute2: "{{ ldap_attr2 | to_bytes }}"
      register: result_case1

    - debug:
        var: result_case1

    - name: Test Case 2 - LDAP Search with string attributes
      community.general.ldap_search:
        server_uri: ldap://{{ inventory_hostname }}
        bind_dn: "{{ ldap_bind_dn }}"
        bind_pw: "{{ ldap_bind_pw }}"
        dn: "{{ ldap_dn }}"
        filter: "(objectClass=*)"
        attrs:
          - attribute1: "{{ ldap_attr1 }}"
          - attribute2: "{{ ldap_attr2 }}"
      register: result_case2

    - debug:
        var: result_case2