---
- name: Trigger type-related bug in community.general.stackdriver module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set annotated_by variable (str)
      set_fact:
        annotated_by: "John Doe"

    - name: Create configuration values with bytes and strings
      set_fact:
        event: event
        event_epoch: "1627441338"
        instance_id: i-12345
        key: mykey
        level: 'ERROR'
        msg: "This is an error message"
        repository: myrepo
        revision_id: 'abcdefg'

    - name: Deploy code
      community.general.stackdriver:
        deployed_to: myinstance
        deployed_by: "{{ annotated_by }}"
        level: "{{ level }}"
        msg: "{{ msg }}"

    - name: Annotate code deployment
      community.general.stackdriver:
        event: "{{ event }}"
        event_epoch: "{{ event_epoch }}"
        instance_id: "{{ instance_id }}"
        key: "{{ key }}"
        msg: "{{ msg }}"

    - name: Create annotation with repository and revision ID
      community.general.stackdriver:
        event: deploy
        level: "{{ level }}"
        msg: "{{ msg }}"
        repository: "{{ repository }}"
        revision_id: "{{ revision_id }}"