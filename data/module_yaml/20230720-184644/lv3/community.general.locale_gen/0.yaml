---
- name: Test Ansible Latent Type-Related Bug - community.general.locale_gen
  hosts: all
  become: true

  tasks:
    - name: Install required package
      package:
        name: locales
        state: present

    - name: Generate locale configuration
      community.general.locale_gen:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      loop:
        - { name: "en_US.UTF-8", state: "present" }
        - { name: b"en_US.UTF-8", state: "absent" }

    - name: Display locale configuration
      command: locale
      register: locale_output

    - name: Debug locale output
      debug:
        var: locale_output.stdout_lines