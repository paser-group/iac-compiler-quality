---
- name: Ansible Ali Instance Playbook
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create Ali Instance
      community.general.ali_instance:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        instance_type: ecs.t5-lc1m2.small
        image_id: centos_7_04_64_20G_alibase_201701015.vhd
        internet_charge_type: PayByTraffic
        internet_max_bandwidth_out: 1
        allocate_public_ip: true
        security_group_id: sg-j6cze6pcazm9nj8dav3k
        instance_name: test-instance
        instance_tags:
          Name: test-instance
      register: instance

    - name: Start Ali Instance
      community.general.ali_instance:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        instance_id: "{{ instance.instance_id }}"
        state: started

    - name: Stop Ali Instance
      community.general.ali_instance:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        instance_id: "{{ instance.instance_id }}"
        state: stopped

    - name: Restart Ali Instance
      community.general.ali_instance:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        instance_id: "{{ instance.instance_id }}"
        state: restarted

    - name: Terminate Ali Instance
      community.general.ali_instance:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        instance_id: "{{ instance.instance_id }}"
        state: absent