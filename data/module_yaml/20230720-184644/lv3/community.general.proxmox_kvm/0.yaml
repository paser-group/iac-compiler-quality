---
- name: Ansible Latent Bug Finder - Proxmox KVM Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Proxmox KVM Virtual Machine
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "your_username"
        api_password: "your_password"
        vmid: 100
        name: "test_vm"
        description: "Test VM"
        state: "present"
        memory: 2048
        cores: 2
        disk: "local-lvm:50"
        networks:
          - model: "virtio"
            macaddr: "52:54:00:12:34:56"
            bridge: "vmbr0"
        boot: "c"
        os_type: "l26"
        onboot: true
        force: true
        timeout: 180
        validate_certs: false
        tdf: true
        tablet: true
        agent: "qemu-ga"
        sshkeys:
          - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD..."
        tags:
          - "tag1"
          - "tag2"
        update: true
        protection: true
        hotplug: "network,usb"

    - name: Update Proxmox KVM Virtual Machine
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "your_username"
        api_password: "your_password"
        vmid: 100
        name: "test_vm"
        state: "started"
        timeout: 120
        validate_certs: false
        tdf: false

    - name: Delete Proxmox KVM Virtual Machine
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "your_username"
        api_password: "your_password"
        vmid: 100
        name: "test_vm"
        state: "absent"
        timeout: 120
        validate_certs: false
        tdf: false