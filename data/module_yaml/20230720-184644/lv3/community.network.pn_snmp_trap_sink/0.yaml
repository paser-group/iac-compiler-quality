---
- name: Ansible Latent Type-Related Bug Finder
  hosts: localhost
  gather_facts: False

  vars:
    pn_cliswitch: switch1
    pn_community: public
    pn_dest_host: 10.1.1.1
    pn_dest_port: 162
    pn_type: trap
    state: present

  tasks:
    - name: Execute pn_snmp_trap_sink module
      community.network.pn_snmp_trap_sink:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_community: "{{ pn_community }}"
        pn_dest_host: "{{ pn_dest_host }}"
        pn_dest_port: "{{ pn_dest_port }}"
        pn_type: "{{ pn_type }}"
        state: "{{ state }}"
      register: result

    - debug:
        var: result

    - name: Assert bug triggering condition
      assert:
        that:
          - "successful in result.stdout"
        fail_msg: "A type-related bug has not been triggered!"