- name: Test ansible_module for community.network.avi_applicationpersistenceprofile
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Avi credentials
      set_fact:
        avi_credentials:
          username: "admin"
          password: "password"
          controller: "https://avi-controller.example.com"

    - name: Test case - Create persistence profile with mixed byte and string values
      community.network.avi_applicationpersistenceprofile:
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ avi_credentials.controller }}"
        state: present
        name: "test-profile"
        tenant: "Default"
        persistence_type: "PERSISTENCE_TYPE_HTTP_COOKIE"
        http_cookie_persistence_profile:
          timeout: "60s"
          httponly: "true"
          secure: "false"
          insert_xforwarded_for: "true"
          change_timeout: "300s"
          cache_persistence_profile:
            cache_config:
              cache_size: "100MB"
              mem_limit: 1GB

    - name: Test case - Create persistence profile with invalid byte value
      community.network.avi_applicationpersistenceprofile:
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ avi_credentials.controller }}"
        state: present
        name: "test-profile-invalid"
        tenant: "Default"
        persistence_type: "PERSISTENCE_TYPE_HTTP_COOKIE"
        http_cookie_persistence_profile:
          timeout: "60s"
          httponly: "definitely"
          secure: "false"
          insert_xforwarded_for: "true"
          change_timeout: "300s"
          cache_persistence_profile:
            cache_config:
              cache_size: "100MB"
              mem_limit: 1GB

    - name: Test case - Create persistence profile with invalid string value
      community.network.avi_applicationpersistenceprofile:
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ avi_credentials.controller }}"
        state: present
        name: "test-profile-invalid"
        tenant: "Default"
        persistence_type: "PERSISTENCE_TYPE_HTTP_COOKIE"
        http_cookie_persistence_profile:
          timeout: "60s"
          httponly: "true"
          secure: "probably"
          insert_xforwarded_for: "true"
          change_timeout: "300s"
          cache_persistence_profile:
            cache_config:
              cache_size: "100MB"
              mem_limit: 1GB