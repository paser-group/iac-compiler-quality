---
- name: OpenAPI Controller PKI Profile Configuration
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create PKI Profile
      community.network.avi_pkiprofile:
        controller: "https://{{ inventory_hostname }}"
        username: "admin"
        password: "password"
        state: present
        name: "test-pki-profile"
        api_context:
          tenant_uuid: "{{ tenant_uuid }}"
        ignore_peer_chain: true
        validate_only_leaf_crl: true
        crl_check: false
        crls:
          - uri: "http://example.com/crl01.crl"
            name: "CRL01"
          - uri: "http://example.com/crl02.crl"
            name: "CRL02"
        ca_certs:
          - uri: "http://example.com/cacert01.pem"
            name: "CA Cert 01"
          - uri: "http://example.com/cacert02.pem"
            name: "CA Cert 02"

    - name: Update PKI Profile
      community.network.avi_pkiprofile:
        controller: "https://{{ inventory_hostname }}"
        username: "admin"
        password: "password"
        state: present
        name: "test-pki-profile"
        api_context:
          tenant_uuid: "{{ tenant_uuid }}"
        ignore_peer_chain: true
        validate_only_leaf_crl: true
        crl_check: true
        crls:
          - uri: "http://example.com/crl01.crl"
            name: "CRL01"
          - uri: "http://example.com/crl02.crl"
            name: "CRL02"
          - uri: "http://example.com/crl03.crl"
            name: "CRL03"
        ca_certs:
          - uri: "http://example.com/cacert01.pem"
            name: "CA Cert 01"
          - uri: "http://example.com/cacert02.pem"
            name: "CA Cert 02"
          - uri: "http://example.com/cacert03.pem"
            name: "CA Cert 03"

    - name: Delete PKI Profile
      community.network.avi_pkiprofile:
        controller: "https://{{ inventory_hostname }}"
        username: "admin"
        password: "password"
        state: absent
        name: "test-pki-profile"
        api_context:
          tenant_uuid: "{{ tenant_uuid }}"