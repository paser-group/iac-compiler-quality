- name: Manage Bitbucket Access Key
  hosts: all
  gather_facts: false
  become: true

  tasks:
    - name: Install required Python packages
      pip:
        name: atlassian-python-api
        state: present

    - name: Manage Bitbucket Access Key
      community.general.bitbucket_access_key:
        client_id: "{{ client_id }}"
        client_secret: "{{ client_secret }}"
        key: "{{ key }}"
        label: "{{ label }}"
        password: "{{ password }}"
        repository: "{{ repository }}"
        state: "{{ state }}"
        user: "{{ user }}"
        workspace: "{{ workspace }}"
      register: bitbucket_access_key_result

    - name: Debug Bitbucket Access Key result
      debug:
        var: bitbucket_access_key_result