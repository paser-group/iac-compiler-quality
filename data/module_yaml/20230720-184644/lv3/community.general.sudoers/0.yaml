---
- name: Test playbook for community.general.sudoers module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create sudoers configuration
      community.general.sudoers:
        name: ansible_user
        sudoers_path: /etc/sudoers.d
        state: present
        user: "%ansible_user"
        nopassword: True
        setenv: False
        sudoers_vars:
          commands:
            - "/bin/echo"
            - "/usr/bin/id"
            - "/usr/sbin/visudo"
          groups: "wheel"
          hosts: "ALL"
          runas: "ALL"
          validation: "validate"

    - name: Create configuration values with bytes and strings
      community.general.sudoers:
        name: ansible_bytes
        sudoers_path: /etc/sudoers.d
        state: present
        user: "%ansible_bytes"
        nopassword: True
        setenv: False
        sudoers_vars:
          commands: "echo"
          groups: ["wheel"]
          hosts: b"bytes_host"
          runas: b"ALL"
          validation: "validate"

    - name: Remove sudoers configuration
      community.general.sudoers:
        name: ansible_user
        sudoers_path: /etc/sudoers.d
        state: absent
        user: "%ansible_user"
        nopassword: True
        setenv: False

    - name: Remove configuration values with bytes and strings
      community.general.sudoers:
        name: ansible_bytes
        sudoers_path: /etc/sudoers.d
        state: absent
        user: "%ansible_bytes"
        nopassword: True
        setenv: False