---
- name: Test Elasticsearch Plugin
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Elasticsearch Plugin
      community.general.elasticsearch_plugin:
        name: "my_plugin"
        version: "{{ random_version }}"
        state: present
        src: "/path/to/plugin.zip"
        plugin_bin: "/usr/bin/elasticsearch"
        plugin_dir: "/usr/share/elasticsearch/plugins"
        timeout: "10s"
        force: "{{ random_force }}"
        url: "http://example.com/my_plugin.zip"
        proxy_host: "{{ random_proxy_host }}"
        proxy_port: "{{ random_proxy_port }}"
      vars:
        random_version: "{{ random_item(versions) }}"
        random_force: "{{ random_item([true, false]) }}"
        random_proxy_host: "{{ random_item(proxy_hosts) }}"
        random_proxy_port: "{{ random_item(proxy_ports) }}"
        versions:
          - "6.0.0"
          - "6.1.0"
          - "6.2.0"
          - "6.3.0"
          - "6.4.0"
        proxy_hosts:
          - "proxy1.example.com"
          - "proxy2.example.com"
          - ""
        proxy_ports:
          - "8080"
          - "3128"
          - ""

    - name: Print Plugin Info
      debug:
        var: ansible_facts.elasticsearch_plugin_info.my_plugin