---
- name: Test A10 Networks AX/SoftAX/Thunder/vThunder configuration
  hosts: localhost
  gather_facts: false

  vars:
    a10_server_config:
      - server_ip: 10.1.1.1
        server_ports: null
        state: present
        url: "http://{{ inventory_hostname }}/api/endpoint"
        use_proxy: true
        validate_certs: false
        write_config: true
        client_cert: "./client_cert.pem"
        client_key: "./client_key.pem"
        force: 1
        force_basic_auth: "true"
        host: "{{ inventory_hostname }}"
        http_agent: 12345
        password: "{{ lookup('env', 'A10_SERVER_PASSWORD') }}"
        username: admin

  tasks:
    - name: Ensure A10 Networks server configuration
      community.network.a10_server:
        provider:
          host: "{{ host }}"
          username: "{{ username }}"
          password: "{{ password }}"
          use_proxy: "{{ use_proxy }}"
          validate_certs: "{{ validate_certs }}"
        config: "{{ a10_server_config }}"
      register: result

    - name: Debug A10 Networks server configuration
      debug:
        var: result