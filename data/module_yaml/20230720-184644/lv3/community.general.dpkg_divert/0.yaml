---
- name: Test playbook for community.general.dpkg_divert
  hosts: localhost
  gather_facts: false

  vars:
    divert_path: /etc/default/foo
    divert_force: true
    divert_holder: foo
    divert_rename: true
    divert_state: present

  tasks:
    - name: Override Debian package
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ divert_force }}"
        holder: "{{ divert_holder }}"
        path: "{{ divert_path }}.orig"
        rename: "{{ divert_rename }}"
        state: "{{ divert_state }}"

    - name: Test case: Configuration with bytes and strings
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ divert_force }}"
        holder: "{{ divert_holder }}"
        path: "{{ divert_path }}.orig"
        rename: "{{ divert_rename }}"
        state: "{{ divert_state }}"
        bytes_attr: !!python/bytes "test bytes value"
        str_attr: "test string value"

    - name: Test case: Configuration without bytes and strings
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ divert_force }}"
        holder: "{{ divert_holder }}"
        path: "{{ divert_path }}.orig"
        rename: "{{ divert_rename }}"
        state: "{{ divert_state }}"

    - name: Test case: Configuration with invalid bytes
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ divert_force }}"
        holder: "{{ divert_holder }}"
        path: "{{ divert_path }}.orig"
        rename: "{{ divert_rename }}"
        state: "{{ divert_state }}"
        bytes_attr: "invalid bytes value"

    - name: Test case: Configuration with invalid strings
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ divert_force }}"
        holder: "{{ divert_holder }}"
        path: "{{ divert_path }}.orig"
        rename: "{{ divert_rename }}"
        state: "{{ divert_state }}"
        str_attr: 12345