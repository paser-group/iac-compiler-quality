---
- name: Test playbook for 'community.general.pulp_repo' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add Pulp repository
      pulp_repo:
        name: myrepo
        state: present
        repo_type: 'rpm'
        feed: 'https://example.com/my-repo'
        use_proxy: true
        proxy_host: 'proxy.example.com'
        proxy_port: '8080'
        proxy_username: 'proxyuser'
        proxy_password: b'mypassword'
        use_gssapi: false
        validate_certs: false
        feed_ca_cert: |
          -----BEGIN CERTIFICATE-----
          MIICszCCAjOgAwIBAgIUMKQejMqXBybq/UfuKadce8ViS6kwDQYJKoZIhvcNAQEL
          BQAwejELMAkGA1UEBhMCVVMxFjAUBgNVBAgMDU1hc3NhY2h1c2V0dHMxEzARBgNV
          ...
          UG1rDCBQg==
          -----END CERTIFICATE-----
        feed_client_cert: |
          -----BEGIN CERTIFICATE-----
          MIIG7zCCBdOgAwIBAgIUFq4sjHKfKGR4dQ981FBY0ZB4SOQwDQYJKoZIhvcNAQEL
          BQAwfjELMAkGA1UEBhMCVVMxGTAXBgNVBAgMEFNhbiBKb3NlIFN0cmF0ZWdvcnkm
          ...
          KD2QU1My9Fjo7RR0OT0NOBMrrcnP/jNwi9t00q12Q3jAlFtXh27l7i/OWD2RiK3+
          60mc7hmpTMlT5w==
          -----END CERTIFICATE-----
        feed_client_key: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEowIBAAKCAQEAw17BjYHsdOp6PLKZLROU6AYcFTnTGe3grGrcGHJh6EKv59Ut
          bNaGCxy7uKcTkupkbV0km2JckIH6vgfS5eewX2DKYlOQp0rPh8NS3HQRJ2Ka2u7N
          ...
          20ZR8ZUeC94Mw9aDZoO+avpRE0/zgLMw7iMEHajHwQoCek6LopE=
          -----END RSA PRIVATE KEY-----
        publish_distributor: 'mydistributor'
        add_export_distributor: true
        repoview: true
        generate_sqlite: false
        wait_for_completion: true
        serve_http: true
        serve_https: false
        http_agent: 'Mozilla/5.0'
        client_cert: 'clientcert.pem'
        client_key: 'clientkey.pem'
        url_username: 'myusername'
        url_password: 'mypassword'
        force: false
        force_basic_auth: true
        pulp_host: 'pulp.example.com'
        relative_url: '/pulp/repos'

      register: result

    - debug:
        var: result