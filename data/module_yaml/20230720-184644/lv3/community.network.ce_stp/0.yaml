---
- name: Manage STP configuration on HUAWEI
  hosts: node-net
  gather_facts: false
  tasks:
    - name: Configure STP
      community.network.ce_stp:
        provider:
          host: "{{ inventory_hostname }}"
          username: admin
          password: secret
          transport: cli
        bpdu_filter: "true"
        bpdu_protection: 10
        cost: "2000"
        edged_port: ["GigabitEthernet0/0/1", "GigabitEthernet0/0/2"]
        interface: "GigabitEthernet0/0/3"
        loop_protection: true
        root_protection: false
        state: "present"
        stp_converge: "yes"
        stp_enable: "enable"
        stp_mode: 1
        tc_protection: "disabled"
        tc_protection_interval: "3000"
        tc_protection_threshold: 1000
      register: result
    - debug:
        var: result