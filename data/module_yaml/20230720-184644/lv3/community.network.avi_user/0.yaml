---
- name: Create and Configure Avi User
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include Avi User module
      include_role:
        name: community.network.avi_user

      vars:
        avi_user_config:
          - name: test_user
            tenant: Default
            username: admin
            password: "{{ my_password | b64encode }}"
            email: test@example.com
            tenant_uuid: "{{ lookup('vars', 'tenant_uuid') }}"
            user_profile_ref: admin
            is_superuser: yes
            state: present
            controller: "{{ inventory_hostname }}"
      
    - name: Print Avi User Config
      debug:
        var: avi_user_config

  vars:
    my_password: "<password_value>"