---
- name: Test Ansible Latent Bug Finder & Heuristic Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create virtual machine
      community.general.one_vm:
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        attributes:
          NAME: "test-vm"
          MEMORY: 1024
          VCPUTYPE: default
          VCPU: "1"
          DISK: "[ DRIVER='qcow2', SOURCE='/var/lib/one/datastore/0/47/disk.0', TARGET='vda', FORMAT='qcow2', CLONE='YES' ]"
          VNC: "YES"
          GRAPHICS: "VDISPLAY='VNC', KEYMAP='en_US', LISTEN='0.0.0.0'"
          NIC: MODEL='virtio'
          TEMPLATE: "base-vm"
          CONTEXT:
            NETWORK: "YES"
            SSH_PUBLIC_KEY: 123456789
          LABELS: "role=web-server"
        count: 1
      register: vm_creation_result

    - name: Debug
      debug:
        var: vm_creation_result