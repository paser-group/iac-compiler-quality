---
- name: Test Aerospike Migrations Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Check or wait for Aerospike migrations
      community.general.aerospike_migrations:
        host: "{{ inventory_hostname }}"
        port: 3000
        connects_timeout: "10s"
        consecutive_good_checks: 3
        fail_on_cluster_change: true
        migrate_rx_key: "receive"
        migrate_tx_key: "transmit"
        min_cluster_size: "3"
        sleep_between_checks: "5s"
        target_cluster_size: 5
        tries_limit: "10"
      register: migration_result

    - name: Print migration result
      debug:
        var: migration_result