---
- name: Test RAX network module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create RAX network
      community.general.rax_network:
        api_key: "{{ lookup('env', 'RAX_API_KEY') }}"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        cidr: "10.1.1.0/24"
        credentials: "/path/to/credentials"
        env: "production"
        identity_type: "rackspace"
        label: "my_network"
        region: "DFW"
        state: "present"
        tenant_id: "my_tenant_id"
        tenant_name: "my_tenant_name"
        username: "my_username"
        validate_certs: true
      register: network_result

    - name: Display network creation result
      debug:
        var: network_result

    - name: Delete RAX network
      community.general.rax_network:
        api_key: "{{ lookup('env', 'RAX_API_KEY') }}"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        region: "DFW"
        label: "my_network"
        state: "absent"
        credentials: "/path/to/credentials"
        env: "production"
        identity_type: "rackspace"
        tenant_id: "my_tenant_id"
        tenant_name: "my_tenant_name"
        username: "my_username"
        validate_certs: true
      register: delete_result

    - name: Display network deletion result
      debug:
        var: delete_result