---
- name: Test playbook for community.general.ipa_service module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include localhost in inventory
      add_host:
        name: localhost
        ansible_connection: local

    - name: Install required dependencies
      package:
        name: python3-ipaclient
        state: present

    - name: Create IPA service
      community.general.ipa_service:
        state: present
        ipa_user: admin
        ipa_pass: admin123
        ipa_host: "{{ item }}"
      loop:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3
        - 10.1.1.4
      register: ipa_service_result

    - name: Print IPA service result
      debug:
        var: ipa_service_result