---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create GitLab project
      community.general.gitlab_project:
        name: "test-project"
        description: "This is a test project"
        url: "http://gitlab.example.com"
        token: 12345
        default_branch: master
        visibility: private
        only_allow_merge_if_all_discussions_are_resolved: yes
        state: absent
      register: result1

    - debug:
        var: result1

    - name: Update GitLab project
      community.general.gitlab_project:
        name: "test-project"
        description:
          - This is a multi-line description
          - It should accept both strings and bytes
        url: "http://gitlab.example.com"
        token: "abc123"
        default_branch: "develop"
        visibility: public
        only_allow_merge_if_pipeline_succeeds: True
        state: present
      register: result2

    - debug:
        var: result2