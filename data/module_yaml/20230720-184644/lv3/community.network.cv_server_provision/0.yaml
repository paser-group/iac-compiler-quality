---
- name: Test playbook for Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Provision server port with template configuration
      community.network.cv_server_provision:
        action: "{{ item.action | default(omit) }}"
        auto_run: "{{ item.auto_run }}"
        host: "{{ item.host | default(omit) }}"
        password: "{{ item.password | default(omit) }}"
        port: "{{ item.port | default(omit) }}"
        port_vlan: "{{ item.port_vlan | default(omit) }}"
        protocol: "{{ item.protocol | default(omit) }}"
        server_name: "{{ item.server_name | default(omit) }}"
        switch_name: "{{ item.switch_name | default(omit) }}"
        switch_port: "{{ item.switch_port | default(omit) }}"
        template: "{{ item.template | default(omit) }}"
        username: "{{ item.username | default(omit) }}"
      loop:
        - action: apply
          auto_run: true
          host: 10.1.1.1
          password: mypassword
          port: 80
          port_vlan: "{{ b'vlan10' }}"
          protocol: "{{ b'http' }}"
          server_name: "{{ b'myserver' }}"
          switch_name: myswitch
          switch_port: "{{ b'port1' }}"
          template: config_template.j2
          username: admin
        - action: remove
          auto_run: false
          host: 10.1.1.2
          password: mypassword
          port: 443
          port_vlan: "{{ 'vlan20' }}"
          protocol: "{{ 'https' }}"
          server_name: "{{ 'testserver' }}"
          switch_name: switch1
          switch_port: "{{ 'port2' }}"
          template: config_template.j2
          username: admin