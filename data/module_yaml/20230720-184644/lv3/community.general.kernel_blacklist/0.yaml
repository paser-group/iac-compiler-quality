---
- name: Test Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create blacklist file
      community.general.kernel_blacklist:
        blacklist_file: "{{ playbook_dir }}/blacklist.txt"
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      with_items:
        - { name: "blacklist1", state: "present" }
        - { name: "blacklist2", state: "absent" }

    - name: Verify blacklist file
      command: cat "{{ playbook_dir }}/blacklist.txt"
      register: file_content
      changed_when: false

    - name: Debug blacklist file
      debug:
        var: file_content.stdout_lines