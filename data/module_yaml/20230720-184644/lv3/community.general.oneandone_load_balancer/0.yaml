---
- name: Configure load balancer
  hosts: localhost
  gather_facts: false

  vars:
    load_balancer_name: "MyLoadBalancer"
    lb_rules:
      - protocol: "TCP"
        port_balancer: 80
        port_server: 8080
    lb_server_ips:
      - ip: "10.1.1.1"

  tasks:
    - name: Create load balancer
      community.general.oneandone_load_balancer:
        name: "{{ load_balancer_name }}"
        add_rules: "{{ lb_rules }}"
        add_server_ips: "{{ lb_server_ips }}"
        api_url: "https://api.example.com"
        auth_token: "my_auth_token"
        datacenter: "dc1"
        description: "My load balancer"
        health_check_interval: "30 seconds"
        health_check_parse: "bytes"
        health_check_path: "/"
        health_check_test: "contains string"
        load_balancer: "load_balancer_id"
        method: "round_robin"
        persistence: true
        persistence_time: "2 minutes"
        remove_rules: []
        remove_server_ips: []
        rules: []
        state: "present"
        wait: yes
        wait_interval: 10
        wait_timeout: 120
      register: result

    - name: Debug result
      debug:
        var: result