- name: Test playbook for community.general.xattr module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set xattr value with bytes
      community.general.xattr:
        path: "{{ playbook_dir }}/test_file.txt"
        namespace: user
        key: test_key
        value: "{{ lookup('pipe', 'echo -n aGVsbG8gd29ybGQ= | base64 -d') }}"
        state: present

    - name: Get xattr value
      community.general.xattr:
        path: "{{ playbook_dir }}/test_file.txt"
        namespace: user
        key: test_key
        state: present
      register: xattr_value

    - name: Display xattr value
      debug:
        var: xattr_value.xattr

    - name: Set xattr value with string
      community.general.xattr:
        path: "{{ playbook_dir }}/test_file.txt"
        namespace: user
        key: test_key
        value: "Hello Ansible!"
        state: present

    - name: Get xattr value
      community.general.xattr:
        path: "{{ playbook_dir }}/test_file.txt"
        namespace: user
        key: test_key
        state: present
      register: xattr_value

    - name: Display xattr value
      debug:
        var: xattr_value.xattr