---
- name: Test playbook for latent type-related bugs in Ansible
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create SmartOS VM with mixed type configuration
      community.general.vmadm:
        state: present
        name: "{{ playbook_dir }}"
        vcpus: 2
        ram: "{{ 4 | string}}G"
        disks: "{{ ['/dev/random', '10G'] }}"
        nics:
          - "{{ 1234 }}"
          - "{{ 'eth0' }}"
        routes: "{{ { '10.0.0.0/24': '192.168.1.1' } }}"
        brand: "{{ 'joyent' }}"
        boot: "{{ 1234 }}"
        zpool: "{{ 5 | string }}"
        dns_domain: "{{ 1234 }}"
        vga: "{{ 'text' | int }}"
        image_uuid: "{{ 1234 }}"
        quota: "{{ '50G' | int }}"
        tmpfs: "{{ '1G' | int }}"
        archive_on_delete: "{{ 'false' | bool }}"
        customer_metadata: "{{ { 'key': 'value' } }}"
        internal_metadata: "{{ { 'key': 'value' } }}"
      register: result

    - name: Print result
      debug:
        var: result