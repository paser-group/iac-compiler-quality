---
- name: Configure VLANs on Ruckus ICX
  hosts: switches
  gather_facts: false
  
  vars:
    vlan_id: 100
    name: "Test VLAN"
    associated_interfaces:
      - eth1
      - eth2
    tagged:
      10.1.1.1: "eth1"
      10.1.1.2: "eth2"
    
  tasks:

    - name: Create VLAN
      community.network.icx_vlan:
        vlan_id: "{{ vlan_id }}"
        name: "{{ name }}"
        associated_interfaces: "{{ associated_interfaces }}"
        tagged: "{{ tagged }}"
      register: result
      when: inventory_hostname in groups['switches']

    - name: Print result
      debug:
        var: result