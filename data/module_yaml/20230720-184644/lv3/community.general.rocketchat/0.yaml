- name: Test playbook for RocketChat module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required dependencies
      apt:
        name: python3-pip
        state: present
        update_cache: yes

    - name: Install RocketChat Ansible module
      pip:
        name: rocketchat-python
        state: present

    - name: Send RocketChat notification
      community.general.rocketchat:
        domain: "https://rocketchat.example.com"
        token: "your-token"
        channel: "general"
        msg: "This is a test notification"
        username: "Ansible"

    - name: Send RocketChat notification with attachment
      community.general.rocketchat:
        domain: "https://rocketchat.example.com"
        token: "your-token"
        channel: "general"
        msg: "This is a test notification with attachment"
        username: "Ansible"
        attachments:
          - text: "Attachment 1"
          - text: "Attachment 2"
            color: "#F00"

    - name: Send RocketChat notification with link names enabled
      community.general.rocketchat:
        domain: "https://rocketchat.example.com"
        token: "your-token"
        channel: "general"
        msg: "This is a test notification with link names enabled"
        username: "Ansible"
        link_names: 1

    - name: Send RocketChat notification with custom icon
      community.general.rocketchat:
        domain: "https://rocketchat.example.com"
        token: "your-token"
        channel: "general"
        msg: "This is a test notification with custom icon"
        username: "Ansible"
        icon_emoji: ":rocket:"
        icon_url: "https://example.com/rocket.png"

    - name: Send RocketChat notification with custom protocol and certificate validation
      community.general.rocketchat:
        domain: "http://rocketchat.example.com"
        token: "your-token"
        channel: "general"
        msg: "This is a test notification with custom protocol"
        username: "Ansible"
        protocol: "http"
        validate_certs: true