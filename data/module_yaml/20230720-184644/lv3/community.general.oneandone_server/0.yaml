- name: Ansible Latent Bug Discovery Playbook
  hosts: localhost
  gather_facts: false

  vars:
    api_url: "https://api.1and1.com"
    auth_token: "your_auth_token"
    datacenter: "DC_NAME"
    hdds:
      - size: "50"
        is_main: true
        hdd_type: "ssd"

  tasks:
    - name: Create 1&1 Cloud Server
      oneandone_server:
        state: present
        api_url: "{{ api_url }}"
        auth_token: "{{ auth_token }}"
        datacenter: "{{ datacenter }}"
        hostname: 4
        hdds: "{{ hdds }}"
      register: server

    - debug:
        var: server

    - name: Destroy the Server
      oneandone_server:
        state: absent
        api_url: "{{ api_url }}"
        auth_token: "{{ auth_token }}"
        server: "{{ server['id'] }}"
      when: server is defined