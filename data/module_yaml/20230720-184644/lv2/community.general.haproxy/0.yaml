---
- hosts: localhost
  gather_facts: false

  vars:
    # Set variables for backend servers
    backend_servers:
      - { name: 'server1', ip: '10.1.1.1', weight: '10' }
      - { name: 'server2', ip: '10.1.1.2', weight: '20' }
      - { name: 'server3', ip: '10.1.1.3', weight: '30' }

  tasks:
    - name: Enable, disable, and set weights for backend servers
      community.general.haproxy:
        agent: true
        backend: "{{ item.name }}"
        state: present
        weight: "{{ item.weight | string }}"
      loop: "{{ backend_servers }}"