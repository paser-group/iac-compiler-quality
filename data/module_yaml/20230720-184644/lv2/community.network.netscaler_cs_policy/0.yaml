---
- name: Test playbook for community.network.netscaler_cs_policy module
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: "admin"
    nitro_pass: "admin"
    nitro_protocol: "http"
    nitro_timeout: 10
    validate_certs: false
    nsip: "10.1.1.1"

  tasks:
    - name: Create test policy with byte string value
      community.network.netscaler_cs_policy:
        nsip: "{{ nsip }}"
        action: none
        policyname: b"byte_string_policy"
        state: present
        validate_certs: "{{ validate_certs }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"

    - name: Create policy with incorrect byte string key
      community.network.netscaler_cs_policy:
        nsip: "{{ nsip }}"
        action: none
        policyname: "regular_policy"
        rule: b"byte_string_rule"
        state: present
        validate_certs: "{{ validate_certs }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"

    - name: Save config with byte string value
      community.network.netscaler_cs_policy:
        nsip: "{{ nsip }}"
        save_config: True
        state: present
        validate_certs: "{{ validate_certs }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"

    - name: Remove test policies
      community.network.netscaler_cs_policy:
        nsip: "{{ nsip }}"
        state: absent
        validate_certs: "{{ validate_certs }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"