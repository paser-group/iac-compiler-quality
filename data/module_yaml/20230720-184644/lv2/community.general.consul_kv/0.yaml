---
- name: Uncover type-related bugs in consul_kv module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required module
      pip:
        name: consul

    - name: Set consul key/value
      community.general.consul_kv:
        host: "127.0.0.1"
        port: 8500
        scheme: "http"
        validate_certs: false
        state: "present"
        session: "test-session"
        key: "test-key"
        value: "{{ 'test-value' | to_bytes }}"
      register: result

    - name: Debug result
      debug:
        var: result