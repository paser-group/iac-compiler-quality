---
- name: Test sendgrid module with type-related bugs
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Send email with byte string values
      community.general.sendgrid:
        api_key: "API_KEY"
        attachments:
          - name: "file.txt"
            content: "{{ lookup('file', 'file.txt') | string | encode('utf-8') }}"
            type: "application/octet-stream"
        bcc: ["bcc@email.com"]
        body: "{{ vars.body | string | encode('utf-8') }}"
        cc: ["cc@email.com"]
        from_address: "{{ vars.from_address | string | encode('utf-8') }}"
        from_name: "{{ vars.from_name | string | encode('utf-8') }}"
        headers:
          X-Custom-Header: "custom header"
        html_body: true
        password: "{{ vars.password | string | encode('utf-8') }}"
        subject: "{{ vars.subject | string | encode('utf-8') }}"
        to_addresses: ["to@email.com"]
        username: "{{ vars.username | string | encode('utf-8') }}"
      register: result
      
    - name: Debug sendgrid module output
      debug:
        var: result