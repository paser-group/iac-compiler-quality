---
- name: Test playbook for Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create sensu check
      community.general.sensu_check:
        name: test_check
        standalone: yes
        command: b"This is a test check"
        source: b"{{ playbook_dir }}/plugins/checks"
        state: present
        path: "/etc/sensu/conf.d/checks"
        dependencies:
          - sensu-client
        handlers:
          - email
        subscribers:
          - all
        refresh: 5
        timeout: 10
        ttl: 600
        high_flap_threshold: 10
        low_flap_threshold: 5
        occurrences: 3
        interval: 60
        subdue_begin: "00:00"
        subdue_end: "06:00"
        aggregate: yes
        metric: yes
        backup: yes
        publish: yes
        custom:
          custom_option1: test_value1
          custom_option2: test_value2
    - debug:
        var: ansible_facts.sensu_check