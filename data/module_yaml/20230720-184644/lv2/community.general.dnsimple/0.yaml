---
- name: Test playbook to uncover type-related bugs in dnsimple module
  hosts: localhost
  gather_facts: false
  vars:
    account_api_token: "YOUR_DNSIMAPLE_API_TOKEN"
    account_email: "YOUR_DNSIMPLE_EMAIL"

  tasks:
    - name: Create DNS record with byte string value
      community.general.dnsimple:
        account_api_token: "{{ account_api_token|b }}"
        account_email: "{{ account_email|b }}"
        domain: "{{ domain }}"
        type: "{{ type }}"
        record: "{{ record|b }}"
        value: "{{ value|b }}"
        state: present
      vars:
        record: b'TestRecord'
        value: b'TestValue'
        domain: example.com
        type: A

    - name: Show debug output
      debug:
        var: ansible_facts.dnsimple_records

    - name: Delete the created DNS record
      community.general.dnsimple:
        account_api_token: "{{ account_api_token|b }}"
        account_email: "{{ account_email|b }}"
        domain: "{{ domain }}"
        type: "{{ type }}"
        record: "{{ record|b }}"
        value: "{{ value|b }}"
        state: absent
      vars:
        record: b'TestRecord'
        value: b'TestValue'
        domain: example.com
        type: A