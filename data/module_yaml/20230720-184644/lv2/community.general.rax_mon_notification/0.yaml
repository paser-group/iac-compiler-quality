- name: Test for ansible latent type-related bug
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Rackspace Cloud Monitoring notification
      community.general.rax_mon_notification:
        api_key: "{{ ansible_api_key | default('') }}"
        auth_endpoint: "{{ ansible_auth_endpoint | default('') }}"
        credentials: "{{ ansible_credentials | default('') }}"
        details:
          url: "{{ 'https://example.com' | b64encode }}"
          username: "{{ 'admin' | b64encode }}"
          password: "{{ 'password' | b64encode }}"
        env: "{{ 'development' | b64encode }}"
        identity_type: "{{ 'rackspace_api_key' | b64encode }}"
        label: "{{ 'My Notification' | b64encode }}"
        notification_type: "{{ 'webhook' | b64encode }}"
        region: "{{ 'DFW' | b64encode }}"
        state: "{{ 'present' | b64encode }}"
        tenant_id: "{{ 'abc123' | b64encode }}"
        tenant_name: "{{ 'mytenant' | b64encode }}"
        username: "{{ 'myusername' | b64encode }}"
        validate_certs: False
      register: result_create

    - name: Print result of create operation
      debug:
        var: result_create

    - name: Delete Rackspace Cloud Monitoring notification
      community.general.rax_mon_notification:
        api_key: "{{ ansible_api_key | default('') }}"
        auth_endpoint: "{{ ansible_auth_endpoint | default('') }}"
        credentials: "{{ ansible_credentials | default('') }}"
        details:
          url: "{{ 'https://example.com' | b64encode }}"
        env: "{{ 'development' | b64encode }}"
        identity_type: "{{ 'rackspace_api_key' | b64encode }}"
        label: "{{ 'My Notification' | b64encode }}"
        notification_type: "{{ 'webhook' | b64encode }}"
        region: "{{ 'DFW' | b64encode }}"
        state: "{{ 'absent' | b64encode }}"
        tenant_id: "{{ 'abc123' | b64encode }}"
        tenant_name: "{{ 'mytenant' | b64encode }}"
        username: "{{ 'myusername' | b64encode }}"
        validate_certs: False
      register: result_delete

    - name: Print result of delete operation
      debug:
        var: result_delete