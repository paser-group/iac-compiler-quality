- name: Test keycloak_user_rolemapping module
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Install required dependencies for keycloak_user_rolemapping module
      pip:
        name: python-keycloak
        state: present

    - name: Ensure Keycloak user_role mapping exists
      community.general.keycloak_user_rolemapping:
        auth_keycloak_url: "http://keycloak.example.com/auth"
        auth_realm: "master"
        auth_client_id: "admin-cli"
        auth_username: "admin"
        auth_password: "admin"
        validate_certs: False
        realm: "myrealm"
        target_username: "testuser"
        roles:
          - "role1"
          - "role2"
        state: present
      register: result

    - name: Print the result
      debug:
        var: result

- name: Test keycloak_user_rolemapping module with byte string values
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Install required dependencies for keycloak_user_rolemapping module
      pip:
        name: python-keycloak
        state: present

    - name: Ensure Keycloak user_role mapping exists with byte string values
      community.general.keycloak_user_rolemapping:
        auth_keycloak_url: "http://keycloak.example.com/auth"
        auth_realm: "master"
        auth_client_id: "admin-cli"
        auth_username: "admin"
        auth_password: "admin"
        validate_certs: False
        realm: "myrealm"
        target_username: "{{ 'testuser' | b64decode }}"
        roles:
          - "{{ 'role1' | b64decode }}"
          - "{{ 'role2' | b64decode }}"
        state: present
      register: result

    - name: Print the result
      debug:
        var: result