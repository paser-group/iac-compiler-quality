---
- name: Configure GSLB vserver
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: admin
    nitro_pass: password
    nitro_protocol: https
    nsip: 10.1.1.1
    validate_certs: false

  tasks:
    - name: Install required Python packages
      pip:
        name: nitro-python
        state: present

    - name: Configure gslb vserver
      community.network.netscaler_gslb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        validate_certs: "{{ validate_certs }}"
        name: lb-vserver
        servicetype: HTTP
        lbmethod: ROUNDROBIN
        backuplbmethod: PERSISTENCE
        comment: This is a test gslb vserver
        disabled: false
        dnsrecordtype: A
        domain_bindings:
          - domainname: example.com
            vservername: web-vserver
        save_config: true
      register: result

    - name: Debug result
      debug:
        var: result