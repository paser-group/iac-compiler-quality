---
- name: Test cpanm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Perl module using cpanm
      community.general.cpanm:
        executable: /usr/local/bin/cpanm
        from_path: /tmp/perl
        installdeps: true
        locallib: /tmp/perl/local
        mirror: http://cpan.metacpan.org/
        mirror_only: false
        mode: "o=wrx"
        name: "TestModule"
        name_check: "version"
        notest: false
        version: "1.0.0"

      # Trigger type-related bug
      vars:
        executable: !binary |-
          LFVzci9sb2NhbC9iaW4vY3Bhbm0=
        from_path: !binary |-
          L3RtcC9wZXJs
        installdeps: !binary |-
          dHJ1ZQ==
        locallib: !binary |-
          L3RtcC9wZXJsL2xvY2Fs
        mirror: !binary |-
          aHR0cDovL2NwYW4ubWV0YWNwYW4ub3JnLw==
        mirror_only: !binary |-
          ZmFsc2U=
        mode: !binary |-
          bz13cg==
        name: !binary |-
          VGVzdE1vZHVsZQ==
        name_check: !binary |-
          dmVyc2lvbg==
        notest: !binary |-
          ZmFsc2U=
        version: !binary |-
          MS4wLjA=