---
- name: Test playbook for scaleway_database_backup module
  hosts: localhost
  gather_facts: false

  vars:
    # API credentials
    api_token: "MY_API_TOKEN"
    api_url: "https://api.scaleway.com/"

    # Test variables
    database_name: "my_database"
    instance_id: "12345678"
    region: "fr-par-1"

  tasks:
    - name: Create the database backup
      community.general.scaleway_database_backup:
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        database_name: "{{ database_name }}"
        instance_id: "{{ instance_id }}"
        region: "{{ region }}"
        state: "present"
        expires_at: "2022-12-31"  # Expecting a string, could cause type-related bugs
        query_parameters:
          - limit: 10
            offset: 0
        validate_certs: true
        wait: false
        wait_sleep_time: 5
        wait_timeout: 300
      register: backup_result

    - name: Display backup result
      debug:
        var: backup_result