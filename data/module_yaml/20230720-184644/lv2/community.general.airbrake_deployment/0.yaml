- hosts: localhost
  gather_facts: false

  vars:
    airbrake_environment: "production"
    airbrake_project_id: "123456"
    airbrake_project_key: "abcdef"
    airbrake_repo: "https://github.com/example/repo.git"
    airbrake_revision: "master"
    airbrake_url: "https://airbrake.io"
    airbrake_user: "admin"
    airbrake_validate_certs: true
    airbrake_version: "v1.0"

  tasks:
    - name: Install required package (if needed)
      package:
        name: airbrake
        state: present

    - name: Notify Airbrake
      community.general.airbrake_deployment:
        environment: '{{ airbrake_environment | b64encode }}'  # Introduce byte string
        project_id: '{{ airbrake_project_id }}'
        project_key: '{{ airbrake_project_key }}'
        repo: '{{ airbrake_repo }}'
        revision: '{{ airbrake_revision }}'
        url: '{{ airbrake_url }}'
        user: '{{ airbrake_user }}'
        validate_certs: '{{ airbrake_validate_certs }}'
        version: '{{ airbrake_version }}'
      register: airbrake_result

    - name: Print Airbrake Result
      debug:
        var: airbrake_result