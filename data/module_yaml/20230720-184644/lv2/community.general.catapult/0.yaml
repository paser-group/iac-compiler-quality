- name: Run playbook to expose latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set variables
      vars:
        api_secret: secret
        api_token: token
        dest:
          - "+1234567890"
          - "+9876543210"
        media: my_media.jpg
        msg: "Hello, world!"
        src: "+5555555555"
        user_id: user123

    - name: Convert variables to bytes
      set_fact:
        api_secret_bytes: !binary "{{ api_secret }}"
        api_token_bytes: !binary "{{ api_token }}"
        dest_bytes: "{{ dest | map('regex_replace', '^(.*)$', '!binary \"\\1\"') | list }}"
        media_bytes: !binary "{{ media }}"
        msg_bytes: !binary "{{ msg }}"
        src_bytes: !binary "{{ src }}"
        user_id_bytes: !binary "{{ user_id }}"

    - name: Print variables
      debug:
        msg:
          - "api_secret: {{ api_secret_bytes }}"
          - "api_token: {{ api_token_bytes }}"
          - "dest: {{ dest_bytes }}"
          - "media: {{ media_bytes }}"
          - "msg: {{ msg_bytes }}"
          - "src: {{ src_bytes }}"
          - "user_id: {{ user_id_bytes }}"