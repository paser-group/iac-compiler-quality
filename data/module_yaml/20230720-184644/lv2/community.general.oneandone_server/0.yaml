---
- name: Create a server using oneandone_server module
  hosts: localhost
  gather_facts: false
  vars:
    api_url: "{{ api_url }}"
    auth_token: "{{ auth_token }}"
    state: "present"
    wait: true
    wait_timeout: 300
    wait_interval: 10
    server:
      name: "{{ 'create_server' }}"
      appliance: 'debian'
      fixed_instance_size: 'L32'
      description: 'This is a test description'
      server_type: 'vps'
      datacenter: 'US'
      count: 1
      ssh_key: |
        ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDk6Dm2yPX0xu0b4XYlP+4/GRRzMEbYLw0R+
        Pv68OumcXEsFRBhZ5F6lGnMUpcffUN1MqywXFQIe3ZWQOHOWPUrcwGlobomzC8L
        dLcsgwzxk2J3NdGvITbiO7ET+N0qedQ61eW7G4F2Ine4oLrbDnQjaTjjFyOmMCO
        Gnp9bCEaIxef5cPrmmXS1Xj0wBZ8UrCZkgTQO2jBgTpEQvT9GmTNLZN84cRQO1
        KL8P7n/m6Ii7M9z2mvTz+7wm1xOg2Jex63qS1eMUF/1e5JVZnF/u1r8G11z9mYw
        T4k3HJhtMmTMbFxOSJ3bbzfb+FgiztHZg
      hdds:
        - size: 20
          is_main: true
          image: 'ubuntu_18.04_srv#1'
          password: 'custom'
          isofix: false
          isofix_id: null
      firewall_policy: 'DEFAULT'
      load_balancer: 'load-balancer'
      monitoring_policy: 'ON'
      private_network: 'redhat1_1'
      roles: null
      vcore: 2
      ram: 4
      cores_per_processor: 1
      auto_increment: false

  tasks:
    - name: Create a server
      community.general.oneandone_server:
        wait_timeout: "{{ wait_timeout }}"
        wait_interval: "{{ wait_interval }}"
        api_url: "{{ api_url }}"
        auth_token: "{{ auth_token }}"
        state: "{{ state }}"
        wait: "{{ wait }}"
        server: "{{ server }}"
      register: result

    - name: Debug server creation
      debug:
        var: result