- name: Manage BGP neighbor Address-family configuration on HUAWEI
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure BGP Neighbor Address-family
      community.network.ce_bgp_neighbor_af:
        provider: "{{ provider }}"
        asn: "{{ bgp_asn }}"
        neighbor_ip: "{{ neighbor_ip }}"
        af_type: "{{ af_type }}"
        default_rt_adv_enable: "{{ default_rt_adv_enable }}"
        default_rt_adv_policy: "{{ default_rt_adv_policy }}"
        export_rt_policy_name: "{{ export_rt_policy_name }}"
        import_rt_policy_name: "{{ import_rt_policy_name }}"
        preferred_value: "{{ preferred_value }}"
        nexthop_configure: "{{ nexthop_configure }}"
        redirect_ip: "{{ redirect_ip }}"
        redirect_ip_validation: "{{ redirect_ip_validation }}"
        advertise_remote_nexthop: "{{ advertise_remote_nexthop }}"
        advertise_community: "{{ advertise_community }}"
        advertise_ext_community: "{{ advertise_ext_community }}"
        advertise_irb: "{{ advertise_irb }}"
        public_as_only: "{{ public_as_only }}"
        public_as_only_force: "{{ public_as_only_force }}"
        public_as_only_limited: "{{ public_as_only_limited }}"
        public_as_only_replace: "{{ public_as_only_replace }}"
        public_as_only_skip_peer_as: "{{ public_as_only_skip_peer_as }}"
        import_as_path_name_or_num: "{{ import_as_path_name_or_num }}"
        export_as_path_name_or_num: "{{ export_as_path_name_or_num }}"
        import_pref_filt_name: "{{ import_pref_filt_name }}"
        export_pref_filt_name: "{{ export_pref_filt_name }}"
        import_as_path_filter: "{{ import_as_path_filter }}"
        export_as_path_filter: "{{ export_as_path_filter }}"
        import_acl_name_or_num: "{{ import_acl_name_or_num }}"
        export_acl_name_or_num: "{{ export_acl_name_or_num }}"
        default_rt_match_mode: "{{ default_rt_match_mode }}"
        allow_as_loop_enable: "{{ allow_as_loop_enable }}"
        allow_as_loop_limit: "{{ allow_as_loop_limit }}"
        route_limit: "{{ route_limit }}"
        route_limit_percent: "{{ route_limit_percent }}"
        route_limit_idle_timeout: "{{ route_limit_idle_timeout }}"
        route_limit_type: "{{ route_limit_type }}"
        is_nonstd_ipprefix_mod: "{{ is_nonstd_ipprefix_mod }}"
        ipprefix_orf_enable: "{{ ipprefix_orf_enable }}"
        orf_mode: "{{ orf_mode }}"
        vpls_enable: "{{ vpls_enable }}"
        vpls_ad_disable: "{{ vpls_ad_disable }}"
        reflect_client: "{{ reflect_client }}"
        discard_ext_community: "{{ discard_ext_community }}"
        soostring: "{{ soostring }}"
        afi: "{{ afi }}"
        safi: "{{ safi }}"
        rt_updt_interval: "{{ rt_updt_interval }}"
        add_path_mode: "{{ add_path_mode }}"
        adv_add_path_num: "{{ adv_add_path_num }}"
        route_dist: "{{ route_dist }}"
        state: present

      vars:
        provider:
          host: "{{ inventory_hostname }}"
          username: "{{ ansible_user }}"
          password: "{{ ansible_password }}"
        bgp_asn: "65000"
        neighbor_ip: "10.1.1.1"
        af_type: bcast
        default_rt_adv_enable: 1
        default_rt_adv_policy: "always"
        export_rt_policy_name: "export"
        import_rt_policy_name: "import"
        preferred_value: 100
        nexthop_configure: "basic"
        redirect_ip: "10.1.1.2"
        redirect_ip_validation: "enable"
        advertise_remote_nexthop: "no-advertise"
        advertise_community: "111:222"
        advertise_ext_community: "222:333"
        advertise_irb: "disable"
        public_as_only: "yes"
        public_as_only_force: "yes"
        public_as_only_limited: "yes"
        public_as_only_replace: "yes"
        public_as_only_skip_peer_as: "yes"
        import_as_path_name_or_num: "import-as-path"
        export_as_path_name_or_num: "export-as-path"
        import_pref_filt_name: "import-pref-filt"
        export_pref_filt_name: "export-pref-filt"
        import_as_path_filter: "no-import-as-path"
        export_as_path_filter: "no-export-as-path"
        import_acl_name_or_num: "import-acl"
        export_acl_name_or_num: "export-acl"
        default_rt_match_mode: "exact"
        allow_as_loop_enable: "yes"
        allow_as_loop_limit: 10
        route_limit: "1000"
        route_limit_percent: 10
        route_limit_idle_timeout: 300
        route_limit_type: "warning"
        is_nonstd_ipprefix_mod: "enable"
        ipprefix_orf_enable: "enable"
        orf_mode: "send-receive"
        vpls_enable: "enable"
        vpls_ad_disable: "no"
        reflect_client: "yes"
        discard_ext_community: "yes"
        soostring: "65000:1"
        afi: "ipv4"
        safi: "unicast"
        rt_updt_interval: 30
        add_path_mode: "send-receive"
        adv_add_path_num: 5
        route_dist: "65000:10"