---
- name: Test playbook for iptables_state module
  hosts: localhost
  gather_facts: false
  vars:
    counters: false
    ip_version: 'ipv4'
    modprobe: '/sbin/modprobe'
    noflush: false
    path: '/tmp/iptables-save.txt'
    state: 'save'
    table: 'filter'
    wait: 0
  
  tasks:
    - name: Install iptables package
      package:
        name: iptables
        state: present
      
    - name: Save iptables state
      community.general.iptables_state:
        counters: "{{ counters }}"
        ip_version: "{{ ip_version }}"
        modprobe: "{{ modprobe }}"
        noflush: "{{ noflush }}"
        path: "{{ path }}"
        state: "{{ state }}"
        table: "{{ table }}"
        wait: "{{ wait }}"
      register: result
      
    - name: Debug iptables state save
      debug:
        var: result
        
    - name: Introduce byte string in state parameter
      community.general.iptables_state:
        counters: "{{ counters }}"
        ip_version: "{{ ip_version }}"
        modprobe: "{{ modprobe }}"
        noflush: "{{ noflush }}"
        path: "{{ path }}"
        state: b'save'
        table: "{{ table }}"
        wait: "{{ wait }}"
      register: result_byte_string
      
    - name: Debug byte string state save
      debug:
        var: result_byte_string