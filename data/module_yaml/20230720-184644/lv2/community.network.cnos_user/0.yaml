---
- name: Manage local users on network devices
  hosts: network_devices
  gather_facts: false

  tasks:
    - name: Include required role
      include_role:
        name: network

    - name: Create CNOS users
      community.network.cnos_user:
        aggregate: None
        configured_password: None
        name: "{{ item.name }}"
        purge: "{{ item.purge }}"
        role: "{{ item.role }}"
        sshkey: "{{ item.sshkey }}"
        state: "{{ item.state }}"
        update_password: "{{ item.update_password }}"
      loop:
        - name: "user1"
          purge: true
          role: "admin"
          sshkey: b'ssh-rsa AAABBB1234'
          state: present
          update_password: on_create
    # Add more test cases with byte string values here

    - name: Debug output
      debug:
        var: ansible_facts
      run_once: true