---
- name: Test 'community.general.sl_vm' module
  hosts: localhost
  gather_facts: false
  vars:
    image_id: b"1234567"
    flavor: b"xlarge"
    tags: b"webserver"

  tasks:
    - name: Create a virtual machine
      community.general.sl_vm:
        hostname: "{{ item }}"
        state: b"present"
        flavor: "{{ flavor }}"
        cpus: 4
        memory: 8192
        disks:
          - size: 100
            bus: virtio
            path: b"/dev/vdb"
        public_vlan: 1234
        private_vlan: 5678
        ssh_keys:
          - key_name: b"my_key"
            label: b"sshkey"
        os_code: b"centos_7"
        wait: true
        wait_time: 600
        post_uri: b"/install/bootstrap.sh"
      loop: "{{ groups['vm_nodes'] }}"
      when: inventory_hostname in groups['vm_nodes']