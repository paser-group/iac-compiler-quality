- name: Consul Playbook
  hosts: localhost
  become: false

  vars:
    consul_host: "localhost"
    consul_port: 8500
    consul_scheme: "http"
    consul_token: "my_token"

  tasks:
    - name: Add new service
      community.general.consul:
        host: "{{ consul_host }}"
        port: "{{ consul_port }}"
        scheme: "{{ consul_scheme }}"
        token: "{{ consul_token }}"
        service_name: "my_service"
        service_id: "my_service_id"
        state: present
        tags: ["tag1", "tag2"]

    - name: Modify service
      community.general.consul:
        host: "{{ consul_host }}"
        port: "{{ consul_port }}"
        scheme: "{{ consul_scheme }}"
        token: "{{ consul_token }}"
        service_id: "my_service_id"
        service_address: b"10.1.1.1"
        service_port: 8080
        state: present

    - name: Delete service
      community.general.consul:
        host: "{{ consul_host }}"
        port: "{{ consul_port }}"
        scheme: "{{ consul_scheme }}"
        token: "{{ consul_token }}"
        service_id: "my_service_id"
        state: absent