---
- name: Test Latent Type-Related Bugs in community.network.opx_cps module
  hosts: localhost
  gather_facts: false

  vars:
    attr_data: '{{ None }}'  # Specify the attribute data
    attr_type: '{{ None }}'  # Specify the attribute type
    commit_event: false      # Specify the commit event flag
    db: false                # Specify the database flag
    module_name: '{{ None }}'  # Specify the module name
    operation: '{{ None }}'    # Specify the operation
    qualifier: '{{ None }}'    # Specify the qualifier

    # Define the inventory file with Docker nodes
    inventory_file: |
      [docker_nodes]
      ubuntu1 ansible_host=10.1.1.1 ansible_user=root
      alpine1 ansible_host=10.1.1.2 ansible_user=root
      centos1 ansible_host=10.1.1.3 ansible_user=root
      redhat1 ansible_host=10.1.1.4 ansible_user=root

  tasks:
    - name: Create network nodes subnet
      docker_network:
        name: node-net
        subnet: 10.1.1.0/24
        gateway: 10.1.1.254

    - name: Install Docker package
      become: true
      apt:
        name: docker.io
        state: present

    - name: Start Docker service
      become: true
      service:
        name: docker
        state: started

    - name: Create Docker containers
      community.general.docker_container:
        name: '{{ item.key }}'
        image: '{{ item.value }}'
        state: started
        network_mode: node-net
      loop:
        - { key: 'ubuntu1', value: 'ubuntu:latest' }
        - { key: 'alpine1', value: 'alpine:latest' }
        - { key: 'centos1', value: 'centos:latest' }
        - { key: 'redhat1', value: 'redhat:latest' }

    - name: Run CPS operations on networking device
      community.network.opx_cps:
        attr_data: '{{ attr_data }}'
        attr_type: '{{ attr_type }}'
        commit_event: '{{ commit_event }}'
        db: '{{ db }}'
        module_name: '{{ module_name }}'
        operation: '{{ operation }}'
        qualifier: '{{ qualifier }}'
      ignore_errors: true