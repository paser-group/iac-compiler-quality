---
- name: Latent Bug Finder - Ansible Playbook
  hosts: localhost
  gather_facts: false

  vars:
    alarm_disabled: "false"
    alarm_entity_id: 123456
    alarm_name: "Test Alarm"
    alarm_criteria: "metric > 5"
    alarm_notification_plan_id: "654321"

  tasks:
    - name: Set alarm_disabled variable as a byte string
      set_fact:
        alarm_disabled: !binary |
          "{{ alarm_disabled }}"

    - name: Set alarm_entity_id variable as a byte string
      set_fact:
        alarm_entity_id: !binary |
          "{{ alarm_entity_id }}"

    - name: Set alarm_name variable as a byte string
      set_fact:
        alarm_name: !binary |
          "{{ alarm_name }}"

    - name: Set alarm_criteria variable as a byte string
      set_fact:
        alarm_criteria: !binary |
          "{{ alarm_criteria }}"

    - name: Set alarm_notification_plan_id variable as a byte string
      set_fact:
        alarm_notification_plan_id: !binary |
          "{{ alarm_notification_plan_id }}"

    - name: Create Rackspace Cloud Monitoring alarm
      community.general.rax_mon_alarm:
        api_key: "your_api_key"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        tenant_id: "your_tenant_id"
        alarm_disabled: "{{ alarm_disabled|bool }}"
        alarm_entity_id: "{{ alarm_entity_id|int }}"
        alarm_name: "{{ alarm_name }}"
        alarm_criteria: "{{ alarm_criteria }}"
        alarm_notification_plan_id: "{{ alarm_notification_plan_id }}"
        state: present

    - name: Delete Rackspace Cloud Monitoring alarm
      community.general.rax_mon_alarm:
        api_key: "your_api_key"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        tenant_id: "your_tenant_id"
        alarm_entity_id: "{{ alarm_entity_id|int }}"
        state: absent