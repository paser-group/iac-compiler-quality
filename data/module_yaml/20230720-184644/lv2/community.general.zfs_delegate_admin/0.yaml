---
- name: Test playbook for latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set ZFS delegated administration
      community.general.zfs_delegate_admin:
        name: b"{{ item.name }}"
        recursive: "{{ item.recursive }}"
        descendents: "{{ item.descendents }}"
        local: "{{ item.local }}"
        everyone: "{{ item.everyone }}"
        groups: ["b'{{ item.groups[0] }}'", "b'{{ item.groups[1] }}'"]
        users: ["b'{{ item.users[0] }}'", "b'{{ item.users[1] }}'"]
        permissions: [b'{{ item.permissions[0] }}', b'{{ item.permissions[1] }}']
        state: present
      loop:
        - name: dataset1
          recursive: false
          descendents: true
          local: true
          everyone: false
          groups:
            - 'group1'
            - 'group2'
          users:
            - 'user1'
          permissions:
            - 'create'
            - 'destroy'

        - name: dataset2
          recursive: true
          descendents: false
          local: false
          everyone: true
          groups:
            - 'group3'
          users:
            - 'user2'
            - 'user3'
          permissions:
            - 'clone'
            - 'promote'