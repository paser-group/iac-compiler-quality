---
- name: Test playbook for 'community.general.librato_annotation'
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required dependencies
      pip:
        name: librato

    - name: Create an annotation
      community.general.librato_annotation:
        api_key: "{{ librato_api_key }}"
        title: "{{ title|b64encode }}"
        description: "{{ description|b64encode }}"
        start_time: "{{ start_time }}"
        end_time: "{{ end_time }}"
        source: "{{ source|b64encode }}"
        user: "{{ user }}"
        links: "{{ links|b64encode }}"

      vars:
        librato_api_key: "<YOUR_Librato_API_KEY>"
        title: "Test Annotation"
        description: "This is a test annotation"
        start_time: 1577833200
        end_time: 1577836800
        source: "Test Source"
        user: "Test User"
        links:
          - name: "Link 1"
            url: "https://example.com/link1"
          - name: "Link 2"
            url: "https://example.com/link2"

      register: annotation_result

    - name: Debug annotation result
      debug:
        var: annotation_result