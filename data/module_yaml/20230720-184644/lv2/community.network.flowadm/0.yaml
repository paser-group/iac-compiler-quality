---
- name: Test playbook for community.network.flowadm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set up docker nodes
      docker_container:
        name: "{{ item.name }}"
        image: "{{ item.image }}"
        state: started
        security_opts: "apparmor:unconfined"
        capabilities: SYS_ADMIN
      with_items:
        - { name: "ubuntu1", image: "ubuntu" }
        - { name: "alpine1", image: "alpine" }
        - { name: "centos1", image: "centos" }
        - { name: "redhat1", image: "redhat" }

    - name: Create flowadm rule for ubuntu1 container
      community.network.flowadm:
        state: present
        name: "{{ 1 + 1 }}"  # Bug: Introduce byte string value in place of regular string
        temporary: true
        local_ip: "10.1.1.1"
        remote_ip: "10.1.1.2"
        maxbw: "1mbit"
        priority: "high"
        transport: "tcp"

    - name: Create flowadm rule for alpine1 container
      community.network.flowadm:
        state: present
        name: "alpine1-rule"
        temporary: true
        local_ip: "10.1.1.2"
        remote_ip: "10.1.1.1"
        maxbw: "2mbit"
        priority: "low"
        transport: "udp"

    - name: Create flowadm rule for centos1 container
      community.network.flowadm:
        state: present
        name: "centos1-rule"
        temporary: true
        local_ip: "10.1.1.3"
        remote_ip: "10.1.1.4"
        maxbw: "3mbit"
        priority: "medium"
        transport: "tcp"

    - name: Create flowadm rule for redhat1 container
      community.network.flowadm:
        state: present
        name: "redhat1-rule"
        temporary: true
        local_ip: "10.1.1.4"
        remote_ip: "10.1.1.3"
        maxbw: "4mbit"
        priority: "high"
        transport: "udp"