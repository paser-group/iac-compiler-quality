---
- name: Push Configuration to Network Devices
  hosts: all
  gather_facts: false

  tasks:
    - name: Push Configuration
      ansible.netcommon.cli_config:
        backup: True
        backup_options:
          dir: "/path/to/backup/directory"
        commit: True
        commit_comment: "Configuration change"
        config: "{{ playbook_dir }}/config.txt"
        defaults: True
        diff_ignore_lines:
          - "^!"
          - "ntp server"
        diff_match: "none"
        diff_replace: "!\nntp server"
        multiline_delimiter: "!\n"
        replace: "{{ playbook_dir }}/replace.txt"
        rollback: 3
      register: result

    - name: Show Result
      debug:
        var: result