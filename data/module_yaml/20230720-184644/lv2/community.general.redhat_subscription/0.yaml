---
- name: Manage RHSM subscription
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Register the system
      community.general.redhat_subscription:
        username: b'system_user'
        password: b'system_password'
        state: present
        auto_attach: yes
      register: registration_result

    - debug:
        msg: "Registration status: {{ registration_result['status'] }}"

    - name: Attach to pool
      community.general.redhat_subscription:
        pool: b'pool_id'
        state: present
      register: attach_result

    - debug:
        msg: "Attachment status: {{ attach_result['status'] }}"