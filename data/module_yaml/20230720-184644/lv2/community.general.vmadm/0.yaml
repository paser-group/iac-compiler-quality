---
- name: Detect latent type-related bugs in vmadm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create SmartOS virtual machine with type-related bug
      community.general.vmadm:
        name: "test-vm"
        disk_driver: b'virtio'
        image_uuid: b'1234-5678-abcd-efgh'
        ram: 1024
        cpu_type: b'qemu64'
        boot: b'disk'
        state: present

    - name: Delete SmartOS virtual machine
      community.general.vmadm:
        name: "test-vm"
        state: absent