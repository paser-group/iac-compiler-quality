---
- name: Test Playbook for homebrew_tap module
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Install Homebrew if not already installed
      command: which brew
      register: brew_installed
      failed_when: brew_installed.rc != 0
      changed_when: false

    - name: Install homebrew_tap module
      command: brew install ansible/ansible-collection/community.general

    - name: Define homebrew_tap task
      homebrew_tap:
        name: "{{ item.name }}"
        path: "{{ item.path }}"
        state: "{{ item.state }}"
        url: "{{ item.url }}"
      loop:
        - { name: bintest/tap, path: /usr/local/Homebrew/Library/Taps/bintest/homebrew-tap, state: present, url: 'https://github.com/bintest/homebrew-tap' }
        - { name: ansit/tap, path: /usr/local/Homebrew/Library/Taps/ansit/homebrew-tap, state: present, url: b'https://github.com/ansit/homebrew-tap' }