---
- name: Test for Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Import GitLab project variables
      community.general.gitlab_project_variable:
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "MY_API_TOKEN"
        api_username: "admin"
        api_password: "my_password"
        api_job_token: "my_job_token"
        api_oauth_token: "my_oauth_token"
        project: "my_project"
        state: "present"
        validate_certs: false
        variables:
          - key: "VAR_KEY"
            value: b"byte_string_value"
        vars:
          VAR1: "regular_string"
          VAR2: b"byte_string_value"
        purge: false
      register: result

    - name: Debug module output
      debug:
        var: result

    - name: Clean up GitLab project variables
      community.general.gitlab_project_variable:
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "MY_API_TOKEN"
        api_username: "admin"
        api_password: "my_password"
        api_job_token: "my_job_token"
        api_oauth_token: "my_oauth_token"
        project: "my_project"
        state: "absent"
        validate_certs: false
        variables:
          - key: "VAR_KEY"
        vars:
          VAR1: "regular_string"
          VAR2: b"byte_string_value"
        purge: false
      register: cleanup_result

    - name: Debug module output
      debug:
        var: cleanup_result