---
- name: Test playbook for ldap_search module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Test search with byte string value for bind_dn
      community.general.ldap_search:
        server_uri: ldap://localhost
        bind_dn: !binary |-
          Y249YWRtaW4sZGM9ZXhhbXBsZSxjb209YWRtaW4K
        bind_pw: password
        dn: dc=example,dc=com
        filter: "(objectClass=*)"
        scope: subtree
      register: result
      failed_when: false

    - name: Test search with byte string value for filter
      community.general.ldap_search:
        server_uri: ldap://localhost
        bind_dn: cn=admin,dc=example,dc=com
        bind_pw: password
        dn: dc=example,dc=com
        filter: !binary |-
          YihvYmplY3RDbGFzcykK
        scope: subtree
      register: result
      failed_when: false

    - name: Test search with byte string value for dn
      community.general.ldap_search:
        server_uri: ldap://localhost
        bind_dn: cn=admin,dc=example,dc=com
        bind_pw: password
        dn: !binary |-
          ZGM9ZXhhbXBsZSxjb209Y29tCg==
        filter: "(objectClass=*)"
        scope: subtree
      register: result
      failed_when: false

    - name: Test search with byte string value for server_uri
      community.general.ldap_search:
        server_uri: !binary |-
          bGRhcGxhdGVOYW1lOmxvY2FsaG9zdAo=
        bind_dn: cn=admin,dc=example,dc=com
        bind_pw: password
        dn: dc=example,dc=com
        filter: "(objectClass=*)"
        scope: subtree
      register: result
      failed_when: false