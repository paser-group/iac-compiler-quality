---
- name: Test latent type-related bugs in Ansible compiler
  hosts: localhost
  gather_facts: false

  vars:
    package_name: 'test-package'
    package_state: 'installed'
    package_update_cache: 'true'
    package_force: 'yes'

  tasks:
    - name: Install packages using opkg
      community.general.opkg:
        name: "{{ package_name }}"
        state: "{{ package_state }}"
        update_cache: "{{ package_update_cache }}"
        force: "{{ package_force }}"
      register: result
      become: true

      failed_when: "'Failed to install' in result.msg"

    - name: Display opkg install result
      debug:
        var: result