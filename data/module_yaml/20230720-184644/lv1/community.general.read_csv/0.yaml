---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  vars:
    inventory_file: inventory.ini
    delimiter: ","
    dialect: "excel"
    fieldnames: ["name", "ip_address"]
    key: "name"
    path: "data.csv"
    skipinitialspace: false
    strict: false
    unique: false

  tasks:
    - name: Generate inventory file
      file:
        path: "{{ inventory_file }}"
        state: touch

    - name: Add hosts to inventory file
      blockinfile:
        path: "{{ inventory_file }}"
        block: |
          ubuntu1 ansible_host=10.1.1.1
          alpine1 ansible_host=10.1.1.2
          centos1 ansible_host=10.1.1.3
          redhat1 ansible_host=10.1.1.4

    - name: Generate data file
      file:
        path: "{{ path }}"
        state: touch

    - name: Add data to the data file with mixed case sensitivity
      blockinfile:
        path: "{{ path }}"
        block: |
          Name,Ip_Address
          Ubuntu1,10.1.1.1
          Alpine1,10.1.1.2
          CENTOS1,10.1.1.3
          redhat1,10.1.1.4

    - name: Read CSV file with mixed case sensitivity
      community.general.read_csv:
        path: "{{ path }}"
        delimiter: "{{ delimiter }}"
        dialect: "{{ dialect }}"
        fieldnames: "{{ fieldnames }}"
        key: "{{ key }}"
        skipinitialspace: "{{ skipinitialspace }}"
        strict: "{{ strict }}"
        unique: "{{ unique }}"
      register: csv_data

    - name: Debug CSV data
      debug:
        var: csv_data