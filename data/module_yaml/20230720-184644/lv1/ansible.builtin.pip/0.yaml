---
- name: Manage Python packages
  hosts: localhost
  gather_facts: false
  become: true

  vars:
    python_packages:
      - { name: 'numpy', version: '1.18.5' }
      - { name: 'pandas', version: False }
      - { name: 'scikit-learn', version: 0.23 }

  tasks:
    - name: Install Python packages
      ansible.builtin.pip:
        name: "{{ item.name }}"
        version: "{{ item.version }}"
      loop: "{{ python_packages }}"
      when: item.version is defined

    - name: Uninstall Python packages
      ansible.builtin.pip:
        name: "{{ item.name }}"
        state: absent
      loop: "{{ python_packages }}"