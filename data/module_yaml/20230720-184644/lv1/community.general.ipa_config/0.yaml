---

- name: Manage Global FreeIPA Configuration
  hosts: localhost
  become: yes
  gather_facts: false

  vars:
    ipa_host: "{{ hostvars['localhost']['ipa_host'] | default('localhost') }}"
    ipa_pass: "{{ hostvars['localhost']['ipa_pass'] | default('MySecretPassword') }}"
    ipa_port: "{{ hostvars['localhost']['ipa_port'] | default(443) }}"
    ipa_prot: "{{ hostvars['localhost']['ipa_prot'] | default('https') }}"
    ipa_timeout: "{{ hostvars['localhost']['ipa_timeout'] | default(30) }}"
    ipa_user: "{{ hostvars['localhost']['ipa_user'] | default('admin') }}"
    ipaconfigstring: "{{ hostvars['localhost']['ipaconfigstring'] | default(['string1', 'string2']) }}"
    ipadefaultemaildomain: "{{ hostvars['localhost']['ipadefaultemaildomain'] | default('example.com') }}"
    ipadefaultloginshell: "{{ hostvars['localhost']['ipadefaultloginshell'] | default('/bin/bash') }}"
    ipadefaultprimarygroup: "{{ hostvars['localhost']['ipadefaultprimarygroup'] | default('users') }}"
    ipagroupsearchfields: "{{ hostvars['localhost']['ipagroupsearchfields'] | default(['name', 'description']) }}"
    ipahomesrootdir: "{{ hostvars['localhost']['ipahomesrootdir'] | default('/home') }}"
    ipakrbauthzdata: "{{ hostvars['localhost']['ipakrbauthzdata'] | default(['/admin', '/users']) }}"
    ipamaxusernamelength: "{{ hostvars['localhost']['ipamaxusernamelength'] | default(8) }}"
    ipapwdexpadvnotify: "{{ hostvars['localhost']['ipapwdexpadvnotify'] | default(7) }}"
    ipasearchrecordslimit: "{{ hostvars['localhost']['ipasearchrecordslimit'] | default(1000) }}"
    ipasearchtimelimit: "{{ hostvars['localhost']['ipasearchtimelimit'] | default(120) }}"
    ipaselinuxusermaporder: "{{ hostvars['localhost']['ipaselinuxusermaporder'] | default(['byuid', 'bygecos', 'bygid']) }}"
    ipauserauthtype: "{{ hostvars['localhost']['ipauserauthtype'] | default(['password', 'otp', 'radius']) }}"
    ipausersearchfields: "{{ hostvars['localhost']['ipausersearchfields'] | default(['uid', 'givenname', 'sn']) }}"
    validate_certs: "{{ hostvars['localhost']['validate_certs'] | default(false) }}"

  tasks:
    - name: Manage IPA Configuration
      community.general.ipa_config:
        host: "{{ ipa_host }}"
        pass: "{{ ipa_pass }}"
        port: "{{ ipa_port }}"
        prot: "{{ ipa_prot }}"
        timeout: "{{ ipa_timeout }}"
        user: "{{ ipa_user }}"
        ipaconfigstring: "{{ ipaconfigstring }}"
        ipadefaultemaildomain: "{{ ipadefaultemaildomain }}"
        ipadefaultloginshell: "{{ ipadefaultloginshell }}"
        ipadefaultprimarygroup: "{{ ipadefaultprimarygroup }}"
        ipagroupsearchfields: "{{ ipagroupsearchfields }}"
        ipahomesrootdir: "{{ ipahomesrootdir }}"
        ipakrbauthzdata: "{{ ipakrbauthzdata }}"
        ipamaxusernamelength: "{{ ipamaxusernamelength }}"
        ipapwdexpadvnotify: "{{ ipapwdexpadvnotify }}"
        ipasearchrecordslimit: "{{ ipasearchrecordslimit }}"
        ipasearchtimelimit: "{{ ipasearchtimelimit }}"
        ipaselinuxusermaporder: "{{ ipaselinuxusermaporder }}"
        ipauserauthtype: "{{ ipauserauthtype }}"
        ipausersearchfields: "{{ ipausersearchfields }}"
        validate_certs: "{{ validate_certs }}"