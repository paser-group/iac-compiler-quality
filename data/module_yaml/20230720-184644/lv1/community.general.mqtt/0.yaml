- name: Publish Message on MQTT Server
  hosts: localhost
  gather_facts: false

  vars:
    mqtt_ca_cert: /path/to/ca_cert.pem
    mqtt_client_cert: /path/to/client_cert.pem
    mqtt_client_id: MyClient
    mqtt_client_key: /path/to/client_key.pem
    mqtt_password: mypassword
    mqtt_payload: Hello World!
    mqtt_port: 1883
    mqtt_qos: at_least_once
    mqtt_retain: false
    mqtt_server: mqtt.example.com
    mqtt_tls_version: 1.2
    mqtt_topic: my/topic
    mqtt_username: myusername

  tasks:
    - name: Publish MQTT Message
      community.general.mqtt:
        ca_cert: "{{ mqtt_ca_cert }}"
        client_cert: "{{ mqtt_client_cert }}"
        client_id: "{{ mqtt_client_id }}"
        client_key: "{{ mqtt_client_key }}"
        password: "{{ mqtt_password }}"
        payload: "{{ mqtt_payload }}"
        port: "{{ mqtt_port }}"
        qos: "{{ mqtt_qos }}"
        retain: "{{ mqtt_retain }}"
        server: "{{ mqtt_server }}"
        tls_version: "{{ mqtt_tls_version }}"
        topic: "{{ mqtt_topic }}"
        username: "{{ mqtt_username }}"
      register: mqtt_result

    - name: Debug MQTT Result
      debug:
        var: mqtt_result