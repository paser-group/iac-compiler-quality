---
- name: Test 'community.general.rax_clb_nodes' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add nodes to RackSpace load balancer
      community.general.rax_clb_nodes:
        address: "10.1.1.1"
        api_key: "my_api_key"
        auth_endpoint: "https://api.rackspace.com/v2.0"
        credentials: "path/to/credentials"
        env: "prod"
        identity_type: "username"
        load_balancer_id: 12345
        node_id: 54321
        port: 80
        region: "us-west-2"
        state: "present"
        tenant_id: "my_tenant_id"
        tenant_name: "my_tenant_name"
        type: "server"
        username: "my_username"
        validate_certs: true
        virtualenv: "path/to/virtualenv"
        wait: true
        wait_timeout: 60
        weight: 5
      register: result

    - name: Display result
      debug:
        var: result
      
    - name: Modify nodes in RackSpace load balancer
      community.general.rax_clb_nodes:
        address: "10.1.1.1"
        api_key: "my_api_key"
        auth_endpoint: "https://api.rackspace.com/v2.0"
        credentials: "path/to/credentials"
        env: "dev"
        identity_type: "api_key"
        load_balancer_id: 12345
        node_id: 54321
        port: 8080
        region: "us-east-1"
        state: "present"
        tenant_id: "my_tenant_id"
        tenant_name: "my_tenant_name"
        type: "load_balancer"
        username: "my_username"
        validate_certs: false
        virtualenv: "path/to/virtualenv"
        wait: false
        wait_timeout: 30
        weight: 10
      register: result

    - name: Display result
      debug:
        var: result
      
    - name: Remove nodes from RackSpace load balancer
      community.general.rax_clb_nodes:
        address: "10.1.1.1"
        api_key: "my_api_key"
        auth_endpoint: "https://api.rackspace.com/v2.0"
        credentials: "path/to/credentials"
        env: "stage"
        identity_type: "username"
        load_balancer_id: 12345
        node_id: 54321
        port: 443
        region: "us-west-1"
        state: "absent"
        tenant_id: "my_tenant_id"
        tenant_name: "my_tenant_name"
        type: "network"
        username: "my_username"
        validate_certs: true
        virtualenv: "path/to/virtualenv"
        wait: true
        wait_timeout: 45
        weight: 0
      register: result

    - name: Display result
      debug:
        var: result