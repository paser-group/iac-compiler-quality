---
- name: Test Playbook to Reveal Latent Type-Related Bugs in the Ansible Compiler
  hosts: localhost
  gather_facts: False

  tasks:

    - name: Create an ECS Instance
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: us-west-1
        count: 1
        instance_type: ecs.c1.small
        image_id: centos_7_04_64_20G_cloudinit_20160727.raw
        security_group_id: sg-12345678
        vpc_id: vpc-12345678
      register: instance

    - name: Start the Instance
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: US-EAST-1
        instance_ids: "{{ instance.instance_ids }}"
        state: started

    - name: Stop the Instance
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: us-west-2
        instance_ids: "{{ instance.instance_ids }}"
        state: stopped

    - name: Restart the Instance
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: US-EAST-2
        instance_ids: "{{ instance.instance_ids }}"
        state: restarted

    - name: Terminate the Instance
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: us-west-1
        instance_ids: "{{ instance.instance_ids }}"
        state: absent

    - name: Add Instance to Security Group
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: US-EAST-1
        instance_ids: "{{ instance.instance_ids }}"
        security_group_id: sg-87654321
        state: present

    - name: Remove Instance from Security Group
      community.general.ali_instance:
        alicloud_access_key: EXAMPLE_ACCESS_KEY
        alicloud_secret_key: EXAMPLE_SECRET_KEY
        alicloud_region: us-west-2
        instance_ids: "{{ instance.instance_ids }}"
        security_group_id: sg-12345678
        state: present