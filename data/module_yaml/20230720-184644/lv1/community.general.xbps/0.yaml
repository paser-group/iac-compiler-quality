---
- name: Test Playbook
  hosts: all
  gather_facts: false

  tasks:
    - name: Install packages using xbps
      community.general.xbps:
        name: "{{ item }}"
        update_cache: no
        state: present
      loop:
        - package1
        - package2

    - name: Remove packages using xbps
      community.general.xbps:
        name: "{{ item }}"
        state: absent
      loop:
        - package3
        - package4

    - name: Ensure package is upgraded using xbps
      community.general.xbps:
        name: "{{ item }}"
        upgrade: yes
      loop:
        - package1

    - name: Ensure XBPS repository is updated
      community.general.xbps:
        upgrade_xbps: yes

    - name: Update all XBPS packages
      community.general.xbps:
        upgrade: yes

    - name: Search for available packages using xbps
      community.general.xbps:
        name: "*"
        state: query

    - name: Install packages recursively using xbps
      community.general.xbps:
        name: "{{ item }}"
        recurse: yes
        update_cache: yes
        state: present
      loop:
        - package1
        - package2

    - name: Remove packages recursively using xbps
      community.general.xbps:
        name: "{{ item }}"
        recurse: yes
        state: absent
      loop:
        - package3
        - package4