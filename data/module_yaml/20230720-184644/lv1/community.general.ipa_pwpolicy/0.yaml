- name: Test playbook for community.general.ipa_pwpolicy module
  hosts: localhost
  gather_facts: False
  vars:
    ipa_host: "{{ ansible_host }}"
    ipa_user: "admin"
    ipa_pass: "admin@123"
    ipa_port: 443
    ipa_timeout: 10
    validate_certs: False

  tasks:
    - name: Set FreeIPA password policies
      community.general.ipa_pwpolicy:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_timeout: "{{ ipa_timeout }}"
        state: present
        validate_certs: "{{ validate_certs }}"
        # Test different options with mixed case sensitivity
        minclasses: "{{ ['1', '2'] | random }}"
        minlength: "{{ ['8', '10'] | random }}"
        maxfailcount: "{{ ['3', '5'] | random }}"
        maxpwdlife: "{{ ['60', '90'] | random }}"
        minpwdlife: "{{ ['10', '30'] | random }}"
        historylength: "{{ [3, 5] | random | string }}"
        lockouttime: "{{ [30, 60] | random | string }}"
        priority: "{{ ['low', 'normal', 'high'] | random }}"
      register: pwpolicy_result

    - name: Debug module output
      debug:
        var: pwpolicy_result