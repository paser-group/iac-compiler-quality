---
- name: Manage RHSM subscriptions
  hosts: localhost
  gather_facts: false

  vars:
    activation_key: "ACTIVATIONKEY"
    consumer_name: "MyConsumer"
    consumer_type: "Physical"
    environment: "Test"
    org_id: "ORGID"
    password: "mYp@sswOrd"
    pool: "POOL"
    release: "8.4"
    rhsm_baseurl: "https://rhsm.example.com/"
    rhsm_repo_ca_cert: "/path/to/repo_cert.crt"
    server_hostname: "rhsm.example.com"
    server_insecure: "false"
    server_port: "443"
    server_prefix: "/rhsm"
    server_proxy_hostname: "proxy.example.com"
    server_proxy_password: "ProxyPassw0rd"
    server_proxy_port: "8080"
    server_proxy_scheme: "http"
    server_proxy_user: "proxyuser"
    state: "registered"
    syspurpose:
      - purposes:
          - "test"
        description:
          - "Ansible Test"
      - purposes:
          - "development"
        description:
          - "Development Environment"
    username: "myuser"

  tasks:
    - name: Register and attach to RHSM using mixed case values
      community.general.redhat_subscription:
        activationkey: "{{ activation_key | lower }}"
        auto_attach: true
        consumer_id: "{{ consumer_name | upper }}"
        consumer_name: "{{ consumer_name }}"
        consumer_type: "{{ consumer_type }}"
        environment: "{{ environment | upper }}"
        force_register: false
        org_id: "{{ org_id | upper }}"
        password: "{{ password }}"
        pool: "{{ pool | upper }}"
        release: "{{ release }}"
        rhsm_baseurl: "{{ rhsm_baseurl }}"
        rhsm_repo_ca_cert: "{{ rhsm_repo_ca_cert }}"
        server_hostname: "{{ server_hostname }}"
        server_insecure: "{{ server_insecure }}"
        server_port: "{{ server_port }}"
        server_prefix: "{{ server_prefix }}"
        server_proxy_hostname: "{{ server_proxy_hostname }}"
        server_proxy_password: "{{ server_proxy_password }}"
        server_proxy_port: "{{ server_proxy_port }}"
        server_proxy_scheme: "{{ server_proxy_scheme }}"
        server_proxy_user: "{{ server_proxy_user }}"
        state: "{{ state }}"
        syspurpose: "{{ syspurpose }}"
        token: ""
        username: "{{ username }}"
      register: redhat_subscription_result

    - name: Debug redhat_subscription_result
      debug:
        var: redhat_subscription_result