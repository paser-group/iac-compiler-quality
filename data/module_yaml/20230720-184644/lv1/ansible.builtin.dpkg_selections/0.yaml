---
- name: Test dpkg_selections module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set dpkg selections
      ansible.builtin.dpkg_selections:
        name: "{{ item.name }}"
        selection: "{{ item.selection }}"
      loop:
        - { name: "Package1", selection: "install" }
        - { name: "package2", selection: "hold" }
        - { name: "PACKAGE3", selection: "deinstall" }
        - { name: "pAcKaGe4", selection: "purge" }

    - name: Get dpkg selections
      ansible.builtin.dpkg_selections:
        list: yes

      register: dpkg_output

    - name: Debug dpkg selections
      debug:
        var: dpkg_output