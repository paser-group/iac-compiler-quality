---
- name: Test playbook for exposing latent type-related bugs in Ansible compiler
  hosts: localhost
  gather_facts: false
  vars:
    api_key: "12345678"
    auth_endpoint: "https://example.com"
    config_drive: true
    cooldown: 600
    credentials: "/path/to/credentials.yaml"
    disk_config: "AUTO"
    flavor: "large"
    identity_type: "api_key"
    image: "ubuntu"
    key_name: "my_key"
    loadbalancers:
      - name: "lb1"
        port: 80
        protocol: "http"
    max_entities: 10
    meta:
      my_key1: "value1"
      my_key2: "value2"
    min_entities: 2
    name: "scaling_group1"
    networks:
      - name: "network1"
        fixed_ip: "10.1.1.10"
    region: "us-east-1"
    server_name: "web-server"
    state: "present"
    tenant_id: "123456"
    tenant_name: "my_tenant"
    user_data: |
      #!/bin/bash
      echo "Hello, world!"
    username: "my_user"
    validate_certs: true
    wait: true
    wait_timeout: 300

  tasks:
    - name: Create a Rackspace scaling group
      community.general.rax_scaling_group:
        auth_endpoint: "{{ auth_endpoint }}"
        api_key: "{{ api_key }}"
        config_drive: "{{ config_drive }}"
        cooldown: "{{ cooldown }}"
        credentials: "{{ credentials }}"
        disk_config: "{{ disk_config }}"
        flavor: "{{ flavor }}"
        identity_type: "{{ identity_type }}"
        image: "{{ image }}"
        key_name: "{{ key_name }}"
        loadbalancers: "{{ loadbalancers }}"
        max_entities: "{{ max_entities }}"
        meta: "{{ meta }}"
        min_entities: "{{ min_entities }}"
        name: "{{ name }}"
        networks: "{{ networks }}"
        region: "{{ region }}"
        server_name: "{{ server_name }}"
        state: "{{ state }}"
        tenant_id: "{{ tenant_id }}"
        tenant_name: "{{ tenant_name }}"
        user_data: "{{ user_data }}"
        username: "{{ username }}"
        validate_certs: "{{ validate_certs }}"
        wait: "{{ wait }}"
        wait_timeout: "{{ wait_timeout }}"
      register: scaling_group

    - name: Debug scaling group
      debug:
        var: scaling_group