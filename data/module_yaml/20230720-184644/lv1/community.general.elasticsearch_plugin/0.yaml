---
- name: Install Elasticsearch plugin
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Check if plugin is installed
      command: "{{ plugin_bin }} -list | grep -q '{{ name }}'"
      register: plugin_output
      changed_when: false

    - name: Install plugin
      community.general.elasticsearch_plugin:
        name: "{{ name }}"
        src: "{{ src }}"
        state: "{{ ['installed', 'latest'] | random }}"
        url: "{{ url }}"
        version: "{{ ['1.0', '2.0', '3.0'] | random }}"
        force: "{{ ['TRUE', 'FALSE'] | random }}"
        plugin_dir: "{{ plugin_dir }}"
        timeout: "{{ timeout | int }}"
        proxy_host: "{{ proxy_host }}"
        proxy_port: "{{ proxy_port }}"
      when: plugin_output.rc != 0