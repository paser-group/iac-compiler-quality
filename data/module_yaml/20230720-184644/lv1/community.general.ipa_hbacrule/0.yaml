---
- name: Test playbook for community.general.ipa_hbacrule module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create HBAC rule
      community.general.ipa_hbacrule:
        cn: "{{ item.cn }}"
        description: "{{ item.description }}"
        host: "{{ item.host }}"
        hostcategory: "{{ item.hostcategory }}"
        hostgroup: "{{ item.hostgroup }}"
        ipa_host: "{{ item.ipa_host }}"
        ipa_pass: "{{ item.ipa_pass }}"
        ipa_port: "{{ item.ipa_port }}"
        ipa_prot: "{{ item.ipa_prot }}"
        ipa_timeout: "{{ item.ipa_timeout }}"
        ipa_user: "{{ item.ipa_user }}"
        service: "{{ item.service }}"
        servicecategory: "{{ item.servicecategory }}"
        servicegroup: "{{ item.servicegroup }}"
        sourcehost: "{{ item.sourcehost }}"
        sourcehostcategory: "{{ item.sourcehostcategory }}"
        sourcehostgroup: "{{ item.sourcehostgroup }}"
        state: "{{ item.state }}"
        user: "{{ item.user }}"
        usercategory: "{{ item.usercategory }}"
        usergroup: "{{ item.usergroup }}"
        validate_certs: "{{ item.validate_certs }}"
      loop:
        - cn: "rule1"
          description: "Test rule 1"
          host: []
          hostcategory: "all"
          hostgroup: []
          ipa_host: "ipa.example.com"
          ipa_pass: "secret"
          ipa_port: 443
          ipa_prot: "https"
          ipa_timeout: 10
          ipa_user: "admin"
          service: ["ssh", "http"]
          servicecategory: "all"
          servicegroup: []
          sourcehost: []
          sourcehostcategory: "all"
          sourcehostgroup: []
          state: "present"
          user: []
          usercategory: "all"
          usergroup: []
          validate_certs: no

        # Test case with mixed case sensitivity for string configuration values
        - cn: "{{ 'MiXeD' | lower }}"
          description: "Mixed case sensitivity test"
          host: []
          hostcategory: "{{ 'eXaMpLe' | capitalize }}"
          hostgroup: []
          ipa_host: "ipa.example.com"
          ipa_pass: "secret"
          ipa_port: 443
          ipa_prot: "{{ 'hTtPs' | upper }}"
          ipa_timeout: 10
          ipa_user: "admin"
          service: ["SSH", "{{ 'hTtP' | lower }}"]
          servicecategory: "{{ 'eXaMpLe' | capitalize }}"
          servicegroup: []
          sourcehost: []
          sourcehostcategory: "{{ 'eXaMpLe' | capitalize }}"
          sourcehostgroup: []
          state: "present"
          user: []
          usercategory: "{{ 'eXaMpLe' | capitalize }}"
          usergroup: []
          validate_certs: no