---
- name: Test ansible latent bugs
  hosts: localhost
  gather_facts: false

  vars:
    AUTH_CLIENT_ID: "MyClientID"
    AUTH_CLIENT_SECRET: "MyClientSecret"
    AUTH_KEYCLOAK_URL: "https://keycloak.example.com/auth"
    AUTH_USERNAME: "admin"
    AUTH_PASSWORD: "adminpass"
    AUTH_REALM: "myrealm"
    CLIENT_ID: "MyClientID"
    CONNECTION_TIMEOUT: 5
    DISPLAY_NAME: "My Client"
    HTTP_AGENT: "Mozilla/5.0"
    ICON_URI: "https://example.com/icon.png"
    NAME: "authorization_scope"
    REALM: "myrealm"
    STATE: "present"
    TOKEN: "MyToken"
    VALIDATE_CERTS: true

  tasks:
    - name: Ensure Keycloak client authorization scope exists
      community.general.keycloak_authz_authorization_scope:
        AUTH_CLIENT_ID: "{{ AUTH_CLIENT_ID }}"
        AUTH_CLIENT_SECRET: "{{ AUTH_CLIENT_SECRET }}"
        AUTH_KEYCLOAK_URL: "{{ AUTH_KEYCLOAK_URL }}"
        AUTH_PASSWORD: "{{ AUTH_PASSWORD }}"
        AUTH_REALM: "{{ AUTH_REALM }}"
        AUTH_USERNAME: "{{ AUTH_USERNAME }}"
        CLIENT_ID: "{{ CLIENT_ID }}"
        CONNECTION_TIMEOUT: "{{ CONNECTION_TIMEOUT }}"
        DISPLAY_NAME: "{{ DISPLAY_NAME }}"
        HTTP_AGENT: "{{ HTTP_AGENT }}"
        ICON_URI: "{{ ICON_URI }}"
        NAME: "{{ NAME }}"
        REALM: "{{ REALM }}"
        STATE: "{{ STATE }}"
        TOKEN: "{{ TOKEN }}"
        VALIDATE_CERTS: "{{ VALIDATE_CERTS }}"
      register: result

    - debug:
        var: result