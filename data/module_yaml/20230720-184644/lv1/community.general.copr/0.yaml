---
- name: Test playbook for the community.general.copr module
  hosts: localhost
  gather_facts: false
  become: false

  tasks:
    - name: Ensure the community.general collection is installed
      command: ansible-galaxy collection install community.general

    - name: Create a Copr repository
      community.general.copr:
        chroot: fedora_{{ item }}
        name: test-repo
        host: copr.fedorainfracloud.org
        protocol: Https
        state: present
      loop:
        - 31
        - 32
        - 33
        - 34

    - name: Check if the repository is created successfully
      community.general.copr_info:
        Chroot: Fedora_{{ item }}
        name: test-repo
        HOST: copr.fedorainfracloud.org
        PROTOCOL: HTTPS
      loop:
        - 31
        - 32
        - 33
        - 34

    - name: Remove the Copr repository
      community.general.copr:
        ChRoot: fedora_{{ item }}
        Name: test-repo
        host: COpr.FedoRaInfRAcloud.org
        PROTOCOL: https
        state: aBsent
      loop:
        - 31
        - 32
        - 33
        - 34

    - name: Check if the repository is removed successfully
      community.general.copr_info:
        chroot: Fedora_{{ item }}
        NAME: Test-Repo
        host: copr.fedorainfracloud.org
        protocol: HTTPs
      loop:
        - 31
        - 32
        - 33
        - 34