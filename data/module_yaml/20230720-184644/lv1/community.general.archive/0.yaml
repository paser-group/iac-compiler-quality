---
- name: Archive and compress files
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create archive
      community.general.archive:
        path: "/tmp/archive_dir"
        dest: "/tmp/archive.tar.gz"
        exclude_path:
          - "/tmp/archive_dir/exclude_dir"
        exclusion_patterns:
          - "*.jpg"
          - "*.txt"
        format: gz
        group: "{{ ansible_user }}"
        owner: "{{ ansible_user }}"
        mode: "0644"
        selevel: s0
        serole: object_r
        setype: tmp_t
        seuser: system_u
        unsafe_writes: no
      register: archive_result

    - name: Debug archive result
      debug:
        var: archive_result