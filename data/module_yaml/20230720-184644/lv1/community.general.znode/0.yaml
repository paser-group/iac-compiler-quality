---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: no
  vars:
    auth_credential: "my_password"

  tasks:
    - name: Create znode
      community.general.znode:
        name: "/test_node"
        value: "Test value"
        state: present
        recursive: no
        timeout: "10"
        auth_credential: "{{ auth_credential }}"
        auth_scheme: "basic"
        hosts: "localhost"
        op: "create"
        use_tls: yes

    - name: Delete znode
      community.general.znode:
        name: "/test_node"
        state: absent
        recursive: yes
        timeout: 20
        auth_credential: "{{ auth_credential }}"
        auth_scheme: "basic"
        hosts: "localhost"
        op: delete
        use_tls: true

    - name: Retrieve znode
      community.general.znode:
        name: "/test_node"
        state: present
        recursive: "yes"
        timeout: "{{ 30 }}"
        auth_credential: "{{ auth_credential }}"
        auth_scheme: "basic"
        hosts: "localhost"
        op: "retrieve"
        use_tls: true

    - name: Update znode
      community.general.znode:
        name: "/test_node"
        value: "Updated value"
        state: "present"
        recursive: "{{ true }}"
        timeout: 10
        auth_credential: "{{ auth_credential }}"
        auth_scheme: "basic"
        hosts: "localhost"
        op: "update"
        use_tls: "no"