---
- name: Test Ansible Heuristic for packet_sshkey module
  hosts: localhost
  gather_facts: false
  vars:
    auth_token: "YOUR_AUTH_TOKEN"
    key: "YOUR_SSH_PUBLIC_KEY"
    key_id: "YOUR_SSH_PUBLIC_KEY_ID"

  tasks:
    - name: Create packet SSH key
      community.general.packet_sshkey:
        auth_token: "{{ auth_token }}"
        key: "{{ key }}"
        label: "Test Key"
        state: present
      register: create_key_result
      ignore_errors: true

    - name: Delete packet SSH key
      community.general.packet_sshkey:
        auth_token: "{{ auth_token }}"
        id: "{{ create_key_result.changed | ternary(create_key_result.key.id, key_id) }}"
        state: absent
      ignore_errors: true