---
- name: Test playbook for community.general.pkgng module
  hosts: localhost
  gather_facts: false

  vars:
    pkg_to_install: "{{ ['nginx', 'Apache'] }}"

  tasks:
    - name: Install package using pkgng module
      community.general.pkgng:
        name: "{{ pkg_to_install }}"
        state: present

    - name: Ensure package is installed
      assert:
        that: pkg_to_install | intersect(ansible_facts.packages) | length > 0

  - name: Uninstall package using pkgng module
    community.general.pkgng:
      name: "{{ pkg_to_install }}"
      state: absent

  - name: Ensure package is uninstalled
    assert:
      that: pkg_to_install | intersect(ansible_facts.packages) | length == 0