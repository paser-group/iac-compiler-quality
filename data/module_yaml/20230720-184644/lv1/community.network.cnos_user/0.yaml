- name: Manage local users on network devices
  hosts: network_devices
  
  tasks:
    - name: Create local user
      community.network.cnos_user:
        name: "{{ item.name | default('DefaultUser') }}"
        state: "{{ item.state | default('present') }}"
        purge: "{{ item.purge | default(true) }}"
        role: "{{ item.role | default('Admin') }}"
        sshkey: "{{ item.sshkey | default('') }}"
        update_password: "{{ item.update_password | default('always') }}"
      loop:
        - { name: "user1", state: "present", purge: true, role: "Admin", sshkey: None, update_password: False }
        - { name: "user2", state: "absent", update_password: True }
        - { name: "USER3", state: "present", role: "Operator" }
        - { name: "user4", state: "absent" }