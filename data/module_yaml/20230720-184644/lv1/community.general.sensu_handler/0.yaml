---
- name: Manage Sensu
  hosts: localhost
  gather_facts: false
  become: true

  tasks:
    - name: Install Sensu handler dependencies
      pip:
        name: sensu-handler
        state: present

    - name: Manage Sensu Handler
      community.general.sensu_handler:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
        command: "{{ item.command }}"
        filter: "{{ item.filter }}"
        filters: "{{ item.filters }}"
        handle_flapping: "{{ item.handle_flapping }}"
        handle_silenced: "{{ item.handle_silenced }}"
        handlers: "{{ item.handlers }}"
        mutator: "{{ item.mutator }}"
        pipe: "{{ item.pipe }}"
        severities: "{{ item.severities }}"
        socket: "{{ item.socket }}"
        timeout: "{{ item.timeout }}"
        type: "{{ item.type }}"
      loop:
        - name: Example 1
          state: present
          command: "example command"
          filter: "example filter"
          filters:
            - "filter1"
            - "filter2"
          handle_flapping: false
          handle_silenced: true
          handlers:
            - "handler1"
            - "handler2"
          mutator: "example mutator"
          pipe:
            path: "/tmp/example_pipe"
            mode: "0644"
          severities:
            - "severity1"
            - "severity2"
          socket:
            path: "/tmp/example_socket"
            mode: "0644"
          timeout: 10
          type: "example type"

        - name: Example 2
          state: present
          command: "example command"
          filter: "example filter"
          filters:
            - "filter1"
            - "filter2"
          handle_flapping: false
          handle_silenced: true
          handlers:
            - "handler1"
            - "handler2"
          mutator: "example mutator"
          pipe: None
          severities:
            - "severity1"
            - "severity2"
          socket: None
          timeout: 10
          type: "EXAMPLE TYPE"

        # Add more test cases here based on the heuristic

      register: sensu_handler_result

    - name: Debug Sensu Handler Result
      debug:
        var: sensu_handler_result