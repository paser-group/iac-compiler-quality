---
- name: Create, Update, and Delete Dimension Data Network
  hosts: localhost
  gather_facts: false

  vars:
    description: "Test Network"
    location: "Test Location"
    mcp_user: "admin"
    mcp_password: "adminpassword"
    name: "test-network"
    region: "Test Region"
    service_plan: "CLOSED"
    state: "present"
    validate_certs: false
    wait: false
    wait_poll_interval: 5
    wait_time: 60

  tasks:
    - name: Create Dimension Data Network
      community.general.dimensiondata_network:
        description: "!null"
        location: "!null"
        mcp_user: "!null"
        mcp_password: "!null"
        name: "{{ name }}"
        region: "!null"
        service_plan: "!null"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        wait: "{{ wait }}"
        wait_poll_interval: "{{ wait_poll_interval }}"
        wait_time: "{{ wait_time }}"
      register: network_result

    - name: Debug Network Result
      debug:
        var: network_result

    - name: Update Dimension Data Network
      community.general.dimensiondata_network:
        description: "!null"
        location: "!null"
        mcp_user: "!null"
        mcp_password: "!null"
        name: "{{ name }}"
        region: "!null"
        service_plan: "!null"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        wait: "{{ wait }}"
        wait_poll_interval: "{{ wait_poll_interval }}"
        wait_time: "{{ wait_time }}"
      register: update_result
      when: network_result.changed

    - name: Debug Update Result
      debug:
        var: update_result

    - name: Delete Dimension Data Network
      community.general.dimensiondata_network:
        mcp_user: "!null"
        mcp_password: "!null"
        name: "{{ name }}"
        region: "!null"
        service_plan: "!null"
        state: "absent"
        validate_certs: "{{ validate_certs }}"
        wait: "{{ wait }}"
        wait_poll_interval: "{{ wait_poll_interval }}"
        wait_time: "{{ wait_time }}"
      register: delete_result
      when: network_result.changed

    - name: Debug Delete Result
      debug:
        var: delete_result