---
- name: Test playbook for clc_firewall_policy module
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Create firewall policy
      community.general.clc_firewall_policy:
        name: test-policy
        location: UC1
        state: present
        enabled: "true"
        source: !null
        destination: !null
        ports: []
        destination_account_alias: !Null
        source_account_alias: ""
        wait: "true"
      ignore_errors: true

    - name: Check if policy creation failed
      fail:
        msg: "Failed to create firewall policy"
      when: create_result is failed

    - name: Update firewall policy
      community.general.clc_firewall_policy:
        name: test-policy
        location: UC1
        state: present
        enabled: "false"
        source: !Null
        destination: []
        ports: [8080]
        destination_account_alias: !Null
        source_account_alias: ""
        wait: "true"
      ignore_errors: true

    - name: Check if policy update failed
      fail:
        msg: "Failed to update firewall policy"
      when: update_result is failed

    - name: Delete firewall policy
      community.general.clc_firewall_policy:
        name: test-policy
        location: UC1
        state: absent
      ignore_errors: true

    - name: Check if policy deletion failed
      fail:
        msg: "Failed to delete firewall policy"
      when: delete_result is failed