---
- name: Test ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    api_context:
      api_type: "internal"
      api_version: "20.1.4"

    avi_credentials:
      controller: "https://controller.example.com"
      username: "admin"
      password: "secret"
      tenant: "default"

  tasks:
    - name: Configure Service Engine using avi_serviceengine module
      community.network.avi_serviceengine:
        controller: "{{ avi_credentials.controller }}"
        username: "{{ avi_credentials.username }}"
        password: "{{ avi_credentials.password }}"
        tenant: "{{ avi_credentials.tenant }}"
        api_context: "{{ api_context }}"
        api_version: "{{ api_context.api_version }}"
  
      register: se_config
      
    - name: Debug se_config to unveil latent type-related bugs
      debug:
        var: se_config

    - name: Trigger type-related bug using !null for api_version
      community.network.avi_serviceengine:
        controller: "{{ avi_credentials.controller }}"
        username: "{{ avi_credentials.username }}"
        password: "{{ avi_credentials.password }}"
        tenant: "{{ avi_credentials.tenant }}"
        api_context: "{{ api_context }}"
        api_version: !null
  
      register: se_config_with_bug
  
    - name: Debug se_config_with_bug to unveil latent type-related bugs
      debug:
        var: se_config_with_bug