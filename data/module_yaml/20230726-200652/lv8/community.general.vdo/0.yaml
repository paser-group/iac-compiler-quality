---
- name: Test playbook for community.general.vdo module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required packages
      package:
        name: "{{ item }}"
        state: present
      loop:
        - lvm2
        - vdo

    - name: Create VDO volume
      community.general.vdo:
        state: present
        name: "{{ vdo_name }}"
        device: "{{ device }}"
        logicalsize: "{{ logicalsize }}"
        compression: "{{ compression }}"
        deduplication: "{{ deduplication }}"
        writepolicy: "{{ writepolicy }}"
        readcache: "{{ readcache }}"
        readcachesize: "{{ readcachesize }}"
      vars:
        vdo_name: ansible_vdo
        device: /dev/sdb
        logicalsize: 100G
        compression: !null
        deduplication: !null
        writepolicy: always
        readcache: meta
        readcachesize: 1G