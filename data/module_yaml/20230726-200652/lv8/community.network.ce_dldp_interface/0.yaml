---
- name: Test playbook for latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    node_net_subnet: "10.1.1.0/24"
    node_net_gateway: "10.1.1.254"

    nodes:
      - name: "ubuntu1"
        ip: "10.1.1.1"
        distribution: "ubuntu"
      - name: "alpine1"
        ip: "10.1.1.2"
        distribution: "alpine"
      - name: "centos1"
        ip: "10.1.1.3"
        distribution: "centos"
      - name: "redhat1"
        ip: "10.1.1.4"
        distribution: "redhat"

  tasks:
    - name: Create network
      docker_network:
        name: "node-net"
        subnet: "{{ node_net_subnet }}"
        gateway: "{{ node_net_gateway }}"

    - name: Create Docker nodes
      docker_container:
        name: "{{ item.name }}"
        image: "ansible/{{ item.distribution }}:latest"
        command: sleep infinity
        labels:
          ansible_host: "{{ item.ip }}"
        network_mode: node-net
      with_items: "{{ nodes }}"