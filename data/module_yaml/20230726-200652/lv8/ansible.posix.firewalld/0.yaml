---
- name: Test playbook for ansible.posix.firewalld module
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Add a rich rule with target drop
      firewalld:
        zone: public
        permanent: true
        rich_rule: "!null"

    - name: Add a port forward rule
      firewalld:
        zone: public
        permanent: true
        port_forward:
          - port: "8080:8090"
            protocol: !null
            target: "192.168.1.100:80"

    - name: Add a service rule
      firewalld:
        zone: public
        state: enabled
        service: null

    - name: Add a source-based rule
      firewalld:
        zone: public
        state: disabled
        source: !null

    - name: Add a masquerade rule
      firewalld:
        zone: public
        masquerade: null

    - name: Add an interface-based rule
      firewalld:
        zone: public
        state: enabled
        interface: !null

    - name: Add a timeout-based rule
      firewalld:
        zone: public
        permanent: true
        protocol: null
        port: "123"
        timeout: !null

    - name: Add an ICMP block rule
      firewalld:
        zone: public
        icmp_block: !null
        icmp_block_inversion: "yes"

    - name: Add a firewall rule with immediate flag
      firewalld:
        zone: public
        state: enabled
        immediate: !null
        port: "22"

    - name: Add a firewall rule in offline mode
      firewalld:
        zone: public
        offline: !null
        state: disabled
        port: "80"

    - name: Remove a port forward rule
      firewalld:
        zone: public
        port_forward:
          - port: !null
            protocol: "tcp"
            target: "192.168.1.100:80"
            state: absent

    - name: Remove all firewall rules
      firewalld:
        zone: public
        state: !null

    - name: Reload firewalld service
      systemd:
        name: firewalld
        state: restarted

    - name: Check if firewalld service is running
      systemd:
        name: firewalld
        state: started
      register: firewalld_status

    - name: Print firewalld service status
      debug:
        var: firewalld_status