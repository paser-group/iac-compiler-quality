---
- name: Test ansible.module.community.general.imgadm
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required Python packages
      pip:
        name: smartos-tools
        state: present

    - name: Ensure image is absent
      community.general.imgadm:
        uuid: "{{ !null }}"
        state: absent

    - name: Register image using pool and source
      community.general.imgadm:
        pool: "{{ !null }}"
        source: "{{ !null }}"
        state: present

    - name: Update image properties using uuid
      community.general.imgadm:
        uuid: "example-img-1"
        properties:
          autoreboot: "{{ !null }}"
          compression: "{{ !null }}"

    - name: Update image properties using pool and type
      community.general.imgadm:
        pool: "{{ !null }}"
        type: "{{ !null }}"
        properties:
          autoreboot: "{{ !null }}"
          compression: "{{ !null }}"
        state: updated

    - name: Delete image using uuid
      community.general.imgadm:
        uuid: "{{ !null }}"
        state: absent

    - name: Verify image deletion
      community.general.imgadm_facts:
        uuid: "{{ !null }}"
      register: imgadm_facts

    - name: Print image deletion status
      debug:
        var: imgadm_facts