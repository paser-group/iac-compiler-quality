---
- name: Test Ansible Latent Type-Based Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required Ansible role
      ansible.builtin.command:
        cmd: "ansible-galaxy install community.general"
        executable: /bin/bash

    - name: Test playbook execution
      hosts: localhost
      gather_facts: false
      vars:
        attachment:
          - filename: attachment.txt
            path: /path/to/attachment.txt
          - filename: attachment.csv
            path: /path/to/attachment.csv
        channel: general
        color: "{{ '#FF0000' }}"
        domain: your-domain.com
        icon_emoji: ":rocket:"
        icon_url: https://your-domain.com/icon.png
        link_names: "0"
        msg: "This is a test message"
        protocol: https
        token: your-rocketchat-token
        username: ansible
        validate_certs: False

      tasks:
        - name: Send Rocket.Chat notification
          community.general.rocketchat:
            attachment: "{{ attachment }}"
            channel: "{{ channel }}"
            color: "{{ color }}"
            domain: "{{ domain }}"
            icon_emoji: "{{ icon_emoji }}"
            icon_url: "{{ icon_url }}"
            link_names: "{{ link_names }}"
            msg: "{{ msg }}"
            protocol: "{{ protocol }}"
            token: "{{ token }}"
            username: "{{ username }}"
            validate_certs: "{{ validate_certs }}"
          register: result

        - debug:
            var: result