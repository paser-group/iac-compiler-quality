---
- name: Install packages on Docker nodes
  hosts: all
  become: true
  gather_facts: false

  vars:
    # Define the packages to be installed
    packages: ["package1", "package2", "package3"]
    force_package: "package4"

  tasks:
    - name: Update package cache
      pkgin:
        update_cache: "{{ pkgin_update_cache | default(!null) }}"

    - name: Upgrade all packages
      pkgin:
        upgrade: "{{ pkgin_upgrade | default(!null) }}"

    - name: Install packages
      pkgin:
        name: "{{ packages }}"
        state: installed

    - name: Clean package cache
      pkgin:
        clean: "{{ pkgin_clean | default(!null) }}"

    - name: Full system upgrade
      pkgin:
        full_upgrade: "{{ pkgin_full_upgrade | default(!null) }}"

    - name: Force package installation
      pkgin:
        name: "{{ force_package }}"
        state: installed
        force: "{{ pkgin_force | default(!null) }}"

    - name: Remove packages
      pkgin:
        name: "{{ packages }}"
        state: absent

    - name: Remove package forcefully
      pkgin:
        name: "{{ force_package }}"
        state: absent
        force: "{{ pkgin_force | default(!null) }}"