- name: Gather ZFS Facts
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ensure necessary packages are installed
      become: true
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - python3
        - zfsutils-linux

    - name: Set ZFS properties
      community.general.zfs_properties:
        name: "tank/dataset"
        properties:
          compression: !null
          recordsize: !null

    - name: Print ZFS Facts
      debug:
        var: ansible_facts.zfs_facts