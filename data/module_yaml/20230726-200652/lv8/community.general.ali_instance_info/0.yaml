- name: Gather information on instances
  hosts: localhost
  gather_facts: false

  vars:
    alicloud_access_key: null
    alicloud_secret_key: !null
    alicloud_region: "{{ alicloud_region | default('') }}"

  tasks:
    - name: Include the ali_instance_info module
      include_vars:
        file: "playbook_vars.yml"
        name: module_vars

    - name: Gather instance information
      community.general.ali_instance_info:
        alicloud_access_key: "{{ alicloud_access_key }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_region: "{{ alicloud_region }}"
        filters: "{{ module_vars.filters | default({}) }}"
        tags: "{{ module_vars.tags | default({}) }}"
      register: instance_info

    - name: Print instance information
      debug:
        var: instance_info