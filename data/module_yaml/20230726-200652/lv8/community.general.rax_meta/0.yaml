---

- name: Test playbook for community.general.rax_meta module
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Include rax_meta module
      include_role:
        name: community.general.rax_meta

    - name: Set metadata for Rackspace server
      community.general.rax_meta:
        address: "10.1.1.1"
        api_key: "YOUR_API_KEY"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0"
        credentials: "/path/to/credentials.json"
        env: "prod"
        id: "server_id"
        identity_type: "rackspace"
        meta:
          key1: value1
          key2: value2
        name: "server_name"
        region: "us-east"
        tenant_id: "YOUR_TENANT_ID"
        tenant_name: "YOUR_TENANT_NAME"
        username: "YOUR_USERNAME"
        validate_certs: "true"
      register: result

    - name: Debug rax_meta result
      debug:
        var: result

    # New latent type-related bug test case

    - name: Test validate_certs option with integer value
      community.general.rax_meta:
        address: "10.1.1.1"
        api_key: "YOUR_API_KEY"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0"
        credentials: "/path/to/credentials.json"
        env: "prod"
        id: "server_id"
        identity_type: "rackspace"
        meta:
          key1: value1
          key2: value2
        name: "server_name"
        region: "us-east"
        tenant_id: "YOUR_TENANT_ID"
        tenant_name: "YOUR_TENANT_NAME"
        username: "YOUR_USERNAME"
        validate_certs: 1
      register: result_validate_certs_bug

    - name: Debug rax_meta result with validate_certs bug
      debug:
        var: result_validate_certs_bug