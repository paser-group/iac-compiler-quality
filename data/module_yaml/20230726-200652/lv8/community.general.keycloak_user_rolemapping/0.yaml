---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set up variables
      vars:
        keycloak_url: "https://your-keycloak-url"
        realm: "your-realm"
        client_id: "your-client-id"
        client_secret: "your-client-secret"
        username: "your-username"
        password: "your-password"
        target_username: "your-target-username"

    - name: Create a Keycloak user role mapping with string values
      community.general.keycloak_user_rolemapping:
        auth_keycloak_url: "{{ keycloak_url }}"
        auth_realm: "{{ realm }}"
        auth_client_id: "{{ client_id }}"
        auth_client_secret: "{{ client_secret }}"
        auth_username: "{{ username }}"
        auth_password: "{{ password }}"
        token: "{{ token | default(omit) }}"
        validate_certs: "{{ validate_certs | default(true) }}"
        state: present
        realm: "{{ realm }}"
        uid: "123"
        roles: ["admin", "user"]
      register: result_string

    - name: Debug result with string values
      debug:
        var: result_string

    - name: Create a Keycloak user role mapping with null values
      community.general.keycloak_user_rolemapping:
        auth_keycloak_url: "{{ keycloak_url }}"
        auth_realm: "{{ realm }}"
        auth_client_id: "{{ client_id }}"
        auth_client_secret: "{{ client_secret }}"
        auth_username: "{{ username }}"
        auth_password: "{{ password }}"
        token: "{{ token | default(omit) }}"
        validate_certs: "{{ validate_certs | default(true) }}"
        state: present
        realm: "{{ realm }}"
        uid: null
        roles: null
      register: result_null

    - name: Debug result with null values
      debug:
        var: result_null