---
- name: Test playbook for 'community.general.linode' module
  hosts: localhost
  gather_facts: false
  vars:
    - api_key: YOUR_API_KEY
    - linode_id: 12345
    - name: my-linode
    - plan: 1
    - datacenter: 2
    - distribution: 140
    - backups_enabled: true
    - backupweeklyday: 1
    - backupwindow: 2
    - alert_bwin_enabled: true
    - alert_bwin_threshold: 80
    - alert_bwout_enabled: true
    - alert_bwout_threshold: 80
    - alert_bwquota_enabled: true
    - alert_bwquota_threshold: 80
    - alert_cpu_enabled: true
    - alert_cpu_threshold: 80
    - alert_diskio_enabled: true
    - alert_diskio_threshold: 80
    - ssh_pub_key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
    - state: present
    - wait_timeout: 180

  tasks:
    - name: Create Linode instance
      community.general.linode:
        api_key: "{{ api_key }}"
        name: "{{ name }}"
        plan: "{{ plan }}"
        datacenter: "{{ datacenter }}"
        distribution: "{{ distribution }}"
        backups_enabled: "{{ backups_enabled }}"
        backupweeklyday: "{{ backupweeklyday }}"
        backupwindow: "{{ backupwindow }}"
        alert_bwin_enabled: "{{ alert_bwin_enabled }}"
        alert_bwin_threshold: "{{ alert_bwin_threshold }}"
        alert_bwout_enabled: "{{ alert_bwout_enabled }}"
        alert_bwout_threshold: "{{ alert_bwout_threshold }}"
        alert_bwquota_enabled: "{{ alert_bwquota_enabled }}"
        alert_bwquota_threshold: "{{ alert_bwquota_threshold }}"
        alert_cpu_enabled: "{{ alert_cpu_enabled }}"
        alert_cpu_threshold: "{{ alert_cpu_threshold }}"
        alert_diskio_enabled: "{{ alert_diskio_enabled }}"
        alert_diskio_threshold: "{{ alert_diskio_threshold }}"
        ssh_pub_key: "{{ ssh_pub_key }}"
        state: "{{ state }}"
        wait_timeout: "{{ wait_timeout }}"
      register: linode_result

    - name: Debug Linode creation result
      debug:
        var: linode_result