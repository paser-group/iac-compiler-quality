---
- name: Create or Terminate a VM
  hosts: localhost
  gather_facts: false

  vars:
    api_url: "https://example.com/api"
    api_username: "admin"
    api_password: !null

  tasks:
    - name: Create VM with null password
      community.general.one_vm:
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        attributes:
          NAME: "test_vm"
          CPU: 1
          MEMORY: 1024
          CONTEXT:
            DISK_ID: "222"
            NETWORK: "net1"
        count: 1
      register: vm_null_password

    - name: Debug VM with null password
      debug:
        var: vm_null_password

    - name: Create VM without null password
      community.general.one_vm:
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "secret"
        attributes:
          NAME: "test_vm"
          CPU: 1
          MEMORY: 1024
          CONTEXT:
            DISK_ID: "222"
            NETWORK: "net1"
        count: 1
      register: vm_non_null_password

    - name: Debug VM without null password
      debug:
        var: vm_non_null_password