---
- name: Create Keycloak Identity Provider
  hosts: localhost
  gather_facts: false

  vars:
    identity_provider:
      alias: my_provider
      enabled: true
      auth_username: admin
      auth_password: admin
      auth_realm: my_realm
      auth_keycloak_url: http://keycloak.example.com/auth

  tasks:
    - name: Create identity provider
      community.general.keycloak_identity_provider:
        alias: "{{ identity_provider.alias }}"
        enabled: "{{ identity_provider.enabled }}"
        auth_username: "{{ identity_provider.auth_username }}"
        auth_password: "{{ identity_provider.auth_password }}"
        auth_realm: "{{ identity_provider.auth_realm }}"
        auth_keycloak_url: "{{ identity_provider.auth_keycloak_url }}"
        config:
          display_name: !null
          http_agent: !null
          link_only: false
          mappers:
            - name: "mapper1"
              expr: !null
          post_broker_login_flow_alias: !null
        provider_id: "oidc"
        realm: "{{ identity_provider.realm | default(omit) }}"
        state: present
        store_token: false
        token: !null
        trust_email: false
        validate_certs: true
      register: result

    - debug:
        var: result