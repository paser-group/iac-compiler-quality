---
- name: Test playbook for 'community.general.ipa_role'
  hosts: localhost
  gather_facts: False

  vars:
    cn: "testuser"
    description: !null        # Heuristic: Use !null as configuration value
    group:
      - !null
      - "group1"
      - "group2"
    host:
      - "host1"
      - "host2"
    hostgroup:
      - !null
      - "hostgroup1"
      - "hostgroup2"
    ipa_host: "ipa.example.com"
    ipa_user: "admin"
    ipa_pass: "admin_passwd"
    ipa_port: 443
    ipa_prot: "https"
    ipa_timeout: 10
    privilege:
      - "priv1"
      - !null
      - "priv3"
    service:
      - "service1"
      - "service2"
    state: "present"
    user:
      - !null
      - "user1"
    validate_certs: true

  tasks:
    - name: Install IPA dependencies
      package:
        name: "{{ item }}"
        state: present
      loop:
        - ipa-client
        - python3-ipalib
        - python3-ipaclient
      become: true

    - name: Configure IPA Server
      community.general.ipa_role:
        cn: "{{ cn }}"
        description: "{{ description }}"
        group: "{{ group }}"
        host: "{{ host }}"
        hostgroup: "{{ hostgroup }}"
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        privilege: "{{ privilege }}"
        service: "{{ service }}"
        state: "{{ state }}"
        user: "{{ user }}"
        validate_certs: "{{ validate_certs }}"