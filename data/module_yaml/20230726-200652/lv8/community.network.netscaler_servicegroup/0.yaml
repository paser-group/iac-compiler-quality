---
- name: Test playbook for community.network.netscaler_servicegroup module
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: admin
    nitro_pass: password
    nitro_protocol: http
    nitro_timeout: 10
    nsip: 192.168.0.1

  tasks:
    - name: Create a service group without specifying optional parameters
      community.network.netscaler_servicegroup:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        servicegroupname: my-service-group
        state: present

    - name: Create a service group with specific options
      community.network.netscaler_servicegroup:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        servicegroupname: my-service-group
        state: present
        healthmonitor: true
        comment: "This is a test service group"
        cacheable: true
        clttimeout: 180
        downstateflush: true

    - name: Update an existing service group
      community.network.netscaler_servicegroup:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        servicegroupname: my-service-group
        state: present
        maxclient: 100
        maxreq: 1000

    - name: Delete a service group
      community.network.netscaler_servicegroup:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        servicegroupname: my-service-group
        state: absent