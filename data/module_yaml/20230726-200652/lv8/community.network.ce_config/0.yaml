---
- name: Manage Huawei CloudEngine configuration
  hosts: all
  gather_facts: false

  vars:
    backup_dir: "/tmp/backup"
    null_value: !null

  tasks:
    - name: Backup current configuration
      community.network.ce_config:
        backup: yes
        backup_options:
          dir_path: "{{ backup_dir }}/{{ ansible_host }}"
      register: backup_result

    - name: Verify backup success
      assert:
        that:
          - "backup_result is defined"
          - "backup_result.backup_successful is defined"
          - "backup_result.backup_successful"

    - name: Configure CloudEngine device
      community.network.ce_config:
        after: null_value
        before: null_value
        config: null_value
        defaults: false
        lines: null_value
        match: null_value
        parents: null_value
        replace: null_value
        save: true
        src: null_value