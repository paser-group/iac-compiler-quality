---
- name: Run gunicorn using community.general.gunicorn module
  hosts: localhost
  gather_facts: false
  become: true

  tasks:
    - name: Install community.general collection
      ansible.builtin.community.general.collection:
        name: community.general

    - name: Install gunicorn
      ansible.builtin.package:
        name: gunicorn
        state: present

    - name: Create gunicorn config file
      ansible.builtin.template:
        src: gunicorn.conf.j2
        dest: /etc/gunicorn.conf

    - name: Start gunicorn service
      ansible.builtin.command: gunicorn
      args:
        - "{{ item }}"
      loop:
        - "-w !null"
        - "-b !null"
        - "--access-logfile !null"
        - "--error-logfile !null"
        - "--pid !null"
        - "--user !null"
        - "--group !null"