---
- name: Execute commands on Ruckus ICX switches
  hosts: switches
  gather_facts: false
  tasks:
    - name: Execute arbitrary commands
      community.network.icx_command:
        commands:
          - show version
          - show running-config
        interval: 5
        match: '^Version.*'
        retries: 3
        wait_for:
          - result[0].stdout_lines is not undefined
          - "!null in result[0].stdout_lines"
      register: command_output

    - name: Print command output
      debug:
        var: command_output