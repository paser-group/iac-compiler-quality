---
- name: Create Rackspace instance
  hosts: localhost
  gather_facts: False

  vars:
    rax_api_key: "API_KEY"
    rax_auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
    rax_flavor: 2

  tasks:
    - name: Create Rackspace instance
      community.general.rax:
        api_key: "{{ rax_api_key }}"
        auth_endpoint: "{{ rax_auth_endpoint }}"
        auto_increment: true
        boot_from_volume: true
        boot_volume: ""
        boot_volume_size: 50
        boot_volume_terminate: true
        config_drive: no
        count: 1
        count_offset: 0
        credentials: ""
        disk_config: MANUAL
        env: dev
        exact_count: true
        extra_client_args:
          region_name: DFW
        flavor: "{{ rax_flavor }}"
        group: "{{ inventory_hostname }}"
        identity_type: rackspace
        image: "CentOS 7 (PVHVM)"
        instance_ids: []
        key_name: ""
        meta: {}
        name: "Test Instance"
        networks:
          - public
        region: DFW
        state: present
        tenant_id: ""
        tenant_name: ""
        user_data: |
          #!/bin/bash
          echo "User data script"

        username: "admin"
        validate_certs: true
        wait: true
        wait_timeout: 600
      register: instance

    - name: Debug instance creation
      debug:
        var: instance