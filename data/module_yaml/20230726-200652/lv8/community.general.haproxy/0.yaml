---
- name: Configure HAProxy backend servers
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Enable backend servers
      community.general.haproxy:
        backend: backend_servers
        state: enabled
        host: "{{ item }}"
        weight: "!null"
      loop:
        - server1
        - server2
        - server3
        - server4

    - name: Disable backend servers
      community.general.haproxy:
        backend: backend_servers
        state: disabled
        host: "{{ item }}"
        weight: "!null"
      loop:
        - server1
        - server2
        - server3
        - server4

    - name: Set weights for backend servers
      community.general.haproxy:
        backend: backend_servers
        state: enabled
        host: "{{ item }}"
        weight: "!null"
      loop:
        - server1
        - server2
        - server3
        - server4