---
- name: Manage power state of virtual machines on Citrix Hypervisor/XenServer
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set the power state of a virtual machine
      community.general.xenserver_guest_powerstate:
        hostname: 10.1.1.1
        username: admin
        password: password
        name: my_vm
        state: "{{ state | default('running') }}"
        state_change_timeout: 60
        wait_for_ip_address: "{{ wait_for_ip_address | default(!null) }}"
        validate_certs: true
      register: vm_status

    - name: Display the power state of the virtual machine
      debug:
        msg: "Virtual Machine Power State: {{ vm_status.powerstate }}"