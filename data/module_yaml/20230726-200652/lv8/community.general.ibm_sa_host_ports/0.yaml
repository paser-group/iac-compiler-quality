---
- name: Test playbook for Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add host ports
      community.general.ibm_sa_host_ports:
        endpoint: "https://{{ host }}/rest"
        username: "{{ username }}"
        password: "{{ password }}"
        fcaddress: "{{ fcaddress }}"
        iscsi_name: "{{ iscsi_name }}"
        num_of_visible_targets: "{{ num_of_visible_targets }}"
        state: "{{ state | default('present') }}"
        validate_certs: false
      vars:
        host: "10.1.1.1"
        username: "admin"
        password: "password"
        fcaddress: "host1"
        iscsi_name: "host2"
        num_of_visible_targets: "2"

    - name: Verify configuration
      debug:
        msg: "Host ports have been added successfully."

    - name: Remove host ports
      community.general.ibm_sa_host_ports:
        endpoint: "https://{{ host }}/rest"
        username: "{{ username }}"
        password: "{{ password }}"
        fcaddress: "{{ fcaddress }}"
        iscsi_name: "{{ iscsi_name }}"
        num_of_visible_targets: "{{ num_of_visible_targets }}"
        state: "absent"
        validate_certs: false
      vars:
        host: "10.1.1.1"
        username: "admin"
        password: "password"
        fcaddress: "host1"
        iscsi_name: "host2"
        num_of_visible_targets: "2"

    - name: Verify removal
      debug:
        msg: "Host ports have been removed successfully."