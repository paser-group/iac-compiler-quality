- name: Test ansible latent type-related bugs in keycloak_user_federation module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required dependencies
      pip:
        name: "python-keycloak"
        state: present

    - name: Create Keycloak user federation with null values
      community.general.keycloak_user_federation:
        name: Sample Federation
        realm: Demo Realm
        provider_id: ldap
        provider_type: ldap
        config:
          auth_realm: !null
          auth_username: !null
          auth_password: !null
          auth_client_id: !null
          auth_client_secret: !null
          auth_keycloak_url: !null
        state: present

    - name: Check if Keycloak user federation is created
      community.general.keycloak_user_federation_info:
        realm: Demo Realm
        name: Sample Federation
      register: federation_info

    - name: Display federations info
      debug:
        var: federation_info