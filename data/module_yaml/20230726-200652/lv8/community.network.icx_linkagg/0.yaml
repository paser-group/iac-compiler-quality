---
- name: Test ICX Link Aggregation Groups module
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Create Link Aggregation Group
      community.network.icx_linkagg:
        name: "LAG1"
        members:
          - "ethernet1/1"
          - "ethernet1/2"
        state: present
        check_running_config: true
        mode: "active"
        purge: false
        aggregate: "{{ nonexistent_var }}"
        group: 1
      register: result
      ignore_errors: true

    - name: Check result of creating LAG
      debug:
        var: result

    - name: Remove Link Aggregation Group
      community.network.icx_linkagg:
        name: "LAG1"
        members:
          - "ethernet1/1"
          - "ethernet1/2"
        state: absent
        check_running_config: true
        mode: "active"
        purge: false
        aggregate: "{{ nonexistent_var }}"
        group: 1
      register: result
      ignore_errors: true

    - name: Check result of removing LAG
      debug:
        var: result