---
- name: Get service facts from Docker nodes
  hosts: all
  gather_facts: false

  tasks:
    - name: Set up network
      docker_network:
        name: node-net
        driver: bridge
        ipam_options:
          subnet: 10.1.1.0/24
        state: present

    - name: Create Docker containers
      docker_container:
        name: "{{ item.name }}"
        image: "{{ item.image }}"
        networks:
          - name: node-net
            ipv4_address: "{{ item.ip }}"
        command: sleep infinity
      with_items:
        - { name: "ubuntu1", image: "ubuntu:latest", ip: "10.1.1.1" }
        - { name: "alpine1", image: "alpine:latest", ip: "10.1.1.2" }
        - { name: "centos1", image: "centos:latest", ip: "10.1.1.3" }
        - { name: "redhat1", image: "redhat:latest", ip: "10.1.1.4" }

    - name: Get service facts
      ansible.builtin.service_facts:
        gather_timeout: 30
      register: service_facts

    - name: Print service facts
      debug:
        var: service_facts