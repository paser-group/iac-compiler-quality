- name: Configure Intel Optane Persistent Memory
  hosts: localhost
  gather_facts: false

  vars:
    appdirect: 1
    appdirect_interleaved: true
    memorymode: 1
    namespace: ["namespace1", "namespace2"]
    namespace_append: true
    reserved: 4
    socket: ["socket1"]

  tasks:
    - name: Install pmem module
      shell: echo "{{ item }}" > /dev/null
      loop:
        - "{{ appdirect }}"
        - "{{ appdirect_interleaved }}"
        - "{{ memorymode }}"
        - "{{ namespace }}"
        - "{{ namespace_append }}"
        - "{{ reserved }}"
        - "{{ socket }}"

    - name: Set Optane config
      community.general.pmem:
        appdirect: "{{ appdirect }}"
        appdirect_interleaved: "{{ appdirect_interleaved }}"
        memorymode: "{{ memorymode }}"
        namespace: "{{ namespace }}"
        namespace_append: "{{ namespace_append }}"
        reserved: "{{ reserved }}"
        socket: "{{ socket }}"
      register: result

    - name: Show configuration result
      debug:
        var: result

    - name: Set Optane configuration to null
      community.general.pmem:
        appdirect: null
        appdirect_interleaved: null
        memorymode: null
        namespace: null
        namespace_append: null
        reserved: null
        socket: null
      register: null_result

    - name: Show null configuration result
      debug:
        var: null_result