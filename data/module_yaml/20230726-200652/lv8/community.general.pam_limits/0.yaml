---
- name: Test playbook for community.general.pam_limits
  hosts: all
  become: true

  tasks:
    - name: Set pam limits
      community.general.pam_limits:
        domain: session
        limit_type: soft
        limit_item: nofile
        value: 1024
        dest: /etc/security/limits.conf
        comment: "{{ comment_variable | default('') }}"

    - name: Remove pam limits
      community.general.pam_limits:
        domain: session
        limit_type: soft
        limit_item: nofile
        state: absent
        dest: /etc/security/limits.conf
        comment: "{{ comment_variable | default('') }}"