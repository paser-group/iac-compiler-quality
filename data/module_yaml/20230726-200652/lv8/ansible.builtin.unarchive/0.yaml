---
- name: Unpack Archive
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create temporary directory
      tempfile:
        state: directory
      register: temp_dir

    - name: Copy archive
      copy:
        src: "{{ playbook_dir }}/archive.tar.gz"
        dest: "{{ temp_dir.path }}/archive.tar.gz"

    - name: Unpack archive
      unarchive:
        src: "{{ temp_dir.path }}/archive.tar.gz"
        dest: "{{ temp_dir.path }}"
        copy: 'null'
        creates: 'null'
        decrypt: 'null'
        exclude: 'null'
        extra_opts: 'null'
        group: 'null'
        include: 'null'
        io_buffer_size: 'null'
        keep_newer: 'null'
        list_files: 'null'
        mode: 'null'
        owner: 'null'
        remote_src: 'null'
        selevel: 'null'
        serole: 'null'
        setype: 'null'
        seuser: 'null'
        unsafe_writes: 'null'
        validate_certs: 'null'
      register: unarchive_output

    - name: Remove temporary directory
      file:
        path: "{{ temp_dir.path }}"
        state: absent
      when: unarchive_output.stdout_lines is not defined