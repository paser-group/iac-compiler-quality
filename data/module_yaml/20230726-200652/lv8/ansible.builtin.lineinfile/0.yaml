---
- name: Test playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ensure line is present in file
      ansible.builtin.lineinfile:
        path: /path/to/file.txt
        line: "my_line"
        state: "{{ state | default('present') }}"
        regexp: "^.*{{ line }}.*$"
        backup: "{{ backup | default('yes') }}"
        validate: "{{ validate | default('null') }}"
        unsafe_writes: "{{ unsafe_writes | default('no') }}"
        create: "{{ create | default('no') }}"
        owner: "{{ owner | default('null') }}"
        mode: "{{ mode | default('null') }}"
        others: "{{ others | default('null') }}"
        group: "{{ group | default('null') }}"
        seuser: "{{ seuser | default('null') }}"
        serole: "{{ serole | default('null') }}"
        setype: "{{ setype | default('null') }}"
        selevel: "{{ selevel | default('null') }}"
        insertbefore: "{{ insertbefore | default('null') }}"
        insertafter: "{{ insertafter | default('null') }}"
        backrefs: "{{ backrefs | default('no') }}"

      vars:
        state: "{{ state | default('present') }}"
        backup: "{{ backup | default('yes') }}"
        validate: "{{ validate | default('null') }}"
        unsafe_writes: "{{ unsafe_writes | default('no') }}"
        create: "{{ create | default('no') }}"
        owner: "{{ owner | default('null') }}"
        mode: "{{ mode | default('null') }}"
        others: "{{ others | default('null') }}"
        group: "{{ group | default('null') }}"
        seuser: "{{ seuser | default('null') }}"
        serole: "{{ serole | default('null') }}"
        setype: "{{ setype | default('null') }}"
        selevel: "{{ selevel | default('null') }}"
        insertbefore: "{{ insertbefore | default('null') }}"
        insertafter: "{{ insertafter | default('null') }}"
        backrefs: "{{ backrefs | default('no') }}"

      register: result

    - name: Debug result
      debug:
        var: result