- name: Generate random MAC addresses for network modules
  hosts: localhost
  gather_facts: false
  
  vars:
    pn_cliswitch: "example_switch"
    pn_ip: "10.1.1.1"
    pn_location: "location1"
    pn_name: "vtep1"
    pn_switch_in_cluster: true
    pn_virtual_ip: "10.1.1.100"
    pn_vrouter_name: "vrouter1"

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac_address: "{{ '%02x' | format((255*random()) | int) }}:{{ '%02x' | format((255*random()) | int) }}:{{ '%02x' | format((255*random()) | int) }}:{{ '%02x' | format((255*random()) | int) }}:{{ '%02x' | format((255*random()) | int) }}:{{ '%02x' | format((255*random()) | int) }}"
  
    - name: Create network configuration
      community.network.pn_vtep:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_ip: "{{ pn_ip }}"
        pn_location: "{{ pn_location }}"
        pn_name: "{{ pn_name }}"
        pn_switch_in_cluster: "{{ pn_switch_in_cluster }}"
        pn_virtual_ip: "{{ pn_virtual_ip }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        pn_mac: "{{ random_mac_address }}"
        state: present
      register: result
  
    - name: Debug result
      debug:
        var: result