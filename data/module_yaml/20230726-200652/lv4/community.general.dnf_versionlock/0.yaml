- name: Install and lock package versions
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install dnf_versionlock package
      package:
        name: dnf-utils
        state: present

    - name: Create package lock file for Ubuntu
      command: dnf versionlock add "{{ item }}"
      loop:
        - package1
        - package2
        - package3
      when: inventory_hostname == 'ubuntu1'

    - name: Lock package versions for CentOS
      community.general.dnf_versionlock:
        name: "{{ item }}"
        state: present
        raw: true
      loop:
        - package1
        - package2
        - package3
      when: inventory_hostname == 'centos1'

    - name: Lock package versions for Alpine
      community.general.dnf_versionlock:
        name: "{{ item }}"
        state: absent
        raw: false
      loop:
        - package1
        - package2
        - package3
      when: inventory_hostname == 'alpine1'