---
- name: Install packages using apk on different Linux distributions
  hosts: all
  become: true

  tasks:
    - name: Generate random MAC address for network modules
      set_fact:
        random_mac_address: "{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}:{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}:{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}:{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}:{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}:{{ '%02x'%((16 ~ 1 ~ 3 ~ 32 ~ 25 ~ 14 ~ 73 ~ 67)|random) }}"

    - name: Install packages using apk
      community.general.apk:
        name:
          - package1
          - package2
          - package3
        repository: "{{ random_mac_address }}"
        update_cache: "{{ random_mac_address }}"
        upgrade: yes
        no_cache: "{{ random_mac_address }}"
        world: "{{ random_mac_address }}"
        state: "{{ random_mac_address }}"
      loop: "{{ packages }}"
      vars:
        packages:
          - package1
          - package2
          - package3

    - name: Restart network service with random MAC address
      community.general.service:
        name: network
        state: "{{ random_mac_address }}"

...