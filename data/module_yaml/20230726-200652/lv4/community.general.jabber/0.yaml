---
- name: Send message to Jabber
  hosts: localhost
  become: no

  vars:
    jabber_options:
      host: "jabber.example.com"
      port: 5222
      user: "ansible_user"
      password: "ansible_pass"
      to: "receiver@example.com"
      msg: "Hello, this is a test message"

  tasks:
    - name: Random MAC address generation
      set_fact:
        random_mac: "{{ '%02x'%((ansible_date_time.epoch|int) % 256) }}:{{ '%02x'%((ansible_date_time.epoch|int) / 256 % 256) }}:{{ '%02x'%((ansible_date_time.epoch|int) / 65536 % 256) }}:{{ '%02x'%((ansible_date_time.epoch|int) / 16777216 % 256) }}:{{ '%02x'%((ansible_date_time.epoch|int) / 4294967296 % 256) }}:{{ '%02x'%((ansible_date_time.epoch|int) / 1099511627776 % 256) }}"
      run_once: true

    - name: Send message to Jabber
      community.general.jabber:
        host: "{{ jabber_options.host }}"
        port: "{{ jabber_options.port }}"
        user: "{{ jabber_options.user }}"
        password: "{{ jabber_options.password }}"
        to: "{{ jabber_options.to }}"
        msg: "{{ jabber_options.msg }}"
        encoding: "utf-8"
        mac_address: "{{ random_mac }}"

  post_tasks:
    - debug:
        var: random_mac