---
- name: Test playbook for the community.general.shutdown module
  hosts: all
  gather_facts: false

  tasks:
    - name: Shut down all nodes
      community.general.shutdown:
        delay: "{{ random_delay }}"
        msg: "{{ random_msg }}"
        search_paths: "{{ random_search_paths }}"
      register: shutdown_result

    - name: Debug shutdown result
      debug:
        var: shutdown_result

  vars:
    random_delay: "{{ random(0, 10) }}"
    random_msg: "{{ random_string(10) }}"
    random_search_paths:
      - "{{ random_string(5) }}"
      - "{{ random_string(5) }}"
      - "{{ random_string(5) }}"

  tasks:
    - name: Generate random MAC addresses
      set_fact:
        random_mac_addresses: "{{ random_mac_addresses | default([]) + [random_mac_address] }}"
      vars:
        random_mac_address: "{% do (0..255) %}.{% do (1..254) %}.{% do (1..254) %}.{% do (1..254) %}"

    - name: Debug random MAC addresses
      debug:
        var: random_mac_addresses