---
- name: Test playbook for community.general.one_image module
  hosts: localhost
  connection: local
  gather_facts: False

  tasks:
    - name: Generate random MAC address
      ansible.builtin.script:
        script: |
          echo $(openssl rand -hex 3 | sed 's/\(..\)/\1:/g; s/.$//') | awk '{print tolower($0)}'
      register: random_mac

    - name: Create an OpenNebula image
      community.general.one_image:
        api_url: "https://example.com/api"
        api_username: "admin"
        api_password: "password"
        name: "TestImage"
        state: "present"
        mac_address: "{{ random_mac.stdout }}"
      register: result