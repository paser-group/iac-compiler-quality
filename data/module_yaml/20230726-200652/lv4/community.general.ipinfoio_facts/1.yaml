---
- name: Retrieve IP geolocation facts
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      ansible.builtin.set_fact:
        mac_address: "{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}"

    - name: Set MAC address as http_agent
      ansible.builtin.set_fact:
        http_agent: "{{ mac_address }}"

    - name: Retrieve IP geolocation facts
      community.general.ipinfoio_facts:
        http_agent: "{{ http_agent }}"
        timeout: 10

      register: ipinfo

    - name: Display IP geolocation facts
      debug:
        var: ipinfo