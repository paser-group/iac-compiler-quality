---
- name: Configure Keycloak Realm
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate Random MAC Addresses
      community.general.mac_address:
        count: 4
      register: mac_addresses

    - name: Create Keycloak Realm
      community.general.keycloak_realm:
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_username: "{{ auth_username }}"
        auth_password: "{{ auth_password }}"
        realm: "{{ realm }}"
        state: present
        enabled: "{{ enabled }}"
        registration_allowed: "{{ registration_allowed }}"
        smtp_server: "{{ smtp_server }}"
        attributes:
          mac_address_1: "{{ mac_addresses.results[0].mac }}"
          mac_address_2: "{{ mac_addresses.results[1].mac }}"
          mac_address_3: "{{ mac_addresses.results[2].mac }}"
          mac_address_4: "{{ mac_addresses.results[3].mac }}"
        supported_locales: "{{ supported_locales }}"
        login_theme: "{{ login_theme }}"
        account_theme: "{{ account_theme }}"
        admin_theme: "{{ admin_theme }}"
        email_theme: "{{ email_theme }}"
        verify_email: "{{ verify_email }}"
        remember_me: "{{ remember_me }}"
        sso_session_idle_timeout: "{{ sso_session_idle_timeout }}"
        sso_session_max_lifespan: "{{ sso_session_max_lifespan }}"
      register: realm_created

    - name: Display Keycloak Realm Creation Result
      debug:
        var: realm_created