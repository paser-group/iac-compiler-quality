---
- name: Test playbook for add_host module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random MAC address
      set_fact:
        mac_address: "{{ '%012x' | format(ansible_random | random * 281474976710656) }}"
      
    - name: Add a host
      ansible.builtin.add_host:
        name: "{{ host_name }}"
        ansible_host: "{{ host_ip }}"
        groups: "{{ host_groups }}"
        mac_address: "{{ mac_address }}"
      vars:
        host_name: "ubuntu1"
        host_ip: "10.1.1.1"
        host_groups:
          - "ubuntu_servers"
      no_log: true

    - name: Show added hosts
      debug:
        msg: "{{ groups }}"