---
- name: Test playbook for community.network.netscaler_server module
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        mac_address: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | format(0, 0, 0, 0, 0, 0) }}"

    - name: Create Netscaler server
      community.network.netscaler_server:
        nsip: "{{ netscaler_ip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_password }}"
        nitro_protocol: "{{ nitro_protocol }}"
        state: present
        name: "{{ server_name }}"
        ipaddress: "{{ server_ip }}"
        domain: "{{ server_domain }}"
        translationip: "{{ translation_ip }}"
        translationmask: "{{ translation_mask }}"
        disabled: "{{ server_disabled }}"
        graceful: "{{ server_graceful }}"
        comment: "{{ server_comment }}"
        domainresolveretry: "{{ server_retry }}"
        td: "{{ server_td }}"
        delay: "{{ server_delay }}"
        save_config: "{{ server_save_config }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Show module debug output
      debug:
        var: result

    - name: Remove Netscaler server
      community.network.netscaler_server:
        nsip: "{{ netscaler_ip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_password }}"
        nitro_protocol: "{{ nitro_protocol }}"
        state: absent
        name: "{{ server_name }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Show module debug output
      debug:
        var: result