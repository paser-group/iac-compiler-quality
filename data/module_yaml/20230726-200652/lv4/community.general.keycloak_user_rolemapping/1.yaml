---
- name: Test Ansible Latent Type-Related Bugs
  hosts: all
  gather_facts: false

  vars:
    # Define test variables
    auth_client_id: "<YOUR_AUTH_CLIENT_ID>"
    auth_client_secret: "<YOUR_AUTH_CLIENT_SECRET>"
    auth_keycloak_url: "<YOUR_AUTH_KEYCLOAK_URL>"
    auth_password: "<YOUR_AUTH_PASSWORD>"
    auth_realm: "<YOUR_AUTH_REALM>"
    auth_username: "<YOUR_AUTH_USERNAME>"
    cid: "<YOUR_CID>"
    client_id: "<YOUR_CLIENT_ID>"
    connection_timeout: 30
    http_agent: "ansible-http-agent"
    realm: "<YOUR_REALM>"
    roles:
      - "role1"
      - "role2"
    service_account_user_client_id: "<YOUR_SERVICE_ACCOUNT_USER_CLIENT_ID>"
    state: "present"
    target_username: "<YOUR_TARGET_USERNAME>"
    token: "<YOUR_TOKEN>"
    uid: "<YOUR_UID>"
    validate_certs: true

  tasks:
    - name: Generate random MAC addresses
      vars:
        ansible_netmiko_generated_mac: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | random_mac }}"
      debug:
        var: ansible_netmiko_generated_mac

    - name: Configure user role mapping
      community.general.keycloak_user_rolemapping:
        auth_client_id: "{{ auth_client_id }}"
        auth_client_secret: "{{ auth_client_secret }}"
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_password: "{{ auth_password }}"
        auth_realm: "{{ auth_realm }}"
        auth_username: "{{ auth_username }}"
        cid: "{{ cid }}"
        client_id: "{{ client_id }}"
        connection_timeout: "{{ connection_timeout }}"
        http_agent: "{{ http_agent }}"
        realm: "{{ realm }}"
        roles: "{{ roles }}"
        service_account_user_client_id: "{{ service_account_user_client_id }}"
        state: "{{ state }}"
        target_username: "{{ target_username }}"
        token: "{{ token }}"
        uid: "{{ uid }}"
        validate_certs: "{{ validate_certs }}"
        mac_address: "{{ ansible_netmiko_generated_mac }}"
      register: result

    - name: Debug output
      debug:
        var: result