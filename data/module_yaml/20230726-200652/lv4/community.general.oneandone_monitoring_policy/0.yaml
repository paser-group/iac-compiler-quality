---

- name: Configure OneAndOne Monitoring Policy
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure Monitoring Policy
      community.general.oneandone_monitoring_policy:
        api_url: "https://api_url_here"
        auth_token: "auth_token_here"
        name: "Test Monitoring Policy"
        state: present
        description: "This is a test monitoring policy"
        email: "test@example.com"
        monitoring_policy: "CUSTOM"
        thresholds:
          - metric: "CPU"
            warning: 90
            critical: 95
        add_ports:
          - protocol: "TCP"
            port: 80
        add_processes:
          - process: "httpd"
            critical: true
        add_servers:
          - name: "server1"
            agent: "NRPE"
            hostname: "localhost"
            address: "10.1.1.1"

      register: result

    - debug:
        var: result

    - name: Remove Monitoring Policy
      community.general.oneandone_monitoring_policy:
        api_url: "https://api_url_here"
        auth_token: "auth_token_here"
        name: "Test Monitoring Policy"
        state: absent

      register: result

    - debug:
        var: result