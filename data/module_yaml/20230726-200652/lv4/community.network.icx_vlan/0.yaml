- name: Manage VLANs on Ruckus ICX
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create VLAN
      community.network.icx_vlan:
        name: TestVLAN
        vlan_id: 100
        aggregated: [ethernet 1/1/1 to 1/1/3]
        associated_interfaces: [ethernet 1/1/1 to 1/1/3]
        associated_tagged: [ethernet 1/1/2]
        check_running_config: true
        delay: 5
        interfaces:
          ethernet 1/1/1: { ip_arp_inspection: true, ip_dhcp_snooping: true }
          ethernet 1/1/2: { ip_arp_inspection: true, ip_dhcp_snooping: true }
          ethernet 1/1/3: { ip_arp_inspection: true, ip_dhcp_snooping: true }
        purge: true
        state: present
        stp:
          etherchannel 1: { mode: on }
        tagged:
          ethernet 1/1/2: { ip_arp_inspection: true, ip_dhcp_snooping: true }
      register: result

    - debug:
        var: result