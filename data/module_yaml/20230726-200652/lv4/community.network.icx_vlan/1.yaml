- name: Generate random MAC addresses
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      script: |
        #!/usr/bin/env python3
        import random

        def random_mac_address():
          mac = [0x52, 0x54, 0x00,
                 random.randint(0x00, 0x7f),
                 random.randint(0x00, 0xff),
                 random.randint(0x00, 0xff)]

          return ":".join([format(x, '02x') for x in mac])

        mac_address = random_mac_address()
        print(mac_address)

      register: mac_result

    - name: Create VLAN with random MAC address
      community.network.icx_vlan:
        name: TestVLAN
        vlan_id: 100
        aggregated: [ethernet 1/1/1 to 1/1/3]
        associated_interfaces: [ethernet 1/1/1 to 1/1/3]
        associated_tagged: [ethernet 1/1/2]
        check_running_config: true
        delay: 5
        interfaces:
          ethernet 1/1/1: { ip_arp_inspection: true, ip_dhcp_snooping: true }
          ethernet 1/1/2: { ip_arp_inspection: true, ip_dhcp_snooping: true }
          ethernet 1/1/3: { ip_arp_inspection: true, ip_dhcp_snooping: true }
        purge: true
        state: present
        stp:
          etherchannel 1: { mode: on }
        tagged:
          ethernet 1/1/2: { ip_arp_inspection: true, ip_dhcp_snooping: true }
        mac_address: "{{ mac_result.stdout }}"
      register: result

    - debug:
        var: result