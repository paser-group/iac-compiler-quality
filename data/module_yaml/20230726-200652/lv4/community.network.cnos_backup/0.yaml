---
- name: Backup Configuration using cnos_backup module
  hosts: localhost
  gather_facts: false

  vars:
    deviceType: "{{ hostvars['localhost'].device_type }}"
    configType: None
    enablePassword: "{{ hostvars['localhost'].enable_password }}"
    host: "{{ hostvars['localhost'].host }}"
    outputfile: "{{ hostvars['localhost'].output_file }}"
    password: "{{ hostvars['localhost'].password }}"
    protocol: None
    rcpath: None
    rcserverip: None
    serverpassword: None
    serverusername: None
    username: "{{ hostvars['localhost'].username }}"
    random_mac: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | format(0, 0, 0, 0, 0, 0) }}"

  tasks:
    - name: Backup configuration
      community.network.cnos_backup:
        configType: "{{ configType }}"
        deviceType: "{{ deviceType }}"
        enablePassword: "{{ enablePassword }}"
        host: "{{ host }}"
        outputfile: "{{ outputfile }}"
        password: "{{ password }}"
        protocol: "{{ protocol }}"
        rcpath: "{{ rcpath }}"
        rcserverip: "{{ rcserverip }}"
        serverpassword: "{{ serverpassword }}"
        serverusername: "{{ serverusername }}"
        username: "{{ username }}"
        macaddress: "{{ random_mac }}"
        state: present