- name: Test playbook for community.general.installp
  hosts: localhost
  gather_facts: false

  vars:
    repository_path: /tmp/my_repo
    packages:
      - package1
      - package2
      - package3

  tasks:
    - name: Create temporary repository
      file:
        path: "{{ repository_path }}"
        state: directory

    - name: Install packages
      community.general.installp:
        name: "{{ item }}"
        repository_path: "{{ repository_path }}"
        state: "{{ state }}"
        update_cache: yes
        accept_license: "{{ accept_license }}"
      loop: "{{ packages }}"