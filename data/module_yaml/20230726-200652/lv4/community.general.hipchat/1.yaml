---
- name: Test community.general.hipchat module
  hosts: localhost
  gather_facts: false

  vars:
    api: "YOUR_HIPCHAT_API"
    room: "YOUR_HIPCHAT_ROOM"
    token: "YOUR_HIPCHAT_TOKEN"
    random_mac_address: "00:{{ '%02x' | format((256**2 * random) | int) }}:{{ '%02x' | format((256**2 * random) | int) }}:{{ '%02x' | format((256**2 * random) | int) }}:{{ '%02x' | format((256**2 * random) | int) }}:{{ '%02x' | format((256**2 * random) | int) }}"

  tasks:
    - name: Generate random MAC address
      command: /bin/echo "{{ random_mac_address }}"
      register: mac_address_output

    - name: Hipchat notification
      community.general.hipchat:
        api: "{{ api }}"
        room: "{{ room }}"
        token: "{{ token }}"
        color: "gray"
        msg: "This is a test message"
        msg_format: "html"
        msg_from: "Ansible"
        notify: true
        # Using the randomly generated MAC address variable
        random_mac: "{{ mac_address_output.stdout }}"