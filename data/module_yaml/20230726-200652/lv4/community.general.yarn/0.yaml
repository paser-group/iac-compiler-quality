---
- name: Test playbook for community.general.yarn module
  hosts: localhost
  gather_facts: false

  vars:
    node_net: "10.1.1.0/24"
    gateway: "10.1.1.254"
    nodes:
      - name: "ubuntu1"
        ip_address: "10.1.1.1"
        distro: "ubuntu"
      - name: "alpine1"
        ip_address: "10.1.1.2"
        distro: "alpine"
      - name: "centos1"
        ip_address: "10.1.1.3"
        distro: "centos"
      - name: "redhat1"
        ip_address: "10.1.1.4"
        distro: "redhat"

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        random_mac: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | 
                        format(0x00, 0x16, 0x3e, 
                               ( 0b01000000 + 
                                 (((0<<4) + (0<<0)) % 256) * 256) % 65536 // 256,
                                 (((0<<4) + (0<<0)) % 256) * 256) % 65536 % 256,
                                 ( 0b01000000 + 
                                 (((1<<4) + (0<<0)) % 256) * 256) % 65536 // 256,
                                 (((1<<4) + (0<<0)) % 256) * 256) % 65536 % 256)}}"
      loop: "{{ nodes }}"
      loop_control:
        loop_var: node

    - name: Test community.general.yarn module
      ansible.builtin.debug:
        msg: "Executing yarn installation for {{ item.name }}"
      loop: "{{ nodes }}"
      loop_control:
        loop_var: node