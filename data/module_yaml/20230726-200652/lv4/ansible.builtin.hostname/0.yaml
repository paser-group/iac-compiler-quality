---
- name: Test Hostname Module
  hosts: all
  gather_facts: false

  tasks:
    - name: Set hostname
      ansible.builtin.hostname:
        name: "{{ inventory_hostname }}"
      register: result

    - name: Display result
      debug:
        var: result

    - name: Verify hostname
      ansible.builtin.hostname:
        name: "{{ inventory_hostname }}"
        use: present
      register: verify_result

    - name: Display verification result
      debug:
        var: verify_result

    - name: Generate random MAC address
      set_fact:
        random_mac_address: "{{ lookup('community.general.random_string', chars='0123456789ABCDEF', length=17) | regex_replace(':', '') }}"

    - name: Set hostname with random MAC address
      ansible.builtin.hostname:
        name: "{{ inventory_hostname }}"
        mac_address: "{{ random_mac_address }}"
      register: result_mac_address

    - name: Display result with MAC address
      debug:
        var: result_mac_address