---
- name: Test playbook for community.network.ce_evpn_bgp_rr module
  hosts: all
  gather_facts: false
  vars:
    as_number: "{{ lookup('env', 'AS_NUMBER') | default('65000') }}"
    bgp_evpn_enable: true
    bgp_instance: "{{ lookup('env', 'BGP_INSTANCE') | default('default') }}"
    peer: "{{ lookup('env', 'PEER') | default('10.10.10.1') }}"
    peer_type: "{{ lookup('env', 'PEER_TYPE') | default('as') }}"
    policy_vpn_target: "{{ lookup('env', 'POLICY_VPN_TARGET') | default('65000:100') }}"
    reflect_client: true

  tasks:
    - name: Include community network collection
      include_role:
        name: community.network

    - name: Manage RR for the VXLAN Network on HUAWEI
      community.network.ce_evpn_bgp_rr:
        as_number: "{{ as_number }}"
        bgp_evpn_enable: "{{ bgp_evpn_enable }}"
        bgp_instance: "{{ bgp_instance }}"
        peer: "{{ peer }}"
        peer_type: "{{ peer_type }}"
        policy_vpn_target: "{{ policy_vpn_target }}"
        reflect_client: "{{ reflect_client }}"