---
- name: Create Rackspace Cloud Database User
  hosts: localhost
  gather_facts: false

  vars:
    network_modules:
      - name: ubuntu1
        mac: "{{ lookup('community.general.generate_mac') }}"
      - name: alpine1
        mac: "{{ lookup('community.general.generate_mac') }}"
      - name: centos1
        mac: "{{ lookup('community.general.generate_mac') }}"
      - name: redhat1
        mac: "{{ lookup('community.general.generate_mac') }}"

  tasks:
    - name: Create Rackspace Cloud Database User
      community.general.rax_cdb_user:
        api_key: "YOUR_API_KEY"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0"
        cdb_id: "YOUR_CLOUD_DATABASE_ID"
        credentials: "/path/to/credentials.yaml"
        databases:
          - db_name: "database1"
            db_password: "password1"
            db_username: "user1"
          - db_name: "database2"
            db_password: "password2"
            db_username: "user2"
        host: "{{ item.name }}"
        identity_type: "rackspace"
        region: "DFW"
        state: "present"
        username: "YOUR_USERNAME"
        validate_certs: false
      register: result
      with_items: "{{ network_modules }}"

    - debug:
        var: result