---
- name: Create sudoers entries
  hosts: all
  become: true
  tasks:
    - name: Add sudoers entry
      community.general.sudoers:
        name: "{{ user }}"
        host: "{{ host }}"
        nopassword: "{{ nopassword }}"
        runas: "{{ runas | default('ALL') }}"
        commands: "{{ commands | default([]) }}"
        setenv: "{{ setenv | default(true) }}"
        sudoers_path: "{{ sudoers_path | default('/etc/sudoers') }}"
        state: "{{ state | default('present') }}"
        validation: strict
      vars:
        user: test-user
        host: test.example.com
        nopassword: false
        runas: ALL
        commands:
          - /bin/ls
        setenv: true
        sudoers_path: /etc/sudoers
        state: present