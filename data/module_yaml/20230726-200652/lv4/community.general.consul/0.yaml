- name: Test playbook for community.general.consul module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add service to Consul
      community.general.consul:
        state: present
        service_name: "test-service"
        service_id: "test-service-id"
        service_address: "10.1.1.5"
        service_port: 8080
        check_id: "test-service-check"
        check_name: "Test Check"
        tcp: "localhost:8080"
        interval: "10s"
        timeout: "5s"
        token: "consul_token"
        validate_certs: false
      register: consul_result

    - name: Display debug output for added service
      debug:
        var: consul_result

    - name: Modify service in Consul
      community.general.consul:
        state: present
        service_name: "test-service"
        service_id: "test-service-id"
        service_address: "10.1.1.6"
        service_port: 9090
        check_id: "test-service-check"
        check_name: "Test Check"
        tcp: "localhost:9090"
        interval: "15s"
        timeout: "7s"
        token: "consul_token"
        validate_certs: false
      register: consul_result

    - name: Display debug output for modified service
      debug:
        var: consul_result

    - name: Delete service from Consul
      community.general.consul:
        state: absent
        service_id: "test-service-id"
        token: "consul_token"
        validate_certs: false
      register: consul_result

    - name: Display debug output for deleted service
      debug:
        var: consul_result