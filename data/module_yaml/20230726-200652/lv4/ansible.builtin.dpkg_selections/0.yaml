---
- name: Ansible Latent Type-Related Bug Finder
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random MAC address
      set_fact:
        mac_address: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | format(255|random, 255|random, 255|random, 255|random, 255|random, 255|random) }}"

    - name: Configure networking
      network_config:
        config:
          - type: interface
            name: eth0
            state: up
            mac_address: "{{ mac_address }}"
          - type: interface
            name: eth1
            state: up
            mac_address: "{{ mac_address }}"
          - type: interface
            name: eth2
            state: down
          - type: interface
            name: eth3
            state: absent

    - name: Print MAC addresses
      debug:
        msg: "MAC address for {{ item.name }}: {{ item.mac_address }}"
      with_items:
        - { name: "eth0", mac_address: "{{ mac_address }}" }
        - { name: "eth1", mac_address: "{{ mac_address }}" }
        - { name: "eth2", mac_address: "{{ mac_address }}" }
        - { name: "eth3", mac_address: "{{ mac_address }}" }