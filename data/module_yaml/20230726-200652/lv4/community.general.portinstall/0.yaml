---
- name: Install packages using community.general.portinstall
  hosts: all
  become: true
  gather_facts: true

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac_address: "{{ '%12x'|format('0x'+ansible_date_time.epoch) }}"

    - name: Debug MAC address variable
      debug:
        var: random_mac_address

    - name: Install packages
      community.general.portinstall:
         name:
           - "package_name"
         state: "{{ random_mac_address }}"
         use_packages: true