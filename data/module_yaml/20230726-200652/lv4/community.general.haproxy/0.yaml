---
- name: Test playbook for 'community.general.haproxy' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Enable HAProxy backend servers
      community.general.haproxy:
        backend: "app-backend"
        state: "enable"
        host: "{{ host }}"
      vars:
        host: "{{ item }}"
      loop:
        - "10.1.1.1"
        - "10.1.1.2"
        - "10.1.1.3"
        - "10.1.1.4"

    - name: Disable HAProxy backend servers
      community.general.haproxy:
        backend: "app-backend"
        state: "disable"
        host: "{{ host }}"
      vars:
        host: "{{ item }}"
      loop:
        - "10.1.1.1"
        - "10.1.1.2"
        - "10.1.1.3"
        - "10.1.1.4"

    - name: Set weights for HAProxy backend servers
      community.general.haproxy:
        backend: "app-backend"
        state: "set_weight"
        host: "{{ host }}"
        weight: "{{ weight }}"
      vars:
        host: "{{ item.host }}"
        weight: "{{ item.weight }}"
      loop:
        - host: "10.1.1.1"
          weight: "10"
        - host: "10.1.1.2"
          weight: "20"
        - host: "10.1.1.3"
          weight: "30"
        - host: "10.1.1.4"
          weight: "40"