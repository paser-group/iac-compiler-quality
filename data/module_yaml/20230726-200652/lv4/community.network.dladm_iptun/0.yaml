- name: Manage IP tunnel interfaces
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create IP tunnel interface
      community.network.dladm_iptun:
        local_address: "{{ random_mac_address }}"
        name: "{{ random_mac_address }}"
        remote_address: "{{ random_ipv4_address }}"
        state: present
        temporary: false
        type: ip

      vars:
        random_mac_address: "{{ '00:16:3e:' ~ '%02x:%02x:%02x' | format(random_int(0, 255), random_int(0, 255), random_int(0, 255)) }}"
        random_ipv4_address: "{{ '%d.%d.%d.%d' | format(random_int(1, 255), random_int(1, 255), random_int(1, 255), random_int(1, 255)) }}"