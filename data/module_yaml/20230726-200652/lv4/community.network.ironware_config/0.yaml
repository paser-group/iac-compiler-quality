- name: Test ironware_config module
  hosts: nodes
  tasks:
    - name: Generate random MAC addresses
      hosts: network

      tasks:
        - name: Generate random MAC addresses
          set_fact:
            mac_addresses:
              - mac: "{{ '%02x'% (100|random|int) }}:{{ '%02x'% (100|random|int) }}:{{ '%02x'% (100|random|int) }}:{{ '%02x'% (100|random|int) }}:{{ '%02x'% (100|random|int) }}:{{ '%02x'% (100|random|int) }}"
                ip: "{{ '%s.%s.%s.%s' % (1000|random, 1000|random, 1000|random, 1000|random) }}"
          with_items:
            - ubuntu1
            - alpine1
            - centos1
            - redhat1

    - name: Print MAC addresses
      debug:
        msg: "MAC Address for {{ item }}: {{ item.mac }}"
      with_items: "{{ mac_addresses }}"

    - name: Print IP addresses
      debug:
        msg: "IP Address for {{ item }}: {{ item.ip }}"
      with_items: "{{ mac_addresses }}"

    - name: Configure network
      community.network.ironware_config:
        lines:
          - "interface vlan 10"
          - "description This is a test VLAN"
          - "no shutdown"
          - "ip address {{ item.ip }}/24"
        authorize: yes
        backup: true
        backup_options:
          dir: /backup
        commit: null
        config: null
        match: null
        parents: null
        replace: null
        save_when: null
        src: null
        update: null
        before: null
        after: null
      with_items: "{{ mac_addresses }}"