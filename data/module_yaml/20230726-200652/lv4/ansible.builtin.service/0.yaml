- hosts: localhost
  gather_facts: false
  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distro: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distro: alpine
      - name: centos1
        ip: 10.1.1.3
        distro: centos
      - name: redhat1
        ip: 10.1.1.4
        distro: redhat

  tasks:
    - name: Configure network
      network:
        hostname: "{{ item.name }}"
        interfaces:
          - name: eth0
            proto: static
            address: "{{ item.ip }}"
            netmask: 255.255.255.0
            gateway: 10.1.1.254
            state: up
        sleep: "{{ 5 | random }}"
      with_items: "{{ nodes }}"

    - name: Enable and start service
      ansible.builtin.service:
        name: "{{ item.distro }}-service"
        state: started
      with_items: "{{ nodes }}"

    - name: Test connectivity
      ping:
      register: ping_result

    - name: Debug ping result
      debug:
        var: ping_result