---
- name: Test playbook for avi_analyticsprofile module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create an analytics profile with random MAC addresses
      community.network.avi_analyticsprofile:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        api_version: "{{ api_version }}"
        name: "AnalyticsProfile"
        description: "Test Analytics Profile"
        exclude_client_close_before_request_as_error: true
        exclude_dns_policy_drop_as_significant: true
        exclude_gs_down_as_error: true
        exclude_invalid_dns_domain_as_error: true
        exclude_invalid_dns_query_as_error: true
        exclude_no_dns_record_as_error: true
        exclude_no_valid_gs_member_as_error: true
        exclude_persistence_change_as_error: true
        exclude_server_dns_error_as_error: true
        exclude_server_tcp_reset_as_error: true
        exclude_sip_error_codes: [400, 500]
        exclude_syn_retransmit_as_error: true
        exclude_tcp_reset_as_error: true
        exclude_unsupported_dns_query_as_error: true
        enable_advanced_analytics: true
        disable_ondemand_metrics: false
        disable_se_analytics: false
        disable_server_analytics: false
        disable_vs_analytics: false
        api_context:
          mac_address: "{{ item }}"
      loop: "{{ mac_addresses }}"

  vars:
    controller: "your_controller_ip"
    username: "your_username"
    password: "your_password"
    api_version: "your_api_version"
    mac_addresses:
      - "{{ lookup('mac', '/dev/urandom', format='canonical') }}"
      - "{{ lookup('mac', '/dev/urandom', format='cisco') }}"
      - "{{ lookup('mac', '/dev/urandom', format='digits') }}"
      - "{{ lookup('mac', '/dev/urandom', format='dot') }}"
      - "{{ lookup('mac', '/dev/urandom', format='eui64') }}"
      - "{{ lookup('mac', '/dev/urandom', format='hex') }}"
      - "{{ lookup('mac', '/dev/urandom', format='unix') }}"