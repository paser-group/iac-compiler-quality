---
- name: Test playbook for 'community.general.ipa_user' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create IPA user
      community.general.ipa_user:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        uid: "{{ uid }}"
        givenname: "{{ givenname }}"
        sn: "{{ sn }}"
        userauthtype: "{{ userauthtype }}"
        mail: "{{ mail }}"
        telephonenumber: "{{ telephonenumber }}"
        sshpubkey: "{{ sshpubkey }}"
        gidnumber: "{{ gidnumber }}"
        displayname: "{{ displayname }}"
        password: "{{ password }}"
        state: "{{ state }}"
        homedirectory: "{{ homedirectory }}"
        loginshell: "{{ loginshell }}"
        krbpasswordexpiration: "{{ krbpasswordexpiration }}"
        title: "{{ title }}"
        uidnumber: "{{ uidnumber }}"
        validate_certs: "{{ validate_certs }}"
        update_password: "{{ update_password }}"
      register: result

    - name: Print module output
      debug:
        var: result

    - name: Test case 1 - Random MAC address generation
      vars:
        mac_address: "{{ lookup('community.general.mac_address') }}"
      debug:
        msg: "Generated MAC address: {{ mac_address }}"
      when: result.changed

    - name: Test case 2 - Empty displayname
      community.general.ipa_user:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        uid: "{{ uid }}"
        displayname: ""
        state: "present"

    - name: Test case 3 - Invalid uidnumber
      community.general.ipa_user:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        uid: "{{ uid }}"
        uidnumber: "invalid"
        state: "present"