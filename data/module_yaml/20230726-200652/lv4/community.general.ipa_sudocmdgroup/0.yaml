---
- name: Manage FreeIPA Sudo Command Groups
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Sudo Command Group with Random MAC Addresses
      community.general.ipa_sudocmdgroup:
        cn: TestGroup
        description: Test Sudo Command Group
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        state: present
        sudocmd:
          - /usr/bin/command1
          - /usr/bin/command2
          - /usr/bin/command3
        validate_certs: false
      vars:
        ipa_host: "ipa.example.com"
        ipa_user: "admin"
        ipa_pass: "password"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 10

    - name: Create Sudo Command Group with Invalid MAC Addresses
      community.general.ipa_sudocmdgroup:
        cn: InvalidMacGroup
        description: Invalid MAC Addresses
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        state: present
        sudocmd:
          - /usr/bin/command1
          - "{{ invalid_mac_address }}"
          - /usr/bin/command3
        validate_certs: false
      vars:
        ipa_host: "ipa.example.com"
        ipa_user: "admin"
        ipa_pass: "password"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 10
        invalid_mac_address: "invalid_mac_address"

    - name: Delete Sudo Command Group
      community.general.ipa_sudocmdgroup:
        cn: TestGroup
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        state: absent
        validate_certs: false
      vars:
        ipa_host: "ipa.example.com"
        ipa_user: "admin"
        ipa_pass: "password"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 10