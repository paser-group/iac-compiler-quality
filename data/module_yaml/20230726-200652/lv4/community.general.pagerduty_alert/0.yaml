- hosts: localhost
  gather_facts: false

  vars:
    api_key: <your_api_key>
    integration_key: <your_integration_key>
    service_id: <your_service_id>
    incident_key: "test_incident"
    desc: "Test Incident"

  tasks:
    - name: Trigger PagerDuty incident
      community.general.pagerduty_alert:
        api_key: "{{ api_key }}"
        integration_key: "{{ integration_key }}"
        service_id: "{{ service_id }}"
        incident_key: "{{ incident_key }}"
        desc: "{{ desc }}"
        state: triggered
      register: trigger_result

    - name: Print trigger result
      debug:
        var: trigger_result

    - name: Acknowledge PagerDuty incident
      community.general.pagerduty_alert:
        api_key: "{{ api_key }}"
        integration_key: "{{ integration_key }}"
        service_id: "{{ service_id }}"
        incident_key: "{{ incident_key }}"
        desc: "{{ desc }}"
        state: acknowledged
      register: acknowledge_result

    - name: Print acknowledge result
      debug:
        var: acknowledge_result

    - name: Resolve PagerDuty incident
      community.general.pagerduty_alert:
        api_key: "{{ api_key }}"
        integration_key: "{{ integration_key }}"
        service_id: "{{ service_id }}"
        incident_key: "{{ incident_key }}"
        desc: "{{ desc }}"
        state: resolved
      register: resolve_result

    - name: Print resolve result
      debug:
        var: resolve_result