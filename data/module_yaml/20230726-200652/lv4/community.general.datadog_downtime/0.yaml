- name: Test Datadog Downtime Module
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "https://api.datadoghq.com"
    api_key: "your-api-key"
    app_key: "your-app-key"
    downtime_message: "Testing downtime"
    monitor_id: 123456789
    monitor_tags:
      - tag1
      - tag2
    rrule: "FREQ=WEEKLY;INTERVAL=1;BYDAY=MO,TU,WE,TH,FR;BYHOUR=9,10;BYMINUTE=0;BYSECOND=0"
    scope:
      - ubuntu1
      - alpine1
      - centos1
      - redhat1
    start: 1634415000
    end: 1634497800
    state: present
    timezone: "UTC"
    fake_param: true

  tasks:
    - name: Create Datadog downtime
      community.general.datadog_downtime:
        api_host: "{{ api_host }}"
        api_key: "{{ api_key }}"
        app_key: "{{ app_key }}"
        downtime_message: "{{ downtime_message }}"
        monitor_id: "{{ monitor_id }}"
        monitor_tags: "{{ monitor_tags }}"
        rrule: "{{ rrule }}"
        scope: "{{ scope }}"
        start: "{{ start }}"
        end: "{{ end }}"
        state: "{{ state }}"
        timezone: "{{ timezone }}"
        fake_param: "{{ fake_param }}"
      ignore_errors: true

    - name: Fail the playbook to indicate a potential bug
      fail:
        msg: "A potential bug was found in the Ansible module"
      when: fake_param is not defined or fake_param