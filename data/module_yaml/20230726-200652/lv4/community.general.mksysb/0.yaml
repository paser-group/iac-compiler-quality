---
- name: Generate AIX mksysb
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        mac_address: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | format(0, 0, 0, 0, 0, 0) }}"

    - name: Generate AIX mksysb
      community.general.mksysb:
        name: "/root/aix_mksysb"
        backup_crypt_files: "{{ mac_address | bool }}"
        backup_dmapi_fs: "{{ mac_address | bool }}"
        create_map_files: "{{ mac_address | bool }}"
        exclude_files: "{{ mac_address | bool }}"
        exclude_wpar_files: "{{ mac_address | bool }}"
        extended_attrs: "{{ mac_address | bool }}"
        new_image_data: "{{ mac_address | bool }}"
        software_packing: "{{ mac_address | bool }}"
        storage_path: "/root/aix_mksysb_image"
        use_snapshot: "{{ mac_address | bool }}"

      register: mksysb_output

    - name: Debug mksysb output
      debug:
        var: mksysb_output