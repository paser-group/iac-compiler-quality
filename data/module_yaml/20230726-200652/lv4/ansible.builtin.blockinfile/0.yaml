---
- name: Insert/update/remove a text block
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC addresses for network modules
      ansible.builtin.set_fact:
        mac_address: "{{ [hostvars[item].ansible_default_ipv4['macaddress'] | regex_replace(':', '') | lower] }}"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1

    - name: Insert/update/remove a text block
      ansible.builtin.blockinfile:
        path: "/tmp/example.conf"
        block: |
          # This is a sample block
          # MAC address: {{ mac_address }}
        marker: "# BEGIN GENERATED BLOCK"
        state: present