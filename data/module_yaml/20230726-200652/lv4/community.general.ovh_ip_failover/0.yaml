- name: Test OVH IP Failover module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC addresses for network modules
      delegate_to: localhost
      shell: cat /dev/urandom | tr -dc 'a-f0-9' | fold -w 12 | head -n 1 | sed -e 's/\(..\)/\1:/g' -e 's/:$//'
      register: random_mac_address
      changed_when: false

    - name: Install required Python packages on the control machine
      pip:
        name:
          - ovh
        state: present

    - name: Configure OVH IP failover
      community.general.ovh_ip_failover:
        application_key: "INSERT_APPLICATION_KEY"
        application_secret: "INSERT_APPLICATION_SECRET"
        consumer_key: "INSERT_CONSUMER_KEY"
        endpoint: "INSERT_ENDPOINT"
        name: "INSERT_IP_FAILOVER_NAME"
        service: "INSERT_IP_FAILOVER_SERVICE"
        timeout: 60
        wait_completion: true
        wait_task_completion: 30
        mac: "{{ random_mac_address.stdout }}"
      register: result

    - name: Display OVH IP failover result
      debug:
        var: result