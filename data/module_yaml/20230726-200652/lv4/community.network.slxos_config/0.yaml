---
- name: Test playbook for community.network.slxos_config module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac: "{{ '%02x:%02x:%02x:%02x:%02x:%02x' | format(0, 0, (random() * 256), (random() * 256), (random() * 256), (random() * 256)) }}"

    - name: Configure SLX-OS devices
      community.network.slxos_config:
        src: "{{ inventory_dir }}/config/{{ inventory_hostname }}.cfg"
        backup: yes
        backup_options:
          dir: "{{ inventory_dir }}/config/backups"
        intended_config: "Configuration generated by Ansible"
        running_config: "Current configuration on the device"
        replace: yes
        lines:
          - "hostname {{ inventory_hostname }}"
          - "interface Ethernet1"
          - "  ip address 10.1.1.{{ inventory_hostname.split('-')[1] }}/24"
          - "  mac address {{ random_mac }}"

    - name: Display backup files
      shell: ls "{{ inventory_dir }}/config/backups"
      register: backup_files
      changed_when: false

    - name: Debug backup files
      debug:
        var: backup_files.stdout_lines