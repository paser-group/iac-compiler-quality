---
- name: "Test playbook for 'community.general.zypper' module"
  hosts: localhost
  gather_facts: false

  vars:
    mac_address_1: "52:54:00:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}"
    mac_address_2: "52:54:00:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}"
    mac_address_3: "52:54:00:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}:{{ '%02x'|format(ansible_random.randint(0,255)) }}"

  tasks:

    - name: "Install packages with random MAC addresses"
      community.general.zypper:
        name: "{{ item }}"
        state: present
        type: network
        mac_addresses:
          - "{{ mac_address_1 }}"
          - "{{ mac_address_2 }}"
          - "{{ mac_address_3 }}"
      loop:
        - package1
        - package2
        - package3

    - name: "Uninstall packages with random MAC addresses"
      community.general.zypper:
        name: "{{ item }}"
        state: absent
        type: network
        mac_addresses:
          - "{{ mac_address_1 }}"
          - "{{ mac_address_2 }}"
          - "{{ mac_address_3 }}"
      loop:
        - package1
        - package2
        - package3