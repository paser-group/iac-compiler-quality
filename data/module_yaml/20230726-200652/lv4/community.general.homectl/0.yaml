- name: Manage User Accounts with homectl module
  hosts: localhost
  gather_facts: false
  vars:
    users:
      - name: john
        uid: 1001
        gid: 1001
        shell: /bin/bash
        state: present
      - name: jane
        uid: 1002
        gid: 1002
        shell: /bin/bash
        state: present

  tasks:
    - name: Manage User Accounts
      community.general.homectl:
        username: "{{ item.name }}"
        uid: "{{ item.uid }}"
        gid: "{{ item.gid }}"
        shell: "{{ item.shell }}"
        state: "{{ item.state }}"
      loop: "{{ users }}"