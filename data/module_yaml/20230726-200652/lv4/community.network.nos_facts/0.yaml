---
- name: Test playbook for community.network.nos_facts module
  hosts: all
  gather_facts: no

  tasks:
    - name: Generate random MAC addresses
      set_fact:
        mac_address: "{{ '%012x'|format(ansible_random | int) }}"

    - name: Collect facts from devices
      community.network.nos_facts:
        gather_subset: "{{ none }}"
      register: nos_facts

    - name: Display gathered facts
      debug:
        var: nos_facts

  - name: Verify MAC address
    assert:
      that: "'devices' in nos_facts"
      msg: "No 'devices' facts gathered"

  - name: Verify OS version
    assert:
      that: "item.key in ['ubuntu1', 'alpine1', 'centos1', 'redhat1']"
      msg: "Device '{{ item.key }}' not found in gathered facts"
    loop: "{{ nos_facts.nos_device_info | dict2items }}"