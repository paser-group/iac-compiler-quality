---
- name: Test playbook for community.general.deploy_helper module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include tasks for generating random MAC addresses
      include_tasks: random_mac_address.yml

    - name: Test community.general.deploy_helper module
      community.general.deploy_helper:
        clean: True
        current_path: /var/www/app
        group: www-data
        keep_releases: 3
        mode: '0664'
        owner: www-data
        path: /var/www
        release: "{{ lookup('pipe', 'date +%Y%m%d%H%M%S') }}"
        releases_path: /var/www/releases
        selevel: s0
        serole: object_r
        setype: httpd_sys_content_t
        seuser: unconfined_u
        shared_path: /var/www/app/shared
        state: present
        unfinished_filename: unfinished.txt
        unsafe_writes: True
      register: deploy_result

    - name: Print deploy_helper result
      debug:
        var: deploy_result