---
- name: Test modprobe module and generate random MAC addresses
  hosts: all
  gather_facts: False
  vars:
    mac_address: "52:54:00:{{ '%02x'|format(item)|upper }}:{{ '%02x'|format(item)|upper }}:{{ '%02x'|format(item)|upper }}"
    module_name: "module1"
    module_params: "param1"
    persistent: "yes"
    module_state: "present"

  tasks:
    - name: Generate random MAC addresses
      set_fact:
        mac_address: "{{ mac_address }}"
      loop: "{{ range(1,5)|list }}"

    - name: Load or unload a kernel module
      community.general.modprobe:
        name: "{{ module_name }}"
        params: "{{ module_params }}"
        persistent: "{{ persistent }}"
        state: "{{ module_state }}"