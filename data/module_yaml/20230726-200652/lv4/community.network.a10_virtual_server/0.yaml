- name: Test playbook for community.network.a10_virtual_server module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create virtual server with random MAC addresses
      community.network.a10_virtual_server:
        host: "{{ host }}"
        username: "{{ username }}"
        password: "{{ password }}"
        virtual_server: "{{ virtual_server }}"
        virtual_server_ip: "{{ virtual_server_ip }}"
        virtual_server_ports:
          - protocol: tcp
            port_number: 80
            mac_address: "{{ hostvars[inventory_hostname].ansible_default_ipv4.macaddress }}"
          - protocol: tcp
            port_number: 443
            mac_address: "{{ hostvars[inventory_hostname].ansible_default_ipv4.macaddress }}"
        state: present
      vars:
        host: "10.1.1.1"
        username: "admin"
        password: "password"
        virtual_server: "webserver"
        virtual_server_ip: "10.1.1.10"

    - name: Delete virtual server
      community.network.a10_virtual_server:
        host: "{{ host }}"
        username: "{{ username }}"
        password: "{{ password }}"
        virtual_server: "{{ virtual_server }}"
        state: absent
      vars:
        host: "10.1.1.1"
        username: "admin"
        password: "password"
        virtual_server: "webserver"