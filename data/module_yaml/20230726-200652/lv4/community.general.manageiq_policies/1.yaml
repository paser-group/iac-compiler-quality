---
- name: Manage Resource Policies
  hosts: all
  gather_facts: false
  tasks:
    - name: Install required dependencies
      ansible.builtin.package:
        name: pyvmomi
        state: present

    - name: Manage resource policies
      community.general.manageiq_policies:
        manageiq_connection: "{{ manageiq_connection | default({}) }}"
        policy_profiles: "{{ policy_profiles }}"
        resource_id: "{{ resource_id | default(0) }}"
        resource_name: "{{ resource_name | default('') }}"
        resource_type: "{{ resource_type | default('') }}"
        state: "{{ state }}"
      register: result

    - name: Debug output
      ansible.builtin.debug:
        var: result