---
- name: Create or destroy a ProfitBricks data center
  hosts: localhost
  gather_facts: false

  vars:
    description: "My Data Center"
    location: "us/las"
    name: "my-dc"
    state: "present"
    subscription_password: "my-password"
    subscription_user: "my-username"
    wait: true
    wait_timeout: 300

  tasks:
    - name: Create a ProfitBricks data center
      community.general.profitbricks_datacenter:
        description: "{{ description }}"
        location: "{{ location }}"
        name: "{{ name }}"
        state: "{{ state }}"
        subscription_password: "{{ subscription_password }}"
        subscription_user: "{{ subscription_user }}"
        wait: "{{ wait }}"
        wait_timeout: "{{ wait_timeout }}"
      register: result

    - name: Print result
      debug:
        msg: "{{ result }}"

    - name: Destroy the ProfitBricks data center
      community.general.profitbricks_datacenter:
        name: "{{ name }}"
        state: "absent"
        subscription_password: "{{ subscription_password }}"
        subscription_user: "{{ subscription_user }}"
        wait: "{{ wait }}"
        wait_timeout: "{{ wait_timeout }}"
      when: result is defined and result.changed

      register: destroy_result

    - name: Print destroy result
      debug:
        msg: "{{ destroy_result }}"