---
- name: Manage state of a program using monit module
  hosts: localhost
  gather_facts: false

  vars:
    program_name: "nginx"
    program_state: "started"
    program_timeout: 30

  tasks:
    - name: Generate random MAC addresses
      shell: openssl rand -hex 6 | sed 's/\(..\)/\1:/g; s/.$//'
      register: mac_addresses

    - name: Set up monit to manage the program
      community.general.monit:
        name: "{{ program_name }}"
        state: "{{ program_state }}"
        timeout: "{{ program_timeout }}"
      register: monit_result

    - name: Debug monit result
      debug:
        var: monit_result

    - name: Debug MAC addresses
      debug:
        var: mac_addresses.stdout_lines