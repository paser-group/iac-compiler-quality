---
- name: Manage Layer-3 interfaces on Lenovo switches
  hosts: switches
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      shell: echo "{{ '%02x' | format(item) }}" | xargs | sed 's/ //g'
      register: random_mac

    - name: Configure L3 interfaces
      community.network.cnos_l3_interface:
        aggregate: "{{ aggregate | default(False) }}"
        ipv4: "{{ ipv4 | default('192.168.0.1/24') }}"
        ipv6: "{{ ipv6 | default(None) }}"
        name: "interface{{ random_mac.stdout }}"
        state: "{{ state }}"
      register: result

    - name: Print result
      debug:
        var: result