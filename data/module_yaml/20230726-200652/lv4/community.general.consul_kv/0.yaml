---
- name: Test playbook for Ansible module 'community.general.consul_kv'
  hosts: localhost
  gather_facts: false

  vars:
    host: "localhost"
    port: 8500
    scheme: "http"
    validate_certs: false
    recurse: false
    retrieve: false
    state: "present"

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac: "{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}"

    - name: Manipulate key/value store entries in Consul
      community.general.consul_kv:
        host: "{{ host }}"
        port: "{{ port }}"
        scheme: "{{ scheme }}"
        validate_certs: "{{ validate_certs }}"
        recurse: "{{ recurse }}"
        retrieve: "{{ retrieve }}"
        state: "{{ state }}"
        key: "{{ random_mac }}"
        value: "Test value"
        cas: "0"
        session: "Test session"
        token: "Test token"
        flags: "123"