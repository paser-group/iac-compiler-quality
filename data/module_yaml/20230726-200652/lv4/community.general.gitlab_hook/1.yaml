---
- name: Manage GitLab webhooks
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac: "{{ '%02x' | format(item) }}"
      loop: "{{ range(6) | list }}"
      register: mac_result

    - name: Create GitLab webhook
      community.general.gitlab_hook:
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "YOUR_API_TOKEN"
        project: "your-username/your-project"
        hook_url: "https://your-webhook-url.com"
        push_events: true
        tag_push_events: true
        merge_requests_events: true
        pipeline_events: true
        job_events: true
        wiki_page_events: true
        note_events: true
        issues_events: true
        push_events_branch_filter: "master"
        validate_certs: false
        state: present
        network_params:
          mac_address: "{{ mac_result.results | map(attribute='ansible_facts.random_mac') | join(':') }}"
      register: result