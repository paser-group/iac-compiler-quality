---
- name: Execute arbitrary commands on Ruckus ICX devices
  hosts: icx_devices
  gather_facts: false
  tasks:
    - name: Generate random MAC address
      shell: echo $RANDOM | md5sum | sed 's/\(..\)/\1:/g; s/.$//'
      register: random_mac

    - name: Execute command on ICX devices
      community.network.icx_command:
        commands:
          - show interfaces
        interval: 2
        match: "Gi1/0/1 is up"
        retries: 3
        wait_for:
          - condition: match
            expression: "{{ random_mac.stdout }}"
      register: command_output

    - name: Show command output
      debug:
        var: command_output