---
- name: Add or remove SSH authorized keys
  hosts: all
  gather_facts: false
  become: true

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac: "{{ '%02x' | format(randint(0, 255)) }}:{{ '%02x' | format(randint(0, 255)) }}:{{ '%02x' | format(randint(0, 255)) }}:{{ '%02x' | format(randint(0, 255)) }}:{{ '%02x' | format(randint(0, 255)) }}:{{ '%02x' | format(randint(0, 255)) }}"

    - name: Print random MAC address
      debug:
        var: random_mac

    - name: Add or remove SSH authorized key
      ansible.posix.authorized_key:
        user: "{{ ansible_user }}"
        state: present
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
        comment: "Generated by Ansible"
      when: ansible_os_family == "Debian"