---
- name: Test playbook for community.general.kernel_blacklist module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create temporary blacklist file
      copy:
        content: ""
        dest: /tmp/blacklist.txt

    - name: Add kernel module to blacklist
      community.general.kernel_blacklist:
        blacklist_file: /tmp/blacklist.txt
        name: random_module_name
        state: present

    - name: Verify kernel module is blacklisted
      command: |
        grep random_module_name /tmp/blacklist.txt
      register: grep_result
      changed_when: false

    - name: Display grep result
      debug:
        var: grep_result.stdout_lines