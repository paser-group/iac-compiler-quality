- name: Get facts about HUAWEI
  hosts: all
  gather_facts: false

  tasks:
    - name: Set gather_subset
      set_fact:
        gather_subset: None

    - name: Get HUAWEI facts
      community.network.ce_facts:
        gather_subset: "{{ gather_subset }}"
      register: huawei_facts

    - name: Print HUAWEI facts
      debug:
        var: huawei_facts

    - name: Generate random MAC addresses for network modules
      set_fact:
        random_mac: "{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}:{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}:{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}:{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}:{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}:{{ '%02x'%((ansible_date_time.epoch|random)*256)|int }}"

    - name: Test HUAWEI facts with random MAC
      community.network.ce_facts:
        gather_subset: "{{ gather_subset }}"
        mac_address: "{{ random_mac }}"
      register: huawei_facts_random_mac

    - name: Print HUAWEI facts with random MAC
      debug:
        var: huawei_facts_random_mac