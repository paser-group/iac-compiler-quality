- name: Set clientscope type in Keycloak realm
  hosts: localhost
  gather_facts: false

  vars:
    auth_client_id: "admin-cli"
    auth_client_secret: "admin-secret"
    auth_keycloak_url: "http://localhost:8080/auth"
    auth_realm: "master"
    auth_username: "admin"
    auth_password: "admin"

    client_id: "my-client"
    realm: "my-realm"

    # Specify the options for your tests here
    default_clientscopes: []
    optional_clientscopes:
      - "scope1"
      - "scope2"

  tasks:
    - name: Install 'requests' Python module
      pip:
        name: requests
        state: present

    - name: Include the 'community.general.keycloak_clientscope_type' module
      include_role:
        name: community.general.keycloak_clientscope_type

    - name: Set clientscope type to 'read-only'
      community.general.keycloak_clientscope_type:
        auth_client_id: "{{ auth_client_id }}"
        auth_client_secret: "{{ auth_client_secret }}"
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_password: "{{ auth_password }}"
        auth_realm: "{{ auth_realm }}"
        auth_username: "{{ auth_username }}"
        client_id: "{{ client_id }}"
        connection_timeout: 30
        default_clientscopes: "{{ default_clientscopes }}"
        http_agent: "Ansible"
        optional_clientscopes: "{{ optional_clientscopes }}"
        realm: "{{ realm }}"
        token: "{{ token | default(omit) }}"
        validate_certs: false