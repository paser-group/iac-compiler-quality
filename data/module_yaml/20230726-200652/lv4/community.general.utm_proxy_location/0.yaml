---
- name: Test playbook for community.general.utm_proxy_location module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create reverse proxy location
      community.general.utm_proxy_location:
        name: TestLocation
        path: /test
        backend:
          - webserver1
          - webserver2
        utm_host: utm.example.com
        utm_port: 8443
        utm_protocol: https
        utm_token: "{{ lookup('env', 'UTM_TOKEN') }}"
        state: present
      register: result_create

    - name: Print create result
      debug:
        var: result_create

    - name: Update reverse proxy location
      community.general.utm_proxy_location:
        name: TestLocation
        path: /test
        backend:
          - webserver3
          - webserver4
        utm_host: utm.example.com
        utm_port: 8443
        utm_protocol: https
        utm_token: "{{ lookup('env', 'UTM_TOKEN') }}"
        headers:
          X-Forwarded-Proto: "https"
        state: present
      register: result_update

    - name: Print update result
      debug:
        var: result_update

    - name: Delete reverse proxy location
      community.general.utm_proxy_location:
        name: TestLocation
        path: /test
        utm_host: utm.example.com
        utm_port: 8443
        utm_protocol: https
        utm_token: "{{ lookup('env', 'UTM_TOKEN') }}"
        state: absent
      register: result_delete

    - name: Print delete result
      debug:
        var: result_delete