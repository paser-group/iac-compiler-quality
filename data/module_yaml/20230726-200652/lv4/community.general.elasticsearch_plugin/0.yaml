---
- name: Manage Elasticsearch plugins
  hosts: localhost
  gather_facts: false
  become: true

  tasks:
    - name: Install Elasticsearch plugin
      community.general.elasticsearch_plugin:
        name: my_plugin
        state: present
        src: https://example.com/my_plugin.zip
        version: 7.11.2
        plugin_bin: /usr/share/elasticsearch/bin/plugin
        plugin_dir: /usr/share/elasticsearch/plugins
        timeout: 60
        force: false
      vars:
        proxy_host: "{{ random_host }}"
        proxy_port: "{{ random_port }}"
        url: "{{ random_url }}"

    - name: Update Elasticsearch plugin
      community.general.elasticsearch_plugin:
        name: my_plugin
        state: present
        src: https://example.com/my_plugin.zip
        version: 7.11.2
        plugin_bin: /usr/share/elasticsearch/bin/plugin
        plugin_dir: /usr/share/elasticsearch/plugins
        timeout: 60
        force: true
      vars:
        proxy_host: "{{ random_host }}"
        proxy_port: "{{ random_port }}"
        url: "{{ random_url }}"

    - name: Remove Elasticsearch plugin
      community.general.elasticsearch_plugin:
        name: my_plugin
        state: absent
        src: https://example.com/my_plugin.zip
        version: 7.11.2
        plugin_bin: /usr/share/elasticsearch/bin/plugin
        plugin_dir: /usr/share/elasticsearch/plugins
        timeout: 60
        force: false
      vars:
        proxy_host: "{{ random_host }}"
        proxy_port: "{{ random_port }}"
        url: "{{ random_url }}"

  vars:
    random_host: "{{ random_ip }}"
    random_port: "{{ random_number }}"
    random_url: "{{ random_string }}"

  tasks:
    - name: Generate random MAC address
      command: /usr/bin/openssl rand -hex 6 | sed 's/\(..\)/\1:/g; s/.$//' | tr '[:lower:]' '[:upper:]'
      register: random_mac

    - name: Print random MAC address
      debug:
        var: random_mac.stdout

  vars:
    random_mac: "{{ random_mac.stdout }}"