---
- name: Test Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  vars:
    access_level: "developer"
    api_job_token: "SOME_JOB_TOKEN"
    api_oauth_token: "SOME_OAUTH_TOKEN"
    api_password: "SOME_PASSWORD"
    api_token: "SOME_TOKEN"
    api_url: "https://gitlab.example.com/api/v4"
    api_username: "admin"
    confirm: true
    email: "test@example.com"
    external: false
    group: "some_group"
    identities:
      - type: "key"
        provider: "google"
        token: "SOME_GOOGLE_TOKEN"
    isadmin: false
    name: "Test User"
    overwrite_identities: true
    password: "test123"
    reset_password: true
    sshkey_expires_at: "2021-12-31T23:59:59"
    sshkey_file: "/path/to/sshkey.pub"
    sshkey_name: "test-sshkey"
    state: "present"
    username: "testuser"
    validate_certs: false

  tasks:
    - name: Create GitLab user
      community.general.gitlab_user:
        access_level: "{{ access_level }}"
        api_job_token: "{{ api_job_token }}"
        api_oauth_token: "{{ api_oauth_token }}"
        api_password: "{{ api_password }}"
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        confirm: "{{ confirm }}"
        email: "{{ email }}"
        external: "{{ external }}"
        group: "{{ group }}"
        identities: "{{ identities }}"
        isadmin: "{{ isadmin }}"
        name: "{{ name }}"
        overwrite_identities: "{{ overwrite_identities }}"
        password: "{{ password }}"
        reset_password: "{{ reset_password }}"
        sshkey_expires_at: "{{ sshkey_expires_at }}"
        sshkey_file: "{{ sshkey_file }}"
        sshkey_name: "{{ sshkey_name }}"
        state: "{{ state }}"
        username: "{{ username }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - debug:
        var: result