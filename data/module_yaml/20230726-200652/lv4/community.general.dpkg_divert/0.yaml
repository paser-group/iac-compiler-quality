---
- name: Test dpkg_divert module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      shell: echo "{{ '%02x'% (0x00 | random * 0xff) }}:{{ '%02x'% (0x00 | random * 0xff) }}:{{ '%02x'% (0x00 | random * 0xff) }}:{{ '%02x'% (0x00 | random * 0xff) }}:{{ '%02x'% (0x00 | random * 0xff) }}:{{ '%02x'% (0x00 | random * 0xff) }}"
      register: random_mac

    - name: Override a debian package using dpkg_divert module
      community.general.dpkg_divert:
        divert: /path/to/package.deb
        force: yes
        holder: "{{ random_mac.stdout }}"
        path: /path/to/diverted/package.deb
        rename: yes
        state: present