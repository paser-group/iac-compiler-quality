---
- name: Test playbook to trigger latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Set network variables
      set_fact:
        network_nodes:
          - name: ubuntu1
            ip_address: 10.1.1.1
            mac_address: "{{ mac_address }}"
          - name: alpine1
            ip_address: 10.1.1.2
            mac_address: "{{ mac_address }}"
          - name: centos1
            ip_address: 10.1.1.3
            mac_address: "{{ mac_address }}"
          - name: redhat1
            ip_address: 10.1.1.4
            mac_address: "{{ mac_address }}"

    - name: Generate random MAC addresses
      set_fact:
        mac_address: "{{ '%02x'% (ansible_random.number % 256) }}:{{ '%02x'% (ansible_random.number % 256) }}:{{ '%02x'% (ansible_random.number % 256) }}:{{ '%02x'% (ansible_random.number % 256) }}:{{ '%02x'% (ansible_random.number % 256) }}:{{ '%02x'% (ansible_random.number % 256) }}"
      run_once: true

    - name: Configure multicast igmp enable on Huawei devices
      community.network.ce_multicast_igmp_enable:
        aftype: "{{ item.aftype }}"
        features: "{{ item.features }}"
        igmp: "{{ item.igmp }}"
        proxy: "{{ item.proxy }}"
        state: "{{ item.state }}"
        version: "{{ item.version }}"
        vlan_id: "{{ item.vlan_id }}"
      loop: "{{ network_nodes }}"
      register: result

    - name: Debug output
      debug:
        var: result