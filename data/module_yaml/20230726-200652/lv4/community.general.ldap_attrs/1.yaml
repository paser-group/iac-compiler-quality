---
- name: Test playbook for community.general.ldap_attrs module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address for network module
      shell: echo $RANDOM | md5sum | sed 's/^\(........\).*/\1/' | sed 's/\(..\)/\1:/g' | sed 's/.$//'
      register: random_mac_address

    - name: Add or remove ldap attributes
      community.general.ldap_attrs:
        dn: "cn=users,dc=example,dc=com"
        attributes:
          - name: "mail"
            values:
              - "user1@example.com"
          - name: "userPassword"
            values:
              - "password1"
        bind_dn: "admin"
        bind_pw: "adminpassword"
        server_uri: "ldap://ldap.example.com"
        mac_address: "{{ random_mac_address.stdout }}"

      register: ldap_attrs

    - name: Debug ldap_attrs output
      debug:
        var: ldap_attrs