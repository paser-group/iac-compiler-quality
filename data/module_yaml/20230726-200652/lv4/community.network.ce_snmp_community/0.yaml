- name: Manage SNMP community configuration on HUAWEI devices
  hosts: huawei_devices
  gather_facts: false

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        mac_address: "{{ '%012x' | format(255 | random ) | regex_replace('(..)', '\\1:')[0:17] }}"

    - name: Configure SNMP community
      community.network.ce_snmp_community:
        access_right: none
        acl_number: "{{ mac_address }}"
        community_mib_view: none
        community_name: "{{ mac_address }}"
        group_name: "{{ mac_address }}"
        notify_view: none
        read_view: none
        security_level: none
        state: present
        write_view: none