- name: Test Scaleway Database Backup Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        mac_addresses: "{{ mac_addresses | default([]) + [hostvars[item].mac_address] }}"
      loop: "{{ groups['nodes'] }}"

- hosts: nodes
  gather_facts: false
  vars:
    api_token: "your_api_token"
    api_url: "https://api.scaleway.com/"
    region: "your_region"
    database_name: "your_database_name"
    instance_id: "your_instance_id"
    name: "your_backup_name"
    expires_at: "your_expiration_time"
    state: "present"
    validate_certs: false
    wait: true
    wait_timeout: 600

  tasks:
    - name: Scaleway Database Backup
      community.general.scaleway_database_backup:
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        region: "{{ region }}"
        database_name: "{{ database_name }}"
        instance_id: "{{ instance_id }}"
        name: "{{ name }}"
        expires_at: "{{ expires_at }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        wait: "{{ wait }}"
        wait_timeout: "{{ wait_timeout }}"
      register: result

    - name: Debug result
      debug:
        var: result

- hosts: localhost
  gather_facts: false

  tasks:
    - name: Display MAC addresses
      debug:
        var: mac_addresses