---
- name: Test playbook for community.network.pn_vrouter_interface_ip module
  hosts: localhost
  gather_facts: false
  vars:
    pn_bd: "my_bridge_domain"
    pn_cliswitch: "my_switch"
    pn_ip: "10.1.1.1"
    pn_netmask: "255.255.255.0"
    pn_nic: ""
    pn_vnet: "my_vnet"
    pn_vrouter_name: "my_vrouter"
    state: "present"

  tasks:
    - name: Generate random MAC address
      shell: macchanger -r eth0 | grep -oE "([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})"
      register: random_mac
      changed_when: false

    - name: Set random MAC address
      set_fact:
        pn_nic: "{{ random_mac.stdout }}"

    - name: Add IP address to vRouter interface
      community.network.pn_vrouter_interface_ip:
        pn_bd: "{{ pn_bd }}"
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_ip: "{{ pn_ip }}"
        pn_netmask: "{{ pn_netmask }}"
        pn_nic: "{{ pn_nic }}"
        pn_vnet: "{{ pn_vnet }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        state: "{{ state }}"
      register: result
      when: state == "present"

    - debug:
        var: result

    - name: Remove IP address from vRouter interface
      community.network.pn_vrouter_interface_ip:
        pn_bd: "{{ pn_bd }}"
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_ip: "{{ pn_ip }}"
        pn_netmask: "{{ pn_netmask }}"
        pn_nic: "{{ pn_nic }}"
        pn_vnet: "{{ pn_vnet }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        state: "absent"
      register: result
      when: state == "absent"

    - debug:
        var: result