---
- name: Test playbook for community.network.pn_connection_stats_settings module
  hosts: localhost
  gather_facts: false

  vars:
    pn_client_server_stats_log_disk_space: "/var/log/connection_stats.log"
    pn_client_server_stats_log_enable: true
    pn_client_server_stats_log_interval: "1d"
    pn_client_server_stats_max_memory: "1024M"
    pn_cliswitch: "switch1"
    pn_connection_backup_enable: true
    pn_connection_backup_interval: "12h"
    pn_connection_max_memory: "512M"
    pn_connection_stats_log_disk_space: "/var/log/connection_stats.log"
    pn_connection_stats_log_enable: true
    pn_connection_stats_log_interval: "1d"
    pn_connection_stats_max_memory: "512M"
    pn_enable: true
    pn_fabric_connection_backup_enable: true
    pn_fabric_connection_backup_interval: "24h"
    pn_fabric_connection_max_memory: "2048M"
    pn_service_stat_max_memory: "256M"
    state: present

  tasks:
    - name: Generate random MAC addresses for network modules
      set_fact:
        random_mac: "{% for _ in range(6) %}{{ '%02x'|format(range(256)|random) }}{% if not loop.last %}:{% endif %}{% endfor %}"

    - name: Configure connection statistics settings
      community.network.pn_connection_stats_settings:
        pn_client_server_stats_log_disk_space: "{{ pn_client_server_stats_log_disk_space }}"
        pn_client_server_stats_log_enable: "{{ pn_client_server_stats_log_enable }}"
        pn_client_server_stats_log_interval: "{{ pn_client_server_stats_log_interval }}"
        pn_client_server_stats_max_memory: "{{ pn_client_server_stats_max_memory }}"
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_connection_backup_enable: "{{ pn_connection_backup_enable }}"
        pn_connection_backup_interval: "{{ pn_connection_backup_interval }}"
        pn_connection_max_memory: "{{ pn_connection_max_memory }}"
        pn_connection_stats_log_disk_space: "{{ pn_connection_stats_log_disk_space }}"
        pn_connection_stats_log_enable: "{{ pn_connection_stats_log_enable }}"
        pn_connection_stats_log_interval: "{{ pn_connection_stats_log_interval }}"
        pn_connection_stats_max_memory: "{{ pn_connection_stats_max_memory }}"
        pn_enable: "{{ pn_enable }}"
        pn_fabric_connection_backup_enable: "{{ pn_fabric_connection_backup_enable }}"
        pn_fabric_connection_backup_interval: "{{ pn_fabric_connection_backup_interval }}"
        pn_fabric_connection_max_memory: "{{ pn_fabric_connection_max_memory }}"
        pn_service_stat_max_memory: "{{ pn_service_stat_max_memory }}"
        state: "{{ state }}"
        pn_connection_stats_mac: "{{ random_mac }}"