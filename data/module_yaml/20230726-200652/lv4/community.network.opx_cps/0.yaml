- hosts: localhost
  gather_facts: false
  tasks:
    - name: Create docker containers and connect to network
      ansible.builtin.docker_container:
        name: "{{ item.name }}"
        image: "{{ item.image }}"
        command: sleep infinity
        network_mode: node-net
      with_items:
        - { name: "ubuntu1", image: "ubuntu" }
        - { name: "alpine1", image: "alpine" }
        - { name: "centos1", image: "centos" }
        - { name: "redhat1", image: "redhat" }

- hosts: node-net
  gather_facts: false
  tasks:
    - name: Configure network on each node
      community.network.opx_cps:
        attr_data: null
        attr_type: null
        commit_event: false
        db: false
        module_name: null
        operation: null
        qualifier: null
      register: result