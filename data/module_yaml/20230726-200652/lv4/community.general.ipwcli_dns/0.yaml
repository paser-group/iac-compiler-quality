---
- name: Test DNS record management
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random MAC address
      set_fact:
        random_mac: "{{ '%012x' | format(256 | random) + '%04x' | format(4096 | random) }}"

    - name: Add a DNS record
      community.general.ipwcli_dns:
        state: present
        address: 192.168.1.10
        container: example.com
        dnsname: www
        flags: "C"
        order: 123
        password: secret
        port: 53
        preference: 10
        priority: 5
        replacement: smtp.example.com
        service: smtp
        target: host.example.com
        ttl: 3600
        type: A
        username: admin
        weight: 1
        mac_address: "{{ random_mac }}"
      register: result

    - name: Show the added DNS record
      debug:
        var: result

    - name: Modify the DNS record
      community.general.ipwcli_dns:
        state: present
        address: 192.168.1.20
        container: example.com
        dnsname: www
        flags: "C"
        order: 123
        password: secret
        port: 53
        preference: 10
        priority: 5
        replacement: smtp.example.com
        service: smtp
        target: host.example.com
        ttl: 3600
        type: A
        username: admin
        weight: 1
        mac_address: "{{ random_mac }}"
      register: result

    - name: Show the modified DNS record
      debug:
        var: result

    - name: Delete the DNS record
      community.general.ipwcli_dns:
        state: absent
        address: 192.168.1.10
        container: example.com
        dnsname: www
        flags: "C"
        order: 123
        password: secret
        port: 53
        preference: 10
        priority: 5
        replacement: smtp.example.com
        service: smtp
        target: host.example.com
        ttl: 3600
        type: A
        username: admin
        weight: 1
        mac_address: "{{ random_mac }}"
      register: result

    - name: Show the deleted DNS record
      debug:
        var: result