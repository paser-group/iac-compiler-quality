---
- name: Test Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distro: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distro: alpine
      - name: centos1
        ip: 10.1.1.3
        distro: centos
      - name: redhat1
        ip: 10.1.1.4
        distro: redhat
    network_subnet: 10.1.1.0/24
    network_gateway: 10.1.1.254

  tasks:
    - name: Set up Docker network
      ansible.posix.docker_network:
        name: node-net
        subnet: "{{ network_subnet }}"
        gateway: "{{ network_gateway }}"

    - name: Create Docker containers
      ansible.builtin.docker_container:
        name: "{{ item.name }}"
        image: "docker.{{ item.distro }}"
        command: /bin/sleep infinity
        networks:
          - name: node-net
            ipv4_address: "{{ item.ip }}"
      loop: "{{ nodes }}"

    - name: Test ssh_config module
      community.general.ssh_config:
        group: "{{ item.name }}"
        host_not_existing: "{{ item.name }}"
        hostname_incorrect: "{{ item.ip }}"
        user: ansible
        identity_file: /path/to/private_key.pem
      loop: "{{ nodes }}"

    - name: Generate random MAC addresses
      ansible.builtin.debug:
        msg: "Random MAC address: {{ item }}"
      loop: "{{ nodes }}"