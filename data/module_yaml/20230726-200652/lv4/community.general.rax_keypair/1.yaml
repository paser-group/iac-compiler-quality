- name: Generate random MAC addresses for network modules
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random MAC addresses
      ansible.builtin.shell: |
        echo "macaddress={{ item.value.macaddress }}" >> "{{ playbook_dir }}/mac_addresses.cfg"
      loop: "{{ hostvars | dict2items }}"
      loop_control:
        loop_var: item
      when: item.value.macaddress is defined