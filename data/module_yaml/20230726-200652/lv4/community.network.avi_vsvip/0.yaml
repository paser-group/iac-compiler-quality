---
- name: Generate random MAC addresses for network modules
  hosts: localhost
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distro: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distro: alpine
      - name: centos1
        ip: 10.1.1.3
        distro: centos
      - name: redhat1
        ip: 10.1.1.4
        distro: redhat

  tasks:
    - name: Generate random MAC address
      set_fact:
        mac_address: "{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}:{{ '%02x' | format(255 | random) }}"

    - name: Configure network interfaces
      command: "ip link set dev eth0 address {{ mac_address }}"
      delegate_to: "{{ item.ip }}"
      with_items: "{{ nodes }}"

- name: Test community.network.avi_vsvip module
  hosts: localhost
  gather_facts: false

  vars:
    avi_vsvip_params:
      api_version: "20.1.1"
      avi_credentials:
        username: "admin"
        password: "password"
      vip: "10.1.1.10"
      east_west_placement: true
      tenant_ref: "/api/tenant?name=default"
      vrf_context_ref: "/api/vrfcontext?name=Default-Cloud"
      controller: "controller.example.com"
      state: "present"

  tasks:
    - name: Create VsVip using community.network.avi_vsvip module
      community.network.avi_vsvip:
        api_version: "{{ avi_vsvip_params.api_version }}"
        avi_credentials: "{{ avi_vsvip_params.avi_credentials }}"
        vip: "{{ avi_vsvip_params.vip }}"
        east_west_placement: "{{ avi_vsvip_params.east_west_placement }}"
        tenant_ref: "{{ avi_vsvip_params.tenant_ref }}"
        vrf_context_ref: "{{ avi_vsvip_params.vrf_context_ref }}"
        controller: "{{ avi_vsvip_params.controller }}"
        state: "{{ avi_vsvip_params.state }}"
      register: result

    - name: Debug result
      debug:
        var: result