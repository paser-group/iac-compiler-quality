---
- name: Test playbook for ansible.builtin.template module
  hosts: all
  gather_facts: false

  vars:
    network_config:
      - name: ubuntu1
        ip: 10.1.1.1
        mac_address: "{{ random_mac_address }}"
      - name: alpine1
        ip: 10.1.1.2
        mac_address: "{{ random_mac_address }}"
      - name: centos1
        ip: 10.1.1.3
        mac_address: "{{ random_mac_address }}"
      - name: redhat1
        ip: 10.1.1.4
        mac_address: "{{ random_mac_address }}"

  tasks:
    - name: Generate network configuration file
      ansible.builtin.template:
        src: network_config.j2
        dest: /path/to/generated_config.conf
      vars:
        random_mac_address: "{{ '%02x' | format(random.randint(0, 255)) }}:{{ '%02x' | format(random.randint(0, 255)) }}:{{ '%02x' | format(random.randint(0, 255)) }}:{{ '%02x' | format(random.randint(0, 255)) }}:{{ '%02x' | format(random.randint(0, 255)) }}:{{ '%02x' | format(random.randint(0, 255)) }}"