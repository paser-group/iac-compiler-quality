- name: Test playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add Consul service
      community.general.consul:
        state: present
        service_name: "{{ item.name }}"
        service_address: "{{ item.address }}"
        service_port: "{{ item.port }}"
      loop:
        - { name: "service1", address: "10.1.1.1", port: 8080 }
        - { name: "service2", address: "10.1.1.2", port: "8888" }
        - { name: "service3", address: "10.1.1.3", port: "invalid-port" }