---
- name: Test SNMP target host configuration
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Huawei Ansible modules
      pip:
        name: ansible-huawei-modules
        state: present

    - name: Configure SNMP target host
      community.network.ce_snmp_target_host:
        address: "{{ item.address }}"
        connect_port: "{{ item.connect_port }}"
        host_name: "{{ item.host_name }}"
        interface_name: "{{ item.interface_name }}"
        is_public_net: "{{ item.is_public_net }}"
        notify_type: "{{ item.notify_type }}"
        recv_port: "{{ item.recv_port }}"
        security_level: "{{ item.security_level }}"
        security_model: "{{ item.security_model }}"
        security_name: "{{ item.security_name }}"
        security_name_v3: "{{ item.security_name_v3 }}"
        version: "{{ item.version }}"
        vpn_name: "{{ item.vpn_name }}"
      loop:
        - address: "\xf0\x9f\x98\x82"  # UTF-8 encoded string
          connect_port: "161"
          host_name: "target1"
          interface_name: "GigabitEthernet0/0/0"
          is_public_net: "true"
          notify_type: "trap-only"
          recv_port: "162"
          security_level: "auth"
          security_model: "v3"
          security_name: "admin"
          security_name_v3: "admin_v3"
          version: "v3"
          vpn_name: "vpn1"
        - address: "\u041c\u043e\u0441\u043a\u0432\u0430"  # Unicode escape sequence (UTF-16)
          connect_port: "161"
          host_name: "target2"
          interface_name: "GigabitEthernet0/0/1"
          is_public_net: "false"
          notify_type: "inform-trap"
          recv_port: "162"
          security_level: "auth-priv"
          security_model: "snmpv1"
          security_name: "admin"
          security_name_v3: "admin_v3"
          version: "v2c"
          vpn_name: "vpn2"