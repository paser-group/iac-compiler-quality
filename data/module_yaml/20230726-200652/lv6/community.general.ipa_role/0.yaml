---
- name: Test playbook
  hosts: localhost
  gather_facts: false

  vars:
    cn: "test_cn"
    description: "test_description"
    group: ["test_group"]
    host: ["test_host"]
    hostgroup: ["test_hostgroup"]
    ipa_host: "test_ipa_host"
    ipa_pass: "test_ipa_pass"
    ipa_port: 1234
    ipa_prot: "test_ipa_prot"
    ipa_timeout: 60
    ipa_user: "test_ipa_user"
    privilege: ["test_privilege"]
    service: ["test_service"]
    state: "present"
    user: ["test_user"]
    validate_certs: false

  tasks:
    - name: Generate strings with varied encodings
      script: create_strings.sh
      register: encoded_strings

    - name: Debug encoded strings
      debug:
        var: encoded_strings

    - name: Test the ipa_role module
      community.general.ipa_role:
        state: "{{ state }}"
        cn: "{{ cn }}"
        description: "{{ description }}"
        group: "{{ group }}"
        host: "{{ host }}"
        hostgroup: "{{ hostgroup }}"
        ipa_host: "{{ ipa_host }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        ipa_user: "{{ ipa_user }}"
        privilege: "{{ privilege }}"
        service: "{{ service }}"
        user: "{{ user }}"
        validate_certs: "{{ validate_certs }}"
        encoded_strings: "{{ encoded_strings.stdout_lines }}"