---
- hosts: localhost
  gather_facts: false

  vars:
    manageiq_connection:
      url: "https://manageiq.example.com/api"
      username: "admin"
      password: "password"

  tasks:
    - name: Create ManageIQ Alert
      community.general.manageiq_alerts:
        manageiq_connection: "{{ manageiq_connection }}"
        expression_type: equal
        description: "Testing Alert"
        enabled: true
        expression:
          - "tenant_id"
          - "1"
        options:
          severity: warning
          notification_type: email
          notify_emails: "{{ email }}"
        resource_type: vm
        state: present
      loop: "{{ ['utf-8', 'utf-16', 'utf-32', 'ascii', 'latin-1'] }}"
      loop_control:
        loop_var: encoding

      vars:
        email: >
          '{% raw %}{{ 'test@domain.com'.encode(encoding) }}{% endraw %}'