---
- name: Test Playbook for 'community.general.proxmox' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Proxmox instance
      community.general.proxmox:
        api_host: "https://{{ proxmox_host }}:8006/api2/json"
        api_user: "{{ proxmox_user }}"
        api_password: "{{ proxmox_password }}"
        state: present
        node: "{{ proxmox_node }}"
        vmid: "{{ proxmox_vmid }}"
        ostemplate: "{{ proxmox_ostemplate }}"
        hostname: "{{ proxmox_hostname }}"
        cores: "{{ proxmox_cores }}"
        memory: "{{ proxmox_memory }}"
      register: create_result

    - name: Debug create result
      debug:
        var: create_result

    - name: Clone Proxmox instance
      community.general.proxmox:
        api_host: "https://{{ proxmox_host }}:8006/api2/json"
        api_token_id: "{{ proxmox_token_id }}"
        api_token_secret: "{{ proxmox_token_secret }}"
        state: present
        node: "{{ proxmox_node }}"
        vmid: "{{ proxmox_vmid }}"
        clone: "{{ proxmox_clone }}"
        clone_type: "{{ proxmox_clone_type }}"
        hostname: "{{ proxmox_hostname }}"
        memory: "{{ proxmox_memory }}"
      register: clone_result

    - name: Debug clone result
      debug:
        var: clone_result

    # Add more tasks for managing and testing instances

  vars:
    proxmox_host: "10.1.1.1"
    proxmox_user: "admin"
    proxmox_password: "admin"
    proxmox_token_id: "TOKEN_ID"
    proxmox_token_secret: "TOKEN_SECRET"
    proxmox_node: "pve"
    proxmox_vmid: 100
    proxmox_ostemplate: "template_name"
    proxmox_hostname: "test_instance"
    proxmox_cores: 2
    proxmox_memory: 2048
    proxmox_clone: 101
    proxmox_clone_type: "fullclone"