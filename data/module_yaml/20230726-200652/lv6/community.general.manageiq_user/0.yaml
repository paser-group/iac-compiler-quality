---
- name: Test manageiq_user module
  hosts: localhost
  tasks:
    - name: Create a user with different attribute values
      community.general.manageiq_user:
        manageiq_connection:
          url: "https://{{ inventory_hostname }}"
          username: "admin"
          password: "pass123"
        name: "test_user"
        userid: 12345
        email: "test@example.com"
        group: "admins"
        password: "password123"
        state: "present"
        update_password: "on_create"
      register: result

    - name: Print manageiq_user module output
      debug:
        var: result

    - name: Update user with different attribute values
      community.general.manageiq_user:
        manageiq_connection:
          url: "https://{{ inventory_hostname }}"
          username: "admin"
          password: "pass123"
        name: "test_user"
        email: "updated_test@example.com"
        group: "users"
        password: "new_password123"
        state: "present"
        update_password: "always"
      register: result

    - name: Print manageiq_user module output
      debug:
        var: result

    - name: Remove the created user
      community.general.manageiq_user:
        manageiq_connection:
          url: "https://{{ inventory_hostname }}"
          username: "admin"
          password: "pass123"
        name: "test_user"
        state: "absent"
      register: result

    - name: Print manageiq_user module output
      debug:
        var: result