---
- name: Test ansible.posix.authorized_key module
  hosts: all
  gather_facts: false

  tasks:
    - name: Add authorized key
      ansible.posix.authorized_key:
        user: "{{ ansible_user }}"
        state: present
        key: "{{ item }}"
      with_items:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCcG8MbhVj73jq1FmwsP8yiVY0G3bZbDv1W8qI54lTkqCkPb8uPCj8s+nUZyBk4euHJ6QeFxAe6SWD+s9hKSyhjjcJQJPgYR5Ca7x9Aye7geGKt9kM7ZTDLIp/BAAA/wYS1MvLMitdqXR8Z5iHhEqmsJ65/ywii1QSCG8km6ctLqWmd1UwWVm0F5rSx+sFXhLA2sMZYAeAa3uB5j0Hh2px2W0YZXixSEJxaM1+lR+S7lVfUo7I0EhlLnsrviMa2Bx56sex7Q/B05yK3w9g1nV/czKdK6c9hVAdyNZPxOQaRt7MFxAVrN6IMo7KU9/xc3esfl0r/t4sWFAJL8I23 example1@domain.com"
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCcG8MbhVj73jq1FmwsP8yiVY0G3bZbDv1W8qI54lTkqCkPb8uPCj8s+nUZyBk4euHJ6QeFxAe6SWD+s9hKSyhjjcJQJPgYR5Ca7x9Aye7geGKt9kM7ZTDLIp/BAAA/wYS1MvLMitdqXR8Z5iHhEqmsJ65/ywii1QSCG8km6ctLqWmd1UwWVm0F5rSx+sFXhLA2sMZYAeAa3uB5j0Hh2px2W0YZXixSEJxaM1+lR+S7lVfUo7I0EhlLnsrviMa2Bx56sex7Q/B05yK3w9g1nV/czKdK6c9hVAdyNZPxOQaRt7MFxAVrN6IMo7KU9/xc3esfl0r/t4sWFAJL8I23 example2@domain.com"
      register: result

    - name: Remove authorized key
      ansible.posix.authorized_key:
        user: "{{ ansible_user }}"
        state: absent
        key: "{{ item }}"
      with_items:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCcG8MbhVj73jq1FmwsP8yiVY0G3bZbDv1W8qI54lTkqCkPb8uPCj8s+nUZyBk4euHJ6QeFxAe6SWD+s9hKSyhjjcJQJPgYR5Ca7x9Aye7geGKt9kM7ZTDLIp/BAAA/wYS1MvLMitdqXR8Z5iHhEqmsJ65/ywii1QSCG8km6ctLqWmd1UwWVm0F5rSx+sFXhLA2sMZYAeAa3uB5j0Hh2px2W0YZXixSEJxaM1+lR+S7lVfUo7I0EhlLnsrviMa2Bx56sex7Q/B05yK3w9g1nV/czKdK6c9hVAdyNZPxOQaRt7MFxAVrN6IMo7KU9/xc3esfl0r/t4sWFAJL8I23 example1@domain.com"
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCcG8MbhVj73jq1FmwsP8yiVY0G3bZbDv1W8qI54lTkqCkPb8uPCj8s+nUZyBk4euHJ6QeFxAe6SWD+s9hKSyhjjcJQJPgYR5Ca7x9Aye7geGKt9kM7ZTDLIp/BAAA/wYS1MvLMitdqXR8Z5iHhEqmsJ65/ywii1QSCG8km6ctLqWmd1UwWVm0F5rSx+sFXhLA2sMZYAeAa3uB5j0Hh2px2W0YZXixSEJxaM1+lR+S7lVfUo7I0EhlLnsrviMa2Bx56sex7Q/B05yK3w9g1nV/czKdK6c9hVAdyNZPxOQaRt7MFxAVrN6IMo7KU9/xc3esfl0r/t4sWFAJL8I23 example2@domain.com"
      register: result