---
- name: Ansible Latent Bug Finder & Heuristic Test
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create inventory file
      copy:
        dest: /etc/ansible/hosts
        content: |
          [docker]
          ubuntu1 ansible_host=10.1.1.1
          alpine1 ansible_host=10.1.1.2
          centos1 ansible_host=10.1.1.3
          redhat1 ansible_host=10.1.1.4

    - name: Install community.general collection
      ansible.builtin.package:
        name: ansible-collections/community.general
        state: present

    - name: Generate strings with varied encodings
      set_fact:
        test_strings:
          - utf-8: "äöüß"
          - latin1: "\u00E4\u00F6\u00FC\u00DF"
          - utf-16: "\uFEFF\u00E4\u00F6\u00FC\u00DF"

    - name: Retrieve process IDs
      community.general.pids:
        ignore_case: "{{ item.ignore_case }}"
        name: "{{ item.name }}"
        pattern: "{{ item.pattern }}"
      loop:
        - { ignore_case: true, name: "test_process", pattern: "" }
        - { ignore_case: true, name: "", pattern: ".*" }
        - { ignore_case: false, name: "", pattern: ".*" }
        - { ignore_case: true, name: "test_process", pattern: "{{ test_strings[0] }}" }
        - { ignore_case: true, name: "test_process", pattern: "{{ test_strings[1] }}" }
        - { ignore_case: true, name: "test_process", pattern: "{{ test_strings[2] }}" }

    - name: Debug process IDs
      debug:
        var: pids