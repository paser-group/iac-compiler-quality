---
- name: Ansible Latent Bug Finder Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a bigmon policy
      community.network.bigmon_policy:
        controller: "{{ controller }}"
        access_token: "{{ access_token }}"
        name: "{{ name }}"
        priority: "{{ priority }}"
        policy_description: "{{ policy_description }}"
        duration: "{{ duration }}"
        start_time: "{{ start_time }}"
        action: "{{ action }}"
        state: present
        validate_certs: "{{ validate_certs }}"
      register: result_create
      ignore_errors: yes

    - name: Display create results
      debug:
        var: result_create

    - name: Remove the bigmon policy
      community.network.bigmon_policy:
        controller: "{{ controller }}"
        access_token: "{{ access_token }}"
        name: "{{ name }}"
        priority: "{{ priority }}"
        policy_description: "{{ policy_description }}"
        duration: "{{ duration }}"
        start_time: "{{ start_time }}"
        action: "{{ action }}"
        state: absent
        validate_certs: "{{ validate_certs }}"
      register: result_remove
      ignore_errors: yes

    - name: Display remove results
      debug:
        var: result_remove