---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Scaleway Compute Instance
      community.general.scaleway_compute:
        api_token: "{{ lookup('env', 'SCALEWAY_API_TOKEN') }}"
        api_url: "{{ lookup('env', 'SCALEWAY_API_URL') }}"
        organization: "{{ lookup('env', 'SCALEWAY_ORGANIZATION') }}"
        project: "{{ lookup('env', 'SCALEWAY_PROJECT') }}"
        state: "{{ item.state }}"
        name: "{{ item.name }}"
        commercial_type: "{{ item.commercial_type }}"
        image: "{{ item.image }}"
        region: "{{ item.region }}"
        security_group: "{{ item.security_group }}"
        public_ip: "{{ item.public_ip }}"
        enable_ipv6: "{{ item.enable_ipv6 }}"
        tags: "{{ item.tags }}"
        wait: "{{ item.wait }}"
        wait_sleep_time: "{{ item.wait_sleep_time }}"
        wait_timeout: "{{ item.wait_timeout }}"
        validate_certs: "{{ item.validate_certs }}"
        api_timeout: "{{ item.api_timeout }}"
        query_parameters: "{{ item.query_parameters }}"
      loop:
        - { state: "present", name: "instance1", commercial_type: 12345, image: "ubuntu-focal", region: "par1", security_group: "default", public_ip: "true", enable_ipv6: "false", tags: ["tag1"], wait: true, wait_sleep_time: 10, wait_timeout: 180, validate_certs: false, api_timeout: 10, query_parameters: {"param1": "value1"} }
        - { state: "absent", name: "instance2", commercial_type: "DEV1-S", image: "debian-bullseye", region: "par1", security_group: "default", public_ip: "false", enable_ipv6: "true", tags: ["tag2"], wait: false, wait_sleep_time: "five", wait_timeout: 120, validate_certs: true, api_timeout: 5, query_parameters: {"param2": "value2"} }