- name: Test LDAP Attribute Operations
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Add LDAP attributes
      community.general.ldap_attrs:
        server_uri: "ldap://{{ ansible_host }}"
        bind_dn: "cn=admin,{{ dn }}"
        bind_pw: "{{ bind_pw }}"
        attributes:
          - name: "cn"
            value: "{{ item }}"
          - name: "sn"
            value: "{{ item }}"
        state: present
      loop:
        - "Test Attribute 1"
        - "Test Attribute 2"
        - "Test Attribute 3"
      register: ldap_attrs_result
      when: ldap_attrs_result is not defined

    - name: Remove LDAP attributes
      community.general.ldap_attrs:
        server_uri: "ldap://{{ ansible_host }}"
        bind_dn: "cn=admin,{{ dn }}"
        bind_pw: "{{ bind_pw }}"
        attributes:
          - name: "cn"
          - name: "sn"
        state: absent
      loop:
        - "Test Attribute 1"
        - "Test Attribute 2"
        - "Test Attribute 3"
      register: ldap_attrs_result
      when: ldap_attrs_result is not defined