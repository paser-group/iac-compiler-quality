- name: Set up PKI Profile
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate Encoded Strings
      set_fact:
        encoded_strings:
          - name: "pki_profile1"
            encoding: "utf-8"     # Modify this encoding as needed
          - name: "pki_profile2"
            encoding: "utf-16"    # Modify this encoding as needed
          - name: "pki_profile3"
            encoding: "latin-1"   # Modify this encoding as needed

    - name: Create PKI Profile
      community.network.avi_pkiprofile:
        controller: "https://{{ ansible_default_ipv4.address }}"
        username: "admin"
        password: "password"
        tenant: "admin"
        name: "{{ item.name }}"
        encoding: "{{ item.encoding }}"
        state: "present"
      loop: "{{ encoded_strings }}"
      register: pki_profile_result

    - name: Print PKI Profile Result
      debug:
        var: pki_profile_result