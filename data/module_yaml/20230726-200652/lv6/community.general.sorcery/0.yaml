- name: Test 'community.general.sorcery' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ensure sorcery package is installed
      community.general.sorcery:
        name: "sorcery"
        state: present
        update_cache: false

    - name: Generate strings with varied encodings
      set_fact:
        sorcery_test_strings: "{{ sorcery_test_strings | default([]) + [item] }}"
      loop:
        - "Sōrċery"                              # UTF-8 encoded string
        - "\u0053\u014D\u0072\u010B\u0065\u0072\u0079"   # Unicode escape sequence
        - "\xf0\x9d\x90\x8d\xf0\x9d\x90\x9e\xf0\x9d\x90\xad\xf0\x9d\x90\xb0\xf0\x9d\x90\xa9\xf0\x9d\x90\xb4" # UTF-8 encoded hex bytes

    - name: Run sorcery command with test strings
      community.general.sorcery:
        name: "{{ sorcery_test_strings }}"
        state: "{{ ['present', 'absent'] | random }}"
        update: "{{ [True, False] | random }}"
        cache_valid_time: "{{ range(0, 100) | random }}"
      loop: "{{ sorcery_test_strings }}"
      loop_control:
        loop_var: sorcery_test_string

    - name: Clean up sorcery package
      community.general.sorcery:
        name: "sorcery"
        state: absent
        update_cache: false