---
- name: Test playbook for the community.general.clc_alert_policy module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Alert Policy
      community.general.clc_alert_policy:
        alert_recipients:
          - recipient1@example.com
          - recipient2@example.com
        alias: 'test_alert_policy'
        duration: '00:05:00'
        id: 'test_policy_id'
        metric: 'cpu'
        name: 'Test Alert Policy'
        state: 'present'
        threshold: 90
      register: result

    - name: Display result
      debug:
        var: result

    - name: Delete Alert Policy
      community.general.clc_alert_policy:
        id: 'test_policy_id'
        state: 'absent'
      when: result is defined and result.changed
      register: delete_result

    - name: Display deletion result
      debug:
        var: delete_result