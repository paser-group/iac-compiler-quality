---
- name: Test playbook for community.general.keycloak_identity_provider module
  hosts: localhost
  gather_facts: false

  vars:
    add_read_token_role_on_create: true
    alias: "test_alias"
    auth_client_id: "test_client_id"
    auth_client_secret: "test_secret"
    auth_keycloak_url: "https://example.com/auth"
    auth_password: "test_password"
    auth_realm: "test_realm"
    auth_username: "test_user"
    authenticate_by_default: true
    config:
      test_key: "test_value"
    connection_timeout: 30
    display_name: "Test Identity Provider"
    enabled: true
    first_broker_login_flow_alias: "test_first_broker"
    http_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"
    link_only: false
    mappers:
      - test_mapper1
      - test_mapper2
    post_broker_login_flow_alias: "test_post_broker"
    provider_id: "oidc"
    realm: "test_realm"
    state: "present"
    store_token: true
    token: "test_token"
    trust_email: true
    validate_certs: false

  tasks:
    - name: "Include the community.general.keycloak_identity_provider module"
      include_role:
        name: community.general.keycloak_identity_provider
        tasks_from: main

      vars:
        add_read_token_role_on_create: "{{ add_read_token_role_on_create }}"
        alias: "{{ alias }}"
        auth_client_id: "{{ auth_client_id }}"
        auth_client_secret: "{{ auth_client_secret }}"
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_password: "{{ auth_password }}"
        auth_realm: "{{ auth_realm }}"
        auth_username: "{{ auth_username }}"
        authenticate_by_default: "{{ authenticate_by_default }}"
        config: "{{ config }}"
        connection_timeout: "{{ connection_timeout }}"
        display_name: "{{ display_name }}"
        enabled: "{{ enabled }}"
        first_broker_login_flow_alias: "{{ first_broker_login_flow_alias }}"
        http_agent: "{{ http_agent }}"
        link_only: "{{ link_only }}"
        mappers: "{{ mappers }}"
        post_broker_login_flow_alias: "{{ post_broker_login_flow_alias }}"
        provider_id: "{{ provider_id }}"
        realm: "{{ realm }}"
        state: "{{ state }}"
        store_token: "{{ store_token }}"
        token: "{{ token }}"
        trust_email: "{{ trust_email }}"
        validate_certs: "{{ validate_certs }}"