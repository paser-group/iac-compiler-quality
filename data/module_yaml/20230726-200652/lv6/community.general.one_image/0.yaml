- name: Test playbook for 'community.general.one_image' module
  hosts: localhost
  gather_facts: false

  vars:
    api_username: "admin"
    api_password: "password"
    api_url: "http://localhost:2633/RPC2"
    enabled: true
    id: 1
    images:
      - name: "{{ 'test_image'.encode('utf-8') }}"
        state: "present"
      - name: 1001
        state: "absent"

  tasks:
    - name: Create VM image
      community.general.one_image:
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        api_url: "{{ api_url }}"
        enabled: "{{ enabled }}"
        id: "{{ item.id }}"
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      loop: "{{ images }}"
      register: result

    - name: Display the result
      debug:
        var: result