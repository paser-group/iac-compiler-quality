- hosts: all
  gather_facts: false
  tasks:
    - name: Generate strings with varied encodings
      command: echo "Generate strings with varied encodings"

    - name: Set firewall rules
      ansible.builtin.iptables:
        action: "{{ random_action }}"
        chain: "{{ random_chain }}"
        chain_management: "{{ random_chain_management }}"
        comment: "{{ random_comment }}"
        destination: "{{ random_destination }}"
        destination_port: "{{ random_destination_port }}"
        flush: "{{ random_flush }}"
        jump: "{{ random_jump }}"
        log_prefix: "{{ random_log_prefix }}"
        protocol: "{{ random_protocol }}"
        reject_with: "{{ random_reject_with }}"
        state: "{{ random_state }}"
        src_range: "{{ random_src_range }}"
        tcp_flags: "{{ random_tcp_flags }}"
        uid_owner: "{{ random_uid_owner }}"
        wait: "{{ random_wait }}"

      vars:
        random_action: "{{ random_string }}"
        random_chain: "{{ random_string }}"
        random_chain_management: "{{ random_bool }}"
        random_comment: "{{ random_string }}"
        random_destination: "{{ random_string }}"
        random_destination_port: "{{ random_string }}"
        random_flush: "{{ random_bool }}"
        random_jump: "{{ random_string }}"
        random_log_prefix: "{{ random_string }}"
        random_protocol: "{{ random_string }}"
        random_reject_with: "{{ random_string }}"
        random_state: "{{ random_string }}"
        random_src_range: "{{ random_string }}"
        random_tcp_flags:
          SYN: "{{ random_bool }}"
          ACK: "{{ random_bool }}"
          FIN: "{{ random_bool }}"
          RST: "{{ random_bool }}"
          PSH: "{{ random_bool }}"
          URG: "{{ random_bool }}"
        random_uid_owner: "{{ random_string }}"
        random_wait: "{{ random_string }}"

    - name: Verify firewall rules
      ansible.builtin.shell: iptables -L