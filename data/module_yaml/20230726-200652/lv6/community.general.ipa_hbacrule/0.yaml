- hosts: localhost
  gather_facts: false
  vars:
    cn: "test_rule"
    description: "Test HBAC rule"
    host:
      - "{{ ansible_hostname }}"
    hostcategory: "test_host_category"
    hostgroup: []
    ipa_host: "ipa.example.com"
    ipa_pass: "ipa_password"
    ipa_port: 443
    ipa_prot: "https"
    ipa_timeout: 10
    ipa_user: "admin"
    service:
      - "*"
    servicecategory: "test_service_category"
    servicegroup: []
    sourcehost:
      - "{{ ansible_hostname }}"
    sourcehostcategory: "test_source_host_category"
    sourcehostgroup: []
    state: present
    user: []
    usercategory: "test_user_category"
    usergroup: []
    validate_certs: false

  tasks:
    - name: Create HBAC rule
      community.general.ipa_hbacrule:
        cn: "{{ cn }}"
        description: "{{ description }}"
        host: "{{ host }}"
        hostcategory: "{{ hostcategory }}"
        hostgroup: "{{ hostgroup }}"
        ipa_host: "{{ ipa_host }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        ipa_user: "{{ ipa_user }}"
        service: "{{ service }}"
        servicecategory: "{{ servicecategory }}"
        servicegroup: "{{ servicegroup }}"
        sourcehost: "{{ sourcehost }}"
        sourcehostcategory: "{{ sourcehostcategory }}"
        sourcehostgroup: "{{ sourcehostgroup }}"
        state: "{{ state }}"
        user: "{{ user }}"
        usercategory: "{{ usercategory }}"
        usergroup: "{{ usergroup }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Show result
      debug:
        var: result

    # Test Case 1: Generate strings with varied encodings
    - name: Test case 1 - Generate strings with varied encodings
      community.general.ipa_hbacrule:
        cn: "{{ cn }}"
        description: "{{ description | b64encode }}"
        host: "{{ host }}"
        hostcategory: "{{ hostcategory | b16encode }}"
        hostgroup: "{{ hostgroup }}"
        ipa_host: "{{ ipa_host }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        ipa_user: "{{ ipa_user }}"
        service: "{{ service }}"
        servicecategory: "{{ servicecategory | b32encode }}"
        servicegroup: "{{ servicegroup }}"
        sourcehost: "{{ sourcehost }}"
        sourcehostcategory: "{{ sourcehostcategory | b16encode }}"
        sourcehostgroup: "{{ sourcehostgroup }}"
        state: "{{ state }}"
        user: "{{ user }}"
        usercategory: "{{ usercategory | b32encode }}"
        usergroup: "{{ usergroup }}"
        validate_certs: "{{ validate_certs }}"
      register: result_test_case_1

    - name: Show result - Test Case 1
      debug:
        var: result_test_case_1