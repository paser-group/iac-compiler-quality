- name: Gather information on instances using ali_instance_info module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Gather instance information
      community.general.ali_instance_info:
        alicloud_access_key: "{{ alicloud_access_key | b64decode }}"
        alicloud_assume_role:
          arn: "{{ alicloud_assume_role_arn | b64encode }}"
          expiration: "{{ alicloud_assume_role_session_expiration }}"
          name: "{{ alicloud_assume_role_session_name | b64decode }}"
        alicloud_region: "{{ alicloud_region }}"
        alicloud_secret_key: "{{ alicloud_secret_key }}"
        alicloud_security_token: "{{ alicloud_security_token | b64encode }}"
        ecs_role_name: "{{ ecs_role_name | b64decode }}"
        filters: "{{ filters | b64encode }}"
        name_prefix: "{{ name_prefix }}"
        profile: "{{ profile | b64encode }}"
        shared_credentials_file: "{{ shared_credentials_file | b64decode }}"
        tags: "{{ tags | b64encode }}"
      register: instance_info

    - debug:
        var: instance_info