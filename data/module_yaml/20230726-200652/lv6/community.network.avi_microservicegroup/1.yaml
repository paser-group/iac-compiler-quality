---
- name: Test Playbook for community.network.avi_microservicegroup module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Generate strings with varied encodings
      set_fact:
        encoded_name: "{{ 'TestGroup' | b64encode }}"
  
    - name: Create MicroServiceGroup
      community.network.avi_microservicegroup:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        name: "{{ encoded_name }}"
        description: "Test Description"
        state: present
        tenant_uuid: "12345678-1234-5678-1234-567812345678"
        api_context: 
          cloud_ref: "/api/cloud/?name=default-cloud"
        avi_credentials:
          api_version: "17.2.14"
          tenant: "{{ tenant }}"
        service_refs: 
          - http_virtual_service
          - https_virtual_service
        avi_disable_session_cache_as_fact: true
      register: result
    - debug:
        var: result