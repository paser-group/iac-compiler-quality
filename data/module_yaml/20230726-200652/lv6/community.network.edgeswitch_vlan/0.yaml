---
- name: Manage VLANs on Ubiquiti Edgeswitches
  hosts: switches
  gather_facts: false

  tasks:
    - name: Create VLAN
      community.network.edgeswitch_vlan:
        vlan_id: "{{ item.vlan_id }}"
        name: "{{ item.name }}"
        state: "{{ item.state }}"
        tagged_interfaces: "{{ item.tagged_interfaces }}"
        untagged_interfaces: "{{ item.untagged_interfaces }}"
        auto_tag: "{{ item.auto_tag | default(false) }}"
        auto_untag: "{{ item.auto_untag | default(false) }}"
        auto_exclude: "{{ item.auto_exclude | default(false) }}"
        excluded_interfaces: "{{ item.excluded_interfaces | default([]) }}"
        purge: "{{ item.purge | default(false) }}"
      with_items:
        - { vlan_id: "10', name: "VLAN10", state: "present", tagged_interfaces: ["eth1"], untagged_interfaces: ["eth2"], auto_tag: true }
        - { vlan_id: "20", name: "VLAN20", state: "present", tagged_interfaces: ["eth1"], untagged_interfaces: ["eth3"], auto_untag: true }
        - { vlan_id: "30", name: "VLAN30", state: "present", tagged_interfaces: ["eth1"], auto_tag: true }
        - { vlan_id: "40", name: "VLAN40", state: "present", untagged_interfaces: ["eth2"], auto_exclude: true }
        - { vlan_id: 50, name: "VLAN50", state: "present", tagged_interfaces: ["eth1"], untagged_interfaces: ["eth2"], auto_exclude: true }