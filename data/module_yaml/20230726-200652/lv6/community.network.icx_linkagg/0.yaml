---
- name: Test playbook for community.network.icx_linkagg
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create link aggregation group
      community.network.icx_linkagg:
        name: "TestGroup"
        aggregate: '["ethernet1/1", "ethernet1/2"]'
        members: '["ethernet1/3", "ethernet1/4"]'
        mode: "dynamic"
        check_running_config: true
        group: 1
        state: "present"

    - name: Display result
      debug:
        msg: "Link aggregation group '{{ inventory_hostname }}' created"

    - name: Ensure link aggregation group is cleared
      community.network.icx_linkagg:
        name: "TestGroup"
        purge: true
        state: "absent"

    - name: Display result
      debug:
        msg: "Link aggregation group '{{ inventory_hostname }}' cleared"