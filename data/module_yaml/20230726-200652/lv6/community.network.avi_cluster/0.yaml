---
- name: Test playbook for community.network.avi_cluster module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Setup Avi cluster
      community.network.avi_cluster:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        tenant_uuid: "{{ tenant_uuid }}"
        api_version: "{{ api_version }}"
        avi_api_patch_op: "{{ avi_api_patch_op }}"
        avi_api_update_method: "{{ avi_api_update_method }}"
        rejoin_nodes_automatically: "{{ rejoin_nodes_automatically }}"
        name: "{{ name }}"
        nodes:
          - ip: 10.1.1.1
            username: "{{ username }}"
            password: "{{ password }}"
            api_context:
              - name: "context1"
                type: "type1"
          - ip: 10.1.1.2
            username: "{{ username }}"
            password: "{{ password }}"
            api_context:
              - name: "context2"
                type: "type2"
          - ip: 10.1.1.3
            username: "{{ username }}"
            password: "{{ password }}"
          - ip: 10.1.1.4
            username: "{{ username }}"
            password: "{{ password }}"
        single_node_cluster: false
      register: cluster_result

    - name: Debug cluster result
      debug:
        var: cluster_result