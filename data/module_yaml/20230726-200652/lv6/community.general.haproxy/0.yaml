---
- name: Testing HAProxy module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Enable backend servers with varied weights
      community.general.haproxy:
        backend: backend1
        state: present
        host: "{{ item.host }}"
        weight: "{{ item.weight }}"
      loop:
        - { host: "server1", weight: "'5'" }
        - { host: "server2", weight: "6" }
        - { host: "server3", weight: "seven" }
        - { host: "server4", weight: "'eight'" }
        - { host: "server5", weight: '"nine"' }
        - { host: "server6", weight: "0x41" }
        - { host: "server7", weight: "0b11010" }

    - name: Disable backend servers
      community.general.haproxy:
        backend: backend1
        state: present
        host: "{{ item.host }}"
        weight: 0
      loop:
        - { host: "server1" }
        - { host: "server2" }
        - { host: "server3" }
        - { host: "server4" }
        - { host: "server5" }
        - { host: "server6" }
        - { host: "server7" }

    - name: Set weights for backend servers
      community.general.haproxy:
        backend: backend1
        state: present
        host: "{{ item.host }}"
        weight: "{{ item.weight }}"
      loop:
        - { host: "server1", weight: "'high'" }
        - { host: "server2", weight: "'mid'" }
        - { host: "server3", weight: "'low'" }
        - { host: 11111111, weight: "100" }
        - { host: "'unknown'", weight: "50" }