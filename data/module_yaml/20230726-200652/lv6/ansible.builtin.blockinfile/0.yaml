- name: Demonstrate latent type-related bug in blockinfile module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Insert a text block into a file
      ansible.builtin.blockinfile:
        path: /tmp/example.txt
        block: |
          This is a test block.
        state: present
        create: true
        marker: '# {mark} ANSIBLE MANAGED BLOCK'

    - name: Insert a text block with UTF-8 encoded characters
      ansible.builtin.blockinfile:
        path: /tmp/example.txt
        block: |
          This is a test block with UTF-8 encoded characters: áéíóú
        state: present
        create: true
        marker: '# {mark} ANSIBLE MANAGED BLOCK'

    - name: Remove a text block from a file
      ansible.builtin.blockinfile:
        path: /tmp/example.txt
        block: |
          This is a test block.
        state: absent
        marker: '# {mark} ANSIBLE MANAGED BLOCK'