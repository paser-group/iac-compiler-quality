---
- name: Test playbook for latent type-related bugs
  hosts: localhost
  gather_facts: false
  
  vars:
    command: "start"
    config_dir: "/etc/riak"
    http_conn: "localhost:8098"
    target_node: "riak@{{ inventory_hostname }}"
    validate_certs: false
    wait_for_handoffs: 3
    wait_for_ring: 30
    wait_for_service: "riak_kv"
    test_string: "{{ lookup('pipe', 'echo -n Some Test String') | b64encode }}"

  tasks:
    - name: Start Riak CS
      community.general.riak_cs:
        command: "{{ command }}"
        config_dir: "{{ config_dir }}"
        http_conn: "{{ http_conn }}"
        target_node: "{{ target_node }}"
        validate_certs: "{{ validate_certs }}"
        wait_for_handoffs: "{{ wait_for_handoffs }}"
        wait_for_ring: "{{ wait_for_ring }}"
        wait_for_service: "{{ wait_for_service }}"
        test_string: "{{ test_string }}"
        
      register: riak_cs_result

    - name: Debug Riak CS output
      debug:
        var: riak_cs_result