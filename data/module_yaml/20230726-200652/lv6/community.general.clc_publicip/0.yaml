---
- name: Test playbook for clc_publicip module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add public IPs
      community.general.clc_publicip:
        server_ids: "{{ item.server_ids }}"
        state: "present"
        wait: "{{ item.wait }}"
        ports:
          - "{{ item.ports }}"
        protocol: "{{ item.protocol }}"
      loop:
        - { server_ids: ["server_id_1"], ports: ["8080"], protocol: "tcp", state: "present", wait: true }
        - { server_ids: ["server_id_2"], ports: ["443"], protocol: "tcp", state: "present", wait: false }
        - { server_ids: ["server_id_3", "server_id_4"], ports: ["80", "443"], protocol: "tcp", state: "present", wait: true }

    - name: Delete public IPs
      community.general.clc_publicip:
        server_ids: "{{ item.server_ids }}"
        state: "absent"
      loop:
        - { server_ids: ["server_id_1"], state: "absent" }
        - { server_ids: ["server_id_2"], state: "absent" }
        - { server_ids: ["server_id_3", "server_id_4"], state: "absent" }