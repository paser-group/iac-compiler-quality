---
- name: Unveil Latent Type-Related Bugs
  hosts: all
  gather_facts: False

  vars:
    policy_params:
      - action: None
        nitro_protocol: "HTTP"
        nitro_timeout: 10
        nitro_user: "admin"
        nsip: "10.1.1.1"
        policyname: None
        rule: None
        save_config: true
        state: "present"
        url: None
        validate_certs: true
      - action: "SomeAction"
        nitro_protocol: "HTTPS"
        nitro_timeout: "timeout_value"
        nitro_user: "admin"
        nsip: "10.1.1.2"
        policyname: "policy_name"
        rule: "rule_name"
        save_config: false
        state: "absent"
        url: "https://example.com"
        validate_certs: false

  tasks:
    - name: Create Netscaler CS Policy
      community.network.netscaler_cs_policy:
        action: "{{ item.action | default(omit) }}"
        domain: "{{ item.domain | default(omit) }}"
        nitro_pass: "{{ item.nitro_pass | default(omit) }}"
        nitro_protocol: "{{ item.nitro_protocol | default(omit) }}"
        nitro_timeout: "{{ item.nitro_timeout | default(omit) }}"
        nitro_user: "{{ item.nitro_user | default(omit) }}"
        nsip: "{{ item.nsip | default(omit) }}"
        policyname: "{{ item.policyname | default(omit) }}"
        rule: "{{ item.rule | default(omit) }}"
        save_config: "{{ item.save_config | default(omit) }}"
        state: "{{ item.state | default(omit) }}"
        url: "{{ item.url | default(omit) }}"
        validate_certs: "{{ item.validate_certs | default(omit) }}"
      register: result
      loop: "{{ policy_params }}"

    - name: Debug
      debug:
        var: result
      when: result is defined