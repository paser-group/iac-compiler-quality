- name: Test Avi User Module
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    test_user:
      name: "{{ item.name }}"
      username: "{{ item.username }}"
      password: "{{ item.password }}"
      controller: "{{ item.controller }}"
      api_version: "{{ item.api_version }}"
      obj_username: "{{ item.obj_username }}"
      obj_password: "{{ item.obj_password }}"
      state: "{{ item.state }}"
      is_active: "{{ item.is_active }}"
      is_superuser: "{{ item.is_superuser }}"
      email: "{{ item.email }}"
      tenant: "{{ item.tenant }}"
      default_tenant_ref: "{{ item.default_tenant_ref }}"

  tasks:
    - name: Create Avi User
      community.network.avi_user:
        avi_credentials:
          controller: "{{ test_user.controller }}"
          username: "admin"
          password: "admin"
          default_tenant_ref: "{{ test_user.default_tenant_ref }}"
        name: "{{ test_user.name }}"
        username: "{{ test_user.username }}"
        password: "{{ test_user.password }}"
        controller: "{{ test_user.controller }}"
        api_version: "{{ test_user.api_version }}"
        obj_username: "{{ test_user.obj_username }}"
        obj_password: "{{ test_user.obj_password }}"
        state: "{{ test_user.state }}"
        is_active: "{{ test_user.is_active }}"
        is_superuser: "{{ test_user.is_superuser }}"
        email: "{{ test_user.email }}"
        tenant: "{{ test_user.tenant }}"
      register: result
      loop:
        - name: Test Case 1
          username: "test_user1"
          password:
            - "password1"
            - "password2"
          controller: 10.1.1.1
          api_version: "20.1"
          obj_username: "obj_username_1"
          obj_password: "obj_password_1"
          state: "present"
          is_active: "yes"
          is_superuser: "no"
          email: "user1@example.com"
          tenant: "tenant1"
          default_tenant_ref: "/api/tenant?name=default&type=tenant"
        - name: Test Case 2
          username: "test_user2"
          password:
            - "password3"
            - "password4"
          controller: 10.1.1.2
          api_version: "20.1"
          obj_username: "obj_username_2"
          obj_password: "obj_password_2"
          state: "present"
          is_active: "no"
          is_superuser: "yes"
          email: "user2@example.com"
          tenant: "tenant2"
          default_tenant_ref: "/api/tenant?name=default&type=tenant"

    - name: Output debug information
      debug:
        var: result