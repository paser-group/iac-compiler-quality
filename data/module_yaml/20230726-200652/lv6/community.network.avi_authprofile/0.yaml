- name: Test community.network.avi_authprofile module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create AuthProfile
      community.network.avi_authprofile:
        controller: "ansible_controller"
        username: "ansible_user"
        password: "ansible_password"
        tenant: "ansible_tenant"
        action: create
        name: "{{ item.name }}"
        description: "{{ item.description }}"
        type: "{{ item.type }}"

      with_items:
        - { name: "AuthProfile1", description: "Some description", type: "basic" }
        - { name: "AuthProfile2", description: "Another description", type: "cert" }
        - { name: "AuthProfile3", description: "Yet another description", type: "saml" }

    - name: Update AuthProfile
      community.network.avi_authprofile:
        controller: "ansible_controller"
        username: "ansible_user"
        password: "ansible_password"
        tenant: "ansible_tenant"
        action: update
        name: "{{ item.name }}"
        description: "{{ item.description }}"
        type: "{{ item.type }}"

      with_items:
        - { name: "AuthProfile1", description: "Updated description", type: "basic" }
        - { name: "AuthProfile2", description: "Updated description", type: "cert" }
        - { name: "AuthProfile3", description: "Updated description", type: "saml" }

    - name: Delete AuthProfile
      community.network.avi_authprofile:
        controller: "ansible_controller"
        username: "ansible_user"
        password: "ansible_password"
        tenant: "ansible_tenant"
        action: delete
        name: "{{ item.name }}"

      with_items:
        - { name: "AuthProfile1" }
        - { name: "AuthProfile2" }
        - { name: "AuthProfile3" }