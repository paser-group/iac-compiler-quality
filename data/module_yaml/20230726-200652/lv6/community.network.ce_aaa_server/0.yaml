- name: Manage AAA server global configuration
  hosts: network_devices
  gather_facts: false
  vars:
    accounting_mode: "{{ ['standard', 'extended'] | random }}"
    acct_scheme_name: "{{ random_string | b64encode }}"
    authen_scheme_name: "{{ random_string | b64encode }}"
    author_scheme_name: "{{ random_string | b64encode }}"
    domain_name: "{{ random_string }}"
    first_authen_mode: "{{ ['local', 'radius'] | random }}"
    first_author_mode: "{{ ['local', 'radius'] | random }}"
    hwtacas_template: "{{ random_string | b64encode }}"
    local_user_group: "{{ random_string }}"
    radius_server_group: "{{ random_string }}"
    state: present

  tasks:
    - name: Generate random string
      set_fact:
        random_string: "{{ [item | random_string] | random }}"
      loop: "{{ range(1, 10) }}"

    - name: Manage AAA server global configuration
      community.network.ce_aaa_server:
        accounting_mode: "{{ accounting_mode }}"
        acct_scheme_name: "{{ acct_scheme_name }}"
        authen_scheme_name: "{{ authen_scheme_name }}"
        author_scheme_name: "{{ author_scheme_name }}"
        domain_name: "{{ domain_name }}"
        first_authen_mode: "{{ first_authen_mode }}"
        first_author_mode: "{{ first_author_mode }}"
        hwtacas_template: "{{ hwtacas_template }}"
        local_user_group: "{{ local_user_group }}"
        radius_server_group: "{{ radius_server_group }}"
        state: "{{ state }}"
      register: aaa_server_result

    - name: Debug module output
      debug:
        var: aaa_server_result