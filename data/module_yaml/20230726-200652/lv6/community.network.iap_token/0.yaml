- hosts: localhost
  gather_facts: false

  tasks:
    - name: Get IAP token
      community.network.iap_token:
        https: true
        iap_fqdn: "{{ iap_fqdn }}"
        iap_port: "{{ iap_port }}"
        password: null
        username: null
        validate_certs: true
        # Testing varied encodings for the token
        token: "{{ item }}"
      loop:
        - "{{ iap_token | b64encode }}"
        - "{{ iap_token | b64encode | string }}"
        - "{{ iap_token | b64encode | to_yaml }}"
        - "{{ iap_token | b64encode | to_json }}"
        - "{{ iap_token | b64encode | quote }}"