---
- name: Manage ejabberd users
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Create ejabberd user with different encodings
      community.general.ejabberd_user:
        host: "localhost"
        logging: True
        password: "{{ item.password | b64decode }}"
        state: "{{ item.state }}"
        username: "{{ item.username | b64decode }}"
      loop:
        - { username: "dXNlcm5hbWUxCg==", password: "cGFzc3dvcmRzMQo=", state: "present" }
        - { username: "bHVrZW1hbmFnZQo=", password: "b3JkZXJfcGFzc3dvcmQxCg==", state: "absent" }

      register: result

    - name: Debug result
      debug:
        var: result