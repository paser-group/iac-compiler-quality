- name: Manage Qemu(KVM) Virtual Machines
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create VM
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "api_user"
        api_password: "api_password"
        node: "proxmox_node"
        vmid: 100
        state: present
        name: "test_vm"
        memory: 1024

    - name: Set VM Description
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "api_user"
        api_password: "api_password"
        node: "proxmox_node"
        vmid: 100
        state: present
        description: "This is a test VM"

    - name: Stop VM
      community.general.proxmox_kvm:
        api_host: "https://proxmox.example.com"
        api_user: "api_user"
        api_password: "api_password"
        node: "proxmox_node"
        vmid: 100
        state: stopped