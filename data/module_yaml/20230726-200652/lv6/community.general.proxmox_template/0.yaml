---
- name: Test playbook for 'community.general.proxmox_template'
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create OS template in Proxmox
      community.general.proxmox_template:
        api_host: "https://{{ proxmox_host }}"
        api_user: "{{ proxmox_user }}"
        api_password: "{{ proxmox_password }}"
        vmid: 100
        template: "{{ template_name }}"
        node: "{{ proxmox_node }}"
        state: present
        validate_certs: false
      vars:
        proxmox_host: "10.1.1.1"  # Change this to the actual Proxmox host
        proxmox_user: "admin"     # Change this to the Proxmox admin username
        proxmox_password: "password"  # Change this to the Proxmox admin password
        template_name: "{{ generate_test_string() }}"
        proxmox_node: "ubuntu1"   # Change this to the desired Proxmox node

    - name: Generate test string with varied encodings
      set_fact:
        test_string: "{{ generate_test_string() }}"

    - name: Print test string
      debug:
        var: test_string

  vars:
    encodings:
      - utf-8
      - utf-16
      - latin1
      # Add more varied encodings as needed

  tasks:
    - name: Generate test string with varied encodings
      set_fact:
        test_string: "{{ generate_test_string() }}"

    - name: Print test string
      debug:
        var: test_string
  
    - name: Send test string to remote host
      community.general.proxmox_template:
        api_host: "https://{{ proxmox_host }}"
        api_user: "{{ proxmox_user }}"
        api_password: "{{ proxmox_password }}"
        vmid: 101
        template: "{{ test_string }}"
        node: "{{ proxmox_node }}"
        state: present
        validate_certs: false
      
    - name: Verify template creation
      community.general.proxmox_template_info:
        api_host: "https://{{ proxmox_host }}"
        api_user: "{{ proxmox_user }}"
        api_password: "{{ proxmox_password }}"
        node: "{{ proxmox_node }}"
      register: template_info

    - name: Print template info
      debug:
        var: template_info

  vars:
    proxmox_host: "10.1.1.1"  # Change this to the actual Proxmox host
    proxmox_user: "admin"     # Change this to the Proxmox admin username
    proxmox_password: "password"  # Change this to the Proxmox admin password
    proxmox_node: "ubuntu1"   # Change this to the desired Proxmox node

  tasks:
    - name: Generate test string with varied encodings
      set_fact:
        test_string: "{{ generate_test_string() }}"

    - name: Print test string
      debug:
        var: test_string