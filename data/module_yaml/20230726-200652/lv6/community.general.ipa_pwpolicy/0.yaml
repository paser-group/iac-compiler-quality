---
- name: Test playbook for community.general.ipa_pwpolicy module
  hosts: localhost
  gather_facts: false
  vars:
    ipa_host: "ipa.example.com"
    ipa_user: "admin"
    ipa_pass: "password"
    ipa_timeout: 10
    validate_certs: true

  tasks:
    - name: Set FreeIPA password policy
      community.general.ipa_pwpolicy:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_timeout: "{{ ipa_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        group: testgroup
        maxfailcount: "5"
        failinterval: "60"
        lockouttime: "600"
        minpwdlife: "1d"
        maxpwdlife: "90d"
        historylength: "5"
        priority: "0"

    - name: Ensure password policy is set
      community.general.ipa_pwpolicy:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_timeout: "{{ ipa_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        group: testgroup
        maxfailcount: "5"
        failinterval: "60"
        lockouttime: "600"
        minpwdlife: "1d"
        maxpwdlife: "90d"
        historylength: "5"
        priority: "0"

    - name: Remove password policy
      community.general.ipa_pwpolicy:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_timeout: "{{ ipa_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: absent
        group: testgroup