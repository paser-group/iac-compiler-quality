- name: Test the community.general.sudoers module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set sudoers configuration
      community.general.sudoers:
        name: "{{ inventory_hostname }}"
        user: "{{ ansible_user }}"
        host: "{{ inventory_hostname }}"
        runas: ALL
        commands: ALL
        nopassword: true
        state: present
        sudoers_path: "/etc/sudoers.d/"

    - name: Verify sudoers configuration
      shell: visudo -c
      changed_when: false
      register: sudoers_check

    - name: Display sudoers validation result
      debug:
        var: sudoers_check.stderr_lines