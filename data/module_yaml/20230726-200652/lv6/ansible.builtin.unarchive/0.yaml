---
- name: Unarchive files with varied encodings
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create a test archive
      ansible.builtin.shell: |
        mkdir -p /tmp/unarchive_test
        touch /tmp/unarchive_test/testfile
        tar -czf /tmp/test_archive.tar.gz -C /tmp/unarchive_test .

    - name: Unarchive with varied encodings
      ansible.builtin.unarchive:
        src: "/tmp/test_archive.tar.gz"
        dest: "/tmp/unarchive_destination"
        encoding: "{{ item }}"
      with_items:
        - ascii
        - utf-8
        - utf-16
        - utf-32
        - iso8859-1
        - iso8859-15
        - gb2312