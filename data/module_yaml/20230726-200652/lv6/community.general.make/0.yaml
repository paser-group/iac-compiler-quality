- name: Run make command
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate strings with varied encodings
      set_fact:
        strings:
          - "{{ 'test' }}"
          - "{{ b'test'.decode() }}"
          - "{{ 'test'.encode() }}"
          - "{{ b'test'.decode('utf-8') }}"
          - "{{ b'test'.decode('ascii') }}"
          - "{{ 'test'.encode('utf-8') }}"
          - "{{ 'test'.encode('ascii') }}"

    - name: Run make command with varied encodings
      community.general.make:
        chdir: "{{ item.chdir }}"
        file: "{{ item.file }}"
        jobs: "{{ item.jobs }}"
        make: "{{ item.make }}"
        params: "{{ item.params }}"
        target: "{{ item.target }}"
      loop:
        - { chdir: "/path/to/folder", file: "Makefile", jobs: 2, make: "make", params: {}, target: "" }
        - { chdir: "/path/to/folder", file: "Makefile", jobs: 4, make: "make", params: {}, target: "{{ strings | random }}" }
        - { chdir: "/path/to/folder", file: "Makefile", jobs: 4, make: "make", params: {}, target: "{{ strings | random }}" }
        - { chdir: "/path/to/folder", file: "/path/to/Makefile", jobs: 2, make: "make", params: {}, target: "" }
        - { chdir: "/path/to/folder", file: "/path/to/Makefile", jobs: 4, make: "make", params: {}, target: "{{ strings | random }}" }
        - { chdir: "/path/to/folder", file: "/path/to/Makefile", jobs: 4, make: "make", params: {}, target: "{{ strings | random }}" }