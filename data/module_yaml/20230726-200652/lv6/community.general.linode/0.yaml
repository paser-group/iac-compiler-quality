---
- name: Test playbook for 'community.general.linode' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Linode instance
      community.general.linode:
        api_key: YOUR_API_KEY
        name: "Test Instance"
        plan: 1
        distribution: 1
        datacenter: 2
        ssh_pub_key: "ssh-rsa YOUR_PUBLIC_KEY"
        state: present
        alert_bwin_enabled: true
        alert_bwin_threshold: 10
        alert_bwout_enabled: true
        alert_bwout_threshold: 20
        alert_bwquota_enabled: true
        alert_bwquota_threshold: 50
        alert_cpu_enabled: true
        alert_cpu_threshold: 80
        alert_diskio_enabled: true
        alert_diskio_threshold: 150
        backupweeklyday: 3
        backupwindow: 2
        private_ip: true
        swap: 512
        watchdog: true

      vars:
        ansible_python_interpreter: "/usr/bin/python3"

      register: linode_instance

    - name: Print Linode instance details
      debug:
        var: linode_instance

    - name: Update Linode instance name with varied encoding
      community.general.linode:
        api_key: YOUR_API_KEY
        linode_id: "{{ linode_instance.id }}"
        name: "Test Instance àáâäèéêëìíîïòóôöùúûü"

      vars:
        ansible_python_interpreter: "/usr/bin/python3"

      register: updated_instance

    - name: Print updated Linode instance details
      debug:
        var: updated_instance

    - name: Delete Linode instance
      community.general.linode:
        api_key: YOUR_API_KEY
        linode_id: "{{ linode_instance.id }}"
        state: absent

      vars:
        ansible_python_interpreter: "/usr/bin/python3"