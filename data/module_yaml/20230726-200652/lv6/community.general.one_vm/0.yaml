---
- name: Test playbook to uncover type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create VM
      community.general.one_vm:
        api_url: "https://api.example.com"
        api_username: "admin"
        api_password: "{{ lookup('env', 'API_PASSWORD') }}"
        attributes:
          name: "{{ item.name }}"
          ip: "{{ item.ip }}"
        count: "{{ item.count }}"
      loop:
        - { name: "ubuntu1", ip: "10.1.1.1", count: 1 }
        - { name: "alpine1", ip: "10.1.1.2", count: 1 }
        - { name: "centos1", ip: "10.1.1.3", count: 1 }
        - { name: "redhat1", ip: "10.1.1.4", count: 1 }

    - name: Terminate VM
      community.general.one_vm:
        api_url: "https://api.example.com"
        api_username: "admin"
        api_password: "{{ lookup('env', 'API_PASSWORD') }}"
        attributes:
          name: "{{ item.name }}"
        count: 0
      loop:
        - { name: "ubuntu1" }
        - { name: "alpine1" }
        - { name: "centos1" }
        - { name: "redhat1" }