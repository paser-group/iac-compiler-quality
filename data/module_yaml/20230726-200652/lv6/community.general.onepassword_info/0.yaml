- name: Test playbook for 'community.general.onepassword_info' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include required role
      include_role:
        name: ansible-role-community-general

    - name: Gather OnePassword info
      community.general.onepassword_info:
        auto_login:
          vault:
            email: "test@example.com"
            password: "testpassword"
            secret_key: "testsecretkey"
        cli_path: /usr/local/bin/op
        search_terms:
          - "{{ lookup('pipe', 'echo -n teststring | base64') }}"
          - "{{ lookup('pipe', 'echo -n teststring | base64 | base64') }}"
          - "{{ lookup('pipe', 'echo -n teststring | base64 | base64 | base64') }}"
      register: op_info

    - name: Display OnePassword info
      debug:
        var: op_info