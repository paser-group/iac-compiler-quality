---
- name: Test playbook for community.network.avi_api_session
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Create Avi session
      community.network.avi_api_session:
        controller: "{{ ['10.1.{}.{}'.format(item, item) | int] | random }}"
        username: "admin"
        password: "password"
        tenant: "Default"
        avi_credentials:
          - controller: "{{ ['10.1.{}.{}'.format(item, item) | int] | random }}"
            username: "admin"
            password: "password"
            tenant: "Default"
      register: session

    - name: Debug session information
      debug:
        var: session

    - name: Perform API request using the session
      community.network.avi_api_request:
        controller: "{{ ['10.1.{}.{}'.format(item, item) | int] | random }}"
        session: "{{ session }}"
        path: "/api/cluster"
      register: response

    - name: Debug API response
      debug:
        var: response