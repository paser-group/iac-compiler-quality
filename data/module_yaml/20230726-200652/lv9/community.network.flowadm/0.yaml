---
- name: Manage bandwidth resource control and priority
  hosts: localhost
  gather_facts: false
  vars:
    flow_items:
      - name: flow1
        temporary: true
        dsfield: 10
        link: vnet1
        local_ip: 10.1.1.1
        local_port: 1234
        remote_ip: 10.1.1.2
        maxbw: 10Mbit
        priority: high
        transport: udp
      - name: flow2
        temporary: false
        dsfield: 20
        link: vnet2
        local_ip: 10.1.1.3
        local_port: 5678
        remote_ip: 10.1.1.4
        maxbw: 20Mbit
        priority: low
        transport: tcp
  tasks:
    - name: Set up bandwidth resource control
      community.network.flowadm:
        name: "{{ item.name }}"
        state: present
        temporary: "{{ item.temporary }}"
        dsfield: "{{ item.dsfield }}"
        link: "{{ item.link }}"
        local_ip: "{{ item.local_ip }}"
        local_port: "{{ item.local_port }}"
        remote_ip: "{{ item.remote_ip }}"
        maxbw: "{{ item.maxbw }}"
        priority: "{{ item.priority }}"
        transport: "{{ item.transport }}"
      loop: "{{ flow_items }}"