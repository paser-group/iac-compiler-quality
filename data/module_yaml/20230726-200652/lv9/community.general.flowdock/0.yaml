- name: Trigger Type-Related Bug in Flowdock Module
  hosts: localhost
  gather_facts: false

  vars:
    external_user_name: "John Doe"
    from_address: "ansible@example.com"
    from_name: "Ansible"
    link: "https://example.com"
    msg: "This is a test message"
    project: "My Project"
    reply_to: "test@example.com"
    source: "Ansible Playbook"
    subject: "Test Subject"
    tags: "test, ansible"
    token: "your_flowdock_token"
    type: "message"
    validate_certs: false

  tasks:
    - name: Generate Random IP Addresses for Nodes
      ansible.builtin.shell: "echo {{ item }}"
      register: random_ips
      loop:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3
        - 10.1.1.4

    - name: Debug Random IP Addresses
      ansible.builtin.debug:
        var: random_ips.stdout_lines

    - name: Trigger Flowdock Message Using Random IP Address
      community.general.flowdock:
        external_user_name: "{{ external_user_name }}"
        from_address: "{{ from_address }}"
        from_name: "{{ from_name }}"
        link: "{{ link }}"
        msg: "{{ msg }}"
        project: "{{ project }}"
        reply_to: "{{ reply_to }}"
        source: "{{ source }}"
        subject: "{{ subject }}"
        tags: "{{ tags }}"
        token: "{{ token }}"
        type: "{{ type }}"
        validate_certs: "{{ validate_certs }}"
        host: "{{ random_ips.stdout_lines[ansible_play_batch_index] }}"