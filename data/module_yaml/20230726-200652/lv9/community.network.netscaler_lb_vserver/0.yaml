- name: Test playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Manage load balancing
      community.network.netscaler_lb_vserver:
        nitro_user: admin
        nitro_pass: password
        nitro_protocol: http
        nitro_timeout: 10
        validate_certs: false
        nsip: 192.168.0.1
        name: my_lb_vserver
        ipmask: "{{ hostvars['localhost']['ansible_default_ipv4']['mask'] }}"
        port: 80
        servicetype: HTTP
        lbmethod: ROUNDROBIN
        persistencetype: SOURCEIP
        persistmask: "{{ hostvars['localhost']['ansible_default_ipv4']['mask'] }}"
        v6netmasklen: 48
        v6persistmasklen: 48
        persistencebackup: true
        timeout: 180

      vars:
        dnsprofilename: dns_profile
        tcpprofilename: tcp_profile
        httpprofilename: http_profile

        appflowlog: "{{ [True, False] | random }}"
        authentication: "{{ [True, False] | random }}"
        authenticationhost: "{{ ['host1', 'host2', 'host3'] | random }}"
        authn401: "{{ [True, False] | random }}"
        authnvsname: "{{ ['authn_vserver1', 'authn_vserver2'] | random }}"
        backuplbmethod: "{{ ['ROUNDROBIN', 'LEASTCONNECTION'] | random }}"
        bypassaaaa: "{{ [True, False] | random }}"
        cacheable: "{{ [True, False] | random }}"
        connfailover: "{{ ['DISABLED', 'STATEFAIL'] | random }}"
        cookiename: "{{ ['cookie1', 'cookie2'] | random }}"
        datalength: "{{ 1 | random }}"
        dataoffset: "{{ 0 | random }}"
        dbprofilename: "{{ ['db_profile1', 'db_profile2', 'db_profile3'] | random }}"
        dbslb: "{{ ['DATABASE', 'FTP'] | random }}"
        disabled: "{{ [True, False] | random }}"
        disableprimaryondown: "{{ [True, False] | random }}"
        dns64: "{{ [True, False] | random }}"
        downstateflush: "{{ [True, False] | random }}"
        hashlength: "{{ 1 | random }}"
        healththreshold: "{{ 10 | random }}"
        icmpvsrresponse: "{{ ['PASSIVE', 'ACTIVE'] | random }}"
        insertvserveripport: "{{ [True, False] | random }}"
        l2conn: "{{ [True, False] | random }}"
        listenpolicy: "{{ ['listen_policy1', 'listen_policy2'] | random }}"
        listenpriority: "{{ 10 | random }}"
        m: "{{ ['255.255.255.0', '255.255.0.0', '255.0.0.0'] | random }}"
        macmoderetainvlan: "{{ [True, False] | random }}"
        maxautoscalemembers: "{{ 10 | random }}"
        minautoscalemembers: "{{ 1 | random }}"
        mssqlserverversion: "{{ ['2008', '2012', '2016'] | random }}"
        mysqlcharacterset: "{{ ['latin1', 'utf8'] | random }}"
        mysqlprotocolversion: "{{ ['10.0', '10.1', '10.2'] | random }}"
        mysqlservercapabilities: "{{ ['cap1', 'cap2'] | random }}"
        mysqlserverversion: "{{ ['5.6', '5.7', '8.0'] | random }}"
        netmask: "{{ hostvars['localhost']['ansible_default_ipv4']['mask'] }}"
        netprofile: "{{ ['net_profile1', 'net_profile2'] | random }}"
        newservicerequest: "{{ ['ENABLED', 'DISABLED'] | random }}"
        newservicerequestincrementinterval: "{{ 10 | random }}"
        newservicerequestunit: "{{ ['MINUTE', 'HOUR'] | random }}"
        oracleserverversion: "{{ ['10g', '11g', '12c'] | random }}"
        persistavpno: "{{ 10 | random }}"
        persistencetype: "{{ ['SOURCEIP', 'RULE', 'URLPASSIVE'] | random }}"
        persistmask: "{{ hostvars['localhost']['ansible_default_ipv4']['mask'] }}"
        processlocal: "{{ [True, False] | random }}"
        push: "{{ ['ENABLED', 'DISABLED'] | random }}"
        pushlabel: "{{ ['label1', 'label2', 'label3'] | random }}"
        pushmulticlients: "{{ [True, False] | random }}"
        pushvserver: "{{ ['vserver1', 'vserver2', 'vserver3'] | random }}"
        range: "{{ ['range1', 'range2'] | random }}"
        recursionavailable: "{{ [True, False] | random }}"
        redirectportrewrite: "{{ [True, False] | random }}"
        redirurl: "{{ ['url1', 'url2'] | random }}"
        resrule: "{{ ['rule1', 'rule2'] | random }}"
        rhistate: "{{ ['PASSIVE', 'ACTIVE'] | random }}"
        rtspnat: "{{ [True, False] | random }}"
        save_config: "{{ [True, False] | random }}"
        servicebindings: "{{ ['service_bind1', 'service_bind2'] | random }}"
        servicegroupbindings: "{{ ['sg_bind1', 'sg_bind2'] | random }}"
        sessionless: "{{ [True, False] | random }}"
        skippersistency: "{{ [True, False] | random }}"
        sobackupaction: "{{ ['DROP', 'ACCEPT'] | random }}"
        somethod: "{{ ['NONE', 'FIXEDWEIGHT'] | random }}"
        sopersistence: "{{ [True, False] | random }}"
        sopersistencetimeout: "{{ 180 | random }}"
        sothreshold: "{{ 10 | random }}"
        ssl_certkey: "{{ ['cert1', 'cert2'] | random }}"
        state: present
        tcpprofilename: "{{ ['tcp_prof1', 'tcp_prof2'] | random }}"
        td: 0
        timeout: "{{ 180 | random }}"
        tosid: "{{ 0 | random }}"
        v6netmasklen: "{{ 48 | random }}"
        v6persistmasklen: "{{ 48 | random }}"
        vipheader: "{{ ['header1', 'header2'] | random }}"

      register: result

    - debug:
        var: result