- name: Collect facts from the EdgeSwitch device
  hosts: switches
  gather_facts: false

  vars:
    subnet: "10.1.1.0"
    gateway: "10.1.1.254"

  tasks:
    - name: Generate random IP address for the device
      set_fact:
        random_ip: "{{ subnet.split('.')[:-1] + [subnet.split('.')[-1]|int + (4 * inventory_hostname|int)]|join('.') }}"

    - name: Gather EdgeSwitch facts
      community.network.edgeswitch_facts:
        gather_subset: None
        host: "{{ random_ip }}"
        username: "admin"
        password: "password"