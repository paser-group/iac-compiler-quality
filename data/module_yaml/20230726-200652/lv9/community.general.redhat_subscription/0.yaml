---
- name: Manage RHSM Subscriptions
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ '10.1.1.' ~ (1 + random(254)) }}"

    - name: Register a system
      community.general.redhat_subscription:
        username: my_username
        password: my_password
        server_hostname: "{{ random_ip }}"
        state: present
      register: registration_result

    - name: Print registration result
      debug:
        var: registration_result