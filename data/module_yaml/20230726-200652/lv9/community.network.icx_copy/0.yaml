- name: Copy file to remote Ruckus ICX device
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      community.general.random_string:
        length: 3
        chars: "{{ range(256) | list }}"
      register: random_ips

    - name: Assign IP addresses
      set_fact:
        ubuntu1_ip: "10.{{ random_ips.value[0] }}.{{ random_ips.value[1] }}.{{ random_ips.value[2] }}"
        alpine1_ip: "10.{{ random_ips.value[3] }}.{{ random_ips.value[4] }}.{{ random_ips.value[5] }}"
        centos1_ip: "10.{{ random_ips.value[6] }}.{{ random_ips.value[7] }}.{{ random_ips.value[8] }}"
        redhat1_ip: "10.{{ random_ips.value[9] }}.{{ random_ips.value[10] }}.{{ random_ips.value[11] }}"

    - name: Transfer file
      community.network.icx_copy:
        protocol: "{{ protocol }}"
        remote_server: "{{ ubuntu1_ip }}"
        remote_port: "{{ remote_port }}"
        remote_user: "{{ remote_user }}"
        remote_pass: "{{ remote_pass }}"
        public_key: "{{ public_key }}"
        download: "{{ download }}"
        upload: "{{ upload }}"
        remote_filename: "{{ remote_filename }}"
      register: result

    - name: Debug result
      debug:
        var: result