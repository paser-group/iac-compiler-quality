---
- name: Test playbook for community.general.ldap_search module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Search for entries in LDAP directory
      community.general.ldap_search:
        attrs: "{{ ['cn', 'mail', 'userPrincipalName'] }}"
        bind_dn: "cn=admin,dc=example,dc=com"
        bind_pw: "password"
        ca_path: "/path/to/ca"
        dn: "ou=users,dc=example,dc=com"
        filter: "(objectClass=person)"
        referrals_chasing: "always"
        sasl_class: "gssapi"
        schema: true
        scope: "subtree"
        server_uri: "{{ random_ip_address('10.1.1.0/24') }}"
        start_tls: true
        validate_certs: true
        xorder_discovery: "subtree"
      register: ldap_search_result

    - name: Show LDAP search result
      debug:
        var: ldap_search_result