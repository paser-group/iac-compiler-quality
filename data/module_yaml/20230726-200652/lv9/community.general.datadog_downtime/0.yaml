---
- name: Test playbook for Ansible latent type-related bug exploration
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create random IP addresses for the inventory hosts
      ansible.builtin.set_fact:
        random_ip_addresses: "{{ ['10.1.1.1', '10.1.1.2', '10.1.1.3', '10.1.1.4'] }}"

    - name: Print random IP addresses
      debug:
        var: random_ip_addresses

    - name: Set the random IP addresses for the inventory hosts
      ansible.builtin.set_fact:
        inventory_hosts:
          ubuntu1: "{{ random_ip_addresses[0] }}"
          alpine1: "{{ random_ip_addresses[1] }}"
          centos1: "{{ random_ip_addresses[2] }}"
          redhat1: "{{ random_ip_addresses[3] }}"

    - name: Print inventory hosts with IP addresses
      debug:
        var: inventory_hosts

    - name: Perform the test
      community.general.datadog_downtime:
        api_host: "{{ random_ip_addresses[0] }}"
        api_key: "{{ random_ip_addresses[1] }}"
        app_key: "{{ random_ip_addresses[2] }}"
        downtime_message: "{{ random_ip_addresses[3] }}"
        end: "{{ random_ip_addresses[0] }}"
        id: "{{ random_ip_addresses[1] }}"
        monitor_id: "{{ random_ip_addresses[2] }}"
        monitor_tags: ["{{ random_ip_addresses[3] }}"]
        rrule: "{{ random_ip_addresses[0] }}"
        scope: ["{{ random_ip_addresses[1] }}"]
        start: "{{ random_ip_addresses[2] }}"
        state: "absent"
        timezone: "{{ random_ip_addresses[3] }}"

      ignore_errors: true