- name: Test playbook for community.network.pn_fabric_local module
  hosts: localhost
  gather_facts: false

  vars:
    pn_cliswitch: "switch1"
    pn_vlan: "100"

  tasks:
    - name: Set random IP addresses for fabric networks
      ansible.builtin.set_fact:
        pn_control_network: "{{ '10.1.1.' ~ (1..254 | random) }}/24"
        pn_fabric_advertisement_network: "{{ '10.1.2.' ~ (1..254 | random) }}/24"
        pn_fabric_network: "{{ '10.1.3.' ~ (1..254 | random) }}/24"

    - name: Print fabric network IP addresses
      debug:
        var:
          pn_control_network
          pn_fabric_advertisement_network
          pn_fabric_network

    - name: Configure pn_fabric_local module with random IP addresses
      community.network.pn_fabric_local:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_vlan: "{{ pn_vlan }}"
        pn_control_network: "{{ pn_control_network }}"
        pn_fabric_advertisement_network: "{{ pn_fabric_advertisement_network }}"
        pn_fabric_network: "{{ pn_fabric_network }}"
        state: present
      register: result

    - name: Display module result
      debug:
        var: result