---
- name: Test Rackspace Monitoring Alarm
  hosts: localhost
  gather_facts: false

  vars:
    api_key: "YOUR_RACKSPACE_API_KEY"
    auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
    username: "YOUR_RACKSPACE_USERNAME"
    entity_id: "YOUR_RACKSPACE_ENTITY_ID"
    region: "YOUR_RACKSPACE_REGION"
    metadata:
      key: "value"

  tasks:
    - name: Create Rackspace Monitoring Alarm
      community.general.rax_mon_alarm:
        api_key: "{{ api_key }}"
        auth_endpoint: "{{ auth_endpoint }}"
        username: "{{ username }}"
        entity_id: "{{ entity_id }}"
        region: "{{ region }}"
        metadata: "{{ metadata }}"
        criteria: "Your monitoring criteria"
      register: alarm_created

    - name: Debug Alarm Creation Output
      debug:
        var: alarm_created

    - name: Delete Rackspace Monitoring Alarm
      community.general.rax_mon_alarm:
        api_key: "{{ api_key }}"
        auth_endpoint: "{{ auth_endpoint }}"
        username: "{{ username }}"
        entity_id: "{{ entity_id }}"
        state: "absent"
      register: alarm_deleted

    - name: Debug Alarm Deletion Output
      debug:
        var: alarm_deleted