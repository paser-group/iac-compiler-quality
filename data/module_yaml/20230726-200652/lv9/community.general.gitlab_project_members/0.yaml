---
- name: Test playbook for gitlab_project_members module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create temporary GitLab API user
      community.general.gitlab_user:
        api_url: "{{ gitlab_api_url }}"
        api_username: "{{ gitlab_api_username }}"
        api_password: "{{ gitlab_api_password }}"
        email: testuser@example.com
        password: testpassword
        state: present
      register: temp_user
      delegate_to: localhost

    - name: Add project members
      community.general.gitlab_project_members:
        api_url: "{{ gitlab_api_url }}"
        api_token: "{{ gitlab_api_token }}"
        project: "{{ gitlab_project }}"
        gitlab_user: "{{ gitlab_project_members }}"
        state: present
        purge_users: "{{ gitlab_purge_users }}"
        access_level: "invalid_level"