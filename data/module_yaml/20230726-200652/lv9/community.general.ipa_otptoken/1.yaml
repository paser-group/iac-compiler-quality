---

- name: Test playbook for community.general.ipa_otptoken
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ '%d.%d.%d.%d' | format(omit[0].step|int(random_range[0]|random, random_range[1]|random), omit[1].step|int(random_range[2]|random, random_range[3]|random), omit[2].step|int(random_range[4]|random, random_range[5]|random), omit[3].step|int(random_range[6]|random, random_range[7]|random)) }}"
        
    - name: Create an OTP token
      community.general.ipa_otptoken:
        ipa_host: "{{ random_ip }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        state: present
        uniqueid: "{{ uniqueid }}"
        description: "{{ description }}"
        digits: "{{ digits }}"
        otptype: "{{ otptype }}"
        notbefore: "{{ notbefore }}"
        notafter: "{{ notafter }}"
        interval: "{{ interval }}"
        counter: "{{ counter }}"
        offset: "{{ offset }}"
        secretkey: "{{ secretkey }}"
        validate_certs: "{{ validate_certs }}"
      register: result