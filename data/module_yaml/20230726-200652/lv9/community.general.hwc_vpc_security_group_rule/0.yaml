---
- name: Test playbook for 'community.general.hwc_vpc_security_group_rule' module
  hosts: localhost
  gather_facts: false

  vars:
    network_nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distribution: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distribution: alpine
      - name: centos1
        ip: 10.1.1.3
        distribution: centos
      - name: redhat1
        ip: 10.1.1.4
        distribution: redhat

  tasks:
    - name: Create VPC/SecurityGroup Rule
      community.general.hwc_vpc_security_group_rule:
        description: "Test Security Group Rule"
        direction: "{{ direction }}"
        domain: "default"
        ethertype: "IPv4"
        id: "test-rule-id"
        identity_endpoint: "http://identity-endpoint.com"
        password: "password123"
        port_range_max: "{{ port_range_max }}"
        port_range_min: "{{ port_range_min }}"
        project: "test-project"
        protocol: "tcp"
        region: "test-region"
        remote_group_id: "remote-group-id"
        remote_ip_prefix: "{{ remote_ip_prefix }}"
        security_group_id: "security-group-id"
        state: "present"
        user: "test-user"
      vars:
        direction: "{{ ['ingress', 'egress'] | random }}"
        port_range_max: "{{ range(1, 65535) | random }}"
        port_range_min: "{{ range(1, 65535) | random }}"
        remote_ip_prefix: "{{ network_nodes | random | ip_address(network_nodes) }}"