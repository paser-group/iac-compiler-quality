---
- name: Send email using SendGrid
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ 10 + (ansible_play_hosts.index(inventory_hostname) + 1) }}.1.1.{{ 1 + (ansible_play_hosts.index(inventory_hostname) + 1) }}"

    - name: Send email
      community.general.sendgrid:
        api_key: "{{ sendgrid_api_key }}"
        from_address: "{{ random_ip }}"
        to_addresses:
          - "recipient@example.com"
        subject: "Test email from Ansible"
        body: "This is a test email sent using Ansible"

      register: result

    - name: Display result
      debug:
        var: result