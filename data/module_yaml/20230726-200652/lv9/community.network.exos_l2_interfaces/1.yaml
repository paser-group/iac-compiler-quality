- name: Generate Random IP Address
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate Random IP Address
      set_fact:
        random_ip: "{{ '10.{0}.{1}.0' | format(
            (1, 254) | random | int,
            (1, 254) | random | int
          ) }}"

- name: Manage L2 Interfaces on Extreme Switches
  hosts: switches
  gather_facts: false

  vars:
    interfaces:
      - name: Ethernet1
        state: present
        vlan: 100
        ipv4: "{{ random_ip }}"
      - name: Ethernet2
        state: absent

  tasks:
    - name: Configure L2 Interfaces
      community.network.exos_l2_interfaces:
        config: "{{ interfaces }}"
        state: "{{ item.state }}"
        ipv4: "{{ item.ipv4 }}"
      loop: "{{ interfaces }}"