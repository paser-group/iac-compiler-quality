---
- name: Test playbook for community.network.avi_backup module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      ansible.builtin.set_fact:
        random_ips:
          - "{{ ('10.1.1.' + (1..254)|random|int) }}"
          - "{{ ('192.168.0.' + (1..254)|random|int) }}"
          - "{{ ('172.16.0.' + (1..254)|random|int) }}"
          - "{{ ('10.0.0.' + (1..254)|random|int) }}"

    - name: Debug random IP addresses
      debug:
        var: random_ips

    - name: Backup Avi configuration
      community.network.avi_backup:
        controller: "{{ avi_controller }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "{{ avi_tenant }}"
        api_version: "{{ avi_api_version }}"
        api_context:
          tenant_uuid: "{{ avi_tenant_uuid }}"
        state: "absent"
        scheduler_ref: "{{ avi_scheduler_ref }}"
        backup_config_ref: "{{ avi_backup_config_ref }}"
        local_file_url: "{{ avi_local_file_url }}"
        timestamp: "{{ avi_timestamp }}"
      register: avi_backup_result

    - name: Debug Avi backup result
      debug:
        var: avi_backup_result