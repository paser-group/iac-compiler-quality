---
- name: Test playbook for 'community.network.nos_config' module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Generate random IP addresses
      set_fact:
        ip_addresses: "{{ item }}"
      loop: "{{ range(1, 5) | map('string', '10.1.1.') | list }}"
    
    - name: Configure network devices
      community.network.nos_config:
        after: null
        backup: true
        backup_options:
          dir: /backup
          num_to_keep: 5
        before: null
        diff_against: null
        diff_ignore_lines: null
        intended_config: null
        lines: null
        match: null
        multiline_delimiter: null
        parents: null
        replace: null
        running_config: null
        src: "{{ playbook_dir }}/config.txt"
      vars:
        ansible_python_interpreter: /usr/bin/python3
        ip_address: "{{ ip_addresses[loop.index-1] }}"

    - name: Print result
      debug:
        var: backup_files