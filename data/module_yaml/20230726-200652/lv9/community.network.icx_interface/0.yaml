---
- name: Manage ICX Interfaces
  hosts: switches

  tasks:
    - name: Configure ICX Interfaces
      community.network.icx_interface:
        aggregate:
          - { name: "{{ item.name }}", description: "{{ item.description }}", enabled: "{{ item.enabled }}", state: "{{ item.state }}", rx_rate: "{{ item.rx_rate }}", tx_rate: "{{ item.tx_rate }}", speed: "{{ item.speed }}", power: "{{ item.power }}", stp: "{{ item.stp }}", check_running_config: "{{ item.check_running_config }}", neighbors: "{{ item.neighbors }}" }
        delay: "{{ item.delay }}"
      vars:
        interfaces:
          - name: interface1
            description: "Interface 1"
            enabled: true
            state: up
            rx_rate: 1000Mbps
            tx_rate: 1000Mbps
            speed: auto
            power: {"consumption": "100W", "type": "poe"}
            stp: true
            check_running_config: true
            neighbors: []

          - name: interface2
            description: "Interface 2"
            enabled: false
            state: down
            rx_rate: 100Mbps
            tx_rate: 100Mbps
            speed: 100Mbps
            power: {"consumption": "50W", "type": "non-poe"}
            stp: false
            check_running_config: false
            neighbors:
              - "10.1.1.1"
              - "10.1.1.3"

      loop: "{{ interfaces }}"
      loop_control:
        loop_var: item