---
- name: Test playbook for community.network.avi_serverautoscalepolicy module
  hosts: localhost
  gather_facts: false
  
  vars:
    controller: "https://{{ hostvars['localhost']['avi_controller_ip'] }}"
    avi_credentials:
      username: "{{ hostvars['localhost']['avi_username'] }}"
      password: "{{ hostvars['localhost']['avi_password'] }}"
    tenant: "admin"
    api_version: "20.1.1"
    intelligent_autoscale: true
    use_predicted_load: false
    max_size: 5
    min_size: 1
  
  tasks:
    - name: Set random IP address for network module
      set_fact:
        random_ip: "{{ (225, 0, 0, 0) | random_ip }}"
  
    - name: Create ServerAutoScalePolicy
      community.network.avi_serverautoscalepolicy:
        controller: "{{ controller }}"
        avi_credentials: "{{ avi_credentials }}"
        tenant: "{{ tenant }}"
        api_version: "{{ api_version }}"
        intelligent_autoscale: "{{ intelligent_autoscale }}"
        use_predicted_load: "{{ use_predicted_load }}"
        max_size: "{{ max_size }}"
        min_size: "{{ min_size }}"
        name: "TestPolicy"
        description: "Test Policy"
        tenant_uuid: "admin"
        url: "/api/serverautoscalepolicy"
      register: policy_result
   
    - name: Print ServerAutoScalePolicy result
      debug:
        var: policy_result