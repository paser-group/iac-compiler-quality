---
- name: Test Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: False
  
  tasks:
    - name: Initialize variables
      set_fact:
        node_ips:
          - '10.1.1.1'
          - '10.1.1.2'
          - '10.1.1.3'
          - '10.1.1.4'
        node_names:
          - 'ubuntu1'
          - 'alpine1'
          - 'centos1'
          - 'redhat1'
        subnet: 10.1.1.0/24
        gateway: 10.1.1.254
        
    - name: Generate inventory file
      copy:
        content: |
          [nodes]
          {{ node_names[0] }} ansible_host={{ node_ips[0] }}
          {{ node_names[1] }} ansible_host={{ node_ips[1] }}
          {{ node_names[2] }} ansible_host={{ node_ips[2] }}
          {{ node_names[3] }} ansible_host={{ node_ips[3] }}
          
          [node-net]
          {{ node_names[0] }} ip={{ node_ips[0] }} gateway={{ gateway }} subnet={{ subnet }}
          {{ node_names[1] }} ip={{ node_ips[1] }} gateway={{ gateway }} subnet={{ subnet }}
          {{ node_names[2] }} ip={{ node_ips[2] }} gateway={{ gateway }} subnet={{ subnet }}
          {{ node_names[3] }} ip={{ node_ips[3] }} gateway={{ gateway }} subnet={{ subnet }}
          
          [nodes:vars]
          ansible_user=my_user
          ansible_password=my_password
      dest: inventory.ini
      
    - name: Test enos_command module
      vars:
        command_string: 'echo "Test command"'
      community.network.enos_command:
        authorize: "{{ ['True', 'False'] | random }}"
        commands: "{{ command_string }}"
        interval: "{{ ['1', '2', '3', '4', '5'] | random }}"
        match: "{{ ['None', 'prompt', 'all'] | random }}"
        retries: "{{ ['1', '2', '3', '4'] | random }}"
        wait_for: "{{ ['None', 'prompt', 'all'] | random }}"
      with_items:
        - "{{ node_names }}"