- name: Configure static route with BFD
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      set_fact:
        src_ip: "{{ lookup('community.general.ipify', provider='ipv4') }}"
        dest_ip: "{{ lookup('community.general.random_ipv4', network='10.0.0.0/24') }}"

    - name: Print generated IP addresses
      debug:
        var:
          src_ip
          dest_ip

    - name: Configure static route with BFD
      community.network.ce_static_route_bfd:
        aftype: "{{ ['ipv4', 'ipv6'] | random }}"
        bfd_session_name: sample-bfd-session
        commands:
          - ip static-route {{ dest_ip }} {{ mask | default('255.255.255.0') }} {{ next_hop | default('10.1.1.1') }} bfd-session {{ bfd_session_name }}"
        description: "Static route for testing"
        detect_multiplier: "{{ [3, 5, 10] | random }}"
        function_flag: "{{ ['ipsla_syn', 'no_ipsla_syn'] | random }}"
        min_rx_interval: "{{ [100, 200, 300] | random }}"
        min_tx_interval: "{{ [50, 100, 150] | random }}"
        next_hop: "{{ ['10.1.1.1', '10.1.1.2', '10.1.1.3'] | random }}"
        nhp_interface: "{{ ['GigabitEthernet1/0/1', 'Loopback0'] | random }}"
        pref: "{{ [10, 20, 30] | random }}"
        prefix: "{{ ['10.0.0.0', '192.168.1.0', '172.16.0.0'] | random }}"
        state: present
        tag: "{{ [100, 200, 300] | random }}"
        vrf: "{{ ['VRF1', 'VRF2'] | random }}"