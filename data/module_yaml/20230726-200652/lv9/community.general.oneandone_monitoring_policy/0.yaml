---
- name: Ansible Latent Type-Related Bug Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure OneAndOne Monitoring Policy
      community.general.oneandone_monitoring_policy:
        api_url: "https://api.example.com"  # Replace with the actual API URL
        auth_token: "YOUR_AUTH_TOKEN"  # Replace with the actual authentication token
        name: "{{ item.name }}"
        monitoring_policy: "{{ item.policy }}"
        email: "{{ item.email }}"
        add_servers: "{{ item.servers }}"
        add_ports: "{{ item.ports }}"
        add_processes: "{{ item.processes }}"
        remove_servers: "{{ item.remove_servers }}"
        remove_ports: "{{ item.remove_ports }}"
        remove_processes: "{{ item.remove_processes }}"
        update_ports: "{{ item.update_ports }}"
        update_processes: "{{ item.update_processes }}"
        thresholds: "{{ item.thresholds }}"
        agent: "{{ item.agent }}"
        description: "{{ item.description }}"
        state: present
        wait: "{{ item.wait }}"
        wait_interval: "{{ item.wait_interval }}"
        wait_timeout: "{{ item.wait_timeout }}"
      loop:
        - name: Test Case 1
          policy: 'policy1'
          email: 'test1@example.com'
          servers:
            - ubuntu1
            - alpine1
          ports:
            - port: 80
              alert_if: 'HIGH'
          processes:
            - process: nginx
              alert_if: 'LOW'
          remove_servers:
            - centos1
            - redhat1
          remove_ports:
            - port: 443
              alert_if: 'HIGH'
          remove_processes:
            - process: apache
              alert_if: 'LOW'
          update_ports:
            - port: 22
              alert_if: 'LOW'
          update_processes:
            - process: mysql
              alert_if: 'MEDIUM'
          thresholds:
            - type: CPU
              alert_if: 'CRITICAL'
              warning: 90
              critical: 95
          agent: 'default'
          description: 'Test Case 1 Description'
          wait: true
          wait_interval: 5
          wait_timeout: 60
        
        - name: Test Case 2
          policy: 'policy2'
          email: 'test2@example.com'
          servers:
            - ubuntu1
            - centos1
            - redhat1
          ports:
            - port: 8080
              alert_if: 'LOW'
          processes:
            - process: apache
              alert_if: 'HIGH'
          remove_servers: []
          remove_ports: []
          remove_processes: []
          update_ports: []
          update_processes: []
          thresholds:
            - type: Memory
              alert_if: 'MEDIUM'
              warning: 80
              critical: 85
          agent: 'custom_agent'
          description: 'Test Case 2 Description'
          wait: false
          wait_interval: 0
          wait_timeout: 0