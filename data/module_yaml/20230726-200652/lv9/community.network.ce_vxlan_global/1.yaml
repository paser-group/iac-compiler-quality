- name: Manage VXLAN and bridge domain global attributes
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      ansible.builtin.set_fact:
        bridge_domain_id: "{{ item }}"
        nvo3_acl_extend: "{{ item }}"
        nvo3_ecmp_hash: "{{ item }}"
        nvo3_eth_trunk_hash: "{{ item }}"
        nvo3_gw_enhanced: "{{ item }}"
        nvo3_prevent_loops: "{{ item }}"
        nvo3_service_extend: "{{ item }}"
        state: "{{ item }}"
        tunnel_mode_vxlan: "{{ item }}"
      with_items:
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"
        - "{{ rand_ip() }}"

    - name: Configure VXLAN and bridge domain
      community.network.ce_vxlan_global:
        bridge_domain_id: "{{ bridge_domain_id }}"
        nvo3_acl_extend: "{{ nvo3_acl_extend }}"
        nvo3_ecmp_hash: "{{ nvo3_ecmp_hash }}"
        nvo3_eth_trunk_hash: "{{ nvo3_eth_trunk_hash }}"
        nvo3_gw_enhanced: "{{ nvo3_gw_enhanced }}"
        nvo3_prevent_loops: "{{ nvo3_prevent_loops }}"
        nvo3_service_extend: "{{ nvo3_service_extend }}"
        state: "{{ state }}"
        tunnel_mode_vxlan: "{{ tunnel_mode_vxlan }}"