---
- name: Test playbook for community.general.scaleway_compute module
  hosts: localhost
  gather_facts: false

  vars:
    api_token: "your_scaleway_api_token"
    api_url: "https://api.scaleway.com"
    organization: "your_organization"
    project: "your_project"
    region: "your_region"

  tasks:
    - name: Create Scaleway compute instance
      community.general.scaleway_compute:
        state: present
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        organization: "{{ organization }}"
        project: "{{ project }}"
        region: "{{ region }}"
        name: "test-instance"
        commercial_type: "DEV1-S"
        image: "ubuntu"
        security_group: "default"
        wait: true
      register: result_create

    - name: Debug result of Scaleway compute instance creation
      debug:
        var: result_create

    - name: Update Scaleway compute instance tags
      community.general.scaleway_compute:
        state: present
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        organization: "{{ organization }}"
        project: "{{ project }}"
        region: "{{ region }}"
        name: "test-instance"
        tags:
          - "tag1"
          - "tag2"
      register: result_update_tags

    - name: Debug result of Scaleway compute instance tags update
      debug:
        var: result_update_tags

    - name: Delete Scaleway compute instance
      community.general.scaleway_compute:
        state: absent
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        organization: "{{ organization }}"
        project: "{{ project }}"
        region: "{{ region }}"
        name: "test-instance"
      register: result_delete

    - name: Debug result of Scaleway compute instance deletion
      debug:
        var: result_delete