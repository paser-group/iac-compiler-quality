---
- name: Install Elasticsearch plugins
  hosts: localhost
  gather_facts: false

  vars:
    plugins:
      - name: plugin1
        src: "{{ random_ip_address() }}/path/to/plugin1.zip"
      - name: plugin2
        src: "{{ random_ip_address() }}/path/to/plugin2.zip"
      - name: plugin3
        src: "{{ random_ip_address() }}/path/to/plugin3.zip"

  tasks:
    - name: Install Elasticsearch plugins with random IP address
      community.general.elasticsearch_plugin:
        name: "{{ item.name }}"
        src: "{{ item.src }}"
        state: present
      loop: "{{ plugins }}"

  # Random IP address generation function
  tasks:
    - name: Generate random IP address octet
      set_fact:
        random_octet: "{{ range(4) | map('random') | list }}"

    - name: Join IP address octets
      set_fact:
        random_ip: "{{ random_octet | join('.') }}"

    - name: Debug random IP address
      debug:
        msg: "{{ random_ip }}"