---
- name: Test pn_cpu_mgmt_class module
  hosts: all
  gather_facts: False

  vars:
    pn_burst_size: "{{ ['100', '200', '300'] | random }}"
    pn_cliswitch: "{{ ['on', 'off'] | random }}"
    pn_name: "PN{{ ansible_hostname[-1] }}"
    pn_rate_limit: "5"

  tasks:
    - name: Install the community.network collection
      community.general.collection:
        name: community.network

    - name: Configure pn_cpu_mgmt_class module
      community.network.pn_cpu_mgmt_class:
        pn_burst_size: "{{ pn_burst_size }}"
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_name: "{{ pn_name }}"
        pn_rate_limit: "{{ pn_rate_limit }}"
        state: "{{ ['present', 'absent'] | random }}"
      register: pn_cpu_mgmt_class_output

    - name: Debug pn_cpu_mgmt_class module output
      debug:
        var: pn_cpu_mgmt_class_output

    - name: Verify pn_cpu_mgmt_class module output
      assert:
        that:
          - pn_cpu_mgmt_class_output is success