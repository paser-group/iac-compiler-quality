---
- name: Test Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create inventory file
      file:
        path: inventory.ini
        state: touch

    - name: Add nodes to inventory
      lineinfile:
        path: inventory.ini
        line: "{{ item.key }} ansible_host={{ item.value }}"
      loop:
        - { key: 'ubuntu1', value: '10.1.1.1' }
        - { key: 'alpine1', value: '10.1.1.2' }
        - { key: 'centos1', value: '10.1.1.3' }
        - { key: 'redhat1', value: '10.1.1.4' }

    - name: Upgrade nodes
      sysupgrade:
        hosts: nodes
        fetch_only: "{{ random_boolean() }}"
        force: "{{ random_boolean() }}"
        installurl: "{{ random_install_url() }}"
        keep_files: "{{ random_boolean() }}"
        snapshot: "{{ random_boolean() }}"
      register: result

    - name: Debug result
      debug:
        var: result

  vars_files:
    - vars.yml

  vars:
    node_subnet: "10.1.1.0/24"
    node_gateway: "10.1.1.254"

  tasks:
    - name: Generate random boolean
      set_fact:
        random_boolean: "{{ ['true', 'false'] | random }}"

    - name: Generate random install URL
      set_fact:
        random_install_url: "{{ ['http://example.com', 'https://example.org', 'ftp://example.net'] | random }}"