---
- name: Test playbook for community.general.pagerduty module
  hosts: localhost
  gather_facts: false

  vars:
    test_desc: "Test Incident"
    test_hours: "1"
    test_minutes: "30"
    test_name: "John Doe"
    test_user: "example_user"
    test_token: "example_token"
    test_service:
      - "Service1"
      - "Service2"
    test_state: "present"
    test_window_id: "window_id"
    test_validate_certs: false

    # Heuristic: Formulate random IP addresses for recently introduced networking modules
    ip_addresses:
      - "{{ hostvars['ubuntu1']['ansible_default_ipv4']['address'] }}"
      - "{{ hostvars['alpine1']['ansible_default_ipv4']['address'] }}"
      - "{{ hostvars['centos1']['ansible_default_ipv4']['address'] }}"
      - "{{ hostvars['redhat1']['ansible_default_ipv4']['address'] }}"

  tasks:
    - name: Create PagerDuty incident with random IP addresses
      community.general.pagerduty:
        desc: "{{ test_desc }}"
        hours: "{{ test_hours }}"
        minutes: "{{ test_minutes }}"
        name: "{{ test_name }}"
        requester_id: "ansible_tester"
        service: "{{ test_service }}"
        state: "{{ test_state }}"
        token: "{{ test_token }}"
        user: "{{ test_user }}"
        validate_certs: "{{ test_validate_certs }}"
        window_id: "{{ test_window_id }}"
        ip_addresses: "{{ ip_addresses }}"