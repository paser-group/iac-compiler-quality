---
- name: Test alerta_customer module with random IP addresses
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random IP addresses
      set_fact:
        alerta_url: "http://{{ lookup('network', 'random', network='10.1.1.0/24') }}:{{ lookup('network', 'random', network='1025-65535/tcp') }}"
        api_key: "{{ lookup('password', chars=ascii_letters_digit, length=32) }}"
        api_password: "{{ lookup('password', chars=ascii_letters_digit, length=32) }}"
        api_username: "{{ lookup('password', chars=ascii_letters_digit, length=8) }}"
        customer: "{{ lookup('password', chars=ascii_uppercase, length=10) }}"
        match: "{{ lookup('password', chars=ascii_letters, length=8) }}"
        state: present

    - name: Print random IP addresses
      debug:
        var:
          alerta_url
          api_key
          api_password
          api_username
          customer
          match
          state

    - name: Test alerta_customer module
      community.general.alerta_customer:
        alerta_url: "{{ alerta_url }}"
        api_key: "{{ api_key }}"
        api_password: "{{ api_password }}"
        api_username: "{{ api_username }}"
        customer: "{{ customer }}"
        match: "{{ match }}"
        state: "{{ state }}"
      register: result

    - name: Print alerta_customer module result
      debug:
        var: result