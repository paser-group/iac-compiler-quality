- name: Test Plan for ansible.builtin.fail module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Fail task with a custom message
      ansible.builtin.fail:
        msg: This is a custom failure message
      
    - name: Fail task with dynamic IP address in the message
      ansible.builtin.fail:
        msg: "Failed with IP address {{ hostvars[item].ansible_default_ipv4.address }}"
      with_items:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      
    - name: Fail task with incorrect IP address
      ansible.builtin.fail:
        msg: "Failed with incorrect IP address"
      when: hostvars['ubuntu1'].ansible_default_ipv4.address != '10.1.1.1'
      
    - name: Fail task with a random IP address
      ansible.builtin.fail:
        msg: "Failed with a random IP address {{ random_ip }}"
      vars:
        random_ip: "{{ ['10.1.1.5', '10.1.1.6', '10.1.1.7'] | random }}"