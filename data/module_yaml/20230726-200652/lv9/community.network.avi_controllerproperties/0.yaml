---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random IP address for allow_ip_forwarding
      set_fact:
        allow_ip_forwarding: "{{ ansible_random_ipv4.network }}/{{ ansible_random_ipv4.prefix }}"

    - name: Set random IP addresses for allow_unauthenticated_apis and allow_unauthenticated_nodes
      set_fact:
        allow_unauthenticated_apis: "{{ ansible_random_ipv4.network }}/{{ ansible_random_ipv4.prefix }}"
        allow_unauthenticated_nodes: "{{ ansible_random_ipv4.network }}/{{ ansible_random_ipv4.prefix }}"

    - name: Set random IP address for api_context
      set_fact:
        api_context: "{{ ansible_random_ipv4.network }}/{{ ansible_random_ipv4.prefix }}"

    - name: Set random values for remaining attributes
      set_fact:
        api_idle_timeout: "{{ 60 | random }}"
        api_perf_logging_threshold: "{{ 1000 | random }}"
        api_version: "{{ ['v1', 'v2', 'v3'] | random }}"
        appviewx_compat_mode: "{{ true if ansible_random_bool else false }}"
        attach_ip_retry_interval: "{{ 1 | random }}"
        attach_ip_retry_limit: "{{ 5 | random }}"
        avi_api_patch_op: "{{ ['add', 'replace', 'remove'] | random }}"
        avi_api_update_method: "{{ ['POST', 'PUT', 'PATCH'] | random }}"
        avi_credentials:
          username: "{{ 'admin' }}"
          password: "{{ 'password' }}"
        avi_disable_session_cache_as_fact: "{{ true if ansible_random_bool else false }}"
        bm_use_ansible: "{{ true if ansible_random_bool else false }}"
        cleanup_expired_authtoken_timeout_period: "{{ 3600 | random }}"
        cleanup_sessions_timeout_period: "{{ 1800 | random }}"
        cloud_reconcile: "{{ true if ansible_random_bool else false }}"
        cluster_ip_gratuitous_arp_period: "{{ 2 | random }}"
        consistency_check_timeout_period: "{{ 120 | random }}"
        controller: "{{ 'controller.example.com' }}"
        crashed_se_reboot: "{{ true if ansible_random_bool else false }}"
        dead_se_detection_timer: "{{ 10 | random }}"
        dns_refresh_period: "{{ 1800 | random }}"
        dummy: "{{ true if ansible_random_bool else false }}"
        enable_api_sharding: "{{ true if ansible_random_bool else false }}"
        enable_memory_balancer: "{{ true if ansible_random_bool else false }}"
        fatal_error_lease_time: "{{ 600 | random }}"
        max_dead_se_in_grp: "{{ 5 | random }}"
        max_pcap_per_tenant: "{{ 10 | random }}"
        max_seq_attach_ip_failures: "{{ 3 | random }}"
        max_seq_vnic_failures: "{{ 2 | random }}"
        password: "{{ 'admin_password' }}"
        persistence_key_rotate_period: "{{ 86400 | random }}"
        portal_token: "{{ 'portal_token' }}"
        process_locked_useraccounts_timeout_period: "{{ 300 | random }}"
        process_pki_profile_timeout_period: "{{ 60 | random }}"
        query_host_fail: "{{ 5 | random }}"
        safenet_hsm_version: "{{ '1.2.3.4' }}"
        se_create_timeout: "{{ 180 | random }}"
        se_failover_attempt_interval: "{{ 15 | random }}"
        se_from_marketplace: "{{ true if ansible_random_bool else false }}"
        se_offline_del: "{{ true if ansible_random_bool else false }}"
        se_vnic_cooldown: "{{ 5 | random }}"
        secure_channel_cleanup_timeout: "{{ 60 | random }}"
        secure_channel_controller_token_timeout: "{{ 30 | random }}"
        secure_channel_se_token_timeout: "{{ 30 | random }}"
        seupgrade_fabric_pool_size: "{{ 20 | random }}"
        seupgrade_segroup_min_dead_timeout: "{{ 300 | random }}"
        ssl_certificate_expiry_warning_days: "{{ 30 | random }}"
        state: "{{ 'present' }}"
        tenant: "{{ 'Default' }}"
        tenant_uuid: "{{ 'abcd-efgh-ijkl' }}"
        unresponsive_se_reboot: "{{ true if ansible_random_bool else false }}"
        upgrade_dns_ttl: "{{ 7200 | random }}"
        upgrade_lease_time: "{{ 3600 | random }}"
        url: "{{ 'https://controller.example.com' }}"
        username: "{{ 'admin' }}"
        uuid: "{{ 'xyz-123' }}"
        vnic_op_fail_time: "{{ 5 | random }}"
        vs_apic_scaleout_timeout: "{{ 300 | random }}"
        vs_awaiting_se_timeout: "{{ 60 | random }}"
        vs_key_rotate_period: "{{ 2592000 | random }}"
        vs_scaleout_ready_check_interval: "{{ 30 | random }}"
        vs_se_attach_ip_fail: "{{ 3 | random }}"
        vs_se_bootup_fail: "{{ true if ansible_random_bool else false }}"
        vs_se_create_fail: "{{ true if ansible_random_bool else false }}"
        vs_se_ping_fail: "{{ 5 | random }}"
        vs_se_vnic_fail: "{{ 2 | random }}"
        vs_se_vnic_ip_fail: "{{ 2 | random }}"
        warmstart_se_reconnect_wait_time: "{{ 30 | random }}"
        warmstart_vs_resync_wait_time: "{{ 60 | random }}"

    - name: Print variables
      debug:
        var: item
      with_items:
        - allow_ip_forwarding
        - allow_unauthenticated_apis
        - allow_unauthenticated_nodes
        - api_context
        - api_idle_timeout
        - api_perf_logging_threshold
        - api_version
        - appviewx_compat_mode
        - attach_ip_retry_interval
        - attach_ip_retry_limit
        - avi_api_patch_op
        - avi_api_update_method
        - avi_credentials
        - avi_disable_session_cache_as_fact
        - bm_use_ansible
        - cleanup_expired_authtoken_timeout_period
        - cleanup_sessions_timeout_period
        - cloud_reconcile
        - cluster_ip_gratuitous_arp_period
        - consistency_check_timeout_period
        - controller
        - crashed_se_reboot
        - dead_se_detection_timer
        - dns_refresh_period
        - dummy
        - enable_api_sharding
        - enable_memory_balancer
        - fatal_error_lease_time
        - max_dead_se_in_grp
        - max_pcap_per_tenant
        - max_seq_attach_ip_failures
        - max_seq_vnic_failures
        - password
        - persistence_key_rotate_period
        - portal_token
        - process_locked_useraccounts_timeout_period
        - process_pki_profile_timeout_period
        - query_host_fail
        - safenet_hsm_version
        - se_create_timeout
        - se_failover_attempt_interval
        - se_from_marketplace
        - se_offline_del
        - se_vnic_cooldown
        - secure_channel_cleanup_timeout
        - secure_channel_controller_token_timeout
        - secure_channel_se_token_timeout
        - seupgrade_fabric_pool_size
        - seupgrade_segroup_min_dead_timeout
        - ssl_certificate_expiry_warning_days
        - state
        - tenant
        - tenant_uuid
        - unresponsive_se_reboot
        - upgrade_dns_ttl
        - upgrade_lease_time
        - url
        - username
        - uuid
        - vnic_op_fail_time
        - vs_apic_scaleout_timeout
        - vs_awaiting_se_timeout
        - vs_key_rotate_period
        - vs_scaleout_ready_check_interval
        - vs_se_attach_ip_fail
        - vs_se_bootup_fail
        - vs_se_create_fail
        - vs_se_ping_fail
        - vs_se_vnic_fail
        - vs_se_vnic_ip_fail
        - warmstart_se_reconnect_wait_time
        - warmstart_vs_resync_wait_time