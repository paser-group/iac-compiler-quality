---
- name: Test playbook for latent type-related bugs in keycloak_realm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Keycloak realm with random IP addresses
      community.general.keycloak_realm:
        state: present
        realm: example_realm
        auth_keycloak_url: "http://{{ hostvars[groups['keycloak'][0]]['ansible_host'] }}:{{ hostvars[groups['keycloak'][0]]['ansible_port'] }}/auth"
        auth_username: admin
        auth_password: admin
        display_name: "Example Realm"
        supported_locales:
          - en_US
          - en_GB
        attributes:
          attr1: "value1"
          attr2: "value2"
        admin_events_enabled: yes
        admin_events_details_enabled: yes
        auth_client_id: example_client
        auth_client_secret: example_secret
        token: "{{ token }}"
        access_token_lifespan: "{{ 3600 * 24 }}"
        access_token_lifespan_for_implicit_flow: "{{ 3600 * 24 }}"
        access_code_lifespan: "{{ 600 }}"
        access_code_lifespan_login: "{{ 600 }}"
        access_code_lifespan_user_action: "{{ 600 }}"
        action_token_generated_by_admin_lifespan: "{{ 3600 }}"
        action_token_generated_by_user_lifespan: "{{ 3600 }}"
        admin_theme: base
        account_theme: keycloak
        email_theme: keycloak
        login_theme: keycloak
        ssl_required: external
        verify_email: yes
        registration_allowed: no
        edit_username_allowed: no
        reset_password_allowed: yes
        remember_me: yes
        login_with_email_allowed: yes
        duplicate_emails_allowed: no
        brute_force_protected: yes
        events_enabled: yes
        events_expiration: "{{ 3600 * 24 * 365 }}"
        events_listeners:
          - update_profile
          - admin_events
        failure_factor: 10
        minimum_quick_login_wait_seconds: 60
        registered: new_realm

    # Additional tasks and tests go here