---
- name: Test playbook for 'community.general.layman' module
  hosts: localhost
  become: true

  tasks:
    - name: Generate random IP address for network module test
      set_fact:
        random_ip_address: "{{ (255 | random + 1) }}.{{ (255 | random + 1) }}.{{ (255 | random + 1) }}.{{ (255 | random + 1) }}"

    - name: Install and configure layman
      community.general.layman:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
        list_url: "{{ item.list_url }}"
        validate_certs: "{{ item.validate_certs }}"
      loop:
        - { name: 'overlay', state: 'present', list_url: 'http://layman.github.io/layman/overlays.xml', validate_certs: false }
        - { name: 'java', state: 'present', list_url: 'https://{{ random_ip_address }}/java/overlays.xml', validate_certs: true }