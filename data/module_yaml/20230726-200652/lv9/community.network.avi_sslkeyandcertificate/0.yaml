---
- name: Test playbook to uncover latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    network_nodes:
      - node_name: ubuntu1
        ip_address: "10.1.1.1"
        distro: "ubuntu"
      - node_name: alpine1
        ip_address: "10.1.1.2"
        distro: "alpine"
      - node_name: centos1
        ip_address: "10.1.1.3"
        distro: "centos"
      - node_name: redhat1
        ip_address: "10.1.1.4"
        distro: "redhat"

  tasks:
    - name: Create SSL key and certificate
      community.network.avi_sslkeyandcertificate:
        controller: "{{ item.ip_address }}"
        username: "admin"
        password: "password"
        tenant: "default"
        name: "ssl-key-and-cert"
        key: "/path/to/key.pem"
        certificate: "/path/to/certificate.pem"
        ca_certs: "/path/to/ca_certs.pem"
        avi_credentials:
          - api_version: "20.1.1"
            username: "admin"
            password: "password"
        avi_disable_session_cache_as_fact: true
        ssl_key_params:
          - key_algorithm: "RSA"
            key_size: 2048
        ssl_certificate_params:
          - certificate_format: "PEM"
            ca_certs_upload: true
            tenant_name: "ssl-tests"
      loop: "{{ network_nodes }}"
      register: result