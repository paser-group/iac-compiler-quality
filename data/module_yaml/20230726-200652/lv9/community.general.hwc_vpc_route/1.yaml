---
- name: Create Vpc/Route resource
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Define random IP address
      set_fact:
        random_ip: "{{ '10.1.1.' + (hostvars[item].inventory_hostname | ipaddr('subnet', '255.255.255.0')) | ipaddr('addr') }}"
      loop: "{{ groups['docker_nodes'] }}"

    - name: Create Vpc/Route resource
      community.general.hwc_vpc_route:
        destination: "{{ random_ip }}"
        domain: "example.com"
        id: "route1"
        identity_endpoint: "https://identity.endpoint"
        next_hop: "10.1.1.254"
        password: "password"
        project: "myproject"
        region: "us-east-1"
        state: "present"
        type: "vpc"
        user: "admin"
        vpc_id: "vpc-12345678"
      register: result

    - name: Debug result
      debug:
        var: result