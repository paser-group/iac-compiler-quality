---
- name: Test playbook for community.network.icx_linkagg module
  hosts: localhost
  gather_facts: false

  vars:
    linkaggs:
      - name: LinkAgg1
        members:
          - IPAddress1
          - IPAddress2
        mode: active
        group: 1
        state: present
      - name: LinkAgg2
        members:
          - IPAddress2
          - IPAddress3
        mode: passive
        group: 2
        state: present

  tasks:
    - name: Create link aggregation groups
      community.network.icx_linkagg:
        aggregate: "{{ item.members }}"
        check_running_config: true
        group: "{{ item.group }}"
        mode: "{{ item.mode }}"
        name: "{{ item.name }}"
        purge: false
        state: "{{ item.state }}"
      loop: "{{ linkaggs }}"