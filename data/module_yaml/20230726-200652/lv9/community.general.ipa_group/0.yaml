---
- name: Test playbook for community.general.ipa_group module
  hosts: localhost
  gather_facts: false

  vars:
    ipa_host: "example_ipa_server"
    ipa_user: "admin"
    ipa_pass: "admin_password"

  tasks:
    - name: Create IPA group with random IP address
      community.general.ipa_group:
        state: present
        cn: "testgroup"
        description: "Test group"
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 30
        validate_certs: false
        group: "{{ ['user1', 'user2'] }}"
        ipa_group_options:
          append: false
          external: true
          external_user:
            - "user3"
          user:
            - "user4"
          gidnumber: "1000"
          nonposix: false

    - name: Create IPA group with another random IP address
      community.general.ipa_group:
        state: present
        cn: "testgroup2"
        description: "Test group 2"
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: 443
        ipa_prot: "https"
        ipa_timeout: 30
        validate_certs: false
        group: "{{ ['user5', 'user6'] }}"
        ipa_group_options:
          append: true
          external: false
          external_user:
            - "user7"
          user:
            - "user8"
          gidnumber: "2000"
          nonposix: true