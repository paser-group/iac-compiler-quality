---
- name: Test playbook for community.general.rax module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create Rackspace instance
      community.general.rax:
        api_key: "{{ api_key }}"
        auth_endpoint: "https://auth.api.rackspacecloud.com/v2.0/"
        flavor: "general1-2"
        image: "{{ image }}"
        key_name: "{{ key_name }}"
        name: "{{ instance_name }}"
        networks:
          - name: "private"
            fixed_ip_v4: "{{ fixed_ip }}"
        config_drive: false
        disk_config: "AUTO"

    - name: Delete Rackspace instance
      community.general.rax:
        api_key: "{{ api_key }}"
        auth_endpoint: "https://auth.api.rackspacecloud.com/v2.0/"
        instance_ids: "{{ instance_id }}"
        state: absent

        register: result

    - name: Debug result
      debug:
        var: result