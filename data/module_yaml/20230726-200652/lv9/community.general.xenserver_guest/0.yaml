- name: Ansible Playbook for xenserver_guest module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create XenServer VM
      community.general.xenserver_guest:
        cdrom:
          iso_path: /path/to/iso
        custom_params:
          - param1: value1
            param2: value2
        disks:
          - size_gb: 10
            sr: "sr1"
        folder: "VMs"
        force: false
        hardware:
          memory_mb: 2048
          vcpus: 2
        home_server: "xenserver1"
        hostname: "testvm"
        is_template: false
        linked_clone: false
        name: "Test VM"
        name_description: "Ansible Test VM"
        networks:
          - device: "eth0"
            mac: "00:11:22:33:44:55"
            mode: "bridged"
            ip: "10.1.1.5"
            netmask: "255.255.255.0"
            gateway: "10.1.1.254"
            dns:
              - "8.8.8.8"
              - "8.8.4.4"
        password: "password"
        state: "running"
        state_change_timeout: 120
        template: "CentOS 7"
        template_uuid: ""
        username: "ansible"
        uuid: ""
        validate_certs: false
        wait_for_ip_address: true
      register: result
      
    - name: Debug result
      debug:
        var: result