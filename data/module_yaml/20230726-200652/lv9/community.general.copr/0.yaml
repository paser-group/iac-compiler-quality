- name: Set up Copr repository
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ hostvars[groups['all'][0]]['ansible_default_ipv4']['network'] | ipaddr('address', random=True) | ipaddr('network') }}"

    - name: Debug random IP
      debug:
        var: random_ip

    - name: Install Copr repository
      community.general.copr:
        chroot: "{{ random_ip }}"
        host: "{{ random_ip }}"
        name: test-repo
        protocol: http
        state: present