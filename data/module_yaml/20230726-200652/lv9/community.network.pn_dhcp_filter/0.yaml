- name: Configure DHCP filter
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create DHCP filter
      community.network.pn_dhcp_filter:
        pn_cliswitch: "{{ inventory_hostname }}"
        pn_name: "filter1"
        pn_trusted_ports: "ethernet1, ethernet2"
        state: present
      register: result
      ignore_errors: true

    - name: Debug result
      debug:
        var: result

    - name: Update DHCP filter with random IP addresses
      community.network.pn_dhcp_filter:
        pn_cliswitch: "{{ inventory_hostname }}"
        pn_name: "filter1"
        pn_trusted_ports: "ethernet1, ethernet2"
        pn_source_ip: "{{ hostvars['localhost']['random_ip_address'] }}"
        pn_destination_ip: "{{ hostvars['localhost']['random_ip_address'] }}"
        state: present
      register: updated_result
      ignore_errors: true

    - name: Debug updated result
      debug:
        var: updated_result