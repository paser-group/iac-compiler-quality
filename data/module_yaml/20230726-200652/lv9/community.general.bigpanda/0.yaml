---
- name: Test playbook for Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Prepare test data
      set_fact:
        ip_addresses:
          - "{{ hostvars['ubuntu1']['ansible_default_ipv4']['address'] }}"
          - "{{ hostvars['alpine1']['ansible_default_ipv4']['address'] }}"
          - "{{ hostvars['centos1']['ansible_default_ipv4']['address'] }}"
          - "{{ hostvars['redhat1']['ansible_default_ipv4']['address'] }}"

    - name: Notify BigPanda
      community.general.bigpanda:
        component: "{{ component }}"
        deployment_message: "{{ deployment_message }}"
        description: "{{ description }}"
        env: "{{ env }}"
        hosts: "{{ hosts }}"
        owner: "{{ owner }}"
        source_system: "{{ source_system }}"
        state: "{{ state }}"
        token: "{{ token }}"
        url: "{{ url }}"
        validate_certs: "{{ validate_certs }}"
        version: "{{ version }}"
      vars:
        component: "Ansible Component"
        deployment_message: "Deploying Ansible Playbook"
        description: "Testing BigPanda integration"
        env: "test"
        hosts: "{{ ip_addresses | random }}"
        owner: "test_owner"
        source_system: "Ansible"
        state: "present"
        token: "dummy_token"
        url: "https://api.bigpanda.io/data/v2/alerts"
        validate_certs: false
        version: "1.0"