---
- name: Test playbook for community.general.cloudflare_dns module
  hosts: localhost
  gather_facts: false

  vars:
    account_api_key: "my_account_api_key"
    account_email: "my_account@example.com"
    api_token: "my_api_token"
    record_data:
      - name: "test1.example.com"
        value: "10.1.1.1"
      - name: "test2.example.com"
        value: "10.1.1.2"
      - name: "test3.example.com"
        value: "10.1.1.3"
      - name: "test4.example.com"
        value: "10.1.1.4"

  tasks:
    - name: Install community.general.cloudflare_dns collection
      action: community.general.cloudflare_dns

    - name: Create DNS records in Cloudflare
      community.general.cloudflare_dns:
        account_api_key: "{{ account_api_key }}"
        account_email: "{{ account_email }}"
        api_token: "{{ api_token }}"
        zone: "example.com"
        record: "{{ item.name }}"
        type: "A"
        value: "{{ item.value }}"
        state: present
      with_items: "{{ record_data }}"

    - name: Random IP address test case
      community.general.cloudflare_dns:
        account_api_key: "{{ account_api_key }}"
        account_email: "{{ account_email }}"
        api_token: "{{ api_token }}"
        zone: "example.com"
        record: "test5.example.com"
        type: "A"
        value: "{{ item }}"
        state: present
      with_items:
        - "10.1.1.5"
        - "10.1.1.6"
        - "10.1.1.7"
        - "10.1.1.8"

    - name: Remove DNS records from Cloudflare
      community.general.cloudflare_dns:
        account_api_key: "{{ account_api_key }}"
        account_email: "{{ account_email }}"
        api_token: "{{ api_token }}"
        zone: "example.com"
        record: "{{ item.name }}"
        type: "A"
        state: absent
      with_items: "{{ record_data }}"