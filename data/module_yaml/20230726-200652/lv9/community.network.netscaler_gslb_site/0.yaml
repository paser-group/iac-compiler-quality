---
- name: Test playbook for Ansible Latent Bugs
  hosts: localhost
  gather_facts: false
  
  vars:
    nitro_user: "admin"
    nitro_pass: "password"
    nitro_protocol: "https"
    nitro_timeout: 10
    nsip: "10.1.1.1"
    sitename: "test-site"
    siteipaddress: "{{ lookup('pipe','python -c \"import random; print '.'.join(map(str, (random.randint(0, 255) for _ in range(4)) ))\"') }}"
    state: "present"
    validate_certs: False
  
  tasks:
    - name: Create gslb site
      community.network.netscaler_gslb_site:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        sitename: "{{ sitename }}"
        siteipaddress: "{{ siteipaddress }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
      register: result
      
    - name: Show debug output
      debug:
        var: result