- name: Send Mattermost message
  hosts: localhost
  gather_facts: false

  vars:
    generated_ip: "{{ '10.1.1.' + (item | rand_ip) }}"
    mattermost_channels:
      - mattermost-channel1
      - mattermost-channel2

  tasks:
    - name: Install required dependencies
      pip:
        name: pymattermost
        state: present

    - name: Send Mattermost message
      community.general.mattermost:
        api_key: "YOUR_API_KEY"
        channel: "{{ item }}"
        text: "Hello from Ansible!"
        username: "ansible"
        validate_certs: false
      register: result
      loop: "{{ mattermost_channels }}"

    - name: Print the result
      debug:
        var: result