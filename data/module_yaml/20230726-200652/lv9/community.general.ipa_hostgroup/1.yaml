- name: Create and manage IPA hostgroup
  hosts: localhost
  gather_facts: false

  tasks:

  - name: Create new hostgroup
    community.general.ipa_hostgroup:
      state: present
      cn: test_group
      description: Test group

  - name: Add hosts to hostgroup
    community.general.ipa_hostgroup:
      state: present
      cn: test_group
      host:
        - "{{ random_ip() }}"
        - "{{ random_ip() }}"
        - "{{ random_ip() }}"
        - "{{ random_ip() }}"

  - name: Remove hosts from hostgroup
    community.general.ipa_hostgroup:
      state: absent
      cn: test_group
      host:
        - "{{ random_ip() }}"
        - "{{ random_ip() }}"

  - name: Delete hostgroup
    community.general.ipa_hostgroup:
      state: absent
      cn: test_group

  vars:
    random_octet: "{{ 1 + (ansible_play_hosts_all|random | int) }}"
    random_ip: "{{ '10.1.1.' + random_octet }}"