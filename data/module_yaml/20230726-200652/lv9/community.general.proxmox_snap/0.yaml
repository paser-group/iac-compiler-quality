---
- name: Test playbook for Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create random IP addresses
      set_fact:
        random_ips:
          - "{{ ((0-1) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}"
          - "{{ ((0-1) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}"
          - "{{ ((0-1) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}"
          - "{{ ((0-1) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}.{{ ((0-255) |random + 1) }}"

    - name: Print random IPs
      debug:
        var: random_ips

    - name: Test proxmox_snap module
      community.general.proxmox_snap:
        api_host: "{{ random_ips[0] }}"
        api_user: "{{ random_ips[1] }}"
        api_password: "{{ random_ips[2] }}"
        vmid: "{{ random_ips[3] }}"
        vmstate: "{{ random_ips[4] }}"
        snapname: "{{ random_ips[5] }}"
      register: result

    - name: Debug module output
      debug:
        var: result