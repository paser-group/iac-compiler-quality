---
- name: Test ansible.builtin.async_status module
  hosts: localhost

  tasks:
    - name: Run async task
      ansible.builtin.command: sleep 5
      async: 30
      poll: 0
      register: async_output

    - name: Fetch async task status
      ansible.builtin.async_status:
        jid: "{{ async_output.ansible_job_id | random(ip_address=True) }}"
        mode: "{{ random(['json', 'xml', 'yaml']) }}"
      register: async_status

    - name: Print async task status
      debug:
        var: async_status