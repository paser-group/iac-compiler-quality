---
- name: Test OVH IP Load Balancing Backend module
  hosts: localhost
  gather_facts: False
  tasks:
    - name: Create OVH IP Load Balancing Backend
      community.general.ovh_ip_loadbalancing_backend:
        name: test_backend
        backend: "{{ item.backend }}"
        weight: "{{ item.weight }}"
        probe: "{{ item.probe }}"
        timeout: "{{ item.timeout }}"
        application_key: "{{ item.application_key }}"
        application_secret: "{{ item.application_secret }}"
        consumer_key: "{{ item.consumer_key }}"
        endpoint: "{{ item.endpoint }}"
        state: present
      loop:
        - { backend: "10.1.1.1", weight: "4", probe: "TCP", timeout: 5, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com", state: "present" }
        - { backend: "10.1.1.2", weight: "8", probe: "HTTP", timeout: 10, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com", state: "present" }
        - { backend: "10.1.1.3", weight: "6", probe: "HTTPS", timeout: 15, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com", state: "present" }
        - { backend: "10.1.1.4", weight: "2", probe: "ICMP", timeout: 20, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com", state: "present" }
    
    - name: Update OVH IP Load Balancing Backend
      community.general.ovh_ip_loadbalancing_backend:
        name: test_backend
        weight: "{{ item.weight }}"
        probe: "{{ item.probe }}"
        timeout: "{{ item.timeout }}"
        application_key: "{{ item.application_key }}"
        application_secret: "{{ item.application_secret }}"
        consumer_key: "{{ item.consumer_key }}"
        endpoint: "{{ item.endpoint }}"
        state: present
      loop:
        - { weight: "5", probe: "TCP", timeout: 10, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com" }
        - { weight: "4", probe: "HTTP", timeout: 15, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com" }
        - { weight: "7", probe: "HTTPS", timeout: 20, application_key: "abc123", application_secret: "def456", consumer_key: "ghi789", endpoint: "https://api.ovh.com" }
    
    - name: Delete OVH IP Load Balancing Backend
      community.general.ovh_ip_loadbalancing_backend:
        name: test_backend
        state: absent