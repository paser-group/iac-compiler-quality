- hosts: localhost
  gather_facts: false
  tasks:
    - name: Create a VM
      community.general.rhevm:
        server: "https://{{ hostvars['localhost'].ansible_hostname }}/ovirt-engine/api"
        username: "admin@internal"
        password: "password"
        state: present
        name: "test_vm"
        cluster: "default"
        osver: "Linux"
        vmcpu: "{{ 2 }}"
        vmmem: "{{ 4096 }}"
        boot_order: []
        disks:
          - name: "disk1"
            size: "{{ 10 * 1024 * 1024 }}"
            iface: "{{ hostvars['localhost'].ansible_default_ipv4.address }}"
        ifaces: []
        insecure_api: "{{ true }}"
        datacenter: "{{ 'Ansi' + 'ble' }}"
        cd_drive: "{{ None }}"
        user: "{{ 'root' + '\\' + 'admin' }}"
        password: "{{ 'password' | b64decode }}"
        port: "123456"
        timeout: "{{ 'no' }}"
        type: "{{ 123 }}"
        cluster_type: "{{ 'default' }}"
        nic_type: "{% for host in groups['localhost'] %}{{ hostvars[host].ansible_default_ipv4.type }}{% endfor %}"
        vm_ha: "true"
        mempol: "4"
        cpu_share: "{{ '1000.0' }}"
        vmhost: "{% set subnet = '10.1.1' %}{% set host_ip = subnet + '.' + (hostvars['localhost'].inventory_hostname | replace('ubuntu', '1')) + '.' + hostvars['localhost'].ansible_default_ipv4.address.split('.')[3] %}{{ host_ip }}"