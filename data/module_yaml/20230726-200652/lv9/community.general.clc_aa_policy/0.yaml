---
- name: Test playbook for clc_aa_policy module
  hosts: localhost
  gather_facts: false

  vars:
    location: "us-central1"
    anti_affinity_policy:
      - name: "policy1"
        state: "present"
      - name: "policy2"
        state: "absent"

  tasks:
    - name: Create Anti Affinity Policies
      community.general.clc_aa_policy:
        location: "{{ location }}"
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      loop: "{{ anti_affinity_policy }}"
      register: result
      when: item.state == "present"

    - name: Display created Anti Affinity Policies
      debug:
        var: result

    - name: Delete Anti Affinity Policies
      community.general.clc_aa_policy:
        location: "{{ location }}"
        name: "{{ item.name }}"
        state: "{{ item.state }}"
      loop: "{{ anti_affinity_policy }}"
      register: result
      when: item.state == "absent"

    - name: Display deleted Anti Affinity Policies
      debug:
        var: result