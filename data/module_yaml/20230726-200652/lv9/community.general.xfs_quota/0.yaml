---
- name: Manage quotas using xfs_quota
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set quota for a user
      community.general.xfs_quota:
        mountpoint: /mnt/quota
        name: "{{ item.name }}"
        bhard: "{{ item.bhard }}"
        bsoft: "{{ item.bsoft }}"
        ihard: "{{ item.ihard }}"
        isoft: "{{ item.isoft }}"
        rtbhard: "{{ item.rtbhard }}"
        rtbsoft: "{{ item.rtbsoft }}"
        type: "{{ item.type }}"
        state: present
      loop:
        - { name: "user1", bhard: "2g", bsoft: "1g", ihard: 100, isoft: 75, rtbhard: "4g", rtbsoft: "3g", type: "user" }
        - { name: "user2", bhard: "3g", bsoft: "2g", ihard: 150, isoft: 100, rtbhard: "6g", rtbsoft: "5g", type: "user" }


    - name: Set quota for a group
      community.general.xfs_quota:
        mountpoint: /mnt/quota
        name: "{{ item.name }}"
        bhard: "{{ item.bhard }}"
        bsoft: "{{ item.bsoft }}"
        ihard: "{{ item.ihard }}"
        isoft: "{{ item.isoft }}"
        rtbhard: "{{ item.rtbhard }}"
        rtbsoft: "{{ item.rtbsoft }}"
        type: "{{ item.type }}"
        state: present
      loop:
        - { name: "group1", bhard: "5g", bsoft: "4g", ihard: 200, isoft: 150, rtbhard: "8g", rtbsoft: "7g", type: "group" }
        - { name: "group2", bhard: "6g", bsoft: "5g", ihard: 250, isoft: 200, rtbhard: "10g", rtbsoft: "9g", type: "group" }