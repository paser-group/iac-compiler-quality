---
- name: Test playbook for 'community.general.pkgng' module
  hosts: localhost
  gather_facts: false

  vars:
    pkg_options:
      - annotation: "{{ random_ip_address() }}"
        autoremove: "{{ random_boolean() }}"
        cached: "{{ random_boolean() }}"
        chroot: "{{ random_path() }}"
        ignore_osver: "{{ random_boolean() }}"
        jail: "{{ random_string(5) }}"
        name:
          - package1
          - package2
        pkgsite: "{{ random_string(10) }}"
        rootdir: "{{ random_path() }}"
        state: "{{ random_state() }}"

  tasks:
    - name: Print package options
      debug:
        var: pkg_options

    - name: Execute 'community.general.pkgng' module
      pkgng:
        name: "{{ item.name }}"
        annotation: "{{ item.annotation }}"
        autoremove: "{{ item.autoremove }}"
        cached: "{{ item.cached }}"
        chroot: "{{ item.chroot }}"
        ignore_osver: "{{ item.ignore_osver }}"
        jail: "{{ item.jail }}"
        pkgsite: "{{ item.pkgsite }}"
        rootdir: "{{ item.rootdir }}"
        state: "{{ item.state }}"
      with_items: "{{ pkg_options }}"

  tasks:
    - name: Print package options
      debug:
        var: pkg_options

    - name: Execute 'community.general.pkgng' module
      pkgng:
        name: "{{ item.name }}"
        annotation: "{{ item.annotation }}"
        autoremove: "{{ item.autoremove }}"
        cached: "{{ item.cached }}"
        chroot: "{{ item.chroot }}"
        ignore_osver: "{{ item.ignore_osver }}"
        jail: "{{ item.jail }}"
        pkgsite: "{{ item.pkgsite }}"
        rootdir: "{{ item.rootdir }}"
        state: "{{ item.state }}"
      with_items: "{{ pkg_options }}"

  vars:
    pkg_options:
      - annotation: "{{ random_ip_address() }}"
        autoremove: "{{ random_boolean() }}"
        cached: "{{ random_boolean() }}"
        chroot: "{{ random_path() }}"
        ignore_osver: "{{ random_boolean() }}"
        jail: "{{ random_string(5) }}"
        name:
          - package1
          - package2
        pkgsite: "{{ random_string(10) }}"
        rootdir: "{{ random_path() }}"
        state: "{{ random_state() }}"

  tasks:
    - name: Print package options
      debug:
        var: pkg_options

    - name: Execute 'community.general.pkgng' module
      pkgng:
        name: "{{ item.name }}"
        annotation: "{{ item.annotation }}"
        autoremove: "{{ item.autoremove }}"
        cached: "{{ item.cached }}"
        chroot: "{{ item.chroot }}"
        ignore_osver: "{{ item.ignore_osver }}"
        jail: "{{ item.jail }}"
        pkgsite: "{{ item.pkgsite }}"
        rootdir: "{{ item.rootdir }}"
        state: "{{ item.state }}"
      with_items: "{{ pkg_options }}"