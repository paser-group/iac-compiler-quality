- name: Add/Modify/Remove Nodes from Rackspace Load Balancer
  hosts: localhost
  gather_facts: false
  vars:
    load_balancer_id: 12345  # Replace with your load balancer ID
    api_key: your_api_key  # Replace with your Rackspace API key
    region: your_region  # Replace with your Rackspace region

  tasks:
    - name: Add Node to Load Balancer
      community.general.rax_clb_nodes:
        state: present
        load_balancer_id: "{{ load_balancer_id }}"
        api_key: "{{ api_key }}"
        region: "{{ region }}"
        address: "{{ item.address }}"
        port: "{{ item.port }}"
        condition: "{{ item.condition }}"
        weight: "{{ item.weight }}"
      loop:
        - address: "10.1.1.1"
          port: 80
          condition: "ENABLED"
          weight: 10
        - address: "10.1.1.2"
          port: 80
          condition: "DISABLED"
          weight: 5

    - name: Modify Node in Load Balancer
      community.general.rax_clb_nodes:
        state: present
        load_balancer_id: "{{ load_balancer_id }}"
        api_key: "{{ api_key }}"
        region: "{{ region }}"
        node_id: 123  # Replace with the ID of an existing node in the load balancer
        port: 8080
        condition: "ENABLED"
        weight: 15

    - name: Remove Node from Load Balancer
      community.general.rax_clb_nodes:
        state: absent
        load_balancer_id: "{{ load_balancer_id }}"
        api_key: "{{ api_key }}"
        region: "{{ region }}"
        node_id: 123  # Replace with the ID of the node to be removed