- name: Test Ansible module 'community.general.lxd_container'
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      set_fact:
        ip_address_ubuntu1: "10.1.1.{{ 1 | random }}"
        ip_address_alpine1: "10.1.1.{{ 2 | random }}"
        ip_address_centos1: "10.1.1.{{ 3 | random }}"
        ip_address_redhat1: "10.1.1.{{ 4 | random }}"

    - name: Create LXD container
      community.general.lxd_container:
        architecture: "x86_64"
        client_cert: "/path/to/client.cert"
        client_key: "/path/to/client.key"
        config:
          security.nesting: "true"
        devices:
          eth0:
            name: eth0
            nictype: bridged
            parent: lxdbr0
            type: nic
            ipv4.address: "{{ ip_address_ubuntu1 }}"
          root:
            path: "/"
            pool: default
            size: "20GB"
            type: disk
        ephemeral: false
        force_stop: false
        ignore_volatile_options: false
        name: test-container
        profiles:
          - default
        project: default
        snap_url: ""
        source:
          type: image
          mode: pull
          server: https://cloud-images.ubuntu.com/releases
          alias: focal
        state: present
        target: ""
        timeout: 300
        trust_password: "my_password"
        type: "container"
        url: ""
        wait_for_container: true
        wait_for_ipv4_addresses: true