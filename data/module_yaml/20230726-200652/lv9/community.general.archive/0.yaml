---
- name: Archive files
  hosts: localhost
  gather_facts: false

  vars:
    # Specify the path of the source files to be archived
    source_path: /path/to/source/files

    # Specify the destination directory for the archived file
    dest_dir: /path/to/destination

  tasks:
    - name: Create destination directory
      file:
        path: "{{ dest_dir }}"
        state: directory

    - name: Create compressed archive
      community.general.archive:
        path: "{{ source_path }}"
        dest: "{{ dest_dir }}/archive.tar.gz"
        format: gz
        exclude_path:
          - "{{ dest_dir }}/excluded_dir"
        exclusion_patterns:
          - "*.log"
        force_archive: true
        group: root
        mode: 0644
        owner: root
        remove: true
        unsafe_writes: true
      register: archive_result

    - name: Debug archive creation result
      debug:
        var: archive_result