---
- name: Test bigmon_policy module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a bigmon_policy with incorrect IP address type
      community.network.bigmon_policy:
        access_token: "{{ access_token }}"
        action: "{{ action }}"
        controller: "{{ controller }}"
        delivery_packet_count: "{{ delivery_packet_count }}"
        duration: "{{ duration }}"
        name: "{{ name }}"
        policy_description: "{{ policy_description }}"
        priority: "{{ priority }}"
        start_time: "{{ start_time }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        random_address: true
      register: result

    - debug:
        var: result

    - name: Remove the created bigmon_policy
      community.network.bigmon_policy:
        access_token: "{{ access_token }}"
        name: "{{ result.changed | ternary(result.name, omit) }}"
        state: "absent"
        validate_certs: "{{ validate_certs }}"