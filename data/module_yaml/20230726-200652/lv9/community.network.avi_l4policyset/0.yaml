---
- name: Test playbook for community.network.avi_l4policyset module
  hosts: localhost
  gather_facts: false
  vars:
    avi_credentials:
      controller: "10.1.1.1"
      username: "admin"
      password: "password123"
      tenant: "admin"

  tasks:
    - name: Create L4PolicySet
      community.network.avi_l4policyset:
        avi_credentials: "{{ avi_credentials }}"
        tenant_ref: "admin"
        name: "TestL4PolicySet"
        description: "Testing L4PolicySet creation"
        state: present
        is_internal_policy: true

    - name: Update L4PolicySet description
      community.network.avi_l4policyset:
        avi_credentials: "{{ avi_credentials }}"
        tenant_ref: "admin"
        name: "TestL4PolicySet"
        description: "Updated L4PolicySet description"
        state: present

    - name: Delete L4PolicySet
      community.network.avi_l4policyset:
        avi_credentials: "{{ avi_credentials }}"
        tenant_ref: "admin"
        name: "TestL4PolicySet"
        state: absent

    - name: Query L4PolicySet
      community.network.avi_l4policyset:
        avi_credentials: "{{ avi_credentials }}"
        tenant_ref: "admin"
        state: query

    - name: Verify L4PolicySet
      debug:
        var: ansible_facts.network_avi_l4policyset.TestL4PolicySet