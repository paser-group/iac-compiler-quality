---
- name: Test playbook for community.network.ce_bgp_neighbor_af module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure BGP neighbor address-family IPv4 on HUAWEI devices
      community.network.ce_bgp_neighbor_af:
        provider:
          host: "{{ host }}"
          username: "{{ username }}"
          password: "{{ password }}"
        asn: 65000
        neighbor: "10.1.1.1"
        af_type: ipv4
        advertise_community: "test_community"
        export_as_path_name_or_num: "test_as_path"
        import_rt_policy_name: "test_policy"
        redirect_ip: "192.168.1.1"
      register: result
      vars:
        host: "192.168.0.1"
        username: "admin"
        password: "password"

    - debug:
        var: result

- name: Random IP addresses test cases
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure BGP neighbor address-family IPv4 with random IP address
      community.network.ce_bgp_neighbor_af:
        provider:
          host: "{{ host }}"
          username: "{{ username }}"
          password: "{{ password }}"
        asn: 65000
        neighbor: "{{ random_ip }}"
        af_type: ipv4
        advertise_community: "test_community"
        export_as_path_name_or_num: "test_as_path"
        import_rt_policy_name: "test_policy"
        redirect_ip: "{{ random_ip }}"
      vars:
        host: "192.168.0.1"
        username: "admin"
        password: "password"
        random_ip: "{{ ipprefix(net='10.0.0.0/24',prefix=32) }}"

    - debug:
        var: result