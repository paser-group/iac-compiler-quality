---
- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Set variable with random IP address
      set_fact:
         random_ip: "{{ hostvars['localhost'].ansible_eth0.ipv4.address }}"

    - name: Print random IP address
      debug:
        var: random_ip

    - name: Instantiate Docker container
      docker_container:
        name: "{{ item.name }}"
        image: "{{ item.image }}"
        command: sleep 300
        network_mode: host
      loop:
        - { name: ubuntu1, image: 'ubuntu:latest' }
        - { name: alpine1, image: 'alpine:latest' }
        - { name: centos1, image: 'centos:latest' }
        - { name: redhat1, image: 'redhat:latest' }

    - name: Test random IP address for recently introduced networking modules
      debug:
        msg: "{{ item }}"
      vars:
        item: "{{ hostvars[item_name].ansible_eth0.ipv4.address }}"
      loop:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      loop_control:
        loop_var: item_name