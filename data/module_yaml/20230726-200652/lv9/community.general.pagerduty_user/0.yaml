- name: Manage PagerDuty User
  hosts: localhost
  gather_facts: false

  vars:
    access_token: "YOUR_PAGERDUTY_ACCESS_TOKEN"
    pd_email: "test@example.com"
    pd_role: "admin"
    pd_teams:
      - team1
      - team2
    pd_user: "test_user"

  tasks:
    - name: Create PagerDuty User
      community.general.pagerduty_user:
        access_token: "{{ access_token }}"
        pd_email: "{{ pd_email }}"
        pd_role: "{{ pd_role }}"
        pd_teams: "{{ pd_teams }}"
        pd_user: "{{ pd_user }}"
        state: present
      register: result
      delegate_to: localhost

    - name: Assert User Created Successfully
      assert:
        that:
          - result is success

    - name: Update PagerDuty User
      community.general.pagerduty_user:
        access_token: "{{ access_token }}"
        pd_email: "{{ pd_email }}"
        pd_role: "{{ pd_role }}"
        pd_teams: "{{ pd_teams }}"
        pd_user: "{{ pd_user }}"
        state: present
      register: result
      delegate_to: localhost

    - name: Assert User Updated Successfully
      assert:
        that:
          - result is success

    - name: Delete PagerDuty User
      community.general.pagerduty_user:
        access_token: "{{ access_token }}"
        pd_email: "{{ pd_email }}"
        pd_role: "{{ pd_role }}"
        pd_teams: "{{ pd_teams }}"
        pd_user: "{{ pd_user }}"
        state: absent
      register: result
      delegate_to: localhost

    - name: Assert User Deleted Successfully
      assert:
        that:
          - result is success