---
- name: Ansible Latent Bug Finder Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP address
      ansible.builtin.network:
        mode: random
      register: random_ip_address

    - name: Set or delete key value pairs in etcd3
      community.general.etcd3:
        host: "{{ random_ip_address['ansible_facts']['network']['ipv4'][0] }}"
        port: "{{ port }}"
        user: "{{ user }}"
        password: "{{ password }}"
        state: "{{ state }}"
        key: "{{ key }}"
        value: "{{ value }}"
        timeout: "{{ timeout }}"
        ca_cert: "{{ ca_cert }}"
        client_cert: "{{ client_cert }}"
        client_key: "{{ client_key }}"
      register: etcd3_result

    - name: Debug etcd3 result
      debug:
        var: etcd3_result