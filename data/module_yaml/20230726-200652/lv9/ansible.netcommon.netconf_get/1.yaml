---
- name: Fetch configuration/state data from NETCONF endpoint
  hosts: nodes
  gather_facts: false
  vars:
    display: "random_ip"
    filter: "random_ip"
    lock: "random_ip"
    source: "random_ip"
  tasks:
    - name: Generate random IP addresses
      set_fact:
        display: "{{ ansible_facts['node-net']['subnet']|ipaddr('network')|ipaddr('nthhost', 10|random(range=(2, 254))) }}"
        filter: "{{ ansible_facts['node-net']['subnet']|ipaddr('network')|ipaddr('nthhost', 10|random(range=(2, 254))) }}"
        lock: "{{ ansible_facts['node-net']['subnet']|ipaddr('network')|ipaddr('nthhost', 10|random(range=(2, 254))) }}"
        source: "{{ ansible_facts['node-net']['subnet']|ipaddr('network')|ipaddr('nthhost', 10|random(range=(2, 254))) }}"

    - name: Fetch NETCONF data
      ansible.netcommon.netconf_get:
        display: "{{ display }}"
        filter: "{{ filter }}"
        lock: "{{ lock }}"
        source: "{{ source }}"
      register: result

    - name: Display NETCONF data
      debug:
        var: result