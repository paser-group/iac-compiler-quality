---
- name: Manage EVPN VNI on HUAWEI
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random IP addresses
      set_fact:
        bridge_domain_id: "10.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}"
        evpn: "10.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}"
        route_distinguisher: "10.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}.{{ range(1, 255) | random }}"
        state: "present"
        vpn_target_both: "target:{{ range(1, 255) | random }}"
        vpn_target_export: "target:{{ range(1, 255) | random }}"
        vpn_target_import: "target:{{ range(1, 255) | random }}"

    - name: Configure EVPN VNI
      community.network.ce_evpn_bd_vni:
        bridge_domain_id: "{{ bridge_domain_id }}"
        evpn: "{{ evpn }}"
        route_distinguisher: "{{ route_distinguisher }}"
        state: "{{ state }}"
        vpn_target_both: "{{ vpn_target_both }}"
        vpn_target_export: "{{ vpn_target_export }}"
        vpn_target_import: "{{ vpn_target_import }}"
      register: result

    - name: Debug Result
      debug:
        var: result