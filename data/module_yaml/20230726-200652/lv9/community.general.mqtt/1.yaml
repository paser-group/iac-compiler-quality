- name: Publish MQTT message
  hosts: localhost
  vars:
    mqtt_server: "{{ '10.1.1.' ~ 1 + ansible_play_hosts.index(inventory_hostname) }}"
    mqtt_port: 1883
    mqtt_client_id: "ansible-mqtt-client"
    mqtt_username: "mqtt_user"
    mqtt_password: "mqtt_password"
    mqtt_topic: "test/topic"
    mqtt_payload: "Hello, MQTT!"
    mqtt_qos: "0"
    mqtt_retain: false
  tasks:
    - name: Publish message
      community.general.mqtt:
        server: "{{ mqtt_server }}"
        port: "{{ mqtt_port }}"
        client_id: "{{ mqtt_client_id }}"
        username: "{{ mqtt_username }}"
        password: "{{ mqtt_password }}"
        topic: "{{ mqtt_topic }}"
        payload: "{{ mqtt_payload }}"
        qos: "{{ mqtt_qos }}"
        retain: "{{ mqtt_retain }}"
      register: mqtt_publish_result

    - name: Display MQTT publish result
      debug:
        var: mqtt_publish_result