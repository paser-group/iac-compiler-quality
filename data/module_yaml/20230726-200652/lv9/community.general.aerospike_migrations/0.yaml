---
- name: Test playbook for community.general.aerospike_migrations module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random IP address for host
      set_fact:
        host: "{{ host_ip | random }}"
      vars:
        host_ip:
          - "10.1.1.1"
          - "10.1.1.2"
          - "10.1.1.3"
          - "10.1.1.4"

    - name: Check or wait for migrations with community.general.aerospike_migrations module
      community.general.aerospike_migrations:
        host: "{{ host }}"
        port: 3000
        migrate_tx_key: "key"
        migrate_rx_key: "key"
        min_cluster_size: 1
        target_cluster_size: 2
        consecutive_good_checks: 3
        tries_limit: 10
        sleep_between_checks: 5
        connect_timeout: 10
        fail_on_cluster_change: true
        local_only: false
      register: result

    - name: Debug module output
      debug:
        var: result