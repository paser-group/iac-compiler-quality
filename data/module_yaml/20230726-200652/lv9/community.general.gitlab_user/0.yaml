---
- name: Test playbook for community.general.gitlab_user module
  hosts: localhost
  gather_facts: false

  vars:
    access_level: 1
    api_job_token: "api_job_token"
    api_oauth_token: "api_oauth_token"
    api_password: "api_password"
    api_token: "api_token"
    api_url: "https://api.gitlab.com/v4"
    api_username: "api_username"
    confirm: true
    email: "test@example.com"
    external: true
    group: "test-group"
    identities: []
    isadmin: true
    name: "test-user"
    overwrite_identities: true
    password: "test-password"
    reset_password: true
    sshkey_expires_at: "2022-01-01"
    sshkey_file: "/path/to/ssh/key.pub"
    sshkey_name: "test-key"
    state: "present"
    username: "test-username"
    validate_certs: true

  tasks:
    - name: Create GitLab User
      community.general.gitlab_user:
        name: "{{ name }}"
        username: "{{ username }}"
        password: "{{ password }}"
        state: "{{ state }}"
        email: "{{ email }}"
        access_level: "{{ access_level }}"
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        api_token: "{{ api_token }}"
        api_oauth_token: "{{ api_oauth_token }}"
        api_job_token: "{{ api_job_token }}"
        confirm: "{{ confirm }}"
        reset_password: "{{ reset_password }}"
        external: "{{ external }}"
        sshkey_name: "{{ sshkey_name }}"
        sshkey_file: "{{ sshkey_file }}"
        overwrite_identities: "{{ overwrite_identities }}"
        identities: "{{ identities }}"
        group: "{{ group }}"
        isadmin: "{{ isadmin }}"
        sshkey_expires_at: "{{ sshkey_expires_at }}"
        validate_certs: "{{ validate_certs }}"
      delegate_to: localhost
      register: result

    - name: Debug result
      debug:
        var: result