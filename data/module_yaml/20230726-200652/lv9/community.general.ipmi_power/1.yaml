---
- name: Test playbook for community.general.ipmi_power module
  hosts: all
  gather_facts: false

  vars:
    ip_addresses:
      ubuntu1: "10.1.1.1"
      alpine1: "10.1.1.2"
      centos1: "10.1.1.3"
      redhat1: "10.1.1.4"

  tasks:
    - name: Power on machines using IPMI
      community.general.ipmi_power:
        key: "{{ key }}"
        machine:
          - name: "{{ inventory_hostname }}"
            node: "{{ inventory_hostname }}"
            password: "{{ password }}"
            port: "{{ port }}"
            state: "{{ state }}"
            timeout: "{{ timeout }}"
            user: "{{ user }}"
            ip: "{{ ip_addresses[inventory_hostname] }}"
      ignore_errors: true
      register: result

    - name: Display module output
      debug:
        var: result