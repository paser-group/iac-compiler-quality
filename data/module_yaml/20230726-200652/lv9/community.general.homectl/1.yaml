---
- name: Test playbook for community.general.homectl module
  hosts: localhost
  gather_facts: False

  vars:
    ip_range_start: 1
    ip_range_end: 10

  tasks:
    - name: Generate random IP addresses
      set_fact:
        random_ip: "10.1.1.{{ item }}"
      loop: "{{ range(ip_range_start, ip_range_end+1) | list }}"

    - name: Create user account with random IP address
      community.general.homectl:
        name: ansible
        state: present
        uid: 1000
        gid: 1000
        home: "/home/ansible"
        shell: "/bin/bash"
        password: "mystrongpassword"
        sshkeys: "/path/to/id_rsa.pub"
        notbefore: 1618924800
        notafter: 1640460800
        locked: false
        memberof: "group1,group2"
        mountopts: "defaults"
        homedir: "/home/ansible"
        storage: "ssd"
        disksize: "10G"
        resize: false
        email: "ansible@example.com"
        realname: "Ansible User"
        language: "en_US"
        timezone: "Etc/UTC"
        umask: 0022
        skeleton: "/etc/skel"
        realm: "example.com"
        location: "Earth"
        iconname: "ansible-icon"
        imagepath: "/path/to/ansible.png"
        environment: "env=value"
        networking:
          ip: "{{ random_ip }}"

      register: result

    - name: Print result
      debug:
        var: result