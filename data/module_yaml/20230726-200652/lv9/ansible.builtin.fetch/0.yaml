- name: Fetch file from remote nodes
  hosts: all
  gather_facts: false
  tasks:
    - name: Fetch file using ansible.builtin.fetch module
      ansible.builtin.fetch:
        src: "{{ item.src }}"
        dest: "{{ item.dest }}"
        fail_on_missing: "{{ item.fail_on_missing }}"
        flat: "{{ item.flat }}"
        validate_checksum: "{{ item.validate_checksum }}"
      register: fetch_result
      loop:
        - { src: "/path/to/file1", dest: "/tmp/file1", fail_on_missing: true, flat: false, validate_checksum: true }
        - { src: "/path/to/file2", dest: "/tmp/file2", fail_on_missing: true, flat: true, validate_checksum: false }
        - { src: "/path/to/file3", dest: "/tmp/file3", fail_on_missing: false, flat: true, validate_checksum: true }
        - { src: "/path/to/file4", dest: "/tmp/file4", fail_on_missing: false, flat: false, validate_checksum: false }
      when: inventory_hostname in groups['all']

    - name: Print fetch result
      debug:
        var: fetch_result