---
- name: Test 'community.general.hwc_vpc_private_ip' module
  hosts: localhost
  gather_facts: false

  vars:
    domain: "example.com"
    id: "test_id"
    identity_endpoint: "https://identity.endpoint.com"
    password: "test_password"
    project: "test_project"
    region: "test_region"
    state: "present"
    subnet_id: "test_subnet_id"
    user: "test_user"
    ip_address: "{{ random_ip_address }}"

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip_address: "{{ hostvars['localhost']['ansible_all_ipv4_addresses'] | random }}"
        cacheable: true

    - name: Create VPC Priv IP resource using random IP address
      community.general.hwc_vpc_private_ip:
        domain: "{{ domain }}"
        id: "{{ id }}"
        identity_endpoint: "{{ identity_endpoint }}"
        ip_address: "{{ ip_address }}"
        password: "{{ password }}"
        project: "{{ project }}"
        region: "{{ region }}"
        state: "{{ state }}"
        subnet_id: "{{ subnet_id }}"
        user: "{{ user }}"
      register: result

    - name: Debug result
      debug:
        var: result