- name: Manage IP addresses on an interface using ipadm_addr module
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ hostvars[inventory_hostname].ansible_default_ipv4.address }}"

    - name: Add IP address to the interface
      community.network.ipadm_addr:
        address: "{{ random_ip }}"
        addrobj: "{{ random_ip }}"
        addrtype: "inet"
        state: present
        interface: eth0
        temporary: "{{ item }}"
        wait: 5
      loop:
        - True
        - False