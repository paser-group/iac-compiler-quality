- name: Execute SAP Task List
  hosts: localhost
  gather_facts: false

  vars:
    node_ips:
      - 10.1.1.1
      - 10.1.1.2
      - 10.1.1.3
      - 10.1.1.4

  tasks:
    - name: Generate Random IP Addresses
      set_fact:
        random_ip: "{{ node_ips | random }}"
      
    - name: Perform SAP Task List
      community.general.sap_task_list_execute:
        client: "{{ client }}"
        conn_password: "{{ conn_password }}"
        conn_username: "{{ conn_username }}"
        host: "{{ host }}"
        sysnr: "{{ sysnr }}"
        task_parameters: "{{ task_parameters }}"
        task_settings: "{{ task_settings }}"
        task_skip: "{{ task_skip }}"
        task_to_execute: "{{ task_to_execute }}"
        network_module_ip: "{{ random_ip }}"
      register: sap_task_result

    - name: Debug SAP Task List Execution
      debug:
        var: sap_task_result