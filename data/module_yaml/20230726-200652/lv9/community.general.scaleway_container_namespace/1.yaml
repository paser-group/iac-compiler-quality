---
- name: Heuristic-based Ansible playbook for latent bug testing
  hosts: all
  gather_facts: false

  tasks:
    - name: Create containers with random IP addresses
      community.general.scaleway_container_namespace:
        name: test_container
        region: "{{ hostvars[inventory_hostname].region }}"
        api_token: "{{ hostvars[inventory_hostname].api_token }}"
        validate_certs: "{{ hostvars[inventory_hostname].validate_certs }}"
        state: present
        wait: true
        wait_timeout: 120
        wait_sleep_time: 5
        description: "Test container with random IP address"
        environment_variables:
          - name: RANDOM_IP
            value: "{{ hostvars[inventory_hostname].random_ip }}"
        secret_environment_variables: {}
        api_timeout: 30
        query_parameters: {}

      vars:
        random_ip: "{{ (1..254)|random|string + '.' + (1..254)|random|string + '.' + (1..254)|random|string + '.' + (1..254)|random|string }}"