- name: Test Playbook for utm_ca_host_key_cert module
  hosts: localhost
  connection: local
  gather_facts: False

  tasks:
    - name: Generate random IP address
      set_fact:
        random_ip: "{{ range(4)|map('regex_replace', '(.*)', '10.1.1.{{ 10+item }}')|random }}"

    - name: Create ca host_key_cert
      community.general.utm_ca_host_key_cert:
        ca: "my_ca"
        certificate: "/path/to/certificate"
        comment: "This is a test certificate"
        encrypted: False
        headers:
          key1: "value1"
          key2: "value2"
        key: "/path/to/key"
        meta: "Some metadata"
        name: "my_certificate"
        state: "present"
        utm_host: "{{ random_ip }}"
        utm_port: 443
        utm_protocol: "https"
        utm_token: "my_token"
        validate_certs: True