- name: Test Latent Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Execute LDAP Password Change
      community.general.ldap_passwd:
        bind_dn: "cn=admin,dc=mydomain,dc=com"
        bind_pw: "secretpassword"
        ca_path: "/etc/ssl/certs/ca-certificates.crt"
        dn: "{{ item.dn }}"
        passwd: "{{ item.passwd }}"
        referrals_chasing: "ignore"
        sasl_class: "sasl.DEFAULT"
        server_uri: "ldap://localhost:389"
        start_tls: false
        validate_certs: true
        xorder_discovery: "false"
      loop:
        - dn: "cn=user1,ou=users,dc=mydomain,dc=com"
          passwd: "newpassword1"
        - dn: "cn=user2,ou=users,dc=mydomain,dc=com"
          passwd: "newpassword2"
        - dn: "cn=user3,ou=users,dc=mydomain,dc=com"
          passwd: "newpassword3"
        - dn: "cn=user4,ou=users,dc=mydomain,dc=com"
          passwd: "newpassword4"