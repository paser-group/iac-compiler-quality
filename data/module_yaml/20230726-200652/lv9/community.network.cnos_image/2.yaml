---
- name: Firmware Upgrade/Download
  hosts: docker_nodes
  gather_facts: false
  vars:
    deviceType: "device type"
    enablePassword: "enable password"
    outputfile: "output file path"
    password: "device password"
    protocol: null
    serverip: null
    serverpassword: null
    serverusername: null
    username: "device username"

  tasks:
    - name: Generate random IP addresses
      set_fact:
        host_ips: "{{ hostvars[item].ansible_default_ipv4.address }}"
      loop: "{{ groups['docker_nodes'] }}"

    - name: Upgrade firmware
      community.network.cnos_image:
        deviceType: "{{ deviceType }}"
        enable_password: "{{ enablePassword }}"
        host: "{{ host_ips | random }}"
        imgpath: "{{ imgpath }}"
        imgtype: "{{ imgtype }}"
        outputfile: "{{ outputfile }}"
        password: "{{ password }}"
        protocol: "{{ protocol }}"
        serverip: "{{ serverip }}"
        serverpassword: "{{ serverpassword }}"
        serverusername: "{{ serverusername }}"
        username: "{{ username }}"
      register: result

    - name: Show the result
      debug:
        var: result