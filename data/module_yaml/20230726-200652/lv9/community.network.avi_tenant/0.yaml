---
- name: Test playbook for community.network.avi_tenant module
  hosts: localhost
  gather_facts: false
  vars:
    ansible_python_interpreter: auto_silent

  tasks:
    - name: Create random IP addresses
      vars:
        subnet: "10.1.1.0"
        gateway: "10.1.1.254"
      set_fact:
        random_ip: "{{ subnet.split('.')[0] }}.{{ subnet.split('.')[1] }}.{{ subnet.split('.')[2] }}.{{ (subnet.split('.')[3]|int + 2)|random(start=2, end=250) }}"
        subnet_mask: "255.255.255.0"
        nodes:
          - name: ubuntu1
            ip_address: "10.1.1.1"
          - name: alpine1
            ip_address: "10.1.1.2"
          - name: centos1
            ip_address: "10.1.1.3"
          - name: redhat1
            ip_address: "10.1.1.4"

    - name: Test avi_tenant module
      community.network.avi_tenant:
        ansible_python_interpreter: auto_silent
        controller: "https://{{ gateway }}"
        username: "admin"
        password: "password"
        tenant: "example_tenant"
        state: "present"
        api_context:
          api_version: 21.1.1
        config_settings: None

    - name: Debug module output
      debug:
        var: ansible_facts.ansible_network_devices