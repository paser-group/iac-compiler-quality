---
- name: Test playbook for community.network.avi_scheduler module
  hosts: localhost
  gather_facts: false

  vars:
    api_context:
      - api_version: "{{ api_version }}"
        tenant: "{{ tenant }}"
        url: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"

  tasks:
    - name: Create scheduler with random IP address
      community.network.avi_scheduler:
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        api_context: "{{ api_context }}"
        enabled: true
        name: "{{ item.name }}"
        start_date_time: "{{ item.start_date_time }}"
        end_date_time: "{{ item.end_date_time }}"
        frequency: "{{ item.frequency }}"
        frequency_unit: "{{ item.frequency_unit }}"
        state: present
      loop:
        - name: Test scheduler 1
          start_date_time: "2022-01-01T00:00:00Z"
          end_date_time: "2022-01-01T02:00:00Z"
          frequency: 30
          frequency_unit: minutes

        - name: Test scheduler 2
          start_date_time: "2022-01-01T02:00:00Z"
          end_date_time: "2022-01-01T04:00:00Z"
          frequency: 1
          frequency_unit: hour

      register: scheduler_created

    - name: Debug output
      debug:
        var: scheduler_created