---
- name: Manage DNS records with Rackspace module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create A record
      community.general.rax_dns_record:
        api_key: "your_api_key"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        credentials: "/path/to/your/credentials"
        state: present
        domain: "example.com"
        name: "test"
        type: "A"
        data: "{{ hostvars['ubuntu1'].ansible_default_ipv4.address }}"  # Random IP address generated for ubuntu1 node
        comment: "Creating A record"
      register: result
      ignore_errors: true

    - name: Check the result
      debug:
        var: result

    - name: Update A record
      community.general.rax_dns_record:
        api_key: "your_api_key"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        credentials: "/path/to/your/credentials"
        state: present
        domain: "example.com"
        name: "test"
        type: "A"
        data: "{{ hostvars['alpine1'].ansible_default_ipv4.address }}"  # Random IP address generated for alpine1 node
        comment: "Updating A record"
      register: result
      ignore_errors: true

    - name: Check the result
      debug:
        var: result

    - name: Delete A record
      community.general.rax_dns_record:
        api_key: "your_api_key"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        credentials: "/path/to/your/credentials"
        state: absent
        domain: "example.com"
        name: "test"
        type: "A"
        data: "{{ hostvars['centos1'].ansible_default_ipv4.address }}"  # Random IP address generated for centos1 node
        comment: "Deleting A record"
      register: result
      ignore_errors: true

    - name: Check the result
      debug:
        var: result