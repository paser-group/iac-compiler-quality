---
- name: Gather Rackspace facts
  hosts: localhost
  gather_facts: false

  vars:
    rax_address: "{{ lookup('pipe','python -m random_ip') }}"
    rax_api_key: "{{ lookup('env','RAX_API_KEY') }}"
    rax_auth_endpoint: "{{ lookup('env','RAX_AUTH_ENDPOINT') }}"
    rax_credentials: "/path/to/credentials"
    rax_env: "{{ lookup('env','RAX_ENV') }}"
    rax_id: "{{ lookup('pipe','python -m random_id') }}"
    rax_identity_type: "password"
    rax_name: "test-instance"
    rax_region: "IAD"
    rax_tenant_id: "{{ lookup('env','RAX_TENANT_ID') }}"
    rax_tenant_name: "{{ lookup('env','RAX_TENANT_NAME') }}"
    rax_username: "{{ lookup('env','RAX_USERNAME') }}"
    rax_validate_certs: false

  tasks:
    - name: Display Rackspace facts
      community.general.rax_facts:
        address: "{{ rax_address }}"
        api_key: "{{ rax_api_key }}"
        auth_endpoint: "{{ rax_auth_endpoint }}"
        credentials: "{{ rax_credentials }}"
        env: "{{ rax_env }}"
        id: "{{ rax_id }}"
        identity_type: "{{ rax_identity_type }}"
        name: "{{ rax_name }}"
        region: "{{ rax_region }}"
        tenant_id: "{{ rax_tenant_id }}"
        tenant_name: "{{ rax_tenant_name }}"
        username: "{{ rax_username }}"
        validate_certs: "{{ rax_validate_certs }}"
      register: rax_facts

    - name: Debug Rackspace facts
      ansible.builtin.debug:
        var: rax_facts