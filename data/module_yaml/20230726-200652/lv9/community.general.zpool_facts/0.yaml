---
- name: Gather ZFS pool facts
  hosts: all
  gather_facts: False

  tasks:
    - name: Include zpool_facts module
      include_vars:
        file: community/general/zpool_facts.yml

    - name: Get ZFS pool facts
      community.general.zpool_facts:
        name: "{{ zpool_name }}"
        parsable: "{{ zpool_parsable | bool }}"
        properties: "{{ zpool_properties }}"
      register: zpool_facts

    - name: Debug ZFS pool facts
      debug:
        var: zpool_facts

- name: Test cases
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Set zpool_name
      set_fact:
        zpool_name: "{{ item }}"
      with_items:
        - "mypool"
        - "datapool"
        - "testpool"

    - name: Set zpool_parsable
      set_fact:
        zpool_parsable: "{{ item }}"
      with_items:
        - "yes"
        - "no"

    - name: Set zpool_properties
      set_fact:
        zpool_properties: "{{ item }}"
      with_items:
        - "size"
        - "free"
        - "used"

    - name: Include zpool_facts module
      include_vars:
        file: community/general/zpool_facts.yml

    - name: Get ZFS pool facts
      community.general.zpool_facts:
        name: "{{ zpool_name }}"
        parsable: "{{ zpool_parsable | bool }}"
        properties: "{{ zpool_properties }}"
      register: zpool_facts

    - name: Debug ZFS pool facts
      debug:
        var: zpool_facts