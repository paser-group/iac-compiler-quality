---
- name: Test profitbricks_nic module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random IP address for subnet
      set_fact:
        subnet_ip: "{{ query('community.general.random_IP', format='cidr', subnet='10.1.1.0/24') }}"
    
    - name: Generate random IP address for gateway
      set_fact:
        gateway_ip: "{{ query('community.general.random_IP') }}"
      
    - name: Create NIC
      community.general.profitbricks_nic:
        datacenter: "DC1"
        lan: "LAN1"
        name: "TestNIC"
        server: "server1"
        state: present
        subscription_user: "username"
        subscription_password: "password"
        subnet: "{{ subnet_ip }}"
        gateway: "{{ gateway_ip }}"
        wait: true
        wait_timeout: 300
      register: result

    - debug:
        var: result