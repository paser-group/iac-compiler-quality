- name: Create or delete Rackspace Cloud Monitor notification plan
  hosts: localhost
  gather_facts: false

  vars:
    api_key: YOUR_API_KEY
    auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
    env: test_env
    label: my_label
    region: us
    state: present
    validate_certs: false

  tasks:
    - name: Create Rackspace Cloud Monitor notification plan
      community.general.rax_mon_notification_plan:
        api_key: "{{ api_key }}"
        auth_endpoint: "{{ auth_endpoint }}"
        env: "{{ env }}"
        label: "{{ label }}"
        region: "{{ region }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        credentials: "credentials.json"
        critical_state: ["critical_state"]
        warning_state: ["warning_state"]
        ok_state: ["ok_state"]
        identity_type: "rax_kskey"
        username: "your_username"
        tenant_id: "your_tenant_id"
        tenant_name: "your_tenant_name"
      register: result_create

    - name: Debug create result
      debug:
        var: result_create

    - name: Delete Rackspace Cloud Monitor notification plan
      community.general.rax_mon_notification_plan:
        api_key: "{{ api_key }}"
        auth_endpoint: "{{ auth_endpoint }}"
        env: "{{ env }}"
        label: "{{ label }}"
        region: "{{ region }}"
        state: absent
        validate_certs: "{{ validate_certs }}"
        credentials: "credentials.json"
        identity_type: "rax_kskey"
        username: "your_username"
        tenant_id: "your_tenant_id"
        tenant_name: "your_tenant_name"
      register: result_delete

    - name: Debug delete result
      debug:
        var: result_delete