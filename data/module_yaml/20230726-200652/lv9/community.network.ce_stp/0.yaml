---
- name: Test playbook for community.network.ce_stp module
  hosts: all
  gather_facts: false

  vars:
    interface: "{{ ['eth0', 'eth1', 'eth2'] | random }}"
    cost: "{{ 'None' }}"
    bpdu_filter: "{{ ['None', 'True'] | random }}"
    bpdu_protection: "{{ ['None', 'True'] | random }}"
    stp_enable: "{{ ['None', 'True'] | random }}"
    stp_mode: "{{ ['None', 'mstp', 'stp'] | random }}"

  tasks:
    - name: Configure STP on HUAWEI device
      community.network.ce_stp:
        interface: "{{ interface }}"
        cost: "{{ cost }}"
        bpdu_filter: "{{ bpdu_filter }}"
        bpdu_protection: "{{ bpdu_protection }}"
        stp_enable: "{{ stp_enable }}"
        stp_mode: "{{ stp_mode }}"
      register: stp_config
      ignore_errors: true

    - name: Print STP configuration result
      debug:
        var: stp_config