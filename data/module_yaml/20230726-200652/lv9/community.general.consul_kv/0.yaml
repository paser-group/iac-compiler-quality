---
- name: Test playbook for 'community.general.consul_kv' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Manipulate key/value store
      community.general.consul_kv:
        host: "{{ host }}"
        port: "{{ port }}"
        scheme: "{{ scheme }}"
        token: "{{ token }}"
        state: "{{ state }}"
        key: "{{ key }}"
        value: "{{ value }}"
        cas: "{{ cas }}"
        flags: "{{ flags }}"
        recurse: "{{ recurse }}"
        retrieve: "{{ retrieve }}"
        session: "{{ session }}"
        validate_certs: "{{ validate_certs }}"
      register: consul_kv_result

    - name: Print the manipulation result
      debug:
        msg: "{{ consul_kv_result }}"

- name: Random IP address generation for networking modules
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random IP addresses
      set_fact:
        random_ip: "{{ (127, 192, 10, 172)|random }}.{{ range(1,254)|random }}"

    - name: Use the random IP in networking module
      community.general.consul_kv:
        host: "{{ random_ip }}"
        port: "{{ port }}"
        scheme: "{{ scheme }}"
        token: "{{ token }}"
        state: "{{ state }}"
        key: "{{ key }}"
        value: "{{ value }}"
        cas: "{{ cas }}"
        flags: "{{ flags }}"
        recurse: "{{ recurse }}"
        retrieve: "{{ retrieve }}"
        session: "{{ session }}"
        validate_certs: "{{ validate_certs }}"
      register: random_ip_result

    - name: Print the random IP manipulation result
      debug:
        msg: "{{ random_ip_result }}"