- name: Manage DNS records with gandi_livedns module
  hosts: all
  become: true

  vars:
    api_key: "your_api_key"
    domain: "example.com"
    record: "www"
    state: "present"
    ttl: 3600
    type: "A"
    values:
      - "{{ hostvars[inventory_hostname].ansible_host }}"

  tasks:
    - name: Install dependencies
      apt:
        name:
          - python3-pip
          - libssl-dev
      when: ansible_distribution == 'Ubuntu'

    - name: Install dependencies
      apk:
        name:
          - python3-pip
          - openssh-keygen
      when: ansible_distribution == 'Alpine'

    - name: Install dependencies
      yum:
        name:
          - python3-pip
          - openssl-devel
      when: ansible_distribution in ['CentOS', 'RedHat']

    - name: Install gandi_livedns module
      pip:
        name: gandi_livedns
        executable: pip3

    - name: Manage DNS record
      community.general.gandi_livedns:
        api_key: "{{ api_key }}"
        domain: "{{ domain }}"
        record: "{{ record }}"
        state: "{{ state }}"
        ttl: "{{ ttl }}"
        type: "{{ type }}"
        values: "{{ values }}"