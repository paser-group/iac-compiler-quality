---
- name: Ansible Latent Bug Finder & Heuristic Test Playbook
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Create Rackspace Cloud Monitoring check
      community.general.rax_mon_check:
        username: "{{ username }}"
        api_key: "{{ api_key }}"
        tenant_name: "{{ tenant_name }}"
        auth_endpoint: "{{ auth_endpoint }}"
        state: present
        label: "Test Check"
        monitoring_zones_poll: "mzDFW"
        target_hostname: "test.example.com"
        check_type: "remote.tcp"
        details:
          port: 8080
        period: 60
        timeout: 30
      register: rax_mon_check

    - name: Debug Rackspace Cloud Monitoring check creation
      debug:
        var: rax_mon_check

    - name: Update Rackspace Cloud Monitoring check
      community.general.rax_mon_check:
        username: "{{ username }}"
        api_key: "{{ api_key }}"
        tenant_name: "{{ tenant_name }}"
        auth_endpoint: "{{ auth_endpoint }}"
        state: present
        label: "Updated Check"
        monitoring_zones_poll: "mzIAD"
        target_hostname: "updated.example.com"
        check_type: "http"
        details:
          url: "http://example.com"
          method: "HEAD"
        period: 120
        timeout: 60
      register: updated_rax_mon_check

    - name: Debug updated Rackspace Cloud Monitoring check
      debug:
        var: updated_rax_mon_check

    - name: Delete Rackspace Cloud Monitoring check
      community.general.rax_mon_check:
        username: "{{ username }}"
        api_key: "{{ api_key }}"
        tenant_name: "{{ tenant_name }}"
        auth_endpoint: "{{ auth_endpoint }}"
        state: absent
        label: "Test Check"
      register: deleted_rax_mon_check

    - name: Debug deleted Rackspace Cloud Monitoring check
      debug:
        var: deleted_rax_mon_check