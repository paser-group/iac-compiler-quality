---
- name: Manage Resource Policies
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add Resource Policy
      community.general.manageiq_policies:
        manageiq_connection:
          url: "https://manageiq.example.com"
          username: "admin"
          password: "password"
        policy_profiles:
          - name: "Policy Profile 1"
            resource_id: "{{ item.resource_id }}"
            resource_name: "{{ item.resource_name }}"
            resource_type: "{{ item.resource_type }}"
            state: "{{ item.state }}"
        delegate_to: localhost
      loop:
        - { resource_id: 1, resource_name: "resource1", resource_type: "resource_type1", state: "present" }
        - { resource_id: 2, resource_name: "resource2", resource_type: "resource_type2", state: "present" }
        - { resource_id: 3, resource_name: "resource3", resource_type: "resource_type3", state: "absent" }
      register: result

    - name: Print Result
      debug:
        var: result