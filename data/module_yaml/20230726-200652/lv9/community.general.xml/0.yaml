---
- name: Ansible Latent Bug Finder & Heuristic Test
  hosts: localhost
  become: true

  tasks:
    - name: Include community.general.xml module
      include_role:
        name: community.general.xml

    - name: Set attribute using ip addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root"
        attribute: "{{ item.attribute }}"
        value: "{{ item.value | default('') }}"
      loop:
        - { attribute: "ip_address", value: "10.1.1.1" }
        - { attribute: "ip_address", value: "10.1.1.2" }
        - { attribute: "ip_address", value: "10.1.1.3" }
        - { attribute: "ip_address", value: "10.1.1.4" }

    - name: Set child elements using random IP addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root"
        add_children:
          - "{{ item.child }}"
      loop:
        - { child: "<ip_address>10.1.1.1</ip_address>" }
        - { child: "<ip_address>10.1.1.2</ip_address>" }
        - { child: "<ip_address>10.1.1.3</ip_address>" }
        - { child: "<ip_address>10.1.1.4</ip_address>" }

    - name: Remove child elements using random IP addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root"
        remove_children:
          - "{{ item.child }}"
      loop:
        - { child: "<ip_address>10.1.1.1</ip_address>" }
        - { child: "<ip_address>10.1.1.2</ip_address>" }
        - { child: "<ip_address>10.1.1.3</ip_address>" }
        - { child: "<ip_address>10.1.1.4</ip_address>" }

    - name: Set attributes using random IP addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root/ip"
        set_attributes:
          - "{{ item.attribute }}={{ item.value }}"
      loop:
        - { attribute: "address", value: "10.1.1.1" }
        - { attribute: "address", value: "10.1.1.2" }
        - { attribute: "address", value: "10.1.1.3" }
        - { attribute: "address", value: "10.1.1.4" }

    - name: Remove attributes using random IP addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root/ip"
        remove_attributes:
          - "{{ item.attribute }}"
      loop:
        - { attribute: "address" }
        - { attribute: "subnet" }
        - { attribute: "gateway" }
        - { attribute: "dns" }

    - name: Modify XML using random IP addresses
      community.general.xml:
        path: "/path/to/xml/file.xml"
        xpath: "/root"
        xmlstring: "<root><ip>10.1.1.1</ip><ip>10.1.1.2</ip></root>"