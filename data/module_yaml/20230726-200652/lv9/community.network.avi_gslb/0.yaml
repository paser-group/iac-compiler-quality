---
- name: Test playbook for community.network.avi_gslb module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Test Case 1 - Create Gslb
      community.network.avi_gslb:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        name: "TestGslb"
        description: "Test Gslb"
        is_federated: false
        maintenance_mode: false
        sites:
          - name: "PrimarySite"
            description: "Primary Site"
            ip_addresses:
              - "{{ primary_site_ip }}"

      register: result
      failed_when: result | failed
      changed_when: result | changed

    - name: Test Case 2 - Update Gslb
      community.network.avi_gslb:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        name: "TestGslb"
        description: "Updated Gslb"
        maintenance_mode: true

      register: result
      failed_when: result | failed
      changed_when: result | changed

    - name: Test Case 3 - Delete Gslb
      community.network.avi_gslb:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        name: "TestGslb"
        state: absent

      register: result
      failed_when: result | failed
      changed_when: result | changed