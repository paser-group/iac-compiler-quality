---
- name: Test playbook for Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include community.general.manageiq_provider module
      include_vars:
        file: manageiq_vars.yml

    - name: Create provider
      community.general.manageiq_provider:
        manageiq_connection: "{{ manageiq_connection }}"
        name: "{{ name }}"
        type: "{{ type }}"
        state: "{{ state }}"
        project: "{{ project }}"
        provider_region: "{{ provider_region }}"
        tenant_mapping_enabled: "{{ tenant_mapping_enabled }}"
        azure_tenant_id: "{{ azure_tenant_id }}"
        ssh_keypair: "{{ ssh_keypair }}"
        host_default_vnc_port_start: "{{ host_default_vnc_port_start }}"
        host_default_vnc_port_end: "{{ host_default_vnc_port_end }}"
        zone: "{{ zone }}"
        subscription: "{{ subscription }}"
        api_version: "{{ api_version }}"
      register: result

    - name: Debug result
      debug:
        var: result

    - name: Verify the result
      assert:
        that: result.provider | is_changed
        success_msg: Provider successfully created.
        fail_msg: Provider creation failed.