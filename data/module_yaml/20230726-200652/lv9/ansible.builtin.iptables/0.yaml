---
- name: Test playbook for ansible.builtin.iptables module
  hosts: all
  gather_facts: false

  tasks:
    - name: Set up iptables rule
      ansible.builtin.iptables:
        chain: INPUT
        state: present
        comment: "Example rule"
        protocol: tcp
        source: "{{ source_ip }}"
        destination_port: "{{ port }}"
        jump: ACCEPT
      vars:
        source_ip: "10.1.1.{{ (ansible_facts['inventory_hostname'] | split('.')[1] | int) + 1 }}"
        port: "{{ (ansible_facts['ansible_loop.index'] | int) + 1000 }}"

# Additional test cases can be added based on the heuristic