---
- name: Configure reverse proxy frontends
  hosts: proxy_nodes
  gather_facts: false

  tasks:
    - name: Create or update reverse proxy frontend
      community.general.utm_proxy_frontend_info:
        name: my_frontend
        utm_host: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
        utm_port: "{{ hostvars[item]['ansible_default_ipv4']['gateway'] }}"
        utm_protocol: "https"
        utm_token: "abcdef123456"
        validate_certs: true
      loop: "{{ ansible_play_hosts }}"
      loop_control:
        label: "{{ item }}"