---
- name: Test Ansible latent type-related bug in avi_trafficcloneprofile module
  hosts: localhost
  gather_facts: false

  vars:
    # Define the module options
    api_context:
      tenant_uuid: 'example_tenant_uuid'
    api_version: '17.1.6'
    avi_credentials:
      controller: 'https://avi.example.com'
      username: 'admin'
      password: 'password'
    avi_disable_session_cache_as_fact: true
    preserve_client_ip: true
    tenant: 'example_tenant'
    name: 'example_trafficcloneprofile'

  tasks:
    - name: Include the avi_trafficcloneprofile module
      include_role:
        name: community.network.avi_trafficcloneprofile
        tasks_from: main
      vars:
        # Random IP addresses for networking modules
        clone_servers:
          - name: 'server1'
            enabled: true
            ip:
              type: 'V4'
              addr: '{{ 10.1.1 ~ (ansible_random | randrange(start=1, end=255)) }}'
              mask: '255.255.255.0'
              gateway: '10.1.1.254'

        # Module options
        api_context: '{{ api_context }}'
        api_version: '{{ api_version }}'
        avi_api_patch_op: null
        avi_api_update_method: null
        avi_credentials: '{{ avi_credentials }}'
        avi_disable_session_cache_as_fact: '{{ avi_disable_session_cache_as_fact }}'
        clone_servers: '{{ clone_servers }}'
        cloud_ref: null
        controller: 'localhost'
        name: '{{ name }}'
        password: '{{ avi_credentials.password }}'
        preserve_client_ip: '{{ preserve_client_ip }}'
        state: null
        tenant: '{{ tenant }}'
        tenant_ref: null
        tenant_uuid: '{{ api_context.tenant_uuid }}'
        url: null
        username: '{{ avi_credentials.username }}'
        uuid: null