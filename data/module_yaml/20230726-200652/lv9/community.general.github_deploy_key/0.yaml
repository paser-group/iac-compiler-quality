---
- name: Manage deploy keys for GitHub repositories
  hosts: localhost
  gather_facts: false

  vars:
    github_url: "https://github.com/{{ owner }}/{{ repo }}.git"

  tasks:
    - name: Create a GitHub deploy key
      community.general.github_deploy_key:
        github_url: "{{ github_url }}"
        name: "{{ key }}"
        owner: "{{ owner }}"
        state: present
        force: true
        read_only: true
        token: "{{ token }}"
        username: "{{ username }}"
        password: "{{ password }}"
        otp: "{{ otp }}"
      register: deploy_key_result

    - name: Print deploy key creation result
      debug:
        var: deploy_key_result