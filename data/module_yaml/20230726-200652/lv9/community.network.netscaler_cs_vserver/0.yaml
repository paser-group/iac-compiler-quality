---
- name: Test playbook to find latent type-related bugs in 'community.network.netscaler_cs_vserver' module
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: admin
    nitro_pass: admin
    nitro_protocol: http
    nitro_timeout: 30
    nsip: 10.10.10.1
    validate_certs: false

  tasks:
    - name: Create netscaler_cs_vserver
      community.network.netscaler_cs_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: test_vserver
        vipheader: "HTTP.REQ.HOSTNAME"
        servicetype: "HTTP"
        port: 80
        ipv46: "{{ item.ipv46 }}"
      loop:
        - { ipv46: "10.1.1.1" }     # Valid IP address
        - { ipv46: "192.168.0.1" }  # Out of subnet range
        - { ipv46: "10.1.1.abc" }   # Invalid IP address format
        - { ipv46: "10.1.1" }       # Invalid IP address format

    - name: Display results
      debug:
        var: stdout_lines