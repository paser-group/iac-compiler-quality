- name: Create or delete Rackspace Cloud Monitoring entity
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create Rackspace Cloud Monitoring entity
      community.general.rax_mon_entity:
        label: "Test entity"
        state: present
        api_key: "your-api-key"
        username: "your-username"
        identity_type: "rackspace"
        tenant_name: "your-tenant-name"
        tenant_id: "your-tenant-id"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        region: "DFW"
        validate_certs: true
      register: entity_created
      ignore_errors: true

    - name: Check if entity creation failed due to type-related bug
      fail:
        msg: "Type-related bug triggered: {{ entity_created }}"

    - name: Delete Rackspace Cloud Monitoring entity
      community.general.rax_mon_entity:
        label: "Test entity"
        state: absent
        api_key: "your-api-key"
        username: "your-username"
        identity_type: "rackspace"
        tenant_name: "your-tenant-name"
        tenant_id: "your-tenant-id"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        region: "DFW"
        validate_certs: true
      register: entity_deleted
      ignore_errors: true

    - name: Check if entity deletion failed due to type-related bug
      fail:
        msg: "Type-related bug triggered: {{ entity_deleted }}"

- name: Test cases based on heuristic - random port numbers
  hosts: localhost
  gather_facts: false
  vars:
    ports:
      - "{{ 5000 | random }}"
      - "{{ 6000 | random }}"
      - "{{ 7000 | random }}"
  tasks:
    - name: Test port settings with random ports
      community.general.rax_mon_entity:
        label: "Port test entity"
        state: present
        api_key: "your-api-key"
        username: "your-username"
        identity_type: "rackspace"
        tenant_name: "your-tenant-name"
        tenant_id: "your-tenant-id"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        region: "DFW"
        validate_certs: true
        metadata:
          ports: "{{ ports }}"
      register: entity_with_ports
      ignore_errors: true

    - name: Check if port settings failed due to type-related bug
      fail:
        msg: "Type-related bug triggered: {{ entity_with_ports }}"