---
- name: Test community.network.avi_poolgroup module
  hosts: localhost
  gather_facts: False

  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    - name: Create Pool Group with type mismatch bug
      community.network.avi_poolgroup:
        controller: "{{ ansible_host }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "admin"
        state: "present"
        name: "PoolGroup_with_type_bug"
        tenant_uuid: "admin"
        description: "Pool group with type bug"
        members:
          - ip: "10.1.1.1"
            port: "{{ random_port }}"
            enable_ssl: true

    - name: Create Pool Group with missing attribute bug
      community.network.avi_poolgroup:
        controller: "{{ ansible_host }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "admin"
        state: "present"
        name: "PoolGroup_with_missing_attribute_bug"
        tenant_uuid: "admin"
        description: "Pool group with missing attribute bug"
        members:
          - ip: "10.1.1.2"
            enable_ssl: true

    - name: Create Pool Group with incorrect attribute type bug
      community.network.avi_poolgroup:
        controller: "{{ ansible_host }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "admin"
        state: "present"
        name: "PoolGroup_with_incorrect_attribute_type_bug"
        tenant_uuid: "admin"
        description: "Pool group with incorrect attribute type bug"
        members:
          - ip: "10.1.1.3"
            port: "abc"
            enable_ssl: true

    # Add more test cases as needed based on the heuristic

  # Define the random_port variable
  vars:
    random_port: "{{ 1024 + (ansible_play_hosts_all.index(inventory_hostname) * 10)|random }}"