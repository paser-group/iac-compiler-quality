---
- name: Test Ansible compiler for latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    # Randomly generate a port number within the range of 10000 to 20000
    random_port: "{{ 10000 + (ansible_play_hosts_all|length*1111) | random(seed=inventory_hostname) }}"

  tasks:
    - name: Display random port number
      debug:
        var: random_port

    - name: Send matrix message
      community.general.matrix:
        hs_url: "https://matrix.example.com"
        room_id: "!roomid:matrix.example.com"
        user_id: "ansiblebot"
        password: "123456"
        token: "your_token"
        msg_html: "<h1>Test HTML Message</h1>"
        msg_plain: "Test plain text message"
        port: "{{ random_port }}"
      register: matrix_result

    - name: Display matrix module result
      debug:
        var: matrix_result