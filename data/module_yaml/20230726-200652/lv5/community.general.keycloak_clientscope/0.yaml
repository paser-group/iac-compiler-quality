---
- name: Test Keycloak Client Scope
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Keycloak Client Scope
      community.general.keycloak_clientscope:
        auth_client_id: "admin-cli"
        auth_client_secret: "admin-secret"
        auth_keycloak_url: "https://keycloak.example.com/auth"
        auth_username: "admin"
        auth_password: "admin-password"
        realm: "my-realm"
        name: "My Client Scope"
        description: "Example client scope"
        protocol: "openid-connect"
        state: "{{ trigger_state }}"
      vars:
        trigger_state: "absent"
      register: result
      ignore_errors: true

    - name: Trigger Type-related Bug
      debug:
        msg: "{{ invalid_variable }}"

    - name: Clean Up Keycloak Client Scope
      community.general.keycloak_clientscope:
        auth_client_id: "admin-cli"
        auth_client_secret: "admin-secret"
        auth_keycloak_url: "https://keycloak.example.com/auth"
        auth_username: "admin"
        auth_password: "admin-password"
        realm: "my-realm"
        name: "My Client Scope"
        state: "{{ trigger_state }}"
      vars:
        trigger_state: "present"
      when: result is failed