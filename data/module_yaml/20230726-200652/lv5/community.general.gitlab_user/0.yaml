---
- name: Test Ansible Latent Type-Related Bugs in community.general.gitlab_user
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create GitLab User
      community.general.gitlab_user:
        api_url: "https://gitlab.example.com/api/v4/"
        api_username: "admin"
        api_password: "admin_password"
        validate_certs: false
        username: "testuser"
        password: "test@123"
        email: "testuser@example.com"
        state: present
        confirm: true
        access_level: "developer"
  
  # Test cases based on heuristic: 'Produce random port numbers to test port settings'
    - name: Test with a random port number
      community.general.gitlab_user:
        api_url: "https://gitlab.example.com:{{ 10000 | random }}/api/v4/"
        api_username: "admin"
        api_password: "admin_password"
        validate_certs: false
        username: "testuser"
        password: "test@123"
        email: "testuser@example.com"
        state: present
        confirm: true
        access_level: "developer"

    - name: Test with another random port number
      community.general.gitlab_user:
        api_url: "https://gitlab.example.com:{{ 20000 | random }}/api/v4/"
        api_username: "admin"
        api_password: "admin_password"
        validate_certs: false
        username: "testuser"
        password: "test@123"
        email: "testuser@example.com"
        state: present
        confirm: true
        access_level: "developer"