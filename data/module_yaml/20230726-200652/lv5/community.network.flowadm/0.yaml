---
- hosts: all
  gather_facts: false

  tasks:
    - name: Test flowadm module
      community.network.flowadm:
        name: "{{ item }}"
        local_ip: 10.1.1.{{ hostvars[item].inventory_hostname | regex_replace('(\\D+)', '') }}
        local_port: "{{ hostvars[item].inventory_hostname | regex_replace('(\\D+)', '') }}"
        remote_ip: 10.1.1.1
        state: present
      loop:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1
      vars:
        temporary: true

  post_tasks:
    - name: Print flowadm results
      debug:
        var: ansible_facts['community.network.flowadm']