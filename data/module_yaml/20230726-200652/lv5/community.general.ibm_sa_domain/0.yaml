---
- name: Manage IBM Spectrum Accelerate domains
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Manage domain
      community.general.ibm_sa_domain:
        domain: "mydomain"
        endpoints: "{{ item }}"
        hard_capacity: "500"
        ldap_id: "12345"
        max_cgs: "10"
        max_dms: "20"
        max_mirrors: "5"
        max_pools: "3"
        max_volumes: "30"
        password: "mypassword"
        perf_class: "best"
        size: "100"
        soft_capacity: "400"
        state: "present"
        username: "myusername"
      loop:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3
        - 10.1.1.4
      register: result

    - name: Debug result
      debug:
        var: result

    - name: Test port settings
      community.general.ibm_sa_domain:
        domain: "mydomain"
        endpoints: "{{ item }}"
        password: "mypassword"
        username: "myusername"
        port: "{{ 20000 | random }}"
        state: "present"
      loop:
        - 10.1.1.1
        - 10.1.1.2
        - 10.1.1.3
        - 10.1.1.4
      register: port_result

    - name: Debug port result
      debug:
        var: port_result