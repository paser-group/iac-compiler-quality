- hosts: localhost
  gather_facts: false
  tasks:
    - name: Set up inventory
      set_fact:
        influxdb_nodes:
          - name: ubuntu1
            ip: 10.1.1.1
            distribution: ubuntu
          - name: alpine1
            ip: 10.1.1.2
            distribution: alpine
          - name: centos1
            ip: 10.1.1.3
            distribution: centos
          - name: redhat1
            ip: 10.1.1.4
            distribution: redhat

    - name: Generate random port number
      set_fact:
        influxdb_port: "{{ 10000 | random}}"

    - name: Test 'community.general.influxdb_user'
      influxdb_user:
        hostname: "{{ item.ip }}"
        username: admin
        password: admin
        port: "{{ influxdb_port }}"
        admin: true
        state: present
      with_items: "{{ influxdb_nodes }}"