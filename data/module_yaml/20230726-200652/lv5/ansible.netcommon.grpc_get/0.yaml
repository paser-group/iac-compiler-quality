---
- name: Test playbook for ansible.netcommon.grpc_get module
  hosts: localhost
  gather_facts: false

  vars:
    port_range: [10000, 65535]

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ port_range | random }}"


    - name: Fetch configuration/state data from gRPC
      ansible.netcommon.grpc_get:
        command: fetch
        data_type: config
        display: json
        section: system
        port: "{{ random_port }}"
      register: result
      ignore_errors: true

    - debug:
        var: result