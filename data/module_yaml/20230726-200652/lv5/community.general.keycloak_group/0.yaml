---
- name: Test Keycloak Group Module
  hosts: localhost
  gather_facts: false

  vars:
    keycloak_url: "http://localhost:{{ 8000 | random }}"
    group_name: test_group

  tasks:
    - name: Create Keycloak group
      community.general.keycloak_group:
        auth_username: "admin"
        auth_password: "admin"
        auth_realm: "master"
        auth_keycloak_url: "{{ keycloak_url }}"
        name: "{{ group_name }}"
      register: result

    - name: Debug output
      debug:
        var: result

    - name: Update Keycloak group
      community.general.keycloak_group:
        auth_username: "admin"
        auth_password: "admin"
        auth_realm: "master"
        auth_keycloak_url: "{{ keycloak_url }}"
        name: "{{ group_name }}"
        parents: ["parent_group1", "parent_group2"]
      register: result

    - name: Debug output
      debug:
        var: result

    - name: Delete Keycloak group
      community.general.keycloak_group:
        auth_username: "admin"
        auth_password: "admin"
        auth_realm: "master"
        auth_keycloak_url: "{{ keycloak_url }}"
        name: "{{ group_name }}"
        state: "absent"
      register: result

    - name: Debug output
      debug:
        var: result