- name: Testing playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create VM
      community.general.proxmox_kvm:
        api_host: "10.1.1.1"  # Replace with appropriate API host
        api_user: "admin"     # Replace with appropriate API user
        api_password: "password"   # Replace with appropriate API password
        vmid: 100
        name: "test-vm"
        memory: 512
        cores: 2
        boot: "c"
        state: "present"
        ostype: "l26"
      register: result
    - debug:
        var: result

- name: Testing playbook with port settings
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create VM with random port number
      community.general.proxmox_kvm:
        api_host: "10.1.1.1"
        api_user: "admin"
        api_password: "password"
        vmid: 100
        name: "test-vm"
        memory: 512
        cores: 2
        boot: "c"
        state: "present"
        ostype: "l26"
        hotplug: "{{ random_port }}"
      register: result
    - debug:
        var: result