---
- name: Ansible Latent Type-Related Bug Finder
  hosts: localhost
  gather_facts: false

  vars:
    auth_client_id: "client_id"
    auth_client_secret: "client_secret"
    auth_keycloak_url: "http://keycloak_url/auth"
    auth_password: "password"
    auth_realm: "master"
    auth_username: "admin"
    connection_timeout: 5
    http_agent: "Ansible-Agent"
    id: "{{ inventory_hostname }}"
    name: "Keycloak Federation"
    parent_id: "master"
    provider_id: "ldap-provider"
    provider_type: "org.keycloak.storage.ldap.LDAPStorageProvider"
    realm: "master"
    state: "present"
    token: "test_token"
    validate_certs: true

  tasks:
    - name: Test Keycloak User Federation Module
      community.general.keycloak_user_federation:
        auth_client_id: "{{ auth_client_id }}"
        auth_client_secret: "{{ auth_client_secret }}"
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_password: "{{ auth_password }}"
        auth_realm: "{{ auth_realm }}"
        auth_username: "{{ auth_username }}"
        config:
          connectionTimeout: "{{ connection_timeout }}"
          httpAgent: "{{ http_agent }}"
        id: "{{ id }}"
        mappers:
          - name: "Mapper1"
            attributes:
              - "attribute1"
            claim: "claim1"
            consentRequired: true
            defaultValue: "default"
            ldapAttribute: "ldapAttribute1"
            readOnly: false
            userType: "userType1"
        name: "{{ name }}"
        parent_id: "{{ parent_id }}"
        provider_id: "{{ provider_id }}"
        provider_type: "{{ provider_type }}"
        realm: "{{ realm }}"
        state: "{{ state }}"
        token: "{{ token }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - debug:
        var: result