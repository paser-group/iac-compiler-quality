- name: Test playbook for 'community.network.avi_snmptrapprofile' module
  hosts: localhost
  gather_facts: False

  vars:
    avi_credentials:
      controller: "10.1.1.1"
      username: "admin"
      password: "password"

  tasks:
    - name: Create SNMP Trap Profile with random port number
      community.network.avi_snmptrapprofile:
        controller: "{{ avi_credentials.controller }}"
        username: "{{ avi_credentials.username }}"
        password: "{{ avi_credentials.password }}"
        name: "TestTrapProfile"
        trap_servers:
          - ip: "10.1.1.2"
            port: "{{ 10000 | random }}"
          - ip: "10.1.1.3"
            port: "{{ 10000 | random }}"
          - ip: "10.1.1.4"
            port: "{{ 10000 | random }}"
        tenant: "Default"
        state: "present"
      register: result

    - name: Debug SNMP Trap Profile creation result
      debug:
        var: result