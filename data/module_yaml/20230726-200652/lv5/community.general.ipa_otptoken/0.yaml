---
- name: Test community.general.ipa_otptoken module
  hosts: localhost
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 1024 + (ansible_random * (65535 - 1024 + 1)) | int }}"
      become: false

    - name: Test with random values
      community.general.ipa_otptoken:
        algorithm: "sha1"
        counter: "{{ random_port }}"
        description: "Test OTP Token"
        digits: 6
        enabled: true
        interval: 30
        ipa_host: "example.com"
        ipa_pass: "password"
        ipa_port: "{{ random_port }}"
        ipa_prot: "https"
        ipa_timeout: 10
        ipa_user: "admin"
        model: "YubiKey"
        newuniqueid: "1234567890"
        notafter: "2023-12-31"
        notbefore: "2020-01-01"
        offset: 0
        otptype: "totp"
        owner: "user"
        secretkey: "secret"
        serial: "12345"
        state: "present"
        uniqueid: "0987654321"
        validate_certs: true
        vendor: "Vendor"

    - name: Debug results
      debug:
        msg: "{{ community_general_ipa_otptoken }}"