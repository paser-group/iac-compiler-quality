---
- name: Ansible Latent Bug Finder Playbook
  hosts: linux_nodes
  gather_facts: false
  become: true

  tasks:
    - name: Query Btrfs filesystem info
      community.general.btrfs_info:
        path: /
      register: btrfs_info

    - name: Debug Btrfs filesystem info
      debug:
        var: btrfs_info

    - name: Test random port number 1
      community.general.btrfs_info:
        path: /
        port: "{{ 30000 + (ansible_play_hosts_all | length * 10) }}"
      register: btrfs_info_random_port_1

    - name: Debug Btrfs filesystem info with random port number 1
      debug:
        var: btrfs_info_random_port_1

    - name: Test random port number 2
      community.general.btrfs_info:
        path: /
        port: "{{ 40000 + (ansible_play_hosts_all | length * 10) }}"
      register: btrfs_info_random_port_2

    - name: Debug Btrfs filesystem info with random port number 2
      debug:
        var: btrfs_info_random_port_2