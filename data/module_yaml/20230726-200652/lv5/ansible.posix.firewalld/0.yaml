---
- name: Manage firewalld rules
  hosts: localhost
  gather_facts: false
  vars:
    firewall_ports:
      - "80/tcp"
      - "443/tcp"
      - "8080/tcp"
  tasks:
    - name: Ensure firewalld is running
      service:
        name: firewalld
        state: started

    - name: Allow specified ports
      firewalld:
        port: "{{ item }}"
        state: enabled
      loop: "{{ firewall_ports }}"

    - name: Deny all other incoming connections
      firewalld:
        state: disabled
        immediate: true

    - name: Save firewall rules
      firewalld:
        state: saved
        permanent: true