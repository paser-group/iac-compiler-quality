---
- name: Create or update GitLab group variables
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port number
      set_fact:
        random_port: "{{ range(10000, 32767) | random }}"

    - name: Create or update GitLab group variables
      community.general.gitlab_group_variable:
        validate_certs: false
        api_url: "https://gitlab.example.com:{{ random_port }}/api/v4"
        api_token: 123456789
        group: my_group
        variables:
          - key: variable1
            value: true
          - key: variable2
            value: 42
        state: present
      register: result

    - debug:
        var: result