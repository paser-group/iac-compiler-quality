---
- name: Expose Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure SmartOS virtual machine
      community.general.vmadm:
        autoboot: "{{ item.autoboot }}"
        boot: "{{ item.boot }}"
        cpu_cap: "{{ item.cpu_cap }}"
        cpu_shares: "{{ item.cpu_shares }}"
        cpu_type: "{{ item.cpu_type }}"
        delegate_dataset: "{{ item.delegate_dataset }}"
        disks: "{{ item.disks }}"
        dns_domain: "{{ item.dns_domain }}"
        hostname: "{{ item.hostname }}"
        image_uuid: "{{ item.image_uuid }}"
        name: "{{ item.name }}"
        nic_driver: "{{ item.nic_driver }}"
        nics: "{{ item.nics }}"
        ram: "{{ item.ram }}"
        routes: "{{ item.routes }}"
        state: "{{ item.state }}"
        tmpfs: "{{ item.tmpfs }}"
        vcpus: "{{ item.vcpus }}"
      loop:
        - { autoboot: true, boot: "zvols", cpu_cap: 100, cpu_shares: 1024, cpu_type: "qemu64", delegate_dataset: false, disks: ["/dev/zvol/dsk/disk0"], dns_domain: "example.com", hostname: "vm1", image_uuid: "c5731554-a982-4821-88ef-a533a65532d9", name: "vm1", nic_driver: "virtio", nics: [{"nic_tag": "net0", "nic_ip": "10.1.1.5"}], ram: 8192, routes: {"net0": "10.1.1.0/24"}, state: "present", tmpfs: 256, vcpus: 4 }
        - { autoboot: "yes", boot: "none", cpu_cap: "200", cpu_shares: "2048", cpu_type: "host", delegate_dataset: "no", disks: ["/dev/zvol/dsk/disk0", "/dev/zvol/dsk/disk1"], dns_domain: "example.org", hostname: "vm2", image_uuid: "14e30e5d-1967-4df0-91d1-ee5ffab68ae4", name: "vm2", nic_driver: "e1000g", nics: [{"nic_tag": "net0", "nic_ip": "10.1.1.6"}, {"nic_tag": "net1", "nic_ip": "10.1.2.6"}], ram: "4096", routes: {"net0": "10.1.1.0/24", "net1": "10.1.2.0/24"}, state: "running", tmpfs: "512", vcpus: "2" }
        - { autoboot: false, boot: "cdrom", cpu_cap: 300, cpu_shares: 3072, cpu_type: "host-passthrough", delegate_dataset: true, disks: ["/dev/zvol/dsk/disk0"], dns_domain: "example.net", hostname: "vm3", image_uuid: "b31b17c9-3d43-42cb-9962-9e6378f58971", name: "vm3", nic_driver: "e1000", nics: [{"nic_tag": "net0", "nic_ip": "10.1.1.7"}], ram: 2048, routes: {"net0": "10.1.1.0/24"}, state: "stopped", tmpfs: 128, vcpus: 1 }