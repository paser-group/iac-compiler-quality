---
- name: Execute arbitrary commands on APCON OS
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 10000 | random }}"
  
    - name: Run arbitrary commands on APCON OS with random port
      community.network.apconos_command:
        commands:
          - "show port {{ random_port }}"
        interval: 10
        match: "#"
        retries: 3
        wait_for:
          - search(text="Port {{ random_port }}", regex=False)
      register: command_output
  
    - name: Display command output
      debug:
        var: command_output