- name: Test community.general.ibm_sa_pool module
  hosts: localhost
  gather_facts: false
  
  vars:
    domain: "{{ ansible_domain }}"
    endpoints: "{{ ansible_default_ipv4.address }}"
    password: "password"
    perf_class: "default"
    pool: "test_pool"
    size: "100"
    snapshot_size: "50"
    state: "present"
    username: "admin"

  tasks:
    - name: Create random port number
      set_fact:
        random_port: "{{ 1000 | random(inventory_hostname_hash) }}"

    - name: Test community.general.ibm_sa_pool module
      community.general.ibm_sa_pool:
        domain: "{{ domain }}"
        endpoints: "{{ endpoints }}"
        password: "{{ password }}"
        perf_class: "{{ perf_class }}"
        pool: "{{ pool }}"
        size: "{{ size }}"
        snapshot_size: "{{ snapshot_size }}"
        state: "{{ state }}"
        username: "{{ username }}"
        port: "{{ random_port }}"
      register: result

    - name: Debug result
      debug:
        var: result