---
- name: Discover latent type-related bugs in Ansible
  hosts: all
  gather_facts: false
  vars:
    autocommit: "{{ random_boolean }}"
    database: "mydatabase"
    encrypted: "{{ random_boolean }}"
    filepath:
      - "{{ random_file_path }}"
      - "{{ random_file_path }}"
    host: "hostname.example.com"
    instance: "00"
    password: "password123"
    query:
      - "SELECT * FROM table1"
      - "SELECT * FROM table2"
    sid: "DEV"
    user: "myuser"
    userstore: "{{ random_boolean }}"
  tasks:
    - name: Debug connection variables
      debug:
        msg: "{{ hostvars[inventory_hostname] }}"
    - name: Test hana_query module
      community.general.hana_query:
        autocommit: "{{ autocommit }}"
        database: "{{ database }}"
        encrypted: "{{ encrypted }}"
        filepath: "{{ filepath }}"
        host: "{{ host }}"
        instance: "{{ instance }}"
        password: "{{ password }}"
        query: "{{ query }}"
        sid: "{{ sid }}"
        user: "{{ user }}"
        userstore: "{{ userstore }}"
      register: result

    - name: Generate random port number for port settings
      set_fact:
        random_port: "{{ 1024 + inventory_hostname.split('.')[3] | int }}"
      changed_when: false
      
    - name: Debug random port number
      debug:
        var: random_port