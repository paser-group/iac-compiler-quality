---
- name: Test Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    auth_client_id: "{{ lookup('env', 'AUTH_CLIENT_ID') }}"
    auth_client_secret: "{{ lookup('env', 'AUTH_CLIENT_SECRET') }}"
    auth_keycloak_url: "{{ lookup('env', 'AUTH_KEYCLOAK_URL') }}"
    auth_password: "{{ lookup('env', 'AUTH_PASSWORD') }}"
    auth_realm: "{{ lookup('env', 'AUTH_REALM') }}"
    auth_username: "{{ lookup('env', 'AUTH_USERNAME') }}"
    client_id: "{{ lookup('env', 'CLIENT_ID') }}"
    connection_timeout: 10
    http_agent: "Ansible"
    id: "{{ lookup('env', 'ID') }}"
    realm: "{{ lookup('env', 'REALM') }}"
    token: "{{ lookup('env', 'TOKEN') }}"
    validate_certs: "{{ lookup('env', 'VALIDATE_CERTS') | default(true) }}"

  tasks:
    - name: Regenerate Keycloak client secret
      community.general.keycloak_clientsecret_regenerate:
        auth_client_id: "{{ auth_client_id }}"
        auth_client_secret: "{{ auth_client_secret }}"
        auth_keycloak_url: "{{ auth_keycloak_url }}"
        auth_password: "{{ auth_password }}"
        auth_realm: "{{ auth_realm }}"
        auth_username: "{{ auth_username }}"
        client_id: "{{ client_id }}"
        connection_timeout: "{{ connection_timeout }}"
        http_agent: "{{ http_agent }}"
        id: "{{ id }}"
        realm: "{{ realm }}"
        token: "{{ token }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Display the result
      debug:
        var: result