---
- name: Test Riak module
  hosts: localhost
  vars:
    riak_config_dir: "/etc/riak"
    riak_http_port: "{{ 10000 | random }}"
    riak_pb_port: "{{ 8087 | random }}"
    riak_target_node: "riak@127.0.0.1"
    riak_validate_certs: true
    riak_wait_for_handoffs: 10
    riak_wait_for_ring: 10
    riak_wait_for_service: "running"
  tasks:
    - name: Install Riak
      community.general.riak:
        command: install
        config_dir: "{{ riak_config_dir }}"
        http_conn: "127.0.0.1:{{ riak_http_port }}"
        target_node: "{{ riak_target_node }}"
        validate_certs: "{{ riak_validate_certs }}"
        wait_for_handoffs: "{{ riak_wait_for_handoffs }}"
        wait_for_ring: "{{ riak_wait_for_ring }}"
        wait_for_service: "{{ riak_wait_for_service }}"
      register: riak_install
    
    - name: Debug Riak installation
      debug:
        var: riak_install
    
    - name: Configure Riak
      community.general.riak:
        command: configure
        config_dir: "{{ riak_config_dir }}"
      register: riak_configure
    
    - name: Debug Riak configuration
      debug:
        var: riak_configure