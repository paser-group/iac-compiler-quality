---
- name: Random port test playbook
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Generate random port numbers
      shell: echo $(( $RANDOM % 65535 + 1 ))
      register: random_port

    - name: Test bridge_domain_id with random port
      community.network.ce_vxlan_tunnel:
        bridge_domain_id: "{{ random_port.stdout }}"
        provider:
          host: "{{ lookup('env', 'ANSIBLE_NETWORK_GROUP_HOST') }}"
          port: "{{ lookup('env', 'ANSIBLE_NETWORK_GROUP_PORT') | default(4789) | int }}"
          username: "{{ lookup('env', 'ANSIBLE_NETWORK_GROUP_USERNAME') }}"
          password: "{{ lookup('env', 'ANSIBLE_NETWORK_GROUP_PASSWORD') }}"

      when: False