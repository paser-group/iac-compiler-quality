---
- name: Configure authentication with Keycloak
  hosts: localhost
  tasks:
    - name: Generate random port number
      community.general.random_string:
        length: 4
        chars: "{{ '0123456789' }}"
      register: random_port

    - name: Configure Keycloak Authentication
      community.general.keycloak_authentication:
        alias: "my-alias"
        auth_client_id: "my-client-id"
        auth_client_secret: "my-client-secret"
        auth_keycloak_url: "https://keycloak.example.com/auth:{{ random_port.result }}"
        auth_password: "my-password"
        auth_realm: "my-realm"
        auth_username: "my-username"
        authenticationExecutions:
          - execution: "execution1"
            flow: "flow1"
          - execution: "execution2"
            flow: "flow2"
        connection_timeout: 30
        copyFrom: "/path/to/source/file"
        description: "My Keycloak authentication configuration"
        force: true
        http_agent: "My HTTP client agent"
        providerId: "my-provider-id"
        realm: "my-realm"
        state: "present"
        token: "my-token"
        validate_certs: false
      register: keycloak_auth

    - name: Debug keycloak_auth output
      debug:
        var: keycloak_auth