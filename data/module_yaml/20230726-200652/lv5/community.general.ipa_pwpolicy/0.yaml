---
- name: Test Ansible Latent Type-Related Bugs - community.general.ipa_pwpolicy
  hosts: localhost
  gather_facts: false

  vars:
    failinterval: "1m"
    group: "users"
    historylength: "10"
    ipa_host: "ipa.example.com"
    ipa_pass: "ipa_password"
    ipa_port: "{{ random_port }}"
    ipa_prot: "http"
    ipa_timeout: 30
    ipa_user: "admin"
    lockouttime: "5m"
    maxfailcount: "5"
    maxpwdlife: "90d"
    minclasses: "4"
    minlength: "10"
    minpwdlife: "1d"
    priority: "1"
    state: "present"
    validate_certs: false

  vars_prompt:
    - name: random_port
      prompt: "Enter a random port number for testing (1-65535):"
      private: no

  tasks:
    - name: Set random_port fact
      set_fact:
        random_port: "{{ random_port }}"

    - name: Test community.general.ipa_pwpolicy module
      community.general.ipa_pwpolicy:
        failinterval: "{{ failinterval }}"
        group: "{{ group }}"
        historylength: "{{ historylength }}"
        ipa_host: "{{ ipa_host }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        ipa_user: "{{ ipa_user }}"
        lockouttime: "{{ lockouttime }}"
        maxfailcount: "{{ maxfailcount }}"
        maxpwdlife: "{{ maxpwdlife }}"
        minclasses: "{{ minclasses }}"
        minlength: "{{ minlength }}"
        minpwdlife: "{{ minpwdlife }}"
        priority: "{{ priority }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Display module output
      debug:
        var: result