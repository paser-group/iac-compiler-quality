- name: Test playbook for community.network.pn_stp module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set inventory variables
      set_fact:
        inventory_bridge_id: "0100"
        inventory_bridge_priority: "0"
        inventory_cliswitch: "xos_switch"
        inventory_enable: yes
        inventory_forwarding_delay: "15"
        inventory_hello_time: "2"
        inventory_max_age: "20"
        inventory_mst_config_name: "mst_config"
        inventory_mst_max_hops: "5"
        inventory_root_guard_wait_time: "30"
        inventory_stp_mode: "rstp"
        inventory_state: "present"

    - name: Configure STP
      community.network.pn_stp:
        pn_bpdus_bridge_ports:
          - { pn_port: "1/1", pn_bridge_id: "{{ inventory_bridge_id }}", pn_bridge_priority: "{{ inventory_bridge_priority }}"}
          - { pn_port: "1/2", pn_bridge_id: "{{ inventory_bridge_id }}", pn_bridge_priority: "{{ inventory_bridge_priority }}"}
          - { pn_port: "1/3", pn_bridge_id: "{{ inventory_bridge_id }}", pn_bridge_priority: "{{ inventory_bridge_priority }}"}
          - { pn_port: "1/4", pn_bridge_id: "{{ inventory_bridge_id }}", pn_bridge_priority: "{{ inventory_bridge_priority }}"}
        pn_cliswitch: "{{ inventory_cliswitch }}"
        pn_enable: "{{ inventory_enable }}"
        pn_forwarding_delay: "{{ inventory_forwarding_delay }}"
        pn_hello_time: "{{ inventory_hello_time }}"
        pn_max_age: "{{ inventory_max_age }}"
        pn_mst_config_name: "{{ inventory_mst_config_name }}"
        pn_mst_max_hops: "{{ inventory_mst_max_hops }}"
        pn_root_guard_wait_time: "{{ inventory_root_guard_wait_time }}"
        pn_stp_mode: "{{ inventory_stp_mode }}"
        state: "{{ inventory_state }}"
      delegate_to: localhost

    - name: Display output
      debug:
        var: ansible_facts.community_network_pn_stp_result