- name: Test community.general.pids module
  hosts: all
  gather_facts: false

  tasks:
    - name: Produce random port numbers
      shell: "shuf -i 1024-65535 -n 1"
      register: random_port

    - name: Check port process IDs
      community.general.pids:
        name: "processName"  # Replace processName with an actual process name to test
        pattern: "/path/to/process"  # Replace /path/to/process with the actual process path to test
        port: "{{ random_port.stdout|int }}"  # Test different random port numbers
        connections: "established"
      register: pids_result

    - name: Debug pids_result
      debug:
        var: pids_result