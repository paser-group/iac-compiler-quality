---
- name: Publish MQTT message
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Publish message
      mqtt:
        server: "mqtt.example.com"
        port: "{{ mqtt_port }}"
        username: "test_user"
        password: "test_password"
        tls_version: "tlsv1.2"
        client_id: "mqtt-client"
        ca_cert: "/path/to/ca.crt"
        client_cert: "/path/to/client.crt"
        client_key: "/path/to/client.key"
        topic: "test/topic"
        payload: "Hello, MQTT!"
        qos: "1"
        retain: false
      register: mqtt_result

    - name: Display MQTT publish result
      debug:
        var: mqtt_result