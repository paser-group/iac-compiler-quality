---
- name: Test community.network.ce_facts module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Import community.network.ce_facts module
      import_module:
        module_name: community.network.ce_facts
      vars:
        gather_subset: None
  
    - name: Generate random port number
      script: /path/to/random_port_generator.py
      register: random_port_result

    - debug:
        var: random_port_result

    - name: Gather HUAWEI facts
      community.network.ce_facts:
        gather_subset: "{{ gather_subset | default('None') }}"
        port: "{{ random_port_result.stdout }}"
      register: ce_facts_result

    - name: Debug ce_facts_result
      debug:
        var: ce_facts_result