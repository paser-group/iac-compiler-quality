---
- hosts: localhost
  gather_facts: false

  tasks:
    - name: Test Honeybadger.io deployment
      hosts: localhost
      tasks:
        - name: Include required modules
          include_vars:
            file: "{{ playbook_dir }}/vars.yml"

        - name: Install community.general collection
          ansible.builtin.command:
            cmd: ansible-galaxy collection install community.general
            warn: "{{ enabled | bool }}"

        - name: Notify Honeybadger.io
          community.general.honeybadger_deployment:
            environment: "{{ honeybadger_environment }}"
            repo: "{{ honeybadger_repo }}"
            revision: "{{ honeybadger_revision }}"
            token: "{{ honeybadger_token }}"
            url: "{{ honeybadger_url }}"
            user: "{{ honeybadger_user }}"
            validate_certs: "{{ honeybadger_validate_certs }}"