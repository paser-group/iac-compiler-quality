---
- hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port
      set_fact:
        random_port: "{{ 30000 | random }}"
    
    - name: Retrieve public IP
      community.general.ipify_facts:
        api_url: "https://api.ipify.org"
        timeout: "{{ random_port }}"
        validate_certs: true
      register: public_ip

    - name: Print public IP
      debug:
        var: public_ip.ansible_facts.ipify_public_ip