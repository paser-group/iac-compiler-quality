---
- name: Test playbook for community.general.yum_versionlock module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Install the community.general.yum_versionlock module dependencies
      yum:
        name: python3-pip
        state: present
      become: true

    - name: Install the community.general.yum_versionlock module
      pip:
        name: ansible_collections.community.general.yum_versionlock

    - name: Initialize versionlock status
      versionlock_init:
      become: true

    - name: Lock package(s) from being updated
      community.general.yum_versionlock:
        name:
          - package1
          - package2
        state: present
      become: true

    - name: Unlock package(s) to allow updates
      community.general.yum_versionlock:
        name:
          - package1
          - package2
        state: absent
      become: true

    - name: Test random port settings
      community.general.yum_versionlock:
        name: package3
        state: present
        port: "{{ 20000 | random }}"
      become: true