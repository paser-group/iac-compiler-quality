- hosts: localhost
  gather_facts: false

  vars:
    subnet: "10.1.1.0/24"
    gateway: "10.1.1.254"
    nodes:
      - name: "ubuntu1"
        ip: "10.1.1.1"
        distro: "ubuntu"
      - name: "alpine1"
        ip: "10.1.1.2"
        distro: "alpine"
      - name: "centos1"
        ip: "10.1.1.3"
        distro: "centos"
      - name: "redhat1"
        ip: "10.1.1.4"
        distro: "redhat"

  tasks:
    - name: Create network
      docker_network:
        name: "node-net"
        subnet: "{{ subnet }}"
        gateway: "{{ gateway }}"

    - name: Create Docker containers
      docker_container:
        name: "{{ item.name }}"
        image: "docker_{{ item.distro }}"
        state: started
        ip_address: "{{ item.ip }}"
      loop: "{{ nodes }}"

    - name: Configure VDO module
      community.general.vdo:
        name: "myvdo"
        device: "/dev/sdb"
        state: present
        ackthreads: "200"  # Potential type-related bug
        activated: true
        biothreads: "100"  # Potential type-related bug
        blockmapcachesize: "32M"  # Potential type-related bug
        compression: "lz4"  # Potential type-related bug
        cputhreads: "4"  # Potential type-related bug
        deduplication: "true"  # Potential type-related bug
        emulate512: false
        force: true
        growphysical: true
        indexmem: "512M"  # Potential type-related bug
        indexmode: "packed"  # Potential type-related bug
        logicalsize: "10G"  # Potential type-related bug
        logicalthreads: "2"  # Potential type-related bug
        physicalthreads: "4"  # Potential type-related bug
        readcache: "sequential"  # Potential type-related bug
        readcachesize: "64M"  # Potential type-related bug
        running: true
        slabsize: "128M"  # Potential type-related bug
        writepolicy: "auto"  # Potential type-related bug

    - name: Generate random port numbers
      set_fact:
        random_port: "{{ 5000 | random }}"
      loop: "{{ range(10) | list }}"

    - name: Debug port numbers
      debug:
        msg: "Random port number: {{ random_port }}"