---
- name: Test Ansible GitLab Runner Module
  hosts: localhost
  gather_facts: false

  vars:
    gitlab_runner_name: "MyRunner"
    gitlab_runner_url: "http://example.com/ci"
    gitlab_runner_token: "my-runner-token"
    gitlab_runner_description: "My GitLab Runner"
    gitlab_runner_tags: ["tag1", "tag2"]
    gitlab_runner_state: "present"

  tasks:
    - name: Create GitLab Runner
      community.general.gitlab_runner:
        name: "{{ gitlab_runner_name }}"
        url: "{{ gitlab_runner_url }}"
        token: "{{ gitlab_runner_token }}"
        description: "{{ gitlab_runner_description }}"
        tags: "{{ gitlab_runner_tags }}"
        state: "{{ gitlab_runner_state }}"
      register: result
      changed_when: false

    - name: Debug Runner Info
      debug:
        var: result

    - name: Modify GitLab Runner
      community.general.gitlab_runner:
        name: "{{ gitlab_runner_name }}"
        url: "{{ gitlab_runner_url }}"
        token: "{{ gitlab_runner_token }}"
        description: "Modified Runner"
        tags: ["tag3", "tag4"]
        state: "{{ gitlab_runner_state }}"
      register: result
      changed_when: false

    - name: Debug Runner Info
      debug:
        var: result

    - name: Remove GitLab Runner
      community.general.gitlab_runner:
        name: "{{ gitlab_runner_name }}"
        url: "{{ gitlab_runner_url }}"
        token: "{{ gitlab_runner_token }}"
        state: "absent"
      register: result
      changed_when: false

    - name: Debug Runner Info
      debug:
        var: result