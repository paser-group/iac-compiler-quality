---
- hosts: all
  gather_facts: false
  vars:
    auth_token: "TOKEN"
    baseuri: "https://idrac.example.com"
    username: "admin"
    password: "password"
    category: "Systems"
    resource_id: "System.Embedded.1"

  tasks:
    - name: Set random port number
      set_fact:
        port: "{{ 10000 | random(start=1000, end=65535) }}"

    - name: Execute Redfish command on iDRAC
      community.general.idrac_redfish_command:
        auth_token: "{{ auth_token }}"
        baseuri: "{{ baseuri }}"
        username: "{{ username }}"
        password: "{{ password }}"
        category: "{{ category }}"
        resource_id: "{{ resource_id }}"
        command:
          - "get"
          - "/Systems/{{ resource_id }}/"
        timeout: 10
        port: "{{ port }}"
      register: result

    - name: Display command output
      debug:
        var: result.stdout