- name: Test UTM Proxy Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create reverse proxy location
      community.general.utm_proxy_location_info:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
        utm_host: "{{ item.utm_host }}"
        utm_port: "{{ item.utm_port }}"
        utm_protocol: "{{ item.utm_protocol }}"
        utm_token: "{{ item.utm_token }}"
        validate_certs: "{{ item.validate_certs }}"
        headers: "{{ item.headers }}"
      loop:
        - { name: "test_location_1", state: "present", utm_host: "example.com", utm_port: 8080, utm_protocol: "http", utm_token: "abc123", validate_certs: true, headers: { "header1": "value1", "header2": "value2" } }
        - { name: "test_location_2", state: "absent", utm_host: "example.com", utm_port: 8443, utm_protocol: "https", utm_token: "def456", validate_certs: false, headers: { "header3": "value3", "header4": "value4" } }

    - name: Print reverse proxy locations
      debug:
        var: ansible_facts.community_general_utm_proxy_location_info

- name: Test Random Port Numbers
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port numbers
      ansible.builtin.set_fact:
        random_port: "{{ 8000 + (item | random) }}"
      loop: "{{ range(0, 5, 1) | list }}"

    - name: Print random port numbers
      debug:
        var: random_port