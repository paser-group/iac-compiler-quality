---
- name: Test gitlab_protected_branch module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port number
      community.general.random_string:
        length: 5
        digits: true
      register: random_port

    - name: Install required dependencies
      pip:
        name:
          - python-gitlab
          - urllib3

    - name: Test gitlab_protected_branch
      community.general.gitlab_protected_branch:
        api_url: "https://gitlab.example.com:{{ random_port.stdout }}/api/v4"
        api_token: "{{ lookup('env', 'GITLAB_API_TOKEN') }}"
        project: "myproject"
        name: 123
        state: present
        push_access_level: none
        merge_access_levels:
          - developer
          - maintainer
      register: result

    - name: Print module result
      debug:
        var: result