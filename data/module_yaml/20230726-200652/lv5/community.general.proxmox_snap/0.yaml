---
- name: Manage Proxmox snapshots
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create snapshots
      community.general.proxmox_snap:
        api_user: admin
        api_password: secret
        api_token_id: token
        api_token_secret: token_secret
        api_host: proxmox.example.com
        hostname: "{{ item }}"
        snapname: "{{ item }}"
        state: present
        timeout: 5
        unbind: false
        validate_certs: true
        vmid: 100
        vmstate: true
      loop:
        - ubuntu1
        - alpine1
        - centos1
        - redhat1

    - name: Test port settings
      community.general.proxmox_snap:
        api_user: admin
        api_password: secret
        api_token_id: token
        api_token_secret: token_secret
        api_host: proxmox.example.com
        hostname: localhost
        snapname: snapshot-test
        state: present
        timeout: "{{ timeout }}"
        unbind: "{{ unbind }}"
        validate_certs: "{{ validate_certs }}"
        vmid: 100
        vmstate: true
      vars:
        timeout: "{{ random_timeout | default(10) }}"
        validate_certs: "{{ random_validate_certs | default(true) }}"
        unbind: "{{ random_unbind | default(true) }}"