- name: Test playbook for ansible.builtin.rpm_key module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add gp key
      ansible.builtin.rpm_key:
        fingerprint: "{{ random_port() }}"
        key: "{{ random_port() }}"
        state: present
        validate_certs: true
      register: result
      ignore_errors: true

    - name: Show debug output
      debug:
        var: result

    - name: Remove gp key
      ansible.builtin.rpm_key:
        fingerprint: "{{ random_port() }}"
        key: "{{ random_port() }}"
        state: absent
        validate_certs: false
      register: result
      ignore_errors: true

    - name: Show debug output
      debug:
        var: result

- name: Include random port generation
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 10000 | random }}"

    - name: Show debug output
      debug:
        var: random_port