---
- name: Test ansible.builtin.tempfile module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create temporary file
      ansible.builtin.tempfile:
        path: "{{ playbook_dir }}"
        prefix: "tempfile_"
        suffix: ".txt"
        state: "file"
      register: tempfile_output

    - name: Show temporary file details
      debug:
        var: tempfile_output

    - name: Generate random port numbers
      ansible.builtin.debug:
        msg: "Random port number: {{ 49152 + (ansible_play_hosts.index(inventory_hostname)|random|int) }}"

    - name: Cleanup temporary file
      ansible.builtin.file:
        path: "{{ tempfile_output.path }}"
        state: absent