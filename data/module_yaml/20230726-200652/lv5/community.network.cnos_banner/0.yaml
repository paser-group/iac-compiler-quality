---
- name: Manage CNOS Banners
  hosts: network_devices
  gather_facts: false
  vars:
    banner_text: |
      Welcome to My Network Device!
      This is a sample multiline banner.
      Please contact the administrator for more information.

  tasks:
    - name: Configure CNOS banner
      community.network.cnos_banner:
        banner: motd
        state: present
        text: "{{ banner_text }}"
      register: result
      failed_when: result is not defined

    - name: Display CNOS banner
      debug:
        var: result

    - name: Test banner port setting
      community.network.cnos_banner:
        banner: login
        state: present
        text: "{{ banner_text }}"
        port: "{{ random_port }}"
      register: result2
      failed_when: result2 is not defined

    - name: Display CNOS banner with port
      debug:
        var: result2

    - name: Verify banner port setting
      debug:
        msg: "Port setting {{ random_port }} verified"

    - name: Test banner without port setting
      community.network.cnos_banner:
        banner: exec
        state: present
        text: "{{ banner_text }}"
        port: none
      register: result3
      failed_when: result3 is not defined

    - name: Display CNOS banner without port
      debug:
        var: result3

    - name: Verify no port in banner setting
      debug:
        msg: "No port setting verified"