---
- name: Test playbook for community.general.pubnub_blocks module
  hosts: localhost
  gather_facts: false

  vars:
    account: "my_account"
    application: "my_application"
    cache:
      key: "my_key"
      value: "my_value"
    changes:
      - type: "channel"
        operation: "add"
        value: "my_channel"
    description: "My PubNub Block"
    email: "test@example.com"
    event_handlers:
      - function: "my_function"
        channels:
          - "my_channel"
    keyset: "my_keyset"
    name: "My Block"
    password: "my_password"
    state: "present"
    validate_certs: false

  tasks:
    - name: Debug variables
      debug:
        var: item
      with_items:
        - account
        - application
        - cache
        - changes
        - description
        - email
        - event_handlers
        - keyset
        - name
        - password
        - state
        - validate_certs

    - name: Test pubnub_blocks module
      community.general.pubnub_blocks:
        account: "{{ account }}"
        application: "{{ application }}"
        cache: "{{ cache }}"
        changes: "{{ changes }}"
        description: "{{ description }}"
        email: "{{ email }}"
        event_handlers: "{{ event_handlers }}"
        keyset: "{{ keyset }}"
        name: "{{ name }}"
        password: "{{ password }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"

    ### Test cases for the heuristic: Produce random port numbers to test port settings ###
    - name: Random port number test
      community.general.pubnub_blocks:
        account: "{{ account }}"
        application: "{{ application }}"
        cache: "{{ cache }}"
        changes: "{{ changes }}"
        description: "{{ description }}"
        email: "{{ email }}"
        event_handlers: "{{ event_handlers }}"
        keyset: "{{ keyset }}"
        name: "{{ name }}"
        password: "{{ password }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        ports:
          - "{{ (30000..30050)|random }}"
          - "{{ (40000..40050)|random }}"