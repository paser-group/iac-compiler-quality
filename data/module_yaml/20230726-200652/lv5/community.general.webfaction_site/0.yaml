---
- name: Webfaction Site Test
  hosts: localhost
  gather_facts: false

  vars:
    webfaction_host: "your_webfaction_host"
    https: "invalid_value"
    login_name: "your_login_name"
    login_password: "your_login_password"
    site_name: "test_site"
    site_apps:
      - app1
      - app2
    state: "present"
    subdomains:
      - sub1
      - sub2

  tasks:
    - name: Add or Remove Webfaction site
      community.general.webfaction_site:
        host: "{{ webfaction_host }}"
        https: "{{ https }}"
        login_name: "{{ login_name }}"
        login_password: "{{ login_password }}"
        name: "{{ site_name }}"
        site_apps: "{{ site_apps }}"
        state: "{{ state }}"
        subdomains: "{{ subdomains }}"

    - name: Debug output
      debug:
        var: ansible_facts.community_general_webfaction_site_result

    - name: Remove Webfaction site
      community.general.webfaction_site:
        host: "{{ webfaction_host }}"
        https: "{{ https }}"
        login_name: "{{ login_name }}"
        login_password: "{{ login_password }}"
        name: "{{ site_name }}"
        state: "absent"
    
      when: ansible_facts.community_general_webfaction_site_result is defined and ansible_facts.community_general_webfaction_site_result != {}
      ignore_errors: true