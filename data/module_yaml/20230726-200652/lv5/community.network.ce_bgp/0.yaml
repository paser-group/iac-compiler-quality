---
- name: Manage BGP configuration on HUAWEI devices
  hosts: huawei_devices
  gather_facts: False

  tasks:
    - name: Configure BGP
      community.network.ce_bgp:
        as_number: "{{ as_number }}"
        as_path_limit: "{{ as_path_limit }}"
        bgp_rid_auto_sel: "{{ bgp_rid_auto_sel }}"
        check_first_as: "{{ check_first_as }}"
        clear_interval: "{{ clear_interval }}"
        confed_id_number: "{{ confed_id_number }}"
        confed_nonstanded: "{{ confed_nonstanded }}"
        confed_peer_as_num: "{{ confed_peer_as_num }}"
        conn_retry_time: "{{ conn_retry_time }}"
        default_af_type: "{{ default_af_type }}"
        ebgp_if_sensitive: "{{ ebgp_if_sensitive }}"
        gr_peer_reset: "{{ gr_peer_reset }}"
        graceful_restart: "{{ graceful_restart }}"
        hold_interval: "{{ hold_interval }}"
        hold_time: "{{ hold_time }}"
        is_shutdown: "{{ is_shutdown }}"
        keep_all_routes: "{{ keep_all_routes }}"
        keepalive_time: "{{ keepalive_time }}"
        memory_limit: "{{ memory_limit }}"
        min_hold_time: "{{ min_hold_time }}"
        router_id: "{{ router_id }}"
        state: "{{ state }}"
        suppress_interval: "{{ suppress_interval }}"
        time_wait_for_rib: "{{ time_wait_for_rib }}"
        vrf_name: "{{ vrf_name }}"
        vrf_rid_auto_sel: "{{ vrf_rid_auto_sel }}"
      register: result

    - name: Debug output
      debug:
        var: result

- name: Test Port Settings
  hosts: huawei_devices
  gather_facts: False

  tasks:
    - name: Produce random port numbers
      set_fact:
        port_number: "{{ 1024 | random }}"
      run_once: true

    - name: Print port number
      debug:
        var: port_number