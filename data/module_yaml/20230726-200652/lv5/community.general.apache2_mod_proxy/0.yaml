---
- name: Test Apache2 mod_proxy module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set and get members' attributes
      community.general.apache2_mod_proxy:
        balancer_url_suffix: "{{ random_port() }}"
        balancer_vhost: "example.com"
        member_host: "backend-server.com"
        state: "present"
        tls: "{{ random_boolean() }}"
        validate_certs: "{{ random_boolean() }}"
      register: result

    - name: Debug module output
      debug:
        var: result

  vars:
    # Generate random port number
    random_port: "{{ 10000 | random(limit=65000)}}"

    # Generate random boolean value
    random_boolean: "{{ [true, false] | random }}"

  tasks:
    - name: Set and get members' attributes
      community.general.apache2_mod_proxy:
        balancer_url_suffix: "{{ random_port }}"
        balancer_vhost: example.com
        member_host: backend-server.com
        state: present
        tls: "{{ random_boolean }}"
        validate_certs: "{{ random_boolean }}"
      register: result

    - name: Debug module output
      debug:
        var: result