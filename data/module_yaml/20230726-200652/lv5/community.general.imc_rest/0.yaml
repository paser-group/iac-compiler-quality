---
- name: Test for latent type-related bugs in Ansible module
  hosts: localhost
  gather_facts: false

  vars:
    random_ports:
      ubuntu1: "{{ 10000 + (inventory_hostname.index('ubuntu1') * 100) | random }}"
      alpine1: "{{ 10000 + (inventory_hostname.index('alpine1') * 100) | random }}"
      centos1: "{{ 10000 + (inventory_hostname.index('centos1') * 100) | random }}"
      redhat1: "{{ 10000 + (inventory_hostname.index('redhat1') * 100) | random }}"

  tasks:
    - name: Test IMC REST module for ubuntu1
      community.general.imc_rest:
        content: "Some content"
        hostname: "example.com"
        password: "password"
        path: "/api"
        protocol: "https"
        timeout: 10
        username: "admin"
        validate_certs: false
        port: "{{ random_ports['ubuntu1'] }}"
      register: ubuntu1_result

    - name: Test IMC REST module for alpine1
      community.general.imc_rest:
        content: "Some content"
        hostname: "example.com"
        password: "password"
        path: "/api"
        protocol: "https"
        timeout: 10
        username: "admin"
        validate_certs: false
        port: "{{ random_ports['alpine1'] }}"
      register: alpine1_result

    - name: Test IMC REST module for centos1
      community.general.imc_rest:
        content: "Some content"
        hostname: "example.com"
        password: "password"
        path: "/api"
        protocol: "https"
        timeout: 10
        username: "admin"
        validate_certs: false
        port: "{{ random_ports['centos1'] }}"
      register: centos1_result

    - name: Test IMC REST module for redhat1
      community.general.imc_rest:
        content: "Some content"
        hostname: "example.com"
        password: "password"
        path: "/api"
        protocol: "https"
        timeout: 10
        username: "admin"
        validate_certs: false
        port: "{{ random_ports['redhat1'] }}"
      register: redhat1_result

    - debug:
        var: item
      loop:
        - ubuntu1_result
        - alpine1_result
        - centos1_result
        - redhat1_result