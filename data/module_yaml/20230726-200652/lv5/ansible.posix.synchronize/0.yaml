- name: Synchronize files using ansible.posix.synchronize module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Sync files
      ansible.posix.synchronize:
        src: /path/to/source/
        dest: /path/to/destination/
        archive: true
        checksum: true
        compress: true
        copy_links: true
        delay_updates: true
        delete: true
        dest_port: "{{ random_port() }}"
        dirs: true
        existing_only: true
        group: true
        link_dest: 
          - /path/to/link1/
          - /path/to/link2/
        links: true
        mode: "0755"
        owner: true
        partial: true
        perms: true
        private_key: /path/to/private_key
        recursive: true
        rsync_opts: 
          - "--option1"
          - "--option2"
        rsync_path: "/usr/bin/rsync"
        rsync_timeout: 60
        set_remote_user: true
        src: /path/to/source/
        ssh_connection_multiplexing: true
        times: true
        use_ssh_args: true
        verify_host: true

      register: sync_result

    - name: Show synchronization result
      debug:
        var: sync_result

  vars:
    port_range_start: 1024
    port_range_end: 65535

  # Generate a random port number within the specified range
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ range_start + (ansible_play_hosts_all.index(inventory_hostname) | random(seed=inventory_hostname) % (range_end - range_start + 1)) }}"
      vars:
        range_start: "{{ port_range_start }}"
        range_end: "{{ port_range_end }}"