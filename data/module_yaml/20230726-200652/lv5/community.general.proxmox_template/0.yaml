---
- name: Test playbook for community.general.proxmox_template module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Test the proxmox_template module
      community.general.proxmox_template:
        api_host: "https://api.example.com"
        api_user: "myuser"
        api_password: "mypassword"
        api_token_id: "mytokenid"
        api_token_secret: "mytokensecret"
        content_type: "text/html"
        force: false
        node: "pve1"
        src: "/path/to/template.qcow2"
        state: "present"
        storage: "local"
        template: "mytemplate"
        timeout: 60
        validate_certs: true
      register: result

    - name: Print the result
      debug:
        var: result

    - name: Test with random port numbers
      community.general.proxmox_template:
        api_host: "https://api.example.com"
        api_user: "myuser"
        api_password: "mypassword"
        api_token_id: "mytokenid"
        api_token_secret: "mytokensecret"
        content_type: "text/html"
        force: false
        node: "pve1"
        src: "/path/to/template.qcow2"
        state: "present"
        storage: "local"
        template: "mytemplate"
        timeout: 60
        validate_certs: true
        port: "{{ 30000 | random }}"
      register: random_port_result

    - name: Print the result with random port
      debug:
        var: random_port_result