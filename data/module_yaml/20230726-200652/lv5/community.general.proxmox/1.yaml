- name: Test playbook for 'community.general.proxmox' module
  hosts: localhost
  gather_facts: false

  vars:
    # ... other variables ...

    random_port: "{{ 8000 | random(start=1024, end=65535) }}"

  tasks:
    - name: Create a new Proxmox instance
      community.general.proxmox:
        api_host: "{{ api_host }}"
        api_user: "{{ api_user }}"
        api_password: "{{ api_password }}"
        api_port: "{{ random_port }}"
        node: "{{ node }}"
        vmid: "{{ vmid }}"
        ostemplate: "{{ ostemplate }}"
        storage: "{{ storage }}"
        state: present
      register: result
      ignore_errors: true

    # ... other tasks ...