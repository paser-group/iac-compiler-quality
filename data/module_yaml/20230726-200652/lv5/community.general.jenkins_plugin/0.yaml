- name: Test Jenkins plugin installation
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Jenkins plugin
      community.general.jenkins_plugin:
        name: my-plugin
        url: "https://www.example.com/my-plugin.hpi"
        state: present
        force: "{{ force | default(false) }}"
        latest_plugins_url_segments:
          - "api/plugins"
          - "{{ random_port }}"
        update_json_url_segment:
          - "api/update-center/{{ random_port }}"
        updates_expiration: "{{ random_expiration | default(60) }}"
        updates_url:
          - "https://api.example.com/updates"
          - "{{ random_port }}"
        versioned_plugins_url_segments:
          - "api/plugins/{{ random_version }}"

      vars:
        random_port: "{{ 10000 + (inventory_hostname.split('.')[-1] | int) }}"
        random_expiration: "{{ 10 + (inventory_hostname.split('.')[-1] | int) }}"
        random_version: "{{ '1.0.' + (inventory_hostname.split('.')[-1]) }}"

  vars:
    force: false