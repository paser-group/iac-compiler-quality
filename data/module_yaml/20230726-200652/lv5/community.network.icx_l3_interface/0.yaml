---
- name: Test ICX L3 Interface Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure Layer-3 interface
      community.network.icx_l3_interface:
        name: "{{ item.name }}"
        ipv4: "{{ item.ipv4 }}"
        ipv6: "{{ item.ipv6 }}"
        mode: "{{ item.mode }}"
        state: "{{ item.state }}"
        check_running_config: "{{ item.check_running_config }}"
        secondary: "{{ item.secondary }}"
        aggregate: "{{ item.aggregate }}"
        replace: "{{ item.replace }}"
      loop:
        - name: "interface1"
          ipv4: "10.1.1.1"
          mode: "access"
          state: "present"
          check_running_config: false
        - name: "interface2"
          ipv6: "2001:0db8:85a3:0000:0000:8a2e:0370:7334"
          mode: "trunk"
          state: "absent"
          check_running_config: true
        - name: "interface3"
          ipv4: "10.1.1.3"
          ipv6: "2001:0db8:85a3:0000:0000:8a2e:0370:7335"
          mode: "access"
          state: "present"
          check_running_config: true
          secondary: "10.1.1.5"
        - name: "interface4"
          ipv4: "10.1.1.4"
          ipv6: "2001:0db8:85a3:0000:0000:8a2e:0370:7336"
          mode: "trunk"
          state: "present"
          check_running_config: false
          aggregate: true

    - name: Display debug output
      debug:
        var: item
      loop: "{{ ansible_facts['community_network_icx_l3_interface']|default([]) }}"