---
- name: Test UTM Proxy Auth Profile
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Create UTM Proxy Auth Profile with random port number
      community.general.utm_proxy_auth_profile:
        name: test_profile
        utm_host: 10.1.1.1
        utm_port: "{{ range(20000, 30000, 100) | random }}"
        utm_protocol: http
        state: present
      register: result

    - name: Debug UTM Proxy Auth Profile creation
      debug:
        var: result

    - name: Update UTM Proxy Auth Profile with different backend mode
      community.general.utm_proxy_auth_profile:
        name: test_profile
        backend_mode: "insert"
        state: present
      register: result

    - name: Debug UTM Proxy Auth Profile update
      debug:
        var: result

    - name: Delete UTM Proxy Auth Profile
      community.general.utm_proxy_auth_profile:
        name: test_profile
        state: absent
      register: result

    - name: Debug UTM Proxy Auth Profile deletion
      debug:
        var: result