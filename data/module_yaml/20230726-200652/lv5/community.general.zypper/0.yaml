---
- name: Test playbook for community.general.zypper
  hosts: all
  become: true

  tasks:
    - name: Install packages with random port settings
      community.general.zypper:
        name: "{{ item }}"
        type: package
        update_cache: yes
        extra_args: "--port={{ item | random(seed=inventory_hostname) }}"
      with_items:
        - package1
        - package2

    - name: Remove packages with random port settings
      community.general.zypper:
        name: "{{ item }}"
        type: package
        state: absent
        extra_args: "--port={{ item | random(seed=inventory_hostname) }}"
      with_items:
        - package1
        - package2