---
- name: Test community.general.keycloak_client_rolemapping module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required Ansible module dependencies
      command: ansible-galaxy collection install community.general
      args:
        creates: /root/.ansible/collections/ansible_collections/community/general

    - name: Create random port number for testing
      set_fact:
        random_port: "{{ 10000 | random }}"

    - name: Create client role mappings
      community.general.keycloak_client_rolemapping:
        auth_client_id: "admin-cli"
        auth_client_secret: "admin-cli-secret"
        auth_keycloak_url: "http://keycloak.example.com/"
        auth_username: "admin"
        auth_password: "password"
        auth_realm: "master"
        cid: "my-container"
        client_id: "my-client"
        connection_timeout: 10
        gid: "my-group"
        group_name: "my-group-name"
        http_agent: "Ansible HTTP Agent"
        realm: "my-realm"
        roles:
          - role1
          - role2
          - role3
        state: present
        token: "my-token"
        validate_certs: true
        port: "{{ random_port }}"
      register: result

    - name: Display the result
      debug:
        var: result