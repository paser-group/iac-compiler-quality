- name: Test community.general.ssh_config module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure SSH settings
      community.general.ssh_config:
        group: "{{ group }}"
        host: "{{ host }}"
        host_key_algorithms: "{{ host_key_algorithms }}"
        hostname: "{{ hostname }}"
        identity_file: "{{ identity_file }}"
        port: "{{ port }}"
        proxycommand: "{{ proxycommand }}"
        proxyjump: "{{ proxyjump }}"
        remote_user: "{{ remote_user }}"
        ssh_config_file: "{{ ssh_config_file }}"
        state: present
        strict_host_key_checking: "{{ strict_host_key_checking }}"
        user: "{{ user }}"
        user_known_hosts_file: "{{ user_known_hosts_file }}"
      check_mode: true
      register: result

    - name: Display debug output
      debug:
        var: result

- name: Test random port numbers
  hosts: localhost
  gather_facts: false
  vars:
    random_ports:
      - "{{ 8000 + random('int', 0, 999) }}"
      - "{{ 9000 + random('int', 0, 999) }}"

  tasks:
    - name: Test SSH connection with random ports
      community.general.ssh_config:
        host: 127.0.0.1
        remote_user: testuser
        port: "{{ item }}"
        state: present
      with_items: "{{ random_ports }}"
      register: result

    - name: Display debug output
      debug:
        var: result