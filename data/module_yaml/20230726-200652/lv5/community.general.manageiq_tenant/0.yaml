---
- name: Test manageiq_tenant module
  hosts: localhost
  gather_facts: false

  vars:
    description: "Test Tenant"
    manageiq_connection:
      hostname: "localhost"
      port: 3000
      username: "admin"
      password: "password"
    name: "test_tenant"
    parent: "root"
    quotas:
      vms: 5
      vcpu: 10
      memory: 50
    state: "present"

  tasks:
    - name: Create manageiq tenant
      community.general.manageiq_tenant:
        description: "{{ description }}"
        manageiq_connection: "{{ manageiq_connection }}"
        name: "{{ name }}"
        parent: "{{ parent }}"
        quotas: "{{ quotas }}"
        state: "{{ state }}"
      register: result

    - name: Debug result
      debug:
        var: result

    - name: Random port number
      community.general.manageiq_tenant:
        description: "{{ description }}"
        manageiq_connection: "{{ manageiq_connection }}"
        name: "{{ name }}"
        parent: "{{ parent }}"
        quotas: "{{ quotas }}"
        state: "{{ state }}"
        port: "{{ 10000 | random }}"
      register: random_port_result

    - name: Debug random port result
      debug:
        var: random_port_result