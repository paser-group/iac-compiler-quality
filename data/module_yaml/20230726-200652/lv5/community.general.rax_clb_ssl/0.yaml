---
- name: Test playbook for rax_clb_ssl module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Manage SSL termination for Rackspace load balancer
      community.general.rax_clb_ssl:
        api_key: "YOUR_RACKSPACE_API_KEY"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        credentials: "/path/to/credentials/file"
        loadbalancer: "YOUR_LOAD_BALANCER"
        state: "present"
        certificate: "/path/to/certificate/file"
        private_key: "/path/to/private_key/file"
        enabled: true
        https_redirect: true
        secure_port: 443
        secure_traffic_only: true
        validate_certs: true
        wait: true
        wait_timeout: 300
      register: result
      ignore_errors: true

    - name: Print debug output
      debug:
        var: result

- name: Random Port Test Cases
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 1024 + (inventory_hostname | regex_replace('[a-z]+', '') | int) }}"
      
    - name: Test port settings for random port number
      community.general.rax_clb_ssl:
        api_key: "YOUR_RACKSPACE_API_KEY"
        auth_endpoint: "https://identity.api.rackspacecloud.com/v2.0/"
        credentials: "/path/to/credentials/file"
        loadbalancer: "YOUR_LOAD_BALANCER"
        state: "present"
        certificate: "/path/to/certificate/file"
        private_key: "/path/to/private_key/file"
        enabled: true
        https_redirect: true
        secure_port: "{{ random_port }}"
        secure_traffic_only: true
        validate_certs: true
        wait: true
        wait_timeout: 300
      register: result
      ignore_errors: true

    - name: Print debug output
      debug:
        var: result