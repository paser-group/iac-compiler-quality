- name: Copy file with random port configuration
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port numbers
      ansible.builtin.set_fact:
        ssh_port: "{{ 1024 + (ansible_play_hosts_all.index(inventory_hostname) * 100) + (play_hosts.index(inventory_hostname) + 1) }}"
        ftp_port: "{{ 50000 + (ansible_play_hosts_all.index(inventory_hostname) * 100) + (play_hosts.index(inventory_hostname) + 1) }}"

    - name: Copy file using ansible.netcommon.net_put with random port configuration
      ansible.netcommon.net_put:
        dest: /path/to/destination/file
        src: /path/to/source/file
        mode: '0644'
        protocol: scp
        ssh_port: "{{ ssh_port }}"
        ftp_port: "{{ ftp_port }}"