---
- name: Test playbook to reveal latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    subnet_name: "test-subnet"
    vpc_id: "test-vpc"
    availability_zone: "test-availability-zone"
    cidr: "10.1.1.0/24"
    gateway_ip: "10.1.1.254"
    dhcp_enable: true
    dns_address: ["8.8.8.8", "8.8.4.4"]
    domain: "example.com"
    timeouts:
      connection: 60
      operation: 120
    identity_endpoint: "https://identity.example.com/v3"
    user: "test-user"
    password: "test-password"
    project: "test-project"
    region: "test-region"
    state: "present"
    test_port: "{{ 32768 | random(seed=inventory_hostname) }}"

  tasks:
    - name: Create VPC subnet
      community.general.hwc_vpc_subnet:
        name: "{{ subnet_name }}"
        vpc_id: "{{ vpc_id }}"
        availability_zone: "{{ availability_zone }}"
        cidr: "{{ cidr }}"
        gateway_ip: "{{ gateway_ip }}"
        dhcp_enable: "{{ dhcp_enable }}"
        dns_address: "{{ dns_address }}"
        domain: "{{ domain }}"
        timeouts: "{{ timeouts }}"
        identity_endpoint: "{{ identity_endpoint }}"
        user: "{{ user }}"
        password: "{{ password }}"
        project: "{{ project }}"
        region: "{{ region }}"
        state: "{{ state }}"
        test_port: "{{ test_port }}"
      register: subnet_result

    - name: Debug subnet result
      debug:
        var: subnet_result