---
- name: Test playbook for ipa_sudorule module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create random port number
      set_fact:
        random_port: "{{ 10000 | random }}"

    - name: Test ipa_sudorule module
      community.general.ipa_sudorule:
        cmd: create
        cmdcategory: category1
        cmdgroup: [group1, group2]
        cn: sudorule1
        description: Sudorule 1
        host: [host1, host2]
        hostcategory: host_category1
        hostgroup: [host_group1, host_group2]
        ipa_host: 10.1.1.1
        ipa_user: admin
        ipa_pass: password
        ipa_port: "{{ random_port }}"
        ipa_timeout: 10
        ipa_prot: https
        state: present
        sudoopt: [option1, option2]
        user: [user1, user2]
        usercategory: user_category1
        usergroup: [user_group1, user_group2]
        validate_certs: false
      register: result

    - name: Show result
      debug:
        var: result