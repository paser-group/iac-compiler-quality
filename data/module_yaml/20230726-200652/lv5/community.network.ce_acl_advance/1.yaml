- name: Manage advanced ACL configuration on HUAWEI
  hosts: localhost
  gather_facts: false
  connection: local
  tasks:
    - name: Generate random port numbers
      set_fact:
        src_port_begin: "{{ 1024 | random }}"
        src_port_end: "{{ 65535 | random }}"
        dest_port_begin: "{{ 1024 | random }}"
        dest_port_end: "{{ 65535 | random }}"

    - name: Create advanced ACL
      community.network.ce_acl_advance:
        acl_name: "ACL 1"
        acl_description: "Advanced ACL 1"
        acl_num: 10
        rule_id: 1
        rule_name: "Rule 1"
        rule_description: "Allow SSH"
        rule_action: "permit"
        protocol: "tcp"
        src_ip: "10.1.1.1"
        src_mask: "255.255.255.0"
        dest_ip: "10.2.2.2"
        dest_mask: "255.255.255.255"
        src_port_begin: "{{ src_port_begin }}"
        src_port_end: "{{ src_port_end }}"
        dest_port_begin: "{{ dest_port_begin }}"
        dest_port_end: "{{ dest_port_end }}"
      register: result

    - debug:
        var: result