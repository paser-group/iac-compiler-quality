---
- name: Test playbook for community.general.stackdriver module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Deploy application
      community.general.stackdriver:
        deployed_to: "{{ deployed_to }}"
        deployed_by: "{{ deployed_by }}"
        key: "{{ key }}"
        repository: "{{ repository }}"
        revision_id: "{{ revision_id }}"
        event: "Deployment"
      register: deploy_output

    - name: Send annotation event
      community.general.stackdriver:
        key: "{{ key }}"
        instance_id: "{{ instance_id }}"
        event: "{{ event }}"
        event_epoch: "{{ event_epoch }}"
        level: "{{ level }}"
        msg: "{{ msg }}"
        annotated_by: "{{ annotated_by }}"
      register: annotation_output

- name: Testing the playbook
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Test random port settings
      community.general.stackdriver:
        key: "{{ key }}"
        instance_id: "{{ instance_id }}"
        event: "Port Test"
        event_epoch: "{{ event_epoch }}"
        level: "{{ level }}"
        msg: "{{ msg }}"
        annotated_by: "{{ annotated_by }}"
        port: "{{ random_port }}"
      register: port_test_output