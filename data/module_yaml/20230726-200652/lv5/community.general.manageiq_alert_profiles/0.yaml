---

- name: Test Ansible ManageIQ Alert Profiles module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create ManageIQ Alert Profiles
      community.general.manageiq_alert_profiles:
        manageiq_connection:
          host: "{{ manageiq_host }}"
          username: "{{ manageiq_username }}"
          password: "{{ manageiq_password }}"
          verify_ssl: false
        name: "Test Profile"
        notes: "This is a test profile"
        resource_type: "vm"
        state: present
        alerts:
          - name: "Test Alert"
            conditions:
              - attributes:
                  - ["CPU Usage Percent", ">", "90"]
                enabled: true
                monitoring_exec_sequence: 1
            enabled: true
            notifications:
              - attributes:
                  - "Email"
                options: {}
                roles: []
                to:
                  - "test@example.com"

        port: "{{ random_port }}"
      register: result

    - name: Debug result
      debug:
        var: result