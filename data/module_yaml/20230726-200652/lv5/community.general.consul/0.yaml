---
- name: Test for latent type-related bugs
  hosts: localhost
  gather_facts: False

  tasks:
    - name: Add service to Consul
      community.general.consul:
        host: "localhost"
        port: 8500
        state: present
        service:
          name: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
          address: "{{ random_ip }}"
          port: "{{ random_port }}"
          check:
            id: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            name: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            script: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            interval: "{{ random_interval }}"
            timeout: "{{ random_timeout }}"

    - name: Modify service in Consul
      community.general.consul:
        host: "localhost"
        port: 8500
        state: present
        service:
          name: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
          address: "{{ random_ip }}"
          port: "{{ random_port }}"
          tags: ["{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"]
          check:
            id: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            name: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            script: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"
            interval: "{{ random_interval }}"
            timeout: "{{ random_timeout }}"

    - name: Delete service from Consul
      community.general.consul:
        host: "localhost"
        port: 8500
        state: absent
        service_id: "{{ random_string(10, 'abcdefghijklmnopqrstuvwxyz0123456789') }}"