---
- name: Test OVH IP Failover Module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Create OVH IP Failover
      community.general.ovh_ip_failover:
        application_key: "{{ lookup('env', 'OVH_APPLICATION_KEY') }}"
        application_secret: "{{ lookup('env', 'OVH_APPLICATION_SECRET') }}"
        consumer_key: "{{ lookup('env', 'OVH_CONSUMER_KEY') }}"
        endpoint: "{{ lookup('env', 'OVH_ENDPOINT') }}"
        name: "test-failover"
        service: "ovh"
        timeout: 30
        wait_completion: true
        wait_task_completion: 10
      register: result

    - name: Debug Result
      debug:
        var: result

    - name: Test Random Port Settings
      community.general.ovh_ip_failover:
        application_key: "{{ lookup('env', 'OVH_APPLICATION_KEY') }}"
        application_secret: "{{ lookup('env', 'OVH_APPLICATION_SECRET') }}"
        consumer_key: "{{ lookup('env', 'OVH_CONSUMER_KEY') }}"
        endpoint: "{{ lookup('env', 'OVH_ENDPOINT') }}"
        name: "test-failover"
        service: "ovh"
        timeout: 30
        wait_completion: true
        wait_task_completion: 10
        port: "{{ 10000 | random }}"
      register: random_port_result

    - name: Debug Random Port Result
      debug:
        var: random_port_result