- name: Reset switch startup configuration to default
  hosts: switches
  gather_facts: False

  tasks:
    - name: Set random port numbers
      vars:
        random_port: "{{ 2000 + (ansible_play_hosts_all.index(inventory_hostname) * 100) }}"
      community.network.cnos_factory:
        deviceType: "{{ device_type }}"
        enablePassword: "{{ enable_password }}"
        host: "{{ inventory_hostname }}"
        outputfile: "{{ output_file }}"
        password: "{{ password }}"
        username: "{{ username }}"
        port: "{{ random_port }}"
      register: result

    - name: Debug result
      debug:
        var: result

  vars:
    device_type: "ios"
    enable_password: "enable_password_here"
    output_file: "/path/to/output/file"
    password: "password_here"
    username: "username_here"