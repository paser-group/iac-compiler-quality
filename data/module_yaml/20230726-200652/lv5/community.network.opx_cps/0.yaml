- name: Test CPS operations using community.network.opx_cps module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 1024 + (ansible_random | default(0,15) | random * 64511) | int }}"

    - name: Perform CPS operation with attr_data set to random port
      community.network.opx_cps:
        attr_data: "{{ random_port }}"
        attr_type: "{{ ['iana-if-type:ethernetCsmacd', 'iana-if-type:propVirtual'] | random }}"
        commit_event: true
        db: "{{ ['running', 'startup', 'candidate'] | random }}"
        module_name: "{{ ['interface', 'vlan'] | random }}"
        operation: "{{ ['set', 'delete'] | random }}"
        qualifier: "{{ ['admin_state:up', 'admin_state:down'] | random }}"
      register: cps_output

    - name: Debug CPS output
      debug:
        var: cps_output