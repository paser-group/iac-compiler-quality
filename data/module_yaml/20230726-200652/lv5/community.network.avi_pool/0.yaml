---
- name: Test playbook for community.network.avi_pool module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create avi_pool object with random port numbers
      community.network.avi_pool:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        name: "test-pool"
        server_count: 5
        servers: "{{ servers }}"
        server_port: "{{ item }}"
        state: present
      loop:
        - "{{ range(8001, 8006) | random }}"
      register: avi_pool_output
      ignore_errors: true

    - name: Debug avi_pool output
      debug:
        var: avi_pool_output