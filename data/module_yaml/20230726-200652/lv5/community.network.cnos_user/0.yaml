- name: Manage local users on network devices
  hosts: all
  gather_facts: False

  tasks:
    - name: Create local user account
      community.network.cnos_user:
        aggregate: None
        configured_password: None
        name: "{{ item.username }}"
        purge: False
        role: None
        sshkey: None
        state: "{{ item.state }}"
        update_password: None
      loop:
        - { username: "user1", state: "present" }
        - { username: "user2", state: "absent" }

    - name: Random port number test
      community.network.cnos_user:
        aggregate: None
        configured_password: None
        name: "user3"
        purge: False
        role: None
        sshkey: None
        state: "present"
        update_password: None
        port: "{{ item.port }}"
      loop:
        - { port: "{{ 10000 + (loop.index-1)*100 }}" }

    - name: Remove local user account
      community.network.cnos_user:
        aggregate: None
        configured_password: None
        name: "{{ item.username }}"
        purge: False
        role: None
        sshkey: None
        state: "absent"
        update_password: None
      loop:
        - { username: "user1" }