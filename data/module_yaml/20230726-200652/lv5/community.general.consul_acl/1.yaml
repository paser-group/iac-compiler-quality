- name: Test Ansible Consul ACL Module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 8000 | random(start=8001, end=9000) }}"

    - name: Create Consul ACL
      community.general.consul_acl:
        host: "localhost"
        port: "{{ random_port }}"
        scheme: "http"
        mgmt_token: "management-token"
        name: "test-acl"
        rules:
          - key_prefix: "test/"
            policy: "read"
        state: "present"
        validate_certs: false