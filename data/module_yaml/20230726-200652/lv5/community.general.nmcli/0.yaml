- name: Test Ansible Latent Type-Related Bugs
  hosts: all
  gather_facts: false  # Disable gathering facts
  
  tasks:
    - name: Configure network interface
      community.general.nmcli:
        conn_name: "{{ inventory_hostname }}-eth0"
        ifname: eth0
        type: ethernet
        state: up
        autoconnect: yes

    - name: Set random port numbers
      community.general.nmcli:
        conn_name: "{{ inventory_hostname }}-eth0"
        state: present
        ipv4:
          addresses:
            - "{{ hostvars[inventory_hostname]['ansible_default_ipv4'].address }}"
          address_data:
            - addr_gen_mode6: "{{ item }}"
              ageingtime: "{{ item }}"
              arp_interval: "{{ item }}"
              arp_ip_target: "{{ item }}"
              downdelay: "{{ item }}"
              egress: "{{ item }}"
              flags: "{{ item }}"
              forwarddelay: "{{ item }}"
              gw4: "{{ item }}"
              hairpin: "{{ item }}"
              hellotime: "{{ item }}"
              ignore_unsupported_suboptions: "{{ item }}"
              ingress: "{{ item }}"
              ip_privacy6: "{{ item }}"
              ip_tunnel_dev: "{{ item }}"
              ip_tunnel_input_key: "{{ item }}"
              ip_tunnel_local: "{{ item }}"
              ip_tunnel_output_key: "{{ item }}"
              ip_tunnel_remote: "{{ item }}"
              mac: "{{ item }}"
              master: "{{ item }}"
              may_fail4: "{{ item }}"
              method4: "{{ item }}"
              method6: "{{ item }}"
              miimon: "{{ item }}"
              mode: "{{ item }}"
              mtu: "{{ item }}"
              never_default4: "{{ item }}"
              path_cost: "{{ item }}"
              primary: "{{ item }}"
              priority: "{{ item }}"
              route_metric4: "{{ item }}"
              route_metric6: "{{ item }}"
              routing_rules4: "{{ item }}"
              runner: "{{ item }}"
              runner_fast_rate: "{{ item }}"
              runner_hwaddr_policy: "{{ item }}"
              slavepriority: "{{ item }}"
              state: "{{ item }}"
              stp: "{{ item }}"
              transport_mode: "{{ item }}"
              type: "{{ item }}"
              updelay: "{{ item }}"
              vlandev: "{{ item }}"
              vlanid: "{{ item }}"
              vxlan_id: "{{ item }}"
              vxlan_local: "{{ item }}"
              vxlan_remote: "{{ item }}"
              zone: "{{ item }}"
          gateway4: 10.1.1.254
          dns4:
            - 8.8.8.8
            - 8.8.4.4
        connection: "{{ hostvars['localhost']['ansible_default_ipv4']['gateway'] }}"
      loop: "{{ range(10) | list }}"