---
- name: Test playbook for community.network.ce_ospf module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure OSPF on HUAWEI device
      community.network.ce_ospf:
        provider:
          host: "{{ inventory_hostname }}"
          username: admin
          password: password
        addr: "{{ item.addr }}"
        area: "{{ item.area }}"
        auth_key_id: "{{ item.auth_key_id }}"
        auth_mode: "{{ item.auth_mode }}"
        auth_text_md5: "{{ item.auth_text_md5 }}"
        auth_text_simple: "{{ item.auth_text_simple }}"
        mask: "{{ item.mask }}"
        max_load_balance: "{{ item.max_load_balance }}"
        nexthop_addr: "{{ item.nexthop_addr }}"
        nexthop_weight: "{{ item.nexthop_weight }}"
        process_id: "{{ item.process_id }}"
        state: "{{ item.state }}"
      loop:
        - {addr: "10.1.1.1", area: "0.0.0.0", auth_mode: "simple", auth_text_simple: "password", mask: "255.255.255.0", process_id: "1", state: "present"}
        - {addr: "10.1.1.2", area: "0.0.0.0", auth_mode: "simple", auth_text_simple: "password", mask: "255.255.255.0", process_id: "1", state: "present"}
        - {addr: "10.1.1.3", area: "0.0.0.0", auth_mode: "simple", auth_text_simple: "password", mask: "255.255.255.0", process_id: "1", state: "present"}
        - {addr: "10.1.1.4", area: "0.0.0.0", auth_mode: "simple", auth_text_simple: "password", mask: "255.255.255.0", process_id: "1", state: "present"}

    - name: Test port settings using random port numbers
      community.network.ce_ospf:
        provider:
          host: "{{ inventory_hostname }}"
          username: admin
          password: password
        addr: "10.1.1.1"
        area: "0.0.0.0"
        auth_mode: "simple"
        auth_text_simple: "password"
        mask: "255.255.255.0"
        process_id: "1"
        state: "present"
        nexthop_addr: "10.1.1.2"
        nexthop_weight: "{{ range(1, 1000) | random }}"
        auth_key_id: "{{ range(1, 1000) | random }}"
        auth_text_md5: "{{ range(1, 1000) | random }}"
        max_load_balance: "{{ range(1, 1000) | random }}"
      loop: "{{ range(1, 1000) | list }}"