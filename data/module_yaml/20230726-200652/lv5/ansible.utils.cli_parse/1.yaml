- name: Parse cli output or text
  hosts: localhost
  gather_facts: false

  vars:
    cli_output: "This is a sample CLI output"
    random_port: "{{ 3333 | random(start=8000, end=9000) }}"

  tasks:
    - name: Parse CLI output
      ansible.utils.cli_parse:
        command: "{{ cli_output }}"
        parser:
          startswith: "This"

      register: parsed_output

    - name: Set fact with parsed output
      set_fact:
        parsed_output: "{{ parsed_output.stdout }}"
        random_port: "{{ random_port }}"

    - name: Print parsed output and random port
      debug:
        var: parsed_output

    - name: Print random port number
      debug:
        var: random_port