---
- name: Manage Lenovo CNOS configurations with port settings test
  hosts: all
  gather_facts: no

  tasks:
    - name: Generate random port numbers
      set_fact:
        port_numbers: "{{ range(10) | random }}"
      
    - name: Configure CNOS devices
      community.network.cnos_config:
        admin: True
        replace: False
        backup: False
        comment: "This is a test configuration"
        lines:
          - interface eth1
          - port {{ port_numbers }}
          - ip address 10.0.0.1/24

      vars:
        ansible_connection: network_cli
        ansible_network_os: lenovo.cnos

      register: config_result

    - debug:
        var: config_result