---
- name: Manage Serverless deployment
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Install serverless framework
      pip:
        name: serverless
        state: present

    - name: Deploy Serverless service
      community.general.serverless:
        deploy: "{{ deploy | default(true) }}"
        force: "{{ force | default(false) }}"
        region: "{{ region | default('us-east-1') }}"
        serverless_bin_path: "/usr/local/bin/serverless"
        service_path: "/path/to/service"
        stage: "{{ stage | default('dev') }}"
        state: "{{ state | default('present') }}"
        verbose: "{{ verbose | default(false) }}"

  tasks:
    - name: Test port settings
      community.general.serverless:
        deploy: true
        force: false
        region: "us-east-1"
        serverless_bin_path: "/usr/local/bin/serverless"
        service_path: "/path/to/service"
        stage: "dev"
        state: "present"
        verbose: false
        ports:
          - "{{ range(10000, 20000) | random }}"