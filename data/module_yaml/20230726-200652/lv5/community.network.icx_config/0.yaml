- name: Test playbook for community.network.icx_config module
  hosts: localhost
  gather_facts: false
  vars:
    icx_config_attributes:
      after: "{{ random_port() }}"
      backup: "{{ random_boolean() }}"
      before: "{{ random_port() }}"
      defaults: "{{ random_boolean() }}"
      diff_against: "{{ random_string(10) }}"
      diff_ignore_lines:
        - "{{ random_string(10) }}"
        - "{{ random_string(10) }}"
      intended_config: "{{ random_string(30) }}"
      lines:
        - "{{ random_string(20) }}"
        - "{{ random_string(20) }}"
      match: "{{ random_string(10) }}"
      multiline_delimiter: "{{ random_string(5) }}"
      parents:
        - "{{ random_string(5) }}"
        - "{{ random_string(5) }}"
      replace: "{{ random_string(5) }}"
      running_config: "{{ random_string(30) }}"
      save_when: "{{ random_string(10) }}"
      src: "{{ random_string(10) }}"
  tasks:
    - name: Use community.network.icx_config module with random attributes
      community.network.icx_config:
        after: "{{ icx_config_attributes.after }}"
        backup: "{{ icx_config_attributes.backup }}"
        before: "{{ icx_config_attributes.before }}"
        defaults: "{{ icx_config_attributes.defaults }}"
        diff_against: "{{ icx_config_attributes.diff_against }}"
        diff_ignore_lines: "{{ icx_config_attributes.diff_ignore_lines }}"
        intended_config: "{{ icx_config_attributes.intended_config }}"
        lines: "{{ icx_config_attributes.lines }}"
        match: "{{ icx_config_attributes.match }}"
        multiline_delimiter: "{{ icx_config_attributes.multiline_delimiter }}"
        parents: "{{ icx_config_attributes.parents }}"
        replace: "{{ icx_config_attributes.replace }}"
        running_config: "{{ icx_config_attributes.running_config }}"
        save_when: "{{ icx_config_attributes.save_when }}"
        src: "{{ icx_config_attributes.src }}"
      register: result

- hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random port number
      shell: echo $(( RANDOM % 10000 + 1024 ))
      register: random_port_output
      
    - set_fact:
        random_port_value: "{{ random_port_output.stdout_lines[0] }}"
      
    - name: Save random port value to file
      copy:
        content: "{{ random_port_value }}"
        dest: random_port.txt