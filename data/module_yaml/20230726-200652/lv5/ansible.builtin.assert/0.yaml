---
- name: Test Ansible Assert Module
  hosts: all
  gather_facts: false

  tasks:
    - name: Check if port 80 is open
      ansible.builtin.assert:
        that:
          - "'80' in ansible_facts.ansible_interfaces | random_port"
        fail_msg: "Port 80 is not open"
        quiet: true
        success_msg: "Port 80 is open"

    - name: Check if port 443 is open
      ansible.builtin.assert:
        that:
          - "'443' in ansible_facts.ansible_interfaces | random_port"
        fail_msg: "Port 443 is not open"
        quiet: true
        success_msg: "Port 443 is open"

    - name: Check if port 22 is open
      ansible.builtin.assert:
        that:
          - "'22' in ansible_facts.ansible_interfaces | random_port"
        fail_msg: "Port 22 is not open"
        quiet: true
        success_msg: "Port 22 is open"

  vars:
    random_port: "{{ [1024..65535] | random }}"