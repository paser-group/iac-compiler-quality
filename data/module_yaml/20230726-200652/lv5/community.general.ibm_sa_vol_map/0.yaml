---
- name: Test playbook for IBM Spectrum Accelerate volume mapping
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Map volume
      community.general.ibm_sa_vol_map:
        cluster: "{{ cluster }}"
        endpoints: "{{ endpoints }}"
        host: "{{ host }}"
        lun: "{{ lun }}"
        override: "{{ override }}"
        password: "{{ password }}"
        state: "{{ state }}"
        username: "{{ username }}"
        vol: "{{ vol }}"
      register: result
      when: test_case == 'map_volume'

    - name: Show volume mapping
      debug:
        var: result
      when: test_case == 'map_volume'

- name: Random Port Number Test
  hosts: localhost
  gather_facts: false
  vars:
    ports:
      - 8080
      - 9000
      - 8081
      - 8000

  tasks:
    - name: Test random port settings
      community.general.ibm_sa_vol_map:
        cluster: "{{ cluster }}"
        endpoints: "{{ endpoints }}"
        host: "{{ host }}"
        lun: "{{ lun }}"
        override: "{{ override }}"
        password: "{{ password }}"
        state: "{{ state }}"
        username: "{{ username }}"
        vol: "{{ vol }}"
        port: "{{ ports|random }}"
      register: result
      when: test_case == 'random_port'

    - name: Show test result
      debug:
        var: result
      when: test_case == 'random_port'