---
- name: Manage GitLab group members
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add group members
      community.general.gitlab_group_members:
        state: "present"
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "your_gitlab_api_token"
        gitlab_group: "group_name"
        gitlab_user: ["user1", "user2"]
        gitlab_users_access: [30, 40]
      register: result_add_members

    - name: Debug result of adding group members
      debug:
        var: result_add_members

    - name: Update group member access level
      community.general.gitlab_group_members:
        state: "present"
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "your_gitlab_api_token"
        gitlab_group: "group_name"
        gitlab_user: ["user1"]
        gitlab_users_access: [50]
      register: result_update_member

    - name: Debug result of updating group member access level
      debug:
        var: result_update_member

    - name: Remove group members
      community.general.gitlab_group_members:
        state: "absent"
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "your_gitlab_api_token"
        gitlab_group: "group_name"
        gitlab_user: ["user1", "user2"]
        purge_users: true
      register: result_remove_members

    - name: Debug result of removing group members
      debug:
        var: result_remove_members

    - name: Test port settings
      community.general.gitlab_group_members:
        state: "present"
        api_url: "https://gitlab.example.com/api/v4"
        api_token: "your_gitlab_api_token"
        gitlab_group: "group_name"
        gitlab_user: ["user1"]
        gitlab_users_access: [60]
        api_port: "{{ lookup('community.general.random_number', 'min=1025 max=65535') }}"
      register: result_test_port

    - name: Debug result of testing port settings
      debug:
        var: result_test_port