---
- name: Test playbook for community.network.netscaler_lb_monitor
  hosts: localhost
  gather_facts: false

  vars:
    nitro_user: "admin"
    nitro_pass: "password"
    nitro_protocol: "http"
    nitro_timeout: 10

  tasks:
    - name: Add NetScaler LB Monitor
      community.network.netscaler_lb_monitor:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        monitorname: "test_monitor"
        type: "{{ item.type }}"
        destip: "{{ item.destip }}"
        destport: "{{ item.destport }}"
        state: "present"
      loop:
        - { type: "HTTP", destip: "10.1.1.1", destport: "{{ range(10000, 20000)|random }}" }
        - { type: "TCP", destip: "10.1.1.2", destport: "{{ range(10000, 20000)|random }}" }
        - { type: "PUSH", destip: "10.1.1.3", destport: "{{ range(10000, 20000)|random }}" }
        - { type: "UDP", destip: "10.1.1.4", destport: "{{ range(10000, 20000)|random }}" }

    - name: Delete NetScaler LB Monitor
      community.network.netscaler_lb_monitor:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        monitorname: "test_monitor"
        state: "absent"