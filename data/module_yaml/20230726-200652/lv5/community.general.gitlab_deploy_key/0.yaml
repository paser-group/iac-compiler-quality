---
- name: Test Ansible Type-Related Bugs with community.general.gitlab_deploy_key module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port number
      ansible.builtin.set_fact:
        random_port: "{{ 10000 | random }}"

    - name: Include gitlab_deploy_key role
      include_role:
        name: community.general.gitlab_deploy_key

    - name: Test port settings with random port number
      community.general.gitlab_deploy_key:
        api_url: "https://gitlab.example.com:{{ random_port }}"
        api_token: "xxxxxxxxxx"
        project: "myproject"
        key: "{{ lookup('file', '/path/to/key.pub') }}"
        state: "present"
        validate_certs: False
      register: result

    - name: Debug result
      ansible.builtin.debug:
        var: result