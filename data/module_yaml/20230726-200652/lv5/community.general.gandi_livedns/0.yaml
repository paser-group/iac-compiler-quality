---
- name: Test Gandi LiveDNS Module
  hosts: localhost
  gather_facts: false
  vars:
    api_key: "your_api_key"
    domain: "example.com"
    record: "test"
    state: "present"
    ttl: 3600
    type: "A"
    values:
      - "10.1.1.1"
  tasks:
    - name: Install required Python modules
      pip:
        name: gandi.cli
        state: present

    - name: Create random port number
      set_fact:
        random_port: "{{ 8000 + (ansible_random.randint(0, 1000) * 10) }}"

    - name: Test Gandi LiveDNS Module
      community.general.gandi_livedns:
        api_key: "{{ api_key }}"
        domain: "{{ domain }}"
        record: "{{ record }}"
        state: "{{ state }}"
        ttl: "{{ ttl }}"
        type: "{{ type }}"
        values: "{{ values }}"
        port: "{{ random_port }}"
      register: result

    - name: Debug result
      debug:
        var: result