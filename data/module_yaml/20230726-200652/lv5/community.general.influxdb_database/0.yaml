---
- name: Test playbook for community.general.influxdb_database module
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Set random port
      set_fact:
        random_port: "{{ 'port' | random }}"
        
    - name: Test case with random port number
      community.general.influxdb_database:
        database_name: test-db
        hostname: localhost
        password: password123
        path: /var/lib/influxdb
        port: "{{ random_port }}"
        retries: "3"
        ssl: "False"
        state: "active"
        timeout: "10"
        udp_port: "8089"
        use_udp: "yes"
        username: admin
        validate_certs: "true"
      register: influxdb_result

    - debug:
        var: influxdb_result