---
- name: Create Ansible Groups using group_by module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create groups based on attributes
      group_by:
        key: "{{ item.key }}"
        parents: "{{ item.parents }}"
      loop:
        - key: "{{ hostvars[inventory_hostname]['ansible_distribution'] }}"
          parents: [linux_distribution]

    - name: Print created groups
      debug:
        var: groups
        verbosity: 2

- name: Test Port Settings
  hosts: all
  gather_facts: false

  tasks:
    - name: Random Port Number Testing
      debug:
        msg: "Port number {{ item }} is random."
      loop:
        - "{{ range(65536)|random }}"