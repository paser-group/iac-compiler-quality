---
- name: Test playbook for community.general.librato_annotation module
  hosts: localhost
  connection: local

  vars:
    api_key: "your_librato_api_key"

  tasks:
    - name: Create an annotation with valid parameters
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        name: "Test Annotation"
        title: "Test Title"
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "{{ ansible_date_time.epoch }}"
        user: "testuser"
        links:
          - title: "Link Title"
            href: "https://example.com"

    - name: Create an annotation without the required 'api_key' parameter
      community.general.librato_annotation:
        name: "Test Annotation"
        title: "Test Title"
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "{{ ansible_date_time.epoch }}"
        user: "testuser"
        links:
          - title: "Link Title"
            href: "https://example.com"
      ignore_errors: yes

    - name: Create an annotation with an invalid 'end_time' parameter
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        name: "Test Annotation"
        title: "Test Title"
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "2021-02-20"
        user: "testuser"
        links:
          - title: "Link Title"
            href: "https://example.com"
      ignore_errors: yes

    - name: Create an annotation with invalid 'links' parameter
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        name: "Test Annotation"
        title: "Test Title"
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "{{ ansible_date_time.epoch }}"
        user: "testuser"
        links: "invalid_links"
      ignore_errors: yes

    - name: Create an annotation with invalid 'title' parameter
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        name: "Test Annotation"
        title: 123
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "{{ ansible_date_time.epoch }}"
        user: "testuser"
        links:
          - title: "Link Title"
            href: "https://example.com"
      ignore_errors: yes

    - name: Test random port numbers for the 'links' parameter
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        name: "Test Annotation"
        title: "Test Title"
        description: "This is a test annotation"
        source: "Ansible"
        start_time: "{{ ansible_date_time.epoch }}"
        end_time: "{{ ansible_date_time.epoch }}"
        user: "testuser"
        links:
          - title: "Link Title"
            href: "https://example.com:{{ 10000 | random }}"
      ignore_errors: yes