- name: Manage netstream export on HUAWEI devices
  hosts: all
  gather_facts: false

  tasks:
    - name: Configure netstream export with random port number
      community.network.ce_netstream_export:
        as_option: "{{ None }}"
        bgp_nexthop: "{{ None }}"
        host_ip: 10.1.1.1
        host_port: "{{ 3000 + (ansible_play_hosts_all.index(inventory_hostname) | default(0)) }}"
        host_vpn: "{{ None }}"
        source_ip: "{{ None }}"
        state: "{{ None }}"
        type: "{{ None }}"
        version: "{{ None }}"
      register: result

      ignore_errors: true

    - name: Debug the result
      debug:
        var: result