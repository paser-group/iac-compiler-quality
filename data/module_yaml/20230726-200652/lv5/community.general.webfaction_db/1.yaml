---
- name: Test community.general.webfaction_db module with random port numbers
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Generate random port number
      set_fact:
        random_port: "{{ 1024 + (ansible_play_hosts_all.index(inventory_hostname) * 100) + (ansible_play_hosts_all | length) }}"
        
    - name: Add a database
      community.general.webfaction_db:
        login_name: "{{ login_name }}"
        login_password: "{{ login_password }}"
        machine: "{{ machine }}"
        name: "{{ name }}"
        password: "{{ password }}"
        state: "{{ state }}"
        type: "{{ type }}"
        port: "{{ random_port }}"
      register: result

    - debug:
        var: result

    - name: Remove the database
      community.general.webfaction_db:
        login_name: "{{ login_name }}"
        login_password: "{{ login_password }}"
        machine: "{{ machine }}"
        name: "{{ name }}"
        state: "absent"
      register: remove_result

    - debug:
        var: remove_result