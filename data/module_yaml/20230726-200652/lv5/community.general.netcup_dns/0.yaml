---
- name: Test Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  vars:
    api_key: "your-api-key"
    api_password: "your-api-password"
    customer_id: 12345
    domain: "example.com"
    priority: 0
    record: "test-record"
    solo: true
    state: "present"
    timeout: 30
    type: "A"
    value: "10.1.1.1"

  tasks:
    - name: Create random port number
      set_fact:
        random_port: "{{ 1024 + (ansible_play_hosts.index(inventory_hostname) | random(seed=inventory_hostname)) }}"

    - name: Test netcup_dns module with random port
      community.general.netcup_dns:
        api_key: "{{ api_key }}"
        api_password: "{{ api_password }}"
        customer_id: "{{ customer_id }}"
        domain: "{{ domain }}"
        priority: "{{ priority }}"
        record: "{{ record }}"
        solo: "{{ solo }}"
        state: "{{ state }}"
        timeout: "{{ timeout }}"
        type: "{{ type }}"
        value: "{{ value }}"
        port: "{{ random_port }}"
      register: result

    - name: Print module result
      debug:
        var: result