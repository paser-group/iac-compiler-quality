---
- name: Test playbook for community.network.avi_gslb module
  hosts: localhost
  gather_facts: false

  vars:
    api_context:
      api_version: "20.1.5"
      username: "admin"
      password: "avi_password"
      controller: "avi-controller"

  tasks:
    - name: Create GSLB configuration
      community.network.avi_gslb:
        controller: "{{ api_context.controller }}"
        username: "{{ api_context.username }}"
        password: "{{ api_context.password }}"
        action: create
        name: "test_gslb"
        tenant: "admin"
        ip_addresses:
          - "10.1.1.1"
          - "10.1.1.2"
          - "10.1.1.3"
          - "10.1.1.4"
        sites:
          - name: "site1"
            ip_addresses:
              - "192.168.1.1"
              - "192.168.1.2"
              - "192.168.1.3"
        tenant_ref: "/api/tenant/admin"
        state: present

    - name: Update GSLB configuration description
      community.network.avi_gslb:
        controller: "{{ api_context.controller }}"
        username: "{{ api_context.username }}"
        password: "{{ api_context.password }}"
        action: update
        name: "test_gslb"
        tenant: "admin"
        description: "Updated description"
        tenant_ref: "/api/tenant/admin"
        state: present

    - name: Enable GSLB maintenance mode
      community.network.avi_gslb:
        controller: "{{ api_context.controller }}"
        username: "{{ api_context.username }}"
        password: "{{ api_context.password }}"
        action: update
        name: "test_gslb"
        tenant: "admin"
        maintenance_mode: true
        tenant_ref: "/api/tenant/admin"
        state: present

    # Test random port settings
    - name: Test random port settings
      community.network.avi_gslb:
        controller: "{{ api_context.controller }}"
        username: "{{ api_context.username }}"
        password: "{{ api_context.password }}"
        action: update
        name: "test_gslb"
        tenant: "admin"
        api_context:
          api_version: "20.1.5"
          username: "admin"
          password: "avi_password"
        send_interval: "{{ randint(1, 10) }}"
        tenant_ref: "/api/tenant/admin"
        state: present