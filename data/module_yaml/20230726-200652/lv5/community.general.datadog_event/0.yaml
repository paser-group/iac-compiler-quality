---
- name: Post Datadog event
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "api.datadoghq.com"
    api_key: "YOUR_API_KEY"
    app_key: "YOUR_APP_KEY"

  tasks:
    - name: Generate random port number
      set_fact:
        port_number: "{{ 10000 | random }}"

    - name: Post event to Datadog
      community.general.datadog_event:
        api_host: "{{ api_host }}"
        api_key: "{{ api_key }}"
        app_key: "{{ app_key }}"
        priority: "normal"
        alert_type: "info"
        title: "Example event"
        text: "This is an example event"
        aggregation_key: "example_key"
        date_happened: "{{ ansible_date_time.epoch }}"
        host: "{{ inventory_hostname }}"
        tags:
          - "example_tag"
        validate_certs: false
        port: "{{ port_number }}"
      register: result

    - name: Debug result
      debug:
        var: result