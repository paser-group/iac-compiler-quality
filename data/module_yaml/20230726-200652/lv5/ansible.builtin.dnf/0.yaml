---
- name: Manage packages using dnf module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install packages
      ansible.builtin.dnf:
        name: "{{ item }}"
        state: present
      loop:
        - package1
        - package2
        - package3

    - name: Enable plugin
      ansible.builtin.dnf:
        name: plugin
        state: present
        enable_plugin: "{{ item }}"
      loop:
        - plugin1
        - plugin2

    - name: Update packages
      ansible.builtin.dnf:
        name: '*'
        state: latest
        update_cache: yes

    - name: Remove packages
      ansible.builtin.dnf:
        name: "{{ item }}"
        state: absent
      loop:
        - package1
        - package2

    - name: Test port settings
      ansible.builtin.dnf:
        name: package1
        state: present
        enable_plugin: plugin1
        update_cache: yes
        cacheonly: yes
        download_only: yes
        validate_certs: no
        sslverify: no
        install_repoquery: yes
        disable_gpg_check: yes
        skip_broken: yes
        allowerasing: yes
        download_dir: /tmp
        conf_file: /etc/dnf/dnf.conf
        disablerepo:
          - repo1
          - repo2
        enablerepo:
          - repo3
          - repo4
        exclude:
          - package2
        disable_plugin:
          - plugin1
        enable_plugin:
          - plugin2
        disable_excludes: main
        installroot: /chroot
        install_weak_deps: yes
        nobest: yes
        bugfix: yes
        security: yes
        releasever: "8"
        lock_timeout: 300

    - name: Test random port settings
      ansible.builtin.dnf:
        name: package1
        state: present
        enable_plugin: plugin1
        port: "{{ item }}"
      loop:
        - "8080"
        - "9090"