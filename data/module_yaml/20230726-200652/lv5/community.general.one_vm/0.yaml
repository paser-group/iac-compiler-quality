---
- name: Test playbook for latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a VM
      community.general.one_vm:
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        attributes:
          name: "test-vm"
          memory: "{{ memory }}"
          vcpu: "{{ vcpu }}"
          port: "{{ port }}"
      register: vm_creation

    - name: Debug VM creation result
      debug:
        var: vm_creation

    - name: Terminate the VM
      community.general.one_vm:
        api_url: "{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        attributes:
          name: "test-vm"
          state: absent
      register: vm_termination

    - name: Debug VM termination result
      debug:
        var: vm_termination