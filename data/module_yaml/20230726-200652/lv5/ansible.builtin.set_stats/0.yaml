- name: Set stats and test for latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port numbers
      ansible.builtin.set_fact:
        random_port1: "{{ 10000 | random }}"
        random_port2: "{{ 10000 | random }}"

    - name: Set stats
      ansible.builtin.set_stats:
        aggregate: "{{ random_port1 | random_bool }}"
        data:
          port1: "{{ random_port1 | random_item }}"
          port2: "{{ random_port2 | random_item }}"
        per_host: "{{ random_port2 | random_bool }}"

    - name: Debug stats
      ansible.builtin.debug:
        var: ansible_facts.ansible_stats