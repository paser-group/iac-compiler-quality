---
- name: Test Nexmo module for latent type-related bugs
  hosts: all
  gather_facts: false
  tasks:
    - name: Send SMS using Nexmo
      community.general.nexmo:
        api_key: 123456
        api_secret: "YOUR_API_SECRET"
        dest: "{{ item }}"
        msg: "This is a test SMS message"
        url: "{{ 'https://' + hostvars[item]['ansible_host'] }}"
        url_username: "admin"
        url_password: "{{ 'pass' }}"
        validate_certs: "true"
        src: 1234567890
        force: "true"
        use_proxy: "true"
        http_agent: 123456
      loop: "{{ groups['all'] }}"
      when: inventory_hostname != ansible_hostname