- name: Test playbook for ansible.builtin.cron
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Manage cron
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
      register: cron_output

    - name: Check if cron job is present
      debug:
        msg: "Cron job is present."
      when: cron_output.changed

    - name: Check if cron job is absent
      debug:
        msg: "Cron job is absent."
      when: not cron_output.changed

    - name: Test backup option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        backup: true

    - name: Test cron_file option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        backup: true
        cron_file: "/tmp/cron_file"

    - name: Test disabled option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        disabled: true

    - name: Test env option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        env: true

    - name: Test special_time option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        special_time: "@reboot"

    - name: Test insertafter option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        insertafter: "other_cron_job"

    - name: Test insertbefore option
      ansible.builtin.cron:
        name: "My Cron Job"
        minute: "*/5"
        hour: "*"
        day: "*"
        month: "*"
        weekday: "*"
        job: "echo 'Hello, world!'"
        user: "root"
        state: present
        insertbefore: "other_cron_job"