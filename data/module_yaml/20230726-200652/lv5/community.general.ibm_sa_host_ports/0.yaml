- name: Test playbook for community.general.ibm_sa_host_ports
  hosts: localhost
  gather_facts: false

  tasks:

    - name: Generate random port number
      ansible.builtin.set_fact:
        port_number: "{{ 4000 + (ansible_play_hosts_all.index(inventory_hostname) * 10) }}"

    - name: Add host ports on IBM Spectrum Accelerate F
      community.general.ibm_sa_host_ports:
        endpoint: "https://example.com"  # Update with the correct endpoint
        username: "admin"  # Update with the correct username
        password: "password"  # Update with the correct password
        host: "myhost"  # Update with the correct host
        fcaddress: "00:00:00:00:00:00:00:00"  # Update with the correct FC address
        num_of_visible_targets: "2"  # Update with the correct number of visible targets
        iscsi_name: "iqn.2019-12.com.example:myhost"  # Update with the correct iSCSI name
        state: present
        port: "{{ port_number | int }}"  # Convert port_number to an integer

      register: result

    - name: Debug output
      debug:
        var: result