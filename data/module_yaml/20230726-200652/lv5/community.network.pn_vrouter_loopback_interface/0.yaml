---
- name: Test pn_vrouter_loopback_interface module
  hosts: localhost
  gather_facts: false
  vars:
    pn_cliswitch: "vr-device"
    pn_index: "1"
    pn_ip: "10.1.1.200"
    pn_vrouter_name: "my-vrouter"
    state: "present"

  tasks:
    - name: Add loopback interface
      community.network.pn_vrouter_loopback_interface:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_index: "{{ pn_index }}"
        pn_ip: "{{ pn_ip }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        state: "{{ state }}"
      register: result

    - name: Display result
      debug:
        var: result

    - name: Remove loopback interface
      community.network.pn_vrouter_loopback_interface:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_index: "{{ pn_index }}"
        pn_ip: "{{ pn_ip }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        state: "absent"
      register: result

    - name: Display result
      debug:
        var: result

    - name: Test random port numbers
      set_fact:
        random_port: "{{ 10000 | random }}"
  
    - name: Add loopback interface with custom port
      community.network.pn_vrouter_loopback_interface:
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_index: "{{ pn_index }}"
        pn_ip: "{{ pn_ip }}"
        pn_vrouter_name: "{{ pn_vrouter_name }}"
        state: "{{ state }}"
        port: "{{ random_port }}"
      register: result
        
    - name: Display result
      debug:
        var: result