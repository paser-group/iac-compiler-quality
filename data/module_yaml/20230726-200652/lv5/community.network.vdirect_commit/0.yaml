---
- name: Test playbook for community.network.vdirect_commit module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random ports
      block:
        - set_fact:
            vdirect_http_port: "{{ 1024 | random(start=1024, end=65535) }}"
            vdirect_https_port: "{{ 1024 | random(start=1024, end=65535) }}"

    - name: Print vDirect HTTP port number
      debug:
        var: vdirect_http_port

    - name: Print vDirect HTTPS port number
      debug:
        var: vdirect_https_port

    - name: Test community.network.vdirect_commit module
      community.network.vdirect_commit:
        vdirect_ip: "{{ vdirect_ip }}"
        vdirect_user: "{{ vdirect_user }}"
        vdirect_password: "{{ vdirect_password }}"
        vdirect_secondary_ip: "{{ vdirect_secondary_ip }}"
        vdirect_wait: "{{ vdirect_wait }}"
        devices: "{{ devices }}"
        save: "{{ save }}"
        apply: "{{ apply }}"
        sync: "{{ sync }}"
        validate_certs: "{{ validate_certs }}"
        vdirect_timeout: "{{ vdirect_timeout }}"
        vdirect_http_port: "{{ vdirect_http_port }}"
        vdirect_https_port: "{{ vdirect_https_port }}"
        vdirect_use_ssl: "{{ vdirect_use_ssl }}"
        
      register: result

    - name: Print module result
      debug:
        var: result