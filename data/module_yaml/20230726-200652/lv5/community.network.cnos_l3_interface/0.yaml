---
- name: Manage Layer-3 Interfaces on Lenovo Switches
  hosts: switches
  gather_facts: no

  tasks:
    - name: Create Layer-3 Interface
      community.network.cnos_l3_interface:
        aggregate: "{{ my_aggregate | default(None) }}"
        ipv4: "{{ my_ipv4 | default(None) }}"
        ipv6: "{{ my_ipv6 | default(None) }}"
        name: "{{ my_name | default(None) }}"
        state: "{{ my_state | default(None) }}"
      vars:
        my_aggregate: None
        my_ipv4: None
        my_ipv6: None
        my_name: None
        my_state: None

      register: result

    - name: Display result
      debug:
        var: result

- name: Test Cases
  hosts: localhost
  gather_facts: no

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 10000 | random }}"
        
    - name: Test Case 1 - Random Port Number
      include_tasks: "testcase1.yml"
      vars:
        aggregate: "{{ random_port }}"

    - name: Test Case 2 - Random Port Number
      include_tasks: "testcase2.yml"
      vars:
        ipv4: "{{ random_port }}"

    - name: Test Case 3 - Random Port Number
      include_tasks: "testcase3.yml"
      vars:
        ipv6: "{{ random_port }}"

    - name: Test Case 4 - Random Port Number
      include_tasks: "testcase4.yml"
      vars:
        name: "{{ random_port }}"