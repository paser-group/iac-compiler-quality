---
- name: Test playbook for community.general.gunicorn
  hosts: localhost
  gather_facts: false

  vars:
    app: myapp:app
    chdir: /path/to/myapp
    config: /etc/gunicorn/myapp.conf.py
    pid: /var/run/gunicorn.pid
    user: myuser
    venv: /path/to/venv
    worker: gthread

  tasks:
    - name: Install community.general collection
      ansible-galaxy collection install community.general

    - name: Generate invalid port number for Gunicorn
      set_fact:
        gunicorn_port: "invalid"

    - name: Start Gunicorn
      community.general.gunicorn:
        app: "{{ app }}"
        chdir: "{{ chdir }}"
        config: "{{ config }}"
        pid: "{{ pid }}"
        user: "{{ user }}"
        venv: "{{ venv }}"
        worker: "{{ worker }}"
        port: "{{ gunicorn_port }}"
      register: gunicorn_output

    - name: Debug Gunicorn output
      debug:
        var: gunicorn_output