- name: Gather listen ports facts
  hosts: all
  gather_facts: false

  tasks:
    - name: Gather all listen ports
      community.general.listen_ports_facts:
        command: "ss -tln"
      register: listen_ports_all

    - name: Debug all listen ports
      debug:
        var: listen_ports_all

    - name: Gather listen ports for specific process
      community.general.listen_ports_facts:
        command: "ss -tln | grep sshd"
      register: listen_ports_sshd

    - name: Debug listen ports for specific process
      debug:
        var: listen_ports_sshd

    - name: Gather listen ports excluding non-listening
      community.general.listen_ports_facts:
        command: "ss -tln"
        include_non_listening: false
      register: listen_ports_listening

    - name: Debug listen ports excluding non-listening
      debug:
        var: listen_ports_listening

    - name: Test random port numbers
      community.general.listen_ports_facts:
        command: "ss -tln"
        ports:
          - 1234
          - 5678
          - 9012
      register: listen_ports_random

    - name: Debug random port numbers
      debug:
        var: listen_ports_random