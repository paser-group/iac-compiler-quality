---
- name: Test Ansible Latent Type-Related Bugs - community.general.sl_vm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create virtual server with random port numbers
      community.general.sl_vm:
        cpus: "{{ item.cpus }}"
        datacenter: "{{ item.datacenter }}"
        dedicated: "{{ item.dedicated }}"
        disks: "{{ item.disks }}"
        domain: "{{ item.domain }}"
        flavor: "{{ item.flavor }}"
        hostname: "{{ item.hostname }}"
        hourly: "{{ item.hourly }}"
        image_id: "{{ item.image_id }}"
        instance_id: "{{ item.instance_id }}"
        local_disk: "{{ item.local_disk }}"
        memory: "{{ item.memory }}"
        nic_speed: "{{ item.nic_speed }}"
        os_code: "{{ item.os_code }}"
        post_uri: "{{ item.post_uri }}"
        private: "{{ item.private }}"
        private_vlan: "{{ item.private_vlan }}"
        public_vlan: "{{ item.public_vlan }}"
        ssh_keys: "{{ item.ssh_keys }}"
        state: "{{ item.state }}"
        tags: "{{ item.tags }}"
        wait: "{{ item.wait }}"
        wait_time: "{{ item.wait_time }}"
      vars:
        random_ports:
          - "{{ range(1, 10) | random }}"
      loop:
        - cpus: 2
          datacenter: "dal09"
          dedicated: true
          disks:
            - { capacity: 25, os_type: "REDHAT" }
            - { capacity: 50, os_type: "CENTOS" }
          domain: "example.com"
          flavor: "B1_8X8X100"
          hostname: "test1"
          hourly: false
          image_id: "11223344"
          instance_id: "5678"
          local_disk: true
          memory: 8
          nic_speed: 1000
          os_code: "ubuntu_20_64"
          post_uri: "https://example.com"
          private: false
          private_vlan: "12345"
          public_vlan: "56789"
          ssh_keys:
            - "ssh-rsa AAAAB3NzaC1yc2EA ... user@host"
            - "ssh-rsa AAAAB3NzaC1yc2EA ... another@host"
          state: "present"
          tags: "tag1,tag2"
          wait: true
          wait_time: 300
          ports: "{{ random_ports }}"