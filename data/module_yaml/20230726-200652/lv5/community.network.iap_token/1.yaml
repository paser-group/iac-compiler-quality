---
- name: Test playbook for community.network.iap_token
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port numbers
      set_fact:
        iap_port: "{{ range(4, 65535) | random }}"
        https: "{{ ['true', 'false'] | random }}"
        validate_certs: "{{ ['true', 'false'] | random }}"

    - name: Get IAP token
      community.network.iap_token:
        iap_fqdn: "{{ iap_fqdn | default('example.com') }}"
        iap_port: "{{ iap_port }}"
        username: "{{ username | default('admin') }}"
        password: "{{ password | default('password') }}"
        validate_certs: "{{ validate_certs }}"
        https: "{{ https }}"
      register: iap_token

    - name: Debug IAP token
      debug:
        var: iap_token