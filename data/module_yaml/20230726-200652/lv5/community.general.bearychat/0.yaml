---
- name: Test Bearychat Module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Send Bearychat Message
      community.general.bearychat:
        markdown: true
        channel: "my_channel"
        text: "Hello from Ansible!"
        attachments:
          - text: "This is an attachment text"
            color: "#36a64f"
            title: "Attachment Title"
            url: "https://example.com"
      register: bearychat_result

    - name: Debug Bearychat Result
      debug:
        var: bearychat_result

    - name: Generate Random Port Numbers
      set_fact:
        random_port: "{{ range(1, 65536) | random | int }}"

    - name: Send Bearychat Message with Invalid Port
      community.general.bearychat:
        markdown: true
        channel: "my_channel"
        text: "Hello from Ansible with invalid port!"
        attachments:
          - text: "This is an attachment text with invalid port"
            color: "#36a64f"
            title: "Attachment Title with invalid port"
            url: "https://example.com"
        port: "{{ random_port }}"
      ignore_errors: true