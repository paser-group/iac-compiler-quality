---
- name: Test playbook for 'community.general.gitlab_hook' module
  hosts: localhost
  gather_facts: false

  vars:
    gitlab_api_url: "https://gitlab.example.com/api/v4"
    gitlab_project: "myproject"
    random_port: "{{ 1024 + (ansible_play_hosts_all.index(inventory_hostname)|random * 100) }}"
    gitlab_hook_url: "https://example.com:{{ random_port }}/hook"

  tasks:
    - name: Create GitLab hook
      community.general.gitlab_hook:
        api_url: "{{ gitlab_api_url }}"
        api_token: "my_api_token"
        hook_url: "{{ gitlab_hook_url }}"
        project: "{{ gitlab_project }}"
        state: present
        push_events: true
        push_events_branch_filter: "master"
        tag_push_events: true
        note_events: true
        job_events: true
        pipeline_events: true
        issues_events: true
        merge_requests_events: true
        wiki_page_events: true
        push_events: true
        validate_certs: false
      register: result

    - name: Debug result
      debug:
        var: result