---
- name: Manage NTP authentication configuration
  hosts: huawei_devices
  gather_facts: false
  tasks:
    - name: Configure NTP authentication
      community.network.ce_ntp_auth:
        host: "{{ inventory_hostname }}"
        username: admin
        password: password
        auth_mode: None
        auth_pwd: None
        auth_type: None
        authentication: None
        key_id: None
        state: present
        trusted_key: None
      register: result

    - name: Debug module output
      debug:
        var: result

- name: Test NTP authentication configuration
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Produce random port numbers for testing
      shell: |
        echo -e "{{ range(8000, 8100) | random }}"
      register: random_port

    - name: Configure NTP authentication with random port
      community.network.ce_ntp_auth:
        host: dummy
        username: dummy
        password: dummy
        auth_mode: None
        auth_pwd: None
        auth_type: None
        authentication: None
        key_id: None
        state: present
        trusted_key: "{{ random_port.stdout }}"
      register: result

    - name: Debug module output
      debug:
        var: result