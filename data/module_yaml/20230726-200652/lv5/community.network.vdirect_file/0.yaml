- name: Upload file to vDirect
  hosts: localhost
  gather_facts: false

  vars:
    file_name: "{{ lookup('file', 'path/to/file') }}"  # Replace 'path/to/file' with the actual file path on your system
    validate_certs: false
    vdirect_http_port: "{{ random_port() }}"
    vdirect_https_port: "{{ random_port() }}"
    vdirect_ip: "10.1.1.1"  # Replace with the actual IP of vDirect
    vdirect_password: "vdirect_password"  # Replace with the actual password for vDirect
    vdirect_secondary_ip: "10.1.1.2"  # Replace with the actual secondary IP of vDirect if applicable
    vdirect_timeout: 30
    vdirect_use_ssl: true
    vdirect_user: "vdirect_user"  # Replace with the actual username for vDirect
    vdirect_wait: true

  tasks:
    - name: Upload file to vDirect
      community.network.vdirect_file:
        file_name: "{{ file_name }}"
        validate_certs: "{{ validate_certs }}"
        vdirect_http_port: "{{ vdirect_http_port }}"
        vdirect_https_port: "{{ vdirect_https_port }}"
        vdirect_ip: "{{ vdirect_ip }}"
        vdirect_password: "{{ vdirect_password }}"
        vdirect_secondary_ip: "{{ vdirect_secondary_ip }}"
        vdirect_timeout: "{{ vdirect_timeout }}"
        vdirect_use_ssl: "{{ vdirect_use_ssl }}"
        vdirect_user: "{{ vdirect_user }}"
        vdirect_wait: "{{ vdirect_wait }}"
      register: upload_result

    - name: Debug upload result
      debug:
        var: upload_result

  vars_prompt:
    - name: "random_port"
      prompt: "Enter a random port number to test"
      private: no

  pre_tasks:
    - name: Include random port generation script
      include_vars:
        file: "random_port_generator.yml"