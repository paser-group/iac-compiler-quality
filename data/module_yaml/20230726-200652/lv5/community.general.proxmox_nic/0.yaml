---
- name: Manage NIC of Qemu VM in Proxmox
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "your_proxmox_host"
    api_user: "your_proxmox_user"
    api_password: "your_proxmox_password"

  tasks:
    - name: Configure NIC
      community.general.proxmox_nic:
        api_host: "{{ api_host }}"
        api_user: "{{ api_user }}"
        api_password: "{{ api_password }}"
        vmid: 100
        state: present
        name: eth0
        model: virtio
        mtu: 1500
        mac: "52:54:00:00:00:01"
        bridge: vmbr1
        link_down: false
        queues: 1
        rate: 0
        firewall: false
        tag: 999
        trunks: []

    - name: Randomly change port numbers for testing
      community.general.proxmox_nic:
        api_host: "{{ api_host }}"
        api_user: "{{ api_user }}"
        api_password: "{{ api_password }}"
        vmid: 100
        state: present
        name: eth0
        port: "{{ 3000 | random }}"
        listen_all: false