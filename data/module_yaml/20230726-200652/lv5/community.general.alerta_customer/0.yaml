---
- name: Test playbook for alerta_customer module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port number for alerta_url
      set_fact:
        random_port: "{{ 30000 | random(inventory_hostname | hash | int) }}"
      run_once: true

    - name: Manage customer alerts
      community.general.alerta_customer:
        alerta_url: "http://{{ inventory_hostname }}:{{ random_port }}"
        api_key: "your-api-key"
        api_password: "your-api-password"
        api_username: "your-api-username"
        customer: "your-customer-name"
        match: "your-match-string"
        state: "present"
      register: result

    - name: Debug result
      debug:
        var: result