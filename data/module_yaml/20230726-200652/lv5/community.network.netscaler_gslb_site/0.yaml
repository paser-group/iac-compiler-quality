---
- name: Test playbook for netscaler_gslb_site module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create gslb site
      community.network.netscaler_gslb_site:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        sitename: "{{ sitename }}"
        siteipaddress: "{{ siteipaddress }}"
        state: present
        validate_certs: "{{ validate_certs }}"
        clip: "{{ clip | default(None) }}"
        metricexchange: "{{ metricexchange | default(None) }}"
        naptrreplacementsuffix: "{{ naptrreplacementsuffix | default(None) }}"
        nwmetricexchange: "{{ nwmetricexchange | default(None) }}"
        parentsite: "{{ parentsite | default(None) }}"
        publicclip: "{{ publicclip | default(None) }}"
        publicip: "{{ publicip | default(None) }}"
        save_config: "{{ save_config }}"
        sessionexchange: "{{ sessionexchange | default(None) }}"
        sitetype: "{{ sitetype | default(None) }}"
        triggermonitor: "{{ triggermonitor | default(None) }}"

    - name: Update gslb site
      community.network.netscaler_gslb_site:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        sitename: "{{ sitename }}"
        siteipaddress: "{{ siteipaddress }}"
        state: present
        validate_certs: "{{ validate_certs }}"
        clip: "{{ clip | default(None) }}"
        metricexchange: "{{ metricexchange | default(None) }}"
        naptrreplacementsuffix: "{{ naptrreplacementsuffix | default(None) }}"
        nwmetricexchange: "{{ nwmetricexchange | default(None) }}"
        parentsite: "{{ parentsite | default(None) }}"
        publicclip: "{{ publicclip | default(None) }}"
        publicip: "{{ publicip | default(None) }}"
        save_config: "{{ save_config }}"
        sessionexchange: "{{ sessionexchange | default(None) }}"
        sitetype: "{{ sitetype | default(None) }}"
        triggermonitor: "{{ triggermonitor | default(None) }}"

    - name: Delete gslb site
      community.network.netscaler_gslb_site:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        sitename: "{{ sitename }}"
        siteipaddress: "{{ siteipaddress }}"
        state: absent
        validate_certs: "{{ validate_certs }}"

- name: Test random port settings
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port
      community.network.netscaler_gslb_site:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        sitename: "{{ sitename }}"
        siteipaddress: "{{ siteipaddress }}"
        state: present
        validate_certs: "{{ validate_certs }}"
        clip: "{{ clip | default(None) }}"
        metricexchange: "{{ metricexchange | default(None) }}"
        naptrreplacementsuffix: "{{ naptrreplacementsuffix | default(None) }}"
        nwmetricexchange: "{{ nwmetricexchange | default(None) }}"
        parentsite: "{{ parentsite | default(None) }}"
        publicclip: "{{ publicclip | default(None) }}"
        publicip: "{{ publicip | default(None) }}"
        save_config: "{{ save_config }}"
        sessionexchange: "{{ sessionexchange | default(None) }}"
        sitetype: "{{ sitetype | default(None) }}"
        triggermonitor: "{{ triggermonitor | default(None) }}"
        port: "{{ 1024 + (play_hosts.index(inventory_hostname) * 10) }}"