---
- name: Backup Configuration
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Backup Configuration
      community.network.cnos_backup:
        host: "{{ inventory_hostname }}"
        username: "admin"
        password: "password"
        enablePassword: "enable_password"
        configType: none
        deviceType: "{{ item }}"
        outputfile: "/var/backups/{{ inventory_hostname }}_config.txt"
        serverusername: "backup_user"
        serverpassword: "backup_password"
        rcserverip: "10.1.1.100"
        rcpath: "/backup"
        protocol: scp
      loop:
        - "cisco_nxos_ssh"
        - "cisco_ios_ssh"
        - "cisco_xr_ssh"

- name: Test port settings
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Backup Configuration with random port
      community.network.cnos_backup:
        host: "{{ inventory_hostname }}"
        username: "admin"
        password: "password"
        enablePassword: "enable_password"
        configType: none
        deviceType: "cisco_nxos_ssh"
        outputfile: "/var/backups/{{ inventory_hostname }}_config.txt"
        serverusername: "backup_user"
        serverpassword: "backup_password"
        rcserverip: "10.1.1.100"
        rcpath: "/backup"
        protocol: scp
        port: "{{ port }}"
      loop:
        - "{{ range(10) | list }}"