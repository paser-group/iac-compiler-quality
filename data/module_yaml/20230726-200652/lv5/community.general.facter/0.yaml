---
- name: Discover system facts with facter
  hosts: node-net
  gather_facts: false
  tasks:
    - name: Install facter on target nodes
      package:
        name: facter
        state: present

    - name: Run facter on target nodes
      community.general.facter:
        env:
          PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        ignore_errors: true
      register: facter_result

    - name: Print facter result
      debug:
        var: facter_result

    - name: Test port settings with random port numbers
      community.general.facter:
        env:
          PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
        port: "{{ 1024 | random }}"
        ignore_errors: true
      register: port_test_result

    - name: Print port test result
      debug:
        var: port_test_result