---
- name: Test Bitbucket pipeline known host
  hosts: localhost
  gather_facts: false

  vars:
    client_id: "{{ random_port.stdout }}"
    client_secret: "{{ random_port.stdout }}"
    key: "{{ random_port.stdout }}"
    name: "{{ random_port.stdout }}"
    password: "{{ random_port.stdout }}"
    repository: "{{ random_port.stdout }}"
    state: "{{ random_port.stdout }}"
    user: "{{ random_port.stdout }}"
    workspace: "{{ random_port.stdout }}"

  tasks:
    - name: Generate random port numbers
      ansible.builtin.command: python -c 'import random; print(random.randint(1024, 65535))'
      register: random_port

    - name: Add Bitbucket pipeline known host
      community.general.bitbucket_pipeline_known_host:
        client_id: "{{ client_id }}"
        client_secret: "{{ client_secret }}"
        key: "{{ key }}"
        name: "{{ name }}"
        password: "{{ password }}"
        repository: "{{ repository }}"
        state: "{{ state }}"
        user: "{{ user }}"
        workspace: "{{ workspace }}"