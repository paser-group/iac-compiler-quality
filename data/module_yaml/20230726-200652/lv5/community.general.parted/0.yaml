---
- name: Configure block devices using parted
  hosts: localhost
  gather_facts: False
  become: True

  tasks:
    - name: Create random port numbers
      shell: "shuf -i 1024-65535 -n 1"
      register: random_port

    - name: Configure block devices
      community.general.parted:
        align: "{{ random_port.stdout }}"
        device: /dev/sda
        flags:
          - boot
        fs_type: ext4
        label: test
        name: primary
        number: 1
        part_end: 10%
        part_start: 1%
        part_type: primary
        resize: False
        state: present
        unit: MiB