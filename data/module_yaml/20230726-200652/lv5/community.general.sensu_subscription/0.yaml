---
- hosts: all
  gather_facts: false

  tasks:
    - name: Include community.general.sensu_subscription module
      community.general.sensu_subscription:
        backup: "{{ true }}"
        name: "{{ 'example_subscription' }}"
        path: "/path/to/subscription"
        state: "{{ 'present' }}"

    - name: Debug port number
      debug:
        msg: "{{ hostvars['localhost']['port'] }}"

- hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random port number
      set_fact:
        port: "{{ 10000 | random }}"


- hosts: all
  gather_facts: false

  tasks:
    - name: Include community.general.sensu_subscription module with random port
      community.general.sensu_subscription:
        backup: "{{ true }}"
        name: "{{ 'example_subscription' }}"
        path: "/path/to/subscription"
        state: "{{ 'present' }}"
        port: "{{ hostvars['localhost']['port']}}"