---
- name: Test playbook for 'community.general.ipa_hbacrule' module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random variables
      set_fact:
        random_port: "{{ 1024 + (((ansible_play_hosts_all|length - 1) * 100) + playbook_dir|realpath|basename|hash|int) |random(seed=inventory_hostname|int) }}"

    - name: Create HBAC rule
      community.general.ipa_hbacrule:
        cn: 1234
        description: test_hbac_rule
        host: test_host
        ipa_host: example.com
        ipa_pass: secret
        ipa_port: "{{ random_port }}"
        ipa_prot: https
        ipa_timeout: "{{ random_port }}"
        ipa_user: admin
        service: test_service
        state: present
        validate_certs: "{{ random_port }}"