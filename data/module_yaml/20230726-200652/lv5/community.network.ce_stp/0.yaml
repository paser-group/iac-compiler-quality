---
- name: Configure STP on HUAWEI devices
  hosts: all
  gather_facts: false

  tasks:
    - name: Configure STP settings
      community.network.ce_stp:
        interface: "{{ interface }}"
        stp_enable: "{{ stp_enable }}"
        stp_mode: "{{ stp_mode }}"
        cost: "{{ cost }}"
        bpdu_filter: "{{ bpdu_filter }}"
        bpdu_protection: "{{ bpdu_protection }}"
        loop_protection: "{{ loop_protection }}"
        root_protection: "{{ root_protection }}"
        tc_protection: "{{ tc_protection }}"
        tc_protection_interval: "{{ tc_protection_interval }}"
        tc_protection_threshold: "{{ tc_protection_threshold }}"
        edged_port: "{{ edged_port }}"
        stp_converge: "{{ stp_converge }}"
        state: "{{ state }}"
      register: stp_result

    - name: Debug STP configuration
      debug:
        var: stp_result

- name: Test Cases
  hosts: localhost
  gather_facts: false

  vars:
    test_ports:
      - "{{ range(1, 10) }}"
  
  tasks:
    - name: Test STP configuration with random port settings
      community.network.ce_stp:
        interface: "{{ item }}"
        stp_enable: true
        stp_mode: rapid-pvst
        cost: 100
        bpdu_filter: true
        bpdu_protection: true
        loop_protection: true
        root_protection: true
        tc_protection: 5
        tc_protection_interval: 10
        tc_protection_threshold: 20
        edged_port: true
        stp_converge: 30
        state: present
      loop: "{{ test_ports }}"
      register: test_result

    - name: Debug test results
      debug:
        var: test_result