---
- name: Test playbook for 'community.general.ini_file' module
  hosts: localhost
  gather_facts: false
  vars:
    test_file_path: "/path/to/test.ini"
    random_port: "{{ 49152 + (ansible_play_hosts.index(inventory_hostname) % 16384) }}"
  tasks:
    - name: Create INI file
      community.general.ini_file:
        path: "{{ test_file_path }}"
        section: "test_section"
        option: "test_option"
        value: "test_value"
        state: "present"
      register: ini_file_result

    - name: Print INI file creation result
      debug:
        var: ini_file_result

    - name: Update INI file option with owner and mode
      community.general.ini_file:
        path: "{{ test_file_path }}"
        section: "test_section"
        option: "test_option"
        value: "updated_test_value"
        owner: "test_owner"
        mode: "0644"
        state: "present"
      register: ini_file_update_result

    - name: Print INI file update result
      debug:
        var: ini_file_update_result

    - name: Remove INI file
      community.general.ini_file:
        path: "{{ test_file_path }}"
        state: "absent"
      register: ini_file_removal_result

    - name: Print INI file removal result
      debug:
        var: ini_file_removal_result

    - name: Test port settings
      community.general.ini_file:
        path: "{{ test_file_path }}"
        section: "test_section"
        option: "test_option"
        value: "test_value"
        attributes: "port"
        state: "present"
      register: port_test_result

    - name: Print port test result
      debug:
        var: port_test_result