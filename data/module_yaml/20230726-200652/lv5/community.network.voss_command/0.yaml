- name: Execute commands on remote devices
  hosts: all
  gather_facts: false
  tasks:
    - name: Run command on remote device
      community.network.voss_command:
        commands:
          - show version
          - show interfaces
          - show ip route
        interval: None
        match: None
        retries: None
        wait_for: None

- name: Test port settings
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 20000 + (ansible_play_hosts_all.index(inventory_hostname) + 1) }}"
  
    - name: Test random port
      community.network.voss_command:
        commands:
          - echo "Testing port {{ random_port }}"

- name: Cleanup
  hosts: all
  gather_facts: false
  tasks:
    - name: Delete random port variable
      set_fact:
        random_port: None