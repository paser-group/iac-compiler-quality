---
- name: Manage BGP peer configuration on HUAWEI devices
  hosts: localhost
  gather_facts: false

  vars:
    bgp_peer_config:
      - name: Test Peer 1
        peer_addr: "10.1.1.1"
        remote_as: 65001
      - name: Test Peer 2
        peer_addr: "10.1.1.2"
        remote_as: 65002

  tasks:
    - name: Configure BGP peer neighbors
      community.network.ce_bgp_neighbor:
        provider: "{{ cli }}"
        state: present
        vrf_name: "{{ hostvars[inventory_hostname]['vrf_name'] }}"
        neighbor: "{{ item.peer_addr }}"
        as_number: "{{ item.remote_as }}"
      loop: "{{ bgp_peer_config }}"
      register: peer_result

    - name: Debug output
      debug: 
        var: peer_result

    # Additional tasks and test cases can be added here