---
- name: Test playbook for community.general.webfaction_app module
  hosts: localhost
  gather_facts: false
  vars:
    app_name: "test_app"
    app_type: "django"
    app_login_name: "admin"
    app_login_password: "password"
    app_machine: "web1"   # Update with actual machine value

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ 8000 | random }}"  # Modify the range as per your requirement

    - name: Add application using community.general.webfaction_app module
      community.general.webfaction_app:
        type: "{{ app_type }}"
        name: "{{ app_name }}"
        login_name: "{{ app_login_name }}"
        login_password: "{{ app_login_password }}"
        machine: "{{ app_machine }}"
        state: present
        port_open: true
        autostart: false
        extra_info: "port={{ random_port }}"
      register: result
      ignore_errors: true

    - name: Print debug output
      debug:
        var: result

    - name: Remove application using community.general.webfaction_app module
      community.general.webfaction_app:
        type: "{{ app_type }}"
        name: "{{ app_name }}"
        login_name: "{{ app_login_name }}"
        login_password: "{{ app_login_password }}"
        machine: "{{ app_machine }}"
        state: absent
      register: remove_result
      ignore_errors: true

    - name: Print debug output
      debug:
        var: remove_result