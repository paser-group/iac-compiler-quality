---
- name: Test playbook for 'community.general.gitlab_project_badge' module
  hosts: localhost
  gather_facts: false

  vars:
    gitlab_project: "myproject"
    gitlab_api_url: "https://gitlab.example.com/api/v4"
    gitlab_api_token: "my_api_token"
    gitlab_image_url: "https://example.com/badge.svg"
    gitlab_link_url: "https://example.com/myproject"
    gitlab_state: "present"
    gitlab_validate_certs: false
    gitlab_port_range_start: 20000
    gitlab_port_range_end: 30000

  tasks:
    - name: Set random port number
      set_fact:
        random_port: "{{ range_start + (range_end - range_start)|random }}"

    - name: Create badge with random port
      community.general.gitlab_project_badge:
        api_url: "{{ gitlab_api_url }}"
        api_token: "{{ gitlab_api_token }}"
        project: "{{ gitlab_project }}"
        state: "{{ gitlab_state }}"
        image_url: "{{ gitlab_image_url }}"
        link_url: "{{ gitlab_link_url }}"
        validate_certs: "{{ gitlab_validate_certs }}"
        port: "{{ random_port }}"
      register: badge_result

    - name: Display badge creation result
      debug:
        var: badge_result