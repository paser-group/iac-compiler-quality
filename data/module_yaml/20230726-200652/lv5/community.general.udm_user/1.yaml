---
- name: Manage posix users on univen
  hosts: localhost
  gather_facts: false

  vars:
    users:
      - username: testuser
        state: present
        password: password123
        firstname: John
        lastname: Doe
        email: [john.doe@example.com]
        groups: [users]
        home_telephone_number: [1234567890]
        mobile_telephone_number: [9876543210]
        street: 1st Street
        city: New York
        state: NY
        postcode: 12345
        unixhome: /home/testuser
        shell: /bin/bash
        home_share: share
        home_share_path: /shares/testuser
        sambahome: /samba/testuser

    random_ports:
      - 80
      - 443
      - 8080

  tasks:
    - name: Generate random port number
      set_fact:
        random_port: "{{ random_ports | random(seed=inventory_hostname) }}"

    - name: Manage posix users
      community.general.udm_user:
        username: "{{ item.username }}"
        state: "{{ item.state }}"
        password: "{{ item.password }}"
        firstname: "{{ item.firstname }}"
        lastname: "{{ item.lastname }}"
        email: "{{ item.email }}"
        groups: "{{ item.groups }}"
        home_telephone_number: "{{ item.home_telephone_number }}"
        mobile_telephone_number: "{{ item.mobile_telephone_number }}"
        street: "{{ item.street }}"
        city: "{{ item.city }}"
        state: "{{ item.state }}"
        postcode: "{{ item.postcode }}"
        unixhome: "{{ item.unixhome }}"
        shell: "{{ item.shell }}"
        home_share: "{{ item.home_share }}"
        home_share_path: "{{ item.home_share_path }}"
        sambahome: "{{ item.sambahome }}"
        port: "{{ random_port }}"
      loop: "{{ users }}"