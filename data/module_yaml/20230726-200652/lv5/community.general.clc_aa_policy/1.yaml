---
- name: Test community.general.clc_aa_policy module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Generate random port numbers
      set_fact:
        port1: "{{ 1024 + (hostvars[inventory_hostname].ansible_play_hosts.index(inventory_hostname) * 100) | random }}"
        port2: "{{ 1024 + (hostvars[inventory_hostname].ansible_play_hosts.index(inventory_hostname) * 100) | random }}"

    - name: Create Anti Affinity Policy
      community.general.clc_aa_policy:
        location: "{{ inventory_hostname }}"
        name: "test_policy"
        state: "present"
        port: "{{ port1 }}-{{ port2 }}"