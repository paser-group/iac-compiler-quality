---
- name: Test manageiq_policies module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required modules
      pip:
        name: "ansible-modules-hashivault"
        state: present

    - name: Include manageiq_policies module
      include_role:
        name: community.general.manageiq_policies
        tasks_from: main

    - name: Test manageiq_policies module
      community.general.manageiq_policies:
        manageiq_connection:
          url: "https://manageiq.example.com"
          username: "admin"
          password: "password"
        policy_profiles:
          - name: "Development"
            description: "Development policies"
            resource_type: "Vm"
            resource_id: 12345
            resource_name: "test-vm"
            state: present
        delegate_to: localhost
      register: result

    - name: Print manageiq_policies module output
      debug:
        var: result

    - name: Produce random port numbers
      ansible.builtin.debug:
        msg: "{{ item }}"
      with_sequence: start=10000 end=10010