---
- name: Test hipchat module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port number
      set_fact:
        random_port: "{{ 30000 + (ansible_play_hosts.index(inventory_hostname) * 100) }}"

    - name: Send hipchat message with random port
      community.general.hipchat:
        api: "https://hipchat-api.example.com/v2"
        token: "your_token_here"
        room: "your_room_here"
        msg_from: "Ansible"
        msg: "Test message"
        msg_format: "text"
        color: "yellow"
        notify: False
        validate_certs: False
        port: "{{ random_port }}"
      register: result

    - name: Debug result
      debug:
        var: result