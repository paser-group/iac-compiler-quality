---

- name: Test playbook for community.general.modprobe
  hosts: localhost
  gather_facts: false
  
  tasks:
    
    - name: Load or remove a module using modprobe
      community.general.modprobe:
        name: "{{ item.name }}"
        params: "{{ item.params }}"
        persistent: "{{ item.persistent }}"
        state: "{{ item.state }}"
      loop:
        - { name: "sample_module1", params: "-p param1=value1", persistent: "yes", state: "present" }
        - { name: "sample_module2", params: "-p param2=value2", persistent: "no", state: "present" }
        - { name: "sample_module3", params: "-p param3=value3", persistent: "yes", state: "absent" }
        - { name: "sample_module4", params: "-p param4=value4", persistent: "no", state: "absent" }

    - name: Test port settings
      community.general.modprobe:
        name: "sample_module5"
        params: "-p param5={{ item }}"
        persistent: "yes"
        state: "present"
      loop:
        - "{{ 1024 + random() * (65535 - 1024) | int }}"