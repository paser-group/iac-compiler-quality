---
- name: Test playbook to uncover latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install required dependencies
      pip:
        name:
          - jinja2
          - netaddr
        state: present

    - name: Configure Docker nodes in the inventory file
      blockinfile:
        path: inventory.ini
        block: |
          [docker-nodes]
          ubuntu1 ansible_host=10.1.1.1
          alpine1 ansible_host=10.1.1.2
          centos1 ansible_host=10.1.1.3
          redhat1 ansible_host=10.1.1.4

    - name: Create a subnet network using Docker network
      command: docker network create --driver bridge --subnet 10.1.1.0/24 --gateway 10.1.1.254 node-net
      ignore_errors: yes

    - name: Configure Docker containers with IP addresses
      blockinfile:
        path: inventory.ini
        block: |
          [docker-nodes:vars]
          ansible_user=root
          ansible_password=password

    - name: Set random port numbers for port settings
      set_fact:
        random_port_1: "{{ 10000 + (play_hosts.index(inventory_hostname) * 2) }}"
        random_port_2: "{{ random_port_1 + 1 }}"
        
    - name: Test community.network.ce_lacp module
      community.network.ce_lacp:
          trunk_id: 1
          mode: active
          select: system
          priority: "{{ random_port_1 }}"
          state: present
          state_flapping: false
          unexpected_mac_disable: true
      register: result

    - name: Debug module output
      debug:
        var: result