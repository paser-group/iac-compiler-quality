---
- name: Setup Avi Cluster
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Avi Cluster
      community.network.avi_cluster:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        state: present
        name: "{{ cluster_name }}"
        tenant: "{{ tenant }}"
        tenant_uuid: "{{ tenant_uuid }}"
        virtual_ip:
          ip_address: "{{ virtual_ip_address }}"
          port: "{{ virtual_ip_port }}"
        api_context: {}
      register: cluster

    - name: Debug Cluster Result
      debug:
        var: cluster

    - name: Random Port Number Test Case
      community.network.avi_cluster:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        state: present
        name: "{{ cluster_name }}"
        tenant: "{{ tenant }}"
        tenant_uuid: "{{ tenant_uuid }}"
        virtual_ip:
          ip_address: "{{ virtual_ip_address }}"
          port: "{{ random_port }}"
        api_context: {}
      register: cluster_with_random_port

    - name: Debug Random Port Number Test Case Result
      debug:
        var: cluster_with_random_port