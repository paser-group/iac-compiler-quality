---
- name: Test edgeos_config module for latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set random port number
      set_fact:
        random_port: "{{ 1024 + (inventory_hostname | regex_replace('[^[:digit:]]+', '') | int) }}"

    - name: Test edgeos_config module
      community.network.edgeos_config:
        backup: true
        backup_options:
          dir: /backup
        save: true
        src: "{{ inventory_hostname }}.config"
        config: "{{ random_port }}"

      vars:
        inventory_hostname: "ubuntu1"

      when: inventory_hostname == "ubuntu1"

    - name: Test edgeos_config module (random_port + 10)
      community.network.edgeos_config:
        backup: true
        backup_options:
          dir: /backup
        save: true
        src: "{{ inventory_hostname }}.config"
        config: "{{ random_port + 10 }}"

      vars:
        inventory_hostname: "alpine1"

      when: inventory_hostname == "alpine1"

    - name: Test edgeos_config module (random_port + 20)
      community.network.edgeos_config:
        backup: true
        backup_options:
          dir: /backup
        save: true
        src: "{{ inventory_hostname }}.config"
        config: "{{ random_port + 20 }}"

      vars:
        inventory_hostname: "centos1"

      when: inventory_hostname == "centos1"

    - name: Test edgeos_config module (random_port + 30)
      community.network.edgeos_config:
        backup: true
        backup_options:
          dir: /backup
        save: true
        src: "{{ inventory_hostname }}.config"
        config: "{{ random_port + 30 }}"

      vars:
        inventory_hostname: "redhat1"
      
      when: inventory_hostname == "redhat1"