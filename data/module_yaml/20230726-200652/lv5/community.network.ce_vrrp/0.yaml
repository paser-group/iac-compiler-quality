- name: Test playbook for community.network.ce_vrrp module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure VRRP interface
      community.network.ce_vrrp:
        admin_flowdown: "{{ item.admin_flowdown | default(false) }}"
        admin_ignore_if_down: "{{ item.admin_ignore_if_down | default(false) }}"
        admin_interface: "{{ item.admin_interface | default(None) }}"
        admin_vrid: "{{ item.admin_vrid | default(None) }}"
        advertise_interval: "{{ item.advertise_interval | default(None) }}"
        auth_key: "{{ item.auth_key | default(None) }}"
        auth_mode: "{{ item.auth_mode | default('simple') }}"
        fast_resume: "{{ item.fast_resume | default('enable') }}"
        gratuitous_arp_interval: "{{ item.gratuitous_arp_interval | default(None) }}"
        holding_multiplier: "{{ item.holding_multiplier | default(None) }}"
        interface: "{{ item.interface | default(None) }}"
        is_plain: "{{ item.is_plain | default(false) }}"
        preempt_timer_delay: "{{ item.preempt_timer_delay | default(None) }}"
        priority: "{{ item.priority | default(None) }}"
        recover_delay: "{{ item.recover_delay | default(None) }}"
        state: "{{ item.state }}"
        version: "{{ item.version }}"
        virtual_ip: "{{ item.virtual_ip | default(None) }}"
        vrid: "{{ item.vrid | default(None) }}"
        vrrp_type: "{{ item.vrrp_type | default('standard') }}"
      with_items:
        - { state: "present", interface: "eth0", vrid: 1, virtual_ip: "10.1.1.10", priority: 100 }
        - { state: "present", interface: "eth1", vrid: 2, virtual_ip: "10.1.1.20", priority: 150 }
        - { state: "present", interface: "eth2", vrid: 3, virtual_ip: "10.1.1.30", priority: 200 }

    # Random port numbers test cases
    - name: Configure VRRP interface with random port
      community.network.ce_vrrp:
        admin_flowdown: false
        interface: "{{ item.interface | default(None) }}"
        vrid: "{{ item.vrid | default(None) }}"
        virtual_ip: "{{ item.virtual_ip | default(None) }}"
        priority: "{{ item.priority | default(None) }}"
        port: "{{ item.port }}"
        vrrp_type: "{{ item.vrrp_type | default('standard') }}"
        state: present
      with_items:
        - { interface: "eth0", vrid: 4, virtual_ip: "10.1.1.40", priority: 250, port: "{{ 1000 | random }}" }
        - { interface: "eth1", vrid: 5, virtual_ip: "10.1.1.50", priority: 300, port: "{{ 1000 | random }}" }
        - { interface: "eth2", vrid: 6, virtual_ip: "10.1.1.60", priority: 350, port: "{{ 1000 | random }}" }