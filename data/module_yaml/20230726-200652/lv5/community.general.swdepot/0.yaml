- name: Test Ansible Latent Type-Related Bugs in community.general.swdepot
  hosts: localhost
  gather_facts: false
  vars:
    depot_path: "/tmp/swdepot"
    package_name: "test-package"
    package_state: "present"
    random_port: "{{ 1024 + (ansible_play_batch_index + 1) * 1000 | random }}"

  tasks:
    - name: Create depot directory with random port
      file:
        path: "{{ depot_path }}"
        state: directory
        mode: '0755'

    - name: Ensure package is present with random port
      community.general.swdepot:
        depot: "{{ depot_path }}"
        name: "{{ package_name }}"
        state: "{{ package_state }}"
        port: "{{ random_port }}"