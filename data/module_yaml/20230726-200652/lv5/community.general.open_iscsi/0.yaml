- name: Test iSCSI module
  hosts: localhost
  gather_facts: false

  vars:
    target: "iqn.2005-06.com.example:test"
    auto_node_startup: false
    auto_portal_startup: true
    discover: true
    login: false
    node_auth: "chap"
    node_user: "user"
    node_pass: "password"
    port: "abc"
    portal: "10.0.0.1"
    rescan: false
    show_nodes: true

  tasks:
    - name: Connect to iSCSI target
      community.general.open_iscsi:
        target: "{{ target }}"
        auto_node_startup: "{{ auto_node_startup }}"
        auto_portal_startup: "{{ auto_portal_startup }}"
        discover: "{{ discover }}"
        login: "{{ login }}"
        node_auth: "{{ node_auth }}"
        node_user: "{{ node_user }}"
        node_pass: "{{ node_pass }}"
        port: "{{ port }}"
        portal: "{{ portal }}"
        rescan: "{{ rescan }}"
        show_nodes: "{{ show_nodes }}"
      register: result

    - name: Debug module output
      debug:
        var: result