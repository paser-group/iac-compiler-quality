---
- name: Manage SNMP user configuration on HUAWEI
  hosts: localhost
  gather_facts: false
  connection: local

  tasks:
    - name: Install dependencies
      pip:
        name: jinja2

    - name: Generate random port number
      command: python -c "import random; print(random.randint(1024, 65535))"
      register: random_port

    - name: Create SNMP user
      community.network.ce_snmp_user:
        aaa_local_user: "{{ None }}"
        acl_number: "{{ None }}"
        auth_key: "{{ None }}"
        auth_protocol: "{{ None }}"
        priv_key: "{{ None }}"
        priv_protocol: "{{ None }}"
        remote_engine_id: "{{ None }}"
        user_group: "{{ None }}"
        usm_user_name: "{{ None }}"
        port: "{{ random_port.stdout }}"
      register: result

    - name: Debug result
      debug:
        var: result