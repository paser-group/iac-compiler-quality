---

- name: Test Playbook for community.general.utm_proxy_frontend module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create reverse proxy frontend with random port
      community.general.utm_proxy_frontend:
        name: reverse_proxy
        address: 10.1.1.1
        port: "{{ 10000 | random }}"
        type: http
        state: present
      vars:
        utm_host: "{{ utm_host }}"
        utm_port: "{{ utm_port }}"
        utm_protocol: "{{ utm_protocol }}"
        utm_token: "{{ utm_token }}"
        validate_certs: "{{ validate_certs }}"
      register: proxy_frontend_result

    - name: Debug the result of creating reverse proxy frontend
      debug:
        var: proxy_frontend_result

    - name: Update reverse proxy frontend with random port
      community.general.utm_proxy_frontend:
        name: reverse_proxy
        address: 10.1.1.1
        port: "{{ 20000 | random }}"
        type: http
        state: present
      vars:
        utm_host: "{{ utm_host }}"
        utm_port: "{{ utm_port }}"
        utm_protocol: "{{ utm_protocol }}"
        utm_token: "{{ utm_token }}"
        validate_certs: "{{ validate_certs }}"
      register: proxy_frontend_result

    - name: Debug the result of updating reverse proxy frontend
      debug:
        var: proxy_frontend_result

    - name: Destroy reverse proxy frontend
      community.general.utm_proxy_frontend:
        name: reverse_proxy
        state: absent
      vars:
        utm_host: "{{ utm_host }}"
        utm_port: "{{ utm_port }}"
        utm_protocol: "{{ utm_protocol }}"
        utm_token: "{{ utm_token }}"
        validate_certs: "{{ validate_certs }}"
      register: proxy_frontend_result

    - name: Debug the result of destroying reverse proxy frontend
      debug:
        var: proxy_frontend_result

...