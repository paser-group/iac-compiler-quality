---
- name: Send text message
  hosts: localhost
  gather_facts: false

  vars:
    account_sid: "YOUR_ACCOUNT_SID"
    auth_token: "YOUR_AUTH_TOKEN"
    from_number: "YOUR_FROM_NUMBER"
    to_numbers:
      - "YOUR_TO_NUMBER"
    media_url: "http://example.com/media"

  tasks:
    - name: Send message
      community.general.twilio:
        account_sid: "{{ account_sid }}"
        auth_token: "{{ auth_token }}"
        from_number: "{{ from_number }}"
        to_numbers: "{{ to_numbers }}"
        msg: "This is a test message"
        media_url: "{{ media_url }}"
      register: twilio_response

    - name: Display response
      debug:
        var: twilio_response

- name: Test case for port settings
  hosts: localhost
  gather_facts: false

  vars:
    account_sid: "YOUR_ACCOUNT_SID"
    auth_token: "YOUR_AUTH_TOKEN"
    from_number: "YOUR_FROM_NUMBER"
    to_numbers:
      - "YOUR_TO_NUMBER"
    media_url: "http://example.com/media"
    random_port: "{{ 30000 | random }}" # Generate random port number

  tasks:
    - name: Send message with random port
      community.general.twilio:
        account_sid: "{{ account_sid }}"
        auth_token: "{{ auth_token }}"
        from_number: "{{ from_number }}"
        to_numbers: "{{ to_numbers }}"
        msg: "This is a test message"
        media_url: "{{ media_url }}"
        port: "{{ random_port }}" # Set the random port number
      register: twilio_response_with_port

    - name: Display response with port
      debug:
        var: twilio_response_with_port