---
- name: Test Ansible SysVInit Module
  hosts: all
  gather_facts: false

  tasks:
    - name: Start service using sysvinit
      ansible.builtin.sysvinit:
        name: "{{ service_name }}"
        state: started
        enabled: true
      register: result

    - name: Debug result
      debug:
        var: result

    - name: Generate random port number
      set_fact:
        random_port: "{{ 33000 + (ansible_play_batch.index(inventory_hostname) * 100) + 1 }}"

    - name: Test port settings
      ansible.builtin.sysvinit:
        name: "{{ service_name }}"
        state: started
        enabled: true
        port: "{{ random_port }}"
      register: result2

    - name: Debug result2
      debug:
        var: result2