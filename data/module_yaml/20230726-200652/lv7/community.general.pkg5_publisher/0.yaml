---
- name: Manage Solaris 11 Image Packages
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Solaris 11 Image Packages
      community.general.pkg5_publisher:
        name: "{{ item }}"
        state: present
      loop:
        - pkg1
        - pkg2
        - pkg3
      register: install_result
      changed_when: "'Nothing to do' not in install_result.stdout"

    - name: Verify Package Installation
      assert:
        that:
          - "'pkg1' in install_result.stdout"
          - "'pkg2' in install_result.stdout"
          - "'pkg3' in install_result.stdout"
        msg: "Package installation failed"

    - name: Update Solaris 11 Image Packages
      community.general.pkg5_publisher:
        name: "{{ item }}"
        state: latest
      loop:
        - pkg1
        - pkg2
        - pkg3
      register: update_result
      changed_when: "'Nothing to do' not in update_result.stdout"

    - name: Verify Package Update
      assert:
        that:
          - "'pkg1' in update_result.stdout"
          - "'pkg2' in update_result.stdout"
          - "'pkg3' in update_result.stdout"
        msg: "Package update failed"

    - name: Uninstall Solaris 11 Image Packages
      community.general.pkg5_publisher:
        name: "{{ item }}"
        state: absent
      loop:
        - pkg1
        - pkg2
        - pkg3
      register: uninstall_result
      changed_when: "'Nothing to do' not in uninstall_result.stdout"

    - name: Verify Package Uninstallation
      assert:
        that:
          - "'pkg1' in uninstall_result.stdout"
          - "'pkg2' in uninstall_result.stdout"
          - "'pkg3' in uninstall_result.stdout"
        msg: "Package uninstallation failed"