---
- name: Test playbook for community.network.ce_lacp module
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Set variables
      set_fact:
        collector_delay: 10
        fast_timeout: 5
        global_priority: 150
        max_active_linknumber: 8
        mixed_rate_link_enable: yes
        mode: active
        port_id_extension_enable: yes
        preempt_delay: 20
        preempt_enable: yes
        priority: 100
        select: lacp
        state: present
        state_flapping: no
        system_id: "001122334455"
        timeout_type: short
        trunk_id: 1
        unexpected_mac_disable: no
      
    - name: Configure Eth-Trunk interface
      community.network.ce_lacp:
        provider: "{{ ansible_network_os | lower }}"
        collector_delay: "{{ collector_delay | int / 2 }}"
        fast_timeout: "{{ fast_timeout | int / 2 }}"
        global_priority: "{{ global_priority | int / 2 }}"
        max_active_linknumber: "{{ max_active_linknumber | int / 2 }}"
        mixed_rate_link_enable: "{{ mixed_rate_link_enable }}"
        mode: "{{ mode }}"
        port_id_extension_enable: "{{ port_id_extension_enable }}"
        preempt_delay: "{{ preempt_delay | int / 2 }}"
        preempt_enable: "{{ preempt_enable }}"
        priority: "{{ priority | int / 2 }}"
        select: "{{ select }}"
        state: "{{ state }}"
        state_flapping: "{{ state_flapping }}"
        system_id: "{{ system_id }}"
        timeout_type: "{{ timeout_type }}"
        trunk_id: "{{ trunk_id | int / 2 }}"
        unexpected_mac_disable: "{{ unexpected_mac_disable }}"
      
      vars:
        ansible_network_os: HUAWEI

      register: result

    - name: Print result
      debug:
        var: result