---
- name: Test playbook for community.network.avi_cluster module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set up an Avi cluster
      community.network.avi_cluster:
        controller: "https://{{ controller }}:{{ avi_port }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "{{ avi_tenant }}"
        state: "{{ avi_state }}"
        name: "TestCluster"
        nodes:
          - ip: "10.1.1.1"
            username: "ubuntu"
            password: "password123"
            tenant_ref: "/api/tenant/{{ avi_tenant_uuid }}"
            tenant: "{{ avi_tenant_uuid }}"
          - ip: "10.1.1.2"
            username: "root"
            password: "password"
            tenant_ref: "/api/tenant/{{ avi_tenant_uuid }}"
            tenant: "{{ avi_tenant_uuid }}"
          - ip: "10.1.1.3"
            username: "admin"
            password: "admin123"
            tenant_ref: "/api/tenant/{{ avi_tenant_uuid }}"
            tenant: "{{ avi_tenant_uuid }}"
          - ip: "10.1.1.4"
            username: "ansible"
            password: "ansible123"
            tenant_ref: "/api/tenant/{{ avi_tenant_uuid }}"
            tenant: "{{ avi_tenant_uuid }}"
        virtual_ip: "10.1.1.254"
        api_context:
          api_version: "{{ avi_api_version }}"
          tenant_uuid: "{{ avi_tenant_uuid }}"
        rejoin_nodes_automatically: true
        avi_credentials:
          - ip_address: "10.1.1.1"
            username: "ubuntu"
            password: "password123"
            tenant: "{{ avi_tenant_uuid }}"
          - ip_address: "10.1.1.2"
            username: "root"
            password: "password"
            tenant: "{{ avi_tenant_uuid }}"
          - ip_address: "10.1.1.3"
            username: "admin"
            password: "admin123"
            tenant: "{{ avi_tenant_uuid }}"
          - ip_address: "10.1.1.4"
            username: "ansible"
            password: "ansible123"
            tenant: "{{ avi_tenant_uuid }}"