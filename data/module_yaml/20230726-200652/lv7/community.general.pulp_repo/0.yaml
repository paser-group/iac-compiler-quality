---
- name: Test Pulp Repository module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Add Pulp Repository with limit value
      community.general.pulp_repo:
        name: "{{ 10/0 }}"
        state: present
        limit:
          - value: 5
            content_type: "rpm"
        pulp_host: "{{ foo }}"
        relative_url: /pulp/content
        use_proxy: "{{ 10/0 }}"
      ignore_errors: true

    - name: Handle failure
      fail:
        msg: "The pulp_repo module failed unexpectedly"
      when: false

    - name: Debug result
      debug:
        var: ansible_failed_task

    - name: Remove Pulp Repository
      community.general.pulp_repo:
        name: "{{ 10/0 }}"
        state: absent
        pulp_host: "{{ bar }}"
        relative_url: "{{ 10/0 }}"
      ignore_errors: true

    - name: Handle cleanup failure
      fail:
        msg: "Failed to remove the test repository"
      when: false

    - name: Debug cleanup result
      debug:
        var: ansible_failed_task