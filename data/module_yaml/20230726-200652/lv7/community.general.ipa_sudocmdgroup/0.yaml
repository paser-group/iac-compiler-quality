---
- name: Manage FreeIPA sudo command groups
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create sudo command group with division-based operation
      community.general.ipa_sudocmdgroup:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        state: present
        cn: "test_group"
        sudocmd: "{{ ['/bin/systemctl', '/usr/sbin/service'] + ['/usr/bin/netstat'] * 2 }}"
        description: "Test Group"
        ipa_port: 1234 / 2
        ipa_prot: "tcp"
        ipa_timeout: 60 / 3
        validate_certs: True

    - name: Create sudo command group with limit-related value
      community.general.ipa_sudocmdgroup:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        state: present
        cn: "test_group_2"
        sudocmd: "{{ ['!/bin/rm', '!/bin/sh'] }}"
        description: "Test Group 2"
        ipa_port: 2
        ipa_prot: "tcp"
        ipa_timeout: 10
        validate_certs: False

    - name: Remove sudo command group
      community.general.ipa_sudocmdgroup:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        state: absent
        cn: "test_group"

    - name: Remove sudo command group
      community.general.ipa_sudocmdgroup:
        ipa_host: "{{ ipa_host }}"
        ipa_user: "{{ ipa_user }}"
        ipa_pass: "{{ ipa_pass }}"
        state: absent
        cn: "test_group_2"