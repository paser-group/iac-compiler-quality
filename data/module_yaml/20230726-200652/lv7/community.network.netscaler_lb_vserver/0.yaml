- name: Test netscaler_lb_vserver module
  hosts: localhost
  gather_facts: false
  become: false

  tasks:
    - name: Create load balancing vserver
      community.network.netscaler_lb_vserver:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        name: "lb_vserver"
        servicebindings:
          - servicename: "service1"
        state: present
        limit:
          timeout: 30          # Timeout for the vserver
          maxautoscalemembers: "{{ 10/3 }}"   # Bug Trigger: Implementation of division-based operations

    - name: Display vserver info
      debug:
        var: community_network_netscaler_lb_vserver

    - name: Delete load balancing vserver
      community.network.netscaler_lb_vserver:
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        nsip: "{{ nsip }}"
        name: "lb_vserver"
        state: absent