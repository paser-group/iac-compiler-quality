- name: Generate IAP token
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Get IAP token
      community.network.iap_token:
        https: true
        iap_fqdn: "{{ iap_fqdn }}"
        iap_port: "{{ iap_port }}"
        password: "{{ password }}"
        username: "{{ username }}"
        validate_certs: false
      register: iap_token_result

    # Test case 1: Assign a division-based limit
    - name: Assign division-based limit
      set_fact:
        limit: "{{ 100 / 0 }}"  # This will raise a ZeroDivisionError
      when: iap_token_result is not defined

    # Test case 2: Use limit variable without assigning
    - name: Use limit variable
      debug:
        var: limit
      when: iap_token_result is defined