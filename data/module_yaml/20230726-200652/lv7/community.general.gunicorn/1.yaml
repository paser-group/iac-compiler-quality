---
- hosts: localhost
  gather_facts: false

  vars:
    worker_limit: 8
    max_workers: "{{ (worker_limit / 2) + 1 }}"

  tasks:
    - name: Run gunicorn
      community.general.gunicorn:
        app: myapp:app
        chdir: /path/to/myapp
        config: /etc/gunicorn.conf.py
        pid: /var/run/gunicorn.pid
        user: myuser
        venv: /path/to/venv
        worker: "{{ 'sync' if max_workers == 1 else 'gevent' }}"