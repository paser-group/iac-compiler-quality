- name: Create compressed archive
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create archive
      community.general.archive:
        path: "{{ item }}"
        dest: "{{ item }}.tar.gz"
      loop:
        - "/path/to/directory1"
        - "/path/to/directory2"
        - "/path/to/directory3"
      when: inventory_hostname == 'ubuntu1'  # Run only on ubuntu1 node

    - name: Verify archive creation
      shell: ls "{{ item }}.tar.gz"
      loop:
        - "/path/to/directory1"
        - "/path/to/directory2"
        - "/path/to/directory3"
      when: inventory_hostname == 'ubuntu1'  # Run only on ubuntu1 node

    - name: Extract archive
      community.general.archive:
        path: "{{ item }}.tar.gz"
        dest: "/path/to/extract"
        format: "tar.gz"
      loop:
        - "/path/to/directory1"
        - "/path/to/directory2"
        - "/path/to/directory3"
      when: inventory_hostname == 'ubuntu1'  # Run only on ubuntu1 node

    - name: Verify archive extraction
      shell: ls "/path/to/extract/{{ item }}"
      loop:
        - "/path/to/directory1"
        - "/path/to/directory2"
        - "/path/to/directory3"
      when: inventory_hostname == 'ubuntu1'  # Run only on ubuntu1 node

    - name: Remove archive
      file:
        path: "{{ item }}.tar.gz"
        state: absent
      loop:
        - "/path/to/directory1"
        - "/path/to/directory2"
        - "/path/to/directory3"
      when: inventory_hostname == 'ubuntu1'  # Run only on ubuntu1 node