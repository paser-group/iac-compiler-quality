- name: Test Ansible Latent Type-Related Bugs
  hosts: localhost
  gather_facts: false

  vars:
    delivery_packet_divisor: 1000
    
  tasks:
    - name: Create Big Monitoring Policy
      community.network.bigmon_policy:
        access_token: "{{ access_token | default(omit) }}"
        action: "{{ action | default(omit) }}"
        controller: "{{ controller | default(omit) }}"
        delivery_packet_count: "{{ delivery_packet_count | default(omit) }}"
        duration: "{{ duration | default(omit) }}"
        name: "{{ name | default(omit) }}"
        policy_description: "{{ policy_description | default(omit) }}"
        priority: "{{ priority | default(omit) }}"
        start_time: "{{ start_time | default(omit) }}"
        state: "{{ state | default(omit) }}"
        validate_certs: "{{ validate_certs | default(omit) }}"

      register: result

    - name: Determine number of packets
      set_fact:
        packet_count: "{{ delivery_packet_count | default(omit) }}"
        packet_count_divided: "{{ packet_count | default(omit) | int / delivery_packet_divisor }}"

    - name: Display result
      debug:
        msg: "Packet count: {{ packet_count }}, Packet count divided: {{ packet_count_divided }}"

    - name: Remove Big Monitoring Policy
      community.network.bigmon_policy:
        access_token: "{{ access_token | default(omit) }}"
        action: "remove"
        controller: "{{ controller | default(omit) }}"
        name: "{{ name | default(omit) }}"
        validate_certs: "{{ validate_certs | default(omit) }}"