---
- hosts: all
  gather_facts: false
  vars:
    node_net_subnet: "10.1.1.0/24"
    node_net_gateway: "10.1.1.254"
    nodes:
      - hostname: "ubuntu1"
        ip_address: "10.1.1.1"
        distribution: "Ubuntu"
      - hostname: "alpine1"
        ip_address: "10.1.1.2"
        distribution: "Alpine"
      - hostname: "centos1"
        ip_address: "10.1.1.3"
        distribution: "CentOS"
      - hostname: "redhat1"
        ip_address: "10.1.1.4"
        distribution: "Red Hat"

  tasks:
    - name: Configure CNOS devices
      community.network.cnos_config:
        admin: true
        backup: true
        backup_options:
          dir: "{{ inventory_dir }}/backup"
          prefix: "config"
        comment: "Generated by Ansible"
        lines:
          - "ip routing"
          - "hostname {{ inventory_hostname }}"
          - "vrf definition MGMT"
          - "    rd 1:1"
          - "    route-target export 1:1"
          - "    route-target import 1:1"
          - "    exit"
          - "interface vlan 1"
          - "    ip address {{ hostvars[inventory_hostname].ip_address }}/24"
          - "    exit"
          - "ip route 0.0.0.0/0 {{ hostvars['all']['node_net_gateway'] }}"
      when: "'CNOS' in inventory_hostname"

    - name: Print distribution information
      debug:
        msg: "{{ item.hostname }} - Distribution: {{ item.distribution }}"
      loop: "{{ nodes }}"