---

- name: Manage netstream export on HUAWEI devices
  hosts: huawei_devices
  gather_facts: false

  vars:
    as_option: "{{ 'enabled' if test_case == 1 else 'disabled' }}"
    bgp_nexthop: "{{ '10.1.1.254' if test_case == 2 else '10.1.1.1' }}"
    host_ip: "{{ '10.1.1.1' if test_case == 3 else '10.1.1.2' }}"
    host_port: "{{ 2055 if test_case == 4 else 9999 }}"
    host_vpn: "{{ 'VPN1' if test_case == 5 else 'VPN2' }}"
    source_ip: "{{ '10.1.1.1' if test_case == 6 else '10.1.1.4' }}"
    state: "{{ 'present' if test_case == 7 else 'absent' }}"
    type: "{{ 'sflow' if test_case == 8 else 'netstream' }}"
    version: "{{ 'v5' if test_case == 9 else 'v9' }}"

  tasks:
    - name: Manage netstream export
      community.network.ce_netstream_export:
        as_option: "{{ as_option }}"
        bgp_nexthop: "{{ bgp_nexthop }}"
        host_ip: "{{ host_ip }}"
        host_port: "{{ host_port }}"
        host_vpn: "{{ host_vpn }}"
        source_ip: "{{ source_ip }}"
        state: "{{ state }}"
        type: "{{ type }}"
        version: "{{ version }}"
      register: result

    - name: Debug result
      debug:
        var: result