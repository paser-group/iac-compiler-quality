- name: Example playbook for apt module
  hosts: all
  gather_facts: false

  tasks:
    - name: Update apt cache
      ansible.builtin.apt:
        update_cache: yes
      register: apt_cache_update

    - name: Install packages with limit based on the number of nodes
      ansible.builtin.apt:
        name: "{{ item }}"
        state: present
      loop: "{{ packages | limit_count }}"
      vars:
        packages:
          - package1
          - package2
          - package3
          # Add more packages as needed

    - name: Debug package installation result
      debug:
        var: apt_cache_update

    - name: Clean apt cache
      ansible.builtin.apt:
        autoclean: yes
        autoremove: yes