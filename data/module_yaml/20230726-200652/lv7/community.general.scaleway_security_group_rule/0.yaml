---
- name: Test playbook for scaleway_security_group_rule module
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Create a security group rule
      community.general.scaleway_security_group_rule:
        api_token: "{{ scaleway_api_token }}"
        security_group: "{{ security_group_id }}"
        direction: "ingress"
        protocol: "tcp"
        port: 80
        ip_range: "{{ ip_range }}"
        state: "present"
        validate_certs: false
      register: result

    - name: Debug Output
      debug:
        var: result

- name: Cleanup the security group rule
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Delete the security group rule
      community.general.scaleway_security_group_rule:
        api_token: "{{ scaleway_api_token }}"
        security_group: "{{ security_group_id }}"
        direction: "ingress"
        protocol: "tcp"
        port: 80
        ip_range: "{{ ip_range }}"
        state: "absent"
        validate_certs: false

      register: result

    - name: Debug Output
      debug:
        var: result