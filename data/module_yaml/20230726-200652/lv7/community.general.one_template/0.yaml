---
- name: Test playbook for one_template module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create a template
      community.general.one_template:
        api_url: "https://{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        id: "{{ id }}"
        name: "{{ name }}"
        state: "{{ state }}"
        template: "{{ template }}"
        validate_certs: "{{ validate_certs }}"
        wait_timeout: "{{ wait_timeout | default(10) }}"
      register: template_result

    - name: Debug template result
      debug:
        var: template_result

    - name: Divide wait_timeout by 2
      set_fact:
        new_wait_timeout: "{{ wait_timeout // 2 }}"

    - name: Create a template with the new wait_timeout
      community.general.one_template:
        api_url: "https://{{ api_url }}"
        api_username: "{{ api_username }}"
        api_password: "{{ api_password }}"
        id: "{{ id }}"
        name: "{{ name }}"
        state: "{{ state }}"
        template: "{{ template }}"
        validate_certs: "{{ validate_certs }}"
        wait_timeout: "{{ new_wait_timeout | default(5) }}"
      register: new_template_result

    - name: Debug new template result
      debug:
        var: new_template_result