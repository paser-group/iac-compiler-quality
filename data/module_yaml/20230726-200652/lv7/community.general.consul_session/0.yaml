- name: Test playbook for community.general.consul_session module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Consul session with a specific datacenter
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        datacenter: "{{ datacenter_name }}"
      vars:
        session_name: "test_session"
        datacenter_name: "dc1"

    - name: Modify Consul session TTL
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        ttl: "{{ session_ttl }}"
      vars:
        session_name: "test_session"
        session_ttl: 60

    - name: Delete Consul session
      community.general.consul_session:
        state: absent
        name: "{{ session_name }}"
      vars:
        session_name: "test_session"

    - name: Validate certificates for Consul communication
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        validate_certs: "{{ validate_certs_flag }}"
      vars:
        session_name: "test_session"
        validate_certs_flag: true

    - name: Create Consul session with delay parameter
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        delay: "{{ session_delay }}"
      vars:
        session_name: "test_session"
        session_delay: 10

    - name: Create Consul session with a different datacenter
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        datacenter: "{{ datacenter_name }}"
      vars:
        session_name: "test_session"
        datacenter_name: "dc2"

    - name: Create Consul session with a different node
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        node: "{{ node_name }}"
      vars:
        session_name: "test_session"
        node_name: "node2"

    - name: Create Consul session with a different IP address
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        host: "{{ consul_host }}"
      vars:
        session_name: "test_session"
        consul_host: "10.1.1.5"

    - name: Create Consul session on a different port
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        port: "{{ consul_port }}"
      vars:
        session_name: "test_session"
        consul_port: 8501

    - name: Create Consul session with a different scheme
      community.general.consul_session:
        state: present
        name: "{{ session_name }}"
        scheme: "{{ consul_scheme }}"
      vars:
        session_name: "test_session"
        consul_scheme: "https"