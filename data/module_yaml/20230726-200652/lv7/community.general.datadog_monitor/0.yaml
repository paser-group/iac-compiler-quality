---
- name: Datadog Monitor Test
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "api.example.com"
    api_key: "api_key"
    app_key: "app_key"

  tasks:
    - name: Test Case 1 - Division-based operation
      community.general.datadog_monitor:
        api_host: "{{ api_host }}"
        api_key: "{{ api_key }}"
        app_key: "{{ app_key }}"
        type: "metric alert"
        query: "avg(last_5m):sum:system.net.bytes_rcvd{{host}}/100 > 100"
        notification_message: "Network bytes received more than 100"
      register: result1

    - name: Test Case 2 - No division-based operation
      community.general.datadog_monitor:
        api_host: "{{ api_host }}"
        api_key: "{{ api_key }}"
        app_key: "{{ app_key }}"
        type: "metric alert"
        query: "avg(last_5m):sum:system.cpu.idle{{host}} > 50"
        notification_message: "CPU idle more than 50"
      register: result2

    - debug:
        var: result1

    - debug:
        var: result2