---
- name: Test playbook for exposing latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set up L4PolicySet
      community.network.avi_l4policyset:
        controller: 123
        username: "admin"
        password: "password"
        state: present
        name: "MyPolicySet"
        tenant: "MyTenant"
        api_version: "20.1.1"
        avi_credentials:
          api_context: 567
        is_internal_policy: True
        tenant_uuid: "7788"
        l4_connection_policy:
          app_proxy_header_mode: 12345
          enable_http2: 4567
          enable_stateful_udp: "yes"
          enable_tcp_proxy: "true"
          enable_tls: 67890
          max_concurrent_connections_per_server: "10000"
          max_concurrent_requests_per_connection: 20000
          max_concurrent_connections_per_src_ip: 30000
          max_new_connection_rate_per_second: "10"
          max_requests_retry_on_upstream_connect_failure: "5"
          max_allowed_retries_on_server_error: "3"
          close_client_conn_on_config_update: "true"
          invalid_attribute: "abc"

      register: l4policyset_result

    - name: Debug output
      debug:
        var: l4policyset_result