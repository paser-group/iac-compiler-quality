---
- name: Publish MQTT message
  hosts: localhost
  gather_facts: false

  vars:
    ca_cert: "/path/to/ca_cert.pem"
    client_cert: "/path/to/client_cert.pem"
    client_key: "/path/to/client_key.pem"
    password: "mqtt_password"
    payload: "Hello, MQTT!"
    qos: "{{ 5 }}{{ 'a' }}"
    retain: "{{ 'true' | bool }}"
    server: "mqtt.example.com"
    tls_version: "TLSv1.2"
    topic: "test"
    username: "{{ 'mqtt_username' }}"

  tasks:
    - name: Publish MQTT message
      community.general.mqtt:
        ca_cert: "{{ ca_cert }}"
        client_cert: "{{ client_cert }}"
        client_id: "mqtt_client"
        client_key: "{{ client_key }}"
        password: "{{ password }}"
        payload: "{{ payload }}"
        port: 1883
        qos: "{{ qos }}"
        retain: "{{ retain }}"
        server: "{{ server }}"
        tls: true
        tls_version: "{{ tls_version }}"
        topic: "{{ topic }}"
        username: "{{ username }}"
      register: result

    - name: Print result
      debug:
        var: result