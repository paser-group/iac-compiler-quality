---
- name: Ansible Latent Type-Related Bug Finder
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Set limit-related values
      set_fact:
        node_limit: 4
        subnet: 10.1.1.0/24
        gateway: 10.1.1.254

    - name: Assert the values
      ansible.builtin.assert:
        that:
          - "node_limit | int >= 4"
          - "subnet is match('^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/\\d{1,2}$')"
          - "gateway is match('^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$')"
        quiet: false
        fail_msg: "Failed assertion: {{ item }}"
        success_msg: "Successful assertion: {{ item }}"
      loop:
        - "'node_limit | int >= 5'"
        - "'subnet is match('^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$')'"
        - "'gateway is match('^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}/\\d{1,2}$')'"