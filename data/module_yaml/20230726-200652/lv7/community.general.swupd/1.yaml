---
- name: Test playbook for community.general.swupd module
  hosts: localhost
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
      - name: alpine1
        ip: 10.1.1.2
      - name: centos1
        ip: 10.1.1.3
      - name: redhat1
        ip: 10.1.1.4

    contenturl: "https://example.com/content"
    format: "tar.gz"
    manifest: 1234
    name: "example-bundle"
    state: "present"
    update: true
    url: "https://example.com/bundle"
    verify: true
    versionurl: "https://example.com/version"

    # Variables for heuristic-based testing
    num_nodes: "{{ nodes | length }}"
    max_nodes_per_group: "{{ num_nodes / 2 }}"
    min_nodes_per_group: "{{ num_nodes / 4 }}"

  tasks:
    - name: Install community.general.swupd module dependencies
      package:
        name: python3-dnf
        state: present

    - name: Include module and arguments
      include_vars:
        file: "arguments.yml"

    - name: Test community.general.swupd module
      community.general.swupd:
        contenturl: "{{ contenturl }}"
        format: "{{ format }}"
        manifest: "{{ manifest }}"
        name: "{{ name }}"
        state: "{{ state }}"
        update: "{{ update }}"
        url: "{{ url }}"
        verify: "{{ verify }}"
        versionurl: "{{ versionurl }}"
        limit: "{{ min_nodes_per_group | int | abs }}/group"