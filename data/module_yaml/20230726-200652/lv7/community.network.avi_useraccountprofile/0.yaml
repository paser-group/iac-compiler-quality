---
- name: Test playbook for exposing latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    account_lock_timeout: None
    avi_api_patch_op: None
    avi_api_update_method: None
    avi_credentials:
      controller: "https://{{ controller }}/api"
      username: "{{ username }}"
      password: "{{ password }}"
      tenant: "{{ tenant }}"
      tenant_uuid: "{{ tenant_uuid }}"
      api_version: "{{ api_version }}"
    avi_disable_session_cache_as_fact: False
    credentials_timeout_threshold: None
    max_concurrent_sessions: 10
    max_login_failure_count: None
    max_password_history_count: None
    name: None
    password: "{{ password }}"
    state: None
    tenant: "{{ tenant }}"
    url: None
    username: "{{ username }}"
    uuid: None

  tasks:
    - name: Create User Account Profile with account_lock_timeout = None
      community.network.avi_useraccountprofile:
        account_lock_timeout: "{{ account_lock_timeout }}"
        avi_api_patch_op: "{{ avi_api_patch_op }}"
        avi_api_update_method: "{{ avi_api_update_method }}"
        avi_credentials: "{{ avi_credentials }}"
        avi_disable_session_cache_as_fact: "{{ avi_disable_session_cache_as_fact }}"
        credentials_timeout_threshold: "{{ credentials_timeout_threshold }}"
        max_concurrent_sessions: "{{ max_concurrent_sessions }}"
        max_login_failure_count: "{{ max_login_failure_count }}"
        max_password_history_count: "{{ max_password_history_count }}"
        name: "{{ name }}"
        password: "{{ password }}"
        state: "{{ state }}"
        tenant: "{{ tenant }}"
        tenant_uuid: "{{ tenant_uuid }}"
        url: "{{ url }}"
        username: "{{ username }}"
        uuid: "{{ uuid }}"
      register: result

    - debug:
        var: result

    - name: Perform division operation with max_concurrent_sessions
      set_fact:
        max_concurrent_sessions: "{{ max_concurrent_sessions / 0 }}"

    - name: Update User Account Profile with max_concurrent_sessions as float
      community.network.avi_useraccountprofile:
        account_lock_timeout: "{{ account_lock_timeout }}"
        avi_api_patch_op: "{{ avi_api_patch_op }}"
        avi_api_update_method: "{{ avi_api_update_method }}"
        avi_credentials: "{{ avi_credentials }}"
        avi_disable_session_cache_as_fact: "{{ avi_disable_session_cache_as_fact }}"
        credentials_timeout_threshold: "{{ credentials_timeout_threshold }}"
        max_concurrent_sessions: "{{ max_concurrent_sessions }}"
        max_login_failure_count: "{{ max_login_failure_count }}"
        max_password_history_count: "{{ max_password_history_count }}"
        name: "{{ name }}"
        password: "{{ password }}"
        state: "{{ state }}"
        tenant: "{{ tenant }}"
        tenant_uuid: "{{ tenant_uuid }}"
        url: "{{ url }}"
        username: "{{ username }}"
        uuid: "{{ uuid }}"
      register: result_float

    - debug:
        var: result_float