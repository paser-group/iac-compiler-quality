---
- name: Test playbook for latent type-related bugs in ipa_service module
  hosts: my_nodes
  gather_facts: false

  vars:
    ipa_timeout_division: "{{ (60/2)|int }}"  # Division-based calculation

  tasks:
    - name: Install FreeIPA service
      community.general.ipa_service:
        force: true
        hosts: "{{ groups['my_nodes'] }}"
        ipa_host: "{{ ipa_host|default('localhost') }}"
        ipa_pass: "{{ ipa_pass|default('password') }}"
        ipa_port: "{{ ipa_port|default(80)|int }}"
        ipa_prot: "{{ ipa_prot|default('http') }}"
        ipa_timeout: "{{ ipa_timeout_division }}"
        ipa_user: "{{ ipa_user|default('admin') }}"
        krbcanonicalname: "{{ krbcanonicalname|default('host') }}"
        skip_host_check: "{{ skip_host_check|default(false)|bool }}"
        state: "{{ state|default('present') }}"
        validate_certs: "{{ validate_certs|default(true)|bool }}"

      register: ipa_service_result

    - debug:
        var: ipa_service_result