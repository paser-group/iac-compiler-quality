---
- name: Manage Solaris packages
  hosts: all
  gather_facts: false
  tasks:
    - name: Calculate package version limit
      set_fact:
        pkg_version_limit: "{{ name | length // 2 }}"

    - name: Install packages
      community.general.pkg5:
        be_name: global
        name:
          - pkg1
          - pkg2
        state: present
        refresh: yes
        accept_licenses: true
        version_limit: "{{ pkg_version_limit }}"
      register: result
      become: true

    - name: Show result
      debug:
        var: result