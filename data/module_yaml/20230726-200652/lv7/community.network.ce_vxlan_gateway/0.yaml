---
- name: Manage VXLAN gateway
  hosts: localhost
  gather_facts: false
  
  tasks:
  - name: Install Ansible Huawei CloudEngine Modules
    pip:
      name: ansible-collection-network-huawei
      state: present
      
  - name: Manage VXLAN gateway configuration
    ce_vxlan_gateway:
      arp_direct_route: "{{ item.arp_direct_route | default(None) }}"
      arp_distribute_gateway: "{{ item.arp_distribute_gateway | default(None) }}"
      dfs_all_active: "{{ item.dfs_all_active | default(None) }}"
      dfs_id: "{{ item.dfs_id | default(None) }}"
      dfs_peer_ip: "{{ item.dfs_peer_ip | default(None) }}"
      dfs_peer_vpn: "{{ item.dfs_peer_vpn | default(None) }}"
      dfs_source_ip: "{{ item.dfs_source_ip | default(None) }}"
      dfs_source_vpn: "{{ item.dfs_source_vpn | default(None) }}"
      dfs_udp_port: "{{ item.dfs_udp_port | default(None) }}"
      state: "{{ item.state | default(None) }}"
      vbdif_bind_vpn: "{{ item.vbdif_bind_vpn | default(None) }}"
      vbdif_mac: "{{ item.vbdif_mac | default(None) }}"
      vbdif_name: "{{ item.vbdif_name | default(None) }}"
      vpn_instance: "{{ item.vpn_instance | default(None) }}"
      vpn_vni: "{{ item.vpn_vni | default(None) }}"
    loop:
      - arp_direct_route: "none"
        arp_distribute_gateway: "false"
        dfs_all_active: "true"
        dfs_id: "1"
        dfs_peer_ip: "192.168.1.1"
        dfs_peer_vpn: "vpn1"
        dfs_source_ip: "192.168.2.1"
        dfs_source_vpn: "vpn2"
        dfs_udp_port: "4789"
        state: "present"
        vbdif_bind_vpn: "vpn3"
        vbdif_mac: "00:11:22:33:44:55"
        vbdif_name: "vxlan2"
        vpn_instance: "vpn4"
        vpn_vni: "100"
      - arp_direct_route: "true"
        arp_distribute_gateway: "true"
        dfs_all_active: "false"
        dfs_id: "2"
        dfs_peer_ip: "192.168.1.2"
        dfs_peer_vpn: "vpn2"
        dfs_source_ip: "192.168.2.2"
        dfs_source_vpn: "vpn3"
        dfs_udp_port: "4790"
        state: "absent"
        vbdif_bind_vpn: "vpn5"
        vbdif_mac: "00:11:22:33:44:56"
        vbdif_name: "vxlan3"
        vpn_instance: "vpn6"
        vpn_vni: "200"