- name: Manage Pritunl Users
  hosts: localhost
  gather_facts: false

  vars:
    organization: MyOrg
    pritunl_api_secret: my_secret
    pritunl_api_token: my_token
    pritunl_url: https://pritunl.example.com
    validate_certs: false

  tasks:
    - name: Create Pritunl User with limit-related values
      community.general.pritunl_user:
        organization: "{{ organization }}"
        pritunl_api_secret: "{{ pritunl_api_secret }}"
        pritunl_api_token: "{{ pritunl_api_token }}"
        pritunl_url: "{{ pritunl_url }}"
        state: present
        user_name: testuser
        user_disabled: true
        user_email: testuser@example.com
        user_gravatar: true
        user_groups: ["group1", "group2"]
        user_mac_addresses: ["00:11:22:33:44:55", "AA:BB:CC:DD:EE:FF"]
        user_type: admin
        validate_certs: "{{ validate_certs }}"
        # Triggering latent type-related bug by using division operation
        user_limit: "10 / 2"

    - name: Update Pritunl User with limit-related values
      community.general.pritunl_user:
        organization: "{{ organization }}"
        pritunl_api_secret: "{{ pritunl_api_secret }}"
        pritunl_api_token: "{{ pritunl_api_token }}"
        pritunl_url: "{{ pritunl_url }}"
        state: present
        user_name: testuser
        user_disabled: true
        user_email: testuser@example.com
        user_gravatar: true
        user_groups: ["group1", "group2"]
        user_mac_addresses: ["00:11:22:33:44:55", "AA:BB:CC:DD:EE:FF"]
        user_type: admin
        validate_certs: "{{ validate_certs }}"
        # Triggering latent type-related bug by using division operation
        user_limit: "20 / 0"

    - name: Delete Pritunl User
      community.general.pritunl_user:
        organization: "{{ organization }}"
        pritunl_api_secret: "{{ pritunl_api_secret }}"
        pritunl_api_token: "{{ pritunl_api_token }}"
        pritunl_url: "{{ pritunl_url }}"
        state: absent
        user_name: testuser
        validate_certs: "{{ validate_certs }}"