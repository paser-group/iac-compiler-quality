---
- name: Test playbook for community.general.pagerduty_change module
  hosts: localhost
  connection: local
  gather_facts: false
  
  vars:
    total_characters: 250
    summary: "This is a test summary for Ansible."
  
  tasks:
    - name: Calculate the limit for summary length
      set_fact:
        summary_limit: "{{ total_characters // 2 }}"
  
    - name: Track code or infrastructure change as a PagerDuty incident
      community.general.pagerduty_change:
        environment: "{{ environment }}"
        integration_key: "{{ integration_key }}"
        link_text: "{{ link_text }}"
        link_url: "{{ link_url }}"
        repo: "{{ repo }}"
        revision: "{{ revision }}"
        source: "{{ source }}"
        summary: "{{ summary[:summary_limit] }}"
        url: "{{ url }}"
        user: "{{ user }}"
        validate_certs: "{{ validate_certs | bool }}"
      register: pd_result
      
    - name: Show debug output
      debug:
        var: pd_result