---
- name: Test ansible.builtin.service module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Start a service
      ansible.builtin.service:
        name: myservice
        state: started

    - name: Stop the service
      ansible.builtin.service:
        name: myservice
        state: stopped

    - name: Restart the service
      ansible.builtin.service:
        name: myservice
        state: restarted
        sleep: "{{ ansible_memtotal_mb / 2 }}"

    - name: Check service status
      ansible.builtin.service:
        name: myservice
        state: status