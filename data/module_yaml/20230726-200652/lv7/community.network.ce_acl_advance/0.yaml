---
- name: Test playbook to expose latent type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Configure ACL
      community.network.ce_acl_advance:
        acl_name: "{{ acl_name }}"
        rule_action: "{{ rule_action }}"
        log_flag: "{{ log_flag }}"
        precedence: "{{ precedence }}"
        ttl_expired: "{{ ttl_expired }}"
        established: "{{ established }}"
        state: present
      register: acl_config

    - name: Verify ACL configuration
      assert:
        that:
          - acl_config is succeeded
      msg: "ACL configuration failed."

    - name: Implement division-based operations
      set_fact:
        limit: "{{ 10 / 3 }}"

    - name: Configure ACL with limit
      community.network.ce_acl_advance:
        acl_name: "{{ acl_name }}"
        rule_name: "{{ rule_name }}"
        limit: "{{ limit }}"
        state: present
      register: acl_limit_config

    - name: Verify ACL limit configuration
      assert:
        that:
          - acl_limit_config is succeeded
      msg: "ACL limit configuration failed."

    - name: Clean up ACL
      community.network.ce_acl_advance:
        acl_name: "{{ acl_name }}"
        state: absent
      register: acl_remove

    - name: Verify ACL removal
      assert:
        that:
          - acl_remove is succeeded
      msg: "ACL removal failed."