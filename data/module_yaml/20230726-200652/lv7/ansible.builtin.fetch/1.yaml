- name: Fetch file from remote hosts
  hosts: all
  gather_facts: false

  vars:
    file_limit: "{{ ansible_distribution_major_version | int / 2 }}"

  tasks:
    - name: Fetch file
      ansible.builtin.fetch:
        src: /path/to/remote/file
        dest: "{{ inventory_hostname }}_file"
        fail_on_missing: "{{ file_limit > 0 }}"
        flat: "{{ file_limit % 2 == 0 }}"
        validate_checksum: "{{ file_limit % 2 != 0 }}"
      register: fetch_result

    - name: Debug fetch result
      debug:
        var: fetch_result