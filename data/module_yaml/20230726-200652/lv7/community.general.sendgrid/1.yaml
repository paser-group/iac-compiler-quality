---
- name: Send Email
  hosts: localhost
  gather_facts: false

  vars:
    api_key: "your_sendgrid_api_key"
    from_address: "sender@example.com"
    to_addresses:
      - recipient1@example.com
      - recipient2@example.com
    subject: "Test Email"
    body: "This is a test email."
    max_attachments: "{{ to_addresses | length / 2 }}"

  tasks:
    - name: Send Email
      community.general.sendgrid:
        api_key: "{{ api_key }}"
        from_address: "{{ from_address }}"
        to_addresses: "{{ to_addresses }}"
        subject: "{{ subject }}"
        body: "{{ body }}"
        max_attachments: "{{ max_attachments }}"