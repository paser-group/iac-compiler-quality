---
- name: Testing community.network.icx_copy module
  hosts: localhost
  gather_facts: false
  
  vars:
    remote_server: 10.1.1.1
    remote_user: ansible
    remote_pass: password
    remote_port: 22
    remote_filename: test_file.txt
    download_dir: /tmp/download
    upload_file: /tmp/upload/file.txt
    protocol: sftp
  
  tasks:
    - name: Create temporary directory for download
      file:
        path: "{{ download_dir }}"
        state: directory

    - name: Create test file on remote node
      shell: echo 'This is a test file' > {{ remote_filename }}
      register: create_result
      delegate_to: "{{ remote_server }}"

    - name: Test case 1: Download file from remote to local
      community.network.icx_copy:
        host: "{{ remote_server }}"
        username: "{{ remote_user }}"
        password: "{{ remote_pass }}"
        port: "{{ remote_port }}"
        download: "{{ remote_filename }}"
        dest: "{{ download_dir }}"
        protocol: "{{ protocol }}"
      delegate_to: localhost

    - name: Test case 2: Upload file from local to remote
      community.network.icx_copy:
        host: "{{ remote_server }}"
        username: "{{ remote_user }}"
        password: "{{ remote_pass }}"
        port: "{{ remote_port }}"
        upload: "{{ upload_file }}"
        dest: /tmp
        protocol: "{{ protocol }}"
      delegate_to: localhost

    - name: Test case 3: Invalid protocol value
      community.network.icx_copy:
        host: "{{ remote_server }}"
        username: "{{ remote_user }}"
        password: "{{ remote_pass }}"
        port: "{{ remote_port }}"
        download: "{{ remote_filename }}"
        dest: "{{ download_dir }}"
        protocol: "invalid"
      delegate_to: localhost

    - name: Test case 4: Missing required parameters
      community.network.icx_copy:
        host: "{{ remote_server }}"
        username: "{{ remote_user }}"
        password: "{{ remote_pass }}"
        port: "{{ remote_port }}"
        dest: "{{ download_dir }}"
        protocol: "{{ protocol }}"
      delegate_to: localhost