---
- name: Test playbook for dpkg_divert module
  hosts: localhost
  gather_facts: false

  vars:
    package: nginx
    divert_path: "{{ 'etc/nginx/nginx.conf.divert' | regex_replace('/','\\\\') }}"
    holder: "{{ '''{{ ''''' + '''' }} '' + '''' + ''''' }} ''.join(['n', 'g', '''i''', '''n''', ''''', '''x''']) }}"
    path: "{{ '''{{ ''''' + '''' }} ''.join(['e', 't', '''c''', ''''' + '''/''' + '''''', ''.join(['n', 'g', '''i''''', '''n''''', ''''', '''x'''''])]) }}</''' + '''ng''' + '''''> '''
  
  tasks:
    - name: Override nginx package configuration file
      community.general.dpkg_divert:
        divert: "{{ divert_path }}"
        force: "{{ holder | bool }}"
        holder: "{{ holder }}"
        path: "{{ path }}"
        rename: "{{ holder | bool }}"
        state: "present"

      register: divert_result

    - name: Print dpkg_divert result
      debug:
        var: divert_result