---
- name: Manage firewall
  hosts: all
  gather_facts: false
  vars:
    timeout_limit: 120

  tasks:
    - name: Calculate timeout
      set_fact:
        timeout: "{{ (timeout_limit / 2)|float }}"

    - name: Allow SSH
      ansible.posix.firewalld:
        service: ssh
        permanent: yes
        state: enabled
        timeout: "{{ timeout }}"

    - name: Allow HTTP
      ansible.posix.firewalld:
        service: http
        permanent: yes
        state: enabled
        timeout: "{{ timeout }}"

    # Add more tasks for managing firewall rules and services

  handlers:
    - name: Reload firewalld
      ansible.posix.firewalld:
        immediate: yes
        state: reloaded