---
- name: Test Avi Pool Group Deployment Policy
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create Pool Group Deployment Policy
      community.network.avi_poolgroupdeploymentpolicy:
        controller: "{{ controller }}"
        username: "{{ avi_username }}"
        password: "{{ avi_password }}"
        tenant: "{{ avi_tenant }}"
        api_context:
          api_version: "{{ avi_api_version }}"
        name: "{{ avi_policy_name }}"
        tenant_uuid: "{{ avi_tenant_uuid }}"
        rules:
          - metric:
              'name': "{{ avi_metric_name }}"
              'internal': false
              'minutes': 60
          - metric:
              'name': "{{ avi_metric_name }}"
              'internal': false
              'minutes': "{{ avi_minutes|float / avi_divisor }}"  # Heuristic: Implement division-based operations when assigning limit-related values
        state: present
      register: result

    - name: Debug Result
      debug:
        var: result