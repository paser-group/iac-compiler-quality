- name: Test playbook for community.general.vmadm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create SmartOS VM
      community.general.vmadm:
        name: test-vm
        state: running
        vcpus: 2
        ram: 2048
        quota: 50
        max_locked_memory: "{{ ram / 2 }}"
        max_lwps: "{{ (quota * 100) / 5 }}"
        max_physical_memory: "{{ (ram * 2) - quota }}"
        max_swap: "{{ ram / 4 }}"
      register: vmadm_result

    - name: Debug VM creation
      debug:
        var: vmadm_result