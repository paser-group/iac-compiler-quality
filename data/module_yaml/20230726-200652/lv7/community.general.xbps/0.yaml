---
- name: Test playbook for community.general.xbps module
  hosts: localhost
  gather_facts: false

  vars:
    node_net_subnet: "10.1.1.0/24"
    node_net_gateway: "10.1.1.254"
    nodes:
      - name: ubuntu1
        ip: "10.1.1.1"
        distribution: "ubuntu"
      - name: alpine1
        ip: "10.1.1.2"
        distribution: "alpine"
      - name: centos1
        ip: "10.1.1.3"
        distribution: "centos"
      - name: redhat1
        ip: "10.1.1.4"
        distribution: "redhat"

  tasks:
    - name: Create network and Docker containers
      docker_network:
        name: "node-net"
        driver: "bridge"
        ipam:
          config:
            - subnet: "{{ node_net_subnet }}"
              gateway: "{{ node_net_gateway }}"

    - name: Create Docker containers
      docker_container:
        name: "{{ item.name }}"
        image: "docker.{{ item.distribution }}"
        network_mode: "node-net"
        ip: "{{ item.ip }}"
      loop: "{{ nodes }}"

    - name: Gather host facts
      ansible.builtin.setup:
      gather_subset: all

    - name: Install xbps packages
      community.general.xbps:
        name:
          - "{{ non_existing_variable }}"  # Intentionally using an undefined variable
        recurse: "true"  # Intentionally using a string value instead of a boolean value
        state: absent
        update_cache: 1  # Intentionally using an integer value instead of a boolean value
        upgrade: "false"  # Intentionally using a string value instead of a boolean value
        upgrade_xbps: undefined  # Intentionally using an undefined variable
      register: result

    - name: Debug xbps package installation
      debug:
        var: result