- hosts: localhost
  gather_facts: false
  vars:
    htpasswd_path: "/tmp/htpasswd_file"
    htpasswd_user: 12345
    htpasswd_password: "testpassword"
    htpasswd_crypt_scheme: "md5"
  
  tasks:
    - name: Create htpasswd file
      community.general.htpasswd:
        path: "{{ htpasswd_path }}"
        name: "{{ htpasswd_user }}"
        password: "{{ htpasswd_password }}"
        crypt_scheme: "{{ htpasswd_crypt_scheme }}"
        state: present
      
    - name: Verify htpasswd file is created
      stat:
        path: "{{ htpasswd_path }}"
      register: htpasswd_file
      
    - name: Fail if htpasswd file is not created
      fail:
        msg: "htpasswd file was not created"
      when: not htpasswd_file.stat.exists