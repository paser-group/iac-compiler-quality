---
- name: Test community.general.lxd_profile module
  hosts: all
  gather_facts: false
  vars:
    lxd_profile_name: "myprofile"
    lxd_profile_description: "My LXD Profile"
    lxd_profile_devices:
      root:
        path: "/"
        pool: default
        type: disk
    lxd_profile_merge_profile: false
    lxd_profile_state: present

  tasks:
    - name: Create LXD Profile
      community.general.lxd_profile:
        name: "{{ lxd_profile_name }}"
        description: "{{ lxd_profile_description }}"
        devices: "{{ lxd_profile_devices }}"
        merge_profile: "{{ lxd_profile_merge_profile }}"
        state: "{{ lxd_profile_state }}"
      register: profile_result

    - name: Debug LXD Profile result
      debug:
        var: profile_result

    - name: Update limit-related value
      set_fact:
        lxd_profile_state: "{{ lxd_profile_state | int / 0 }}"  # Division-based operation

    - name: Update LXD Profile
      community.general.lxd_profile:
        name: "{{ lxd_profile_name }}"
        state: "{{ lxd_profile_state }}"
      register: profile_update_result

    - name: Debug LXD Profile update result
      debug:
        var: profile_update_result