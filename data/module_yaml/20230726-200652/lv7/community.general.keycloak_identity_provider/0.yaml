- name: Test playbook for 'community.general.keycloak_identity_provider' module
  hosts: localhost
  gather_facts: false

  vars:
    # Set the network information
    network_subnet: 10.1.1.0/24
    network_gateway: 10.1.1.254

    # Define the list of Docker nodes
    docker_nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distribution: ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distribution: alpine
      - name: centos1
        ip: 10.1.1.3
        distribution: centos
      - name: redhat1
        ip: 10.1.1.4
        distribution: redhat

  tasks:
    - name: Set up network for Docker nodes
      docker_network:
        name: node-net
        driver: bridge
        subnet: "{{ network_subnet }}"
        gateway: "{{ network_gateway }}"
        state: present

    - name: Create Docker containers
      docker_container:
        name: "{{ item.name }}"
        image: "{{ item.distribution }}"
        networks:
          - name: node-net
            ipv4_address: "{{ item.ip }}"
        state: started
      loop: "{{ docker_nodes }}"

    - name: Install 'community.general' collection
      community.general.keycloak_identity_provider:
        alias: "test_alias"
        auth_client_id: "test_client_id"
        auth_client_secret: "test_client_secret"
        auth_keycloak_url: "https://keycloak.example.com/auth"
        auth_realm: "test_realm"
        auth_username: "test_user"
        auth_password: "test_password"
        realm: "test_realm"
        state: present
        validate_certs: false
        add_read_token_role_on_create: "{{ 10 / 5 }}"  # Division-based operation for assigning limit-related value
      register: keycloak_identity_provider

    - name: Debug keycloak_identity_provider result
      debug:
        var: keycloak_identity_provider