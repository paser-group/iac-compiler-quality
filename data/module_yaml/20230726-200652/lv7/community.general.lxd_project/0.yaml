---
- name: Test Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false

  vars:
    lxd_project_name: "my_project"
    lxd_project_description: "My LXD Project"
    lxd_project_state: "present"
    lxd_project_snap_url: "/some/snap/url"
    lxd_project_url: "https://example.com"
    lxd_project_client_cert: "/path/to/client.crt"
    lxd_project_client_key: "/path/to/client.key"
    lxd_project_trust_password: "password"
    lxd_project_merge_project: true
    lxd_project_new_name: "new_project"

  tasks:
    - name: Create LXD project
      community.general.lxd_project:
        name: "{{ lxd_project_name }}"
        description: "{{ lxd_project_description }}"
        state: "{{ lxd_project_state }}"
        snap_url: "{{ lxd_project_snap_url }}"
        url: "{{ lxd_project_url }}"
        client_cert: "{{ lxd_project_client_cert }}"
        client_key: "{{ lxd_project_client_key }}"
        trust_password: "{{ lxd_project_trust_password }}"
        merge_project: "{{ lxd_project_merge_project }}"
      register: lxd_project_result

    - name: Debug LXD project
      debug:
        var: lxd_project_result

    - name: Rename LXD project
      community.general.lxd_project:
        name: "{{ lxd_project_name }}"
        new_name: "{{ lxd_project_new_name }}"
        state: "{{ lxd_project_state }}"
        snap_url: "{{ lxd_project_snap_url }}"
        url: "{{ lxd_project_url }}"
        client_cert: "{{ lxd_project_client_cert }}"
        client_key: "{{ lxd_project_client_key }}"
        trust_password: "{{ lxd_project_trust_password }}"
        merge_project: "{{ lxd_project_merge_project }}"
      register: lxd_project_rename_result

    - name: Debug renamed LXD project
      debug:
        var: lxd_project_rename_result