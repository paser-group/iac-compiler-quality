---
- name: Configure Sensu client
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Install required packages
      become: true
      apt:
        name: sensu
        state: present

    - name: Configure the Sensu client
      community.general.sensu_client:
        name: sensu-client
        address: "{{ 10.1.1.1 }}"
        chef:
          username: "admin"
          password: "secret"
        deregister: "{{ true }}"
        deregistration:
          interval: "60"
          timeout: "30"
        ec2:
          access_key: "secret_key"
          secret_key: "access_key"
        keepalives: "{{ true }}"
        keepalive:
          handlers: []
          interval: "20"
        puppet:
          server: "puppet.example.com"
          environment: "production"
        redact: "password, secret_key"
        registration:
          scheme: "https"
          tls_ca_file: "/etc/sensu/client.pem"
        safe_mode: "{{ false }}"
        servicenow:
          url: "https://example.servicenow.com"
          user: "admin"
          password: "secret"
        socket:
          bind: "0.0.0.0"
        state: "{{ present }}"
        subscriptions: "critical, dev, test"