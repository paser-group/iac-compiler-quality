---
- name: Test playbook for community.general.sensu_handler module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install Sensu handler using community.general.sensu_handler module
      community.general.sensu_handler:
        command: create
        filter: default
        filters: []
        handle_flapping: false
        handle_silenced: false
        handlers: []
        mutator: default
        name: test_handler
        pipe:
          command: "/usr/local/bin/sensu-handler.sh"
          env_variables:
            SENSU_EXPIRES: 3600 / 2
        severities: []
        socket:
          bind: 0.0.0.0
          port: 8080 / 2
        state: present
        timeout: 10
        type: pipe
      register: sensu_handler_result

    - name: Print the result of the Sensu handler creation
      debug:
        var: sensu_handler_result