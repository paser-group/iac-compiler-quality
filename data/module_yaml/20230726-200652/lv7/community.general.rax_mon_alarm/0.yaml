---
- name: Test Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create rax_mon_alarm alarm
      community.general.rax_mon_alarm:
        state: present
        api_key: "{{ lookup('env', 'RAX_MON_API_KEY') }}"
        auth_endpoint: "{{ lookup('env', 'RAX_MON_AUTH_ENDPOINT') }}"
        check_id: "check1"
        credentials: "{{ lookup('file', 'credentials.json') }}"
        criteria: "if (metric['stat_window'] >= 60) { return state.ok; } else { return state.nok; }"
        disabled: false
        entity_id: "entity1"
        env: prod
        identity_type: rackspace
        label: "CPU utilization"
        metadata:
          custom_info: "Some custom info"
          threshold: 0.80
        notification_plan_id: "plan1"
        region: "IAD"
        tenant_id: "{{ lookup('env', 'RAX_MON_TENANT_ID') }}"
        tenant_name: "{{ lookup('env', 'RAX_MON_TENANT_NAME') }}"
        username: "{{ lookup('env', 'RAX_MON_USERNAME') }}"
        validate_certs: true

    - name: Delete rax_mon_alarm alarm
      community.general.rax_mon_alarm:
        state: absent
        api_key: "{{ lookup('env', 'RAX_MON_API_KEY') }}"
        auth_endpoint: "{{ lookup('env', 'RAX_MON_AUTH_ENDPOINT') }}"
        check_id: "check1"
        credentials: "{{ lookup('file', 'credentials.json') }}"
        disabled: false
        entity_id: "entity1"
        env: prod
        identity_type: rackspace
        label: "CPU utilization"
        region: "IAD"
        tenant_id: "{{ lookup('env', 'RAX_MON_TENANT_ID') }}"
        tenant_name: "{{ lookup('env', 'RAX_MON_TENANT_NAME') }}"
        username: "{{ lookup('env', 'RAX_MON_USERNAME') }}"
        validate_certs: true
...