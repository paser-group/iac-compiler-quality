---
- name: Test Community General Layman Module
  hosts: localhost
  gather_facts: false

  vars:
    list_url: "https://example.com/custom_repos.list"
    name: "my_custom_repo"
    state: "present"
    validate_certs: false

  tasks:
    - name: Include community.general.layman collection
      include_role:
        name: community.general.layman

    - name: Add custom repository
      community.general.layman:
        name: "{{ name | default('') }}"
        list_url: "{{ list_url }}"
        state: "{{ state | default('present') }}"
        validate_certs: "{{ validate_certs | default(true) | bool }}"
      vars:
        layman_list_url: "{{ list_url }}"
        layman_name: "{{ name }}"
        layman_state: "{{ state }}"
        layman_validate_certs: "{{ validate_certs }}"

    - name: Debug output
      debug:
        var: layman_result

    - name: Trigger division-based operations
      set_fact:
        limit_value: "{{ 10 / 0 }}"

    - name: Update repository with limit value
      community.general.layman:
        name: "{{ name }}"
        list_url: "{{ list_url }}"
        state: "{{ state }}"
        validate_certs: "{{ validate_certs }}"
        limit_value: "{{ limit_value | default(10) }}"
      vars:
        layman_list_url: "{{ list_url }}"
        layman_name: "{{ name }}"
        layman_state: "{{ state }}"
        layman_validate_certs: "{{ validate_certs }}"
        layman_limit_value: "{{ limit_value }}"

    - name: Debug output
      debug:
        var: layman_result