- name: Test playbook for community.network.pn_cpu_mgmt_class module
  hosts: localhost
  gather_facts: false
  vars:
    pn_burst_size: "10"
    pn_cliswitch: "enable"
    pn_name: "switch1"
    pn_rate_limit: "1000"
    state: "present"

  tasks:
    - name: Include the 'pn_cpu_mgmt' class
      include_vars:
        file: cpu_mgmt.yml
        name: cpu_mgmt

    - name: Set the burst size based on the rate limit
      set_fact:
        pn_burst_size: "{{ pn_rate_limit / 100 }}"

    - name: Display the burst size
      debug:
        var: pn_burst_size

    - name: Run the 'pn_cpu_mgmt_class' module
      community.network.pn_cpu_mgmt_class:
        pn_burst_size: "{{ pn_burst_size }}"
        pn_cliswitch: "{{ pn_cliswitch }}"
        pn_name: "{{ pn_name }}"
        pn_rate_limit: "{{ pn_rate_limit }}"
        state: "{{ state }}"