- name: Test for Ansible latent type-related bugs
  hosts: localhost
  gather_facts: false

  vars:
    packages:
      - package1
      - package2
      - package3

  tasks:
    - name: Update package cache
      opkg:
        state: update_cache
        update_cache: true

    - name: Install packages
      opkg:
        name: "{{ item }}"
        state: present
      loop: "{{ packages }}"
      register: result

    - name: Display debug output
      debug:
        var: result

    - name: Remove packages
      opkg:
        name: "{{ item }}"
        state: absent
      loop: "{{ packages }}"
      register: result

    - name: Display debug output
      debug:
        var: result