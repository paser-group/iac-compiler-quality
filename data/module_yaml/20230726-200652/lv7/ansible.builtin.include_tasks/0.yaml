---
- name: Dynamic include_tasks playbook
  hosts: localhost
  gather_facts: false

  vars:
    nodes:
      - name: ubuntu1
        ip: 10.1.1.1
        distribution: Ubuntu
      - name: alpine1
        ip: 10.1.1.2
        distribution: Alpine
      - name: centos1
        ip: 10.1.1.3
        distribution: CentOS
      - name: redhat1
        ip: 10.1.1.4
        distribution: Red Hat

    network:
      subnet: 10.1.1.0/24
      gateway: 10.1.1.254

  tasks:
    - name: Configure network
      debug:
        msg: "Configuring network with subnet {{ network.subnet }} and gateway {{ network.gateway }}"

    - name: Create inventory file
      copy:
        content: |
          [nodes]
          {% for node in nodes %}
          {{ node.name }} ansible_host={{ node.ip }}
          {% endfor %}

    - name: Include tasks based on heuristic
      include_tasks: "{{ 'tasks_heuristic_division.yml' }}"
      vars:
        nodes: "{{ nodes }}"