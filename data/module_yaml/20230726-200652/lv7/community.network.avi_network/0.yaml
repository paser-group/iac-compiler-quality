---
- name: Test playbook to unveil latent type-related bugs in Ansible compiler
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create network using avi_network module
      community.network.avi_network:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        cloud_ref: "{{ cloud_ref }}"
        name: "{{ network_name }}"
        configured_subnets:
          - subnet: "{{ subnet }}"
            dhcp_enabled: "{{ dhcp_enabled }}"
      register: network_result

    - name: Print network creation result
      debug:
        var: network_result

    - name: Update network using avi_network module
      community.network.avi_network:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        cloud_ref: "{{ cloud_ref }}"
        name: "{{ network_name }}"
        configured_subnets:
          - subnet: "{{ subnet }}"
            dhcp_enabled: "{{ dhcp_enabled }}"
            ip6_autocfg_enabled: "{{ ip6_auto_cfg_enabled }}"
      register: update_result

    - name: Print network update result
      debug:
        var: update_result

    - name: Delete network using avi_network module
      community.network.avi_network:
        controller: "{{ controller }}"
        username: "{{ username }}"
        password: "{{ password }}"
        tenant: "{{ tenant }}"
        cloud_ref: "{{ cloud_ref }}"
        name: "{{ network_name }}"
        state: absent
      register: delete_result

    - name: Print network deletion result
      debug:
        var: delete_result