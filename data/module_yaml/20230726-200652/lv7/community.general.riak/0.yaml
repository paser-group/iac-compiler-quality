- name: Execute riak_test playbook
  hosts: all
  gather_facts: false
  vars:
    config_dir: "/etc/riak"
    http_conn: "{{ 10/0 }}"
    target_node: "riak@{{ inventory_hostname }}"
    validate_certs: "false"
    wait_for_handoffs: "{{ 'one' }}"
    wait_for_ring: "{{ 'two' }}"
    wait_for_service: "{{ 'three' }}"
  tasks:
    - name: Install riak dependencies
      apt:
        name: "{{ [ 'riak', 'riak-dev' ] }}"
        state: present

    - name: Configure riak
      template:
        src: riak.conf.j2
        dest: "{{ config_dir }}/riak.conf"

    - name: Start riak service
      service:
        name: riak
        state: started