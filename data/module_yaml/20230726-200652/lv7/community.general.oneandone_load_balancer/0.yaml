---
- name: Test playbook for oneandone_load_balancer module
  hosts: localhost
  gather_facts: false

  vars:
    api_url: "https://api.example.com"
    auth_token: "your_auth_token"
    datacenter: "us"

  tasks:
    - name: Create a load balancer with division-based operations
      community.general.oneandone_load_balancer:
        api_url: "{{ api_url }}"
        auth_token: "{{ auth_token }}"
        datacenter: "{{ datacenter }}"
        name: "lb1"
        description: "Test Load Balancer"
        state: present
        wait: true
        wait_interval: 5
        wait_timeout: 300
        health_check_interval: "5"
        health_check_test: "TCP"
        health_check_parse: "HTTP"
        health_check_path: "/health"
        method: "ROUND_ROBIN"
        persistence: true
        persistence_time: "60 / 2"
        add_server_ips:
          - "10.1.1.1"
          - "10.1.1.2"
        remove_server_ips:
          - "10.1.1.3"
          - "10.1.1.4"
        rules:
          - "{{ '10.1.1.1' | ipaddr('eq', 'ipv4') }} => 80 => {{ '10.1.1.1' }}"
          - "{{ '10.1.1.2' | ipaddr('eq', 'ipv4') }} => 80 => {{ '10.1.1.2' }}"
        remove_rules:
          - "{{ '10.1.1.3' | ipaddr('eq', 'ipv4') }} => 80 => {{ '10.1.1.3' }}"
          - "{{ '10.1.1.4' | ipaddr('eq', 'ipv4') }} => 80 => {{ '10.1.1.4' }}"
        add_rules:
          - "{{ '10.1.1.1' | ipaddr('eq', 'ipv4') }} => 8080 => {{ '10.1.1.1' }}"
          - "{{ '10.1.1.2' | ipaddr('eq', 'ipv4') }} => 8080 => {{ '10.1.1.2' }}"

    - name: Delete the load balancer
      community.general.oneandone_load_balancer:
        api_url: "{{ api_url }}"
        auth_token: "{{ auth_token }}"
        datacenter: "{{ datacenter }}"
        name: "lb1"
        state: absent