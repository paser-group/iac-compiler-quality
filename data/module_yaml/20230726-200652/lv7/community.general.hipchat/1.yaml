---
- name: Send message to HipChat room
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include the hipchat module
      include_vars:
        file: hipchat_module.yml

    - name: Set limit-related values
      set_fact:
        hipchat_msg_length: "{{ hipchat_msg | length }}"
        hipchat_max_msg_length: "{{ hipchat_max_msg_length / 2 }}"

    - name: Send message to HipChat room
      community.general.hipchat:
        api: "{{ hipchat_api }}"
        token: "{{ hipchat_token }}"
        room: "{{ hipchat_room }}"
        msg_format: "{{ hipchat_msg_format }}"
        color: "{{ hipchat_color }}"
        msg_from: "{{ hipchat_msg_from }}"
        msg: "{{ hipchat_msg }}"
        validate_certs: "{{ hipchat_validate_certs }}"
        notify: "{{ hipchat_notify }}"
        msg_length: "{{ hipchat_msg_length }}"
        max_msg_length: "{{ hipchat_max_msg_length | int }}"
      register: result

    - name: Debug result
      debug:
        var: result