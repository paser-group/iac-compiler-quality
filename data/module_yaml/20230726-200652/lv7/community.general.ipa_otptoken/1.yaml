---
- name: Test playbook for 'community.general.ipa_otptoken' module
  hosts: localhost
  gather_facts: false

  vars:
    algorithm: sha512
    counter: 10
    description: "{{ ['Test token', 'Another token'] | random }}"
    digits: "{{ 6 | random }}"
    enabled: true
    interval: "{{ 3600 / (10 | random) }}"
    ipa_host: 10.1.1.1
    ipa_pass: my_password
    ipa_port: 443
    ipa_prot: https
    ipa_timeout: 10
    ipa_user: admin
    model: "{{ ['hotp', 'totp'] | random }}"
    newuniqueid: "{{ 'T'+range(10) | random }}"
    notafter: "+1w"
    notbefore: "now"
    offset: "{{ 60000 | random }}"
    otptype: "{{ ['totp'] | random }}"
    owner: admin
    secretkey: my_secret_key
    serial: "1"
    state: present
    uniqueid: T1
    validate_certs: false
    vendor: my_vendor

  tasks:
    - name: Create OTP token
      community.general.ipa_otptoken:
        algorithm: "{{ algorithm }}"
        counter: "{{ counter }}"
        description: "{{ description }}"
        digits: "{{ digits }}"
        enabled: "{{ enabled }}"
        interval: "{{ interval }}"
        ipa_host: "{{ ipa_host }}"
        ipa_pass: "{{ ipa_pass }}"
        ipa_port: "{{ ipa_port }}"
        ipa_prot: "{{ ipa_prot }}"
        ipa_timeout: "{{ ipa_timeout }}"
        ipa_user: "{{ ipa_user }}"
        model: "{{ model }}"
        newuniqueid: "{{ newuniqueid }}"
        notafter: "{{ notafter }}"
        notbefore: "{{ notbefore }}"
        offset: "{{ offset }}"
        otptype: "{{ otptype }}"
        owner: "{{ owner }}"
        secretkey: "{{ secretkey }}"
        serial: "{{ serial }}"
        state: "{{ state }}"
        uniqueid: "{{ uniqueid }}"
        validate_certs: "{{ validate_certs }}"
        vendor: "{{ vendor }}"
      register: result

    - debug:
        var: result