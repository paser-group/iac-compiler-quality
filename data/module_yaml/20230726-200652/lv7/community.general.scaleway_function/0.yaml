---
- name: Test Ansible Latent Type-Related Bug
  hosts: localhost
  gather_facts: false
  
  vars:
    # Define test variables
    api_token: "your_api_token"
    name: "test-function"
    region: "ams1"
    runtime: "python3.8"
    memory_limit: 512
    min_scale: 2
    max_scale: 4
    wait_timeout: 120

  tasks:
    - name: Create Scaleway Function
      community.general.scaleway_function:
        state: present
        region: "{{ region }}"
        api_token: "{{ api_token }}"
        name: "{{ name }}"
        runtime: "{{ runtime }}"
        memory_limit: "{{ memory_limit }}"
        min_scale: "{{ min_scale }}"
        max_scale: "{{ max_scale }}"
        wait: true
        wait_timeout: "{{ wait_timeout }}"
        redeploy: true
      register: function

    - name: Debug Output
      debug:
        msg: "{{ function }}"

    - name: Delete Scaleway Function
      community.general.scaleway_function:
        state: absent
        region: "{{ region }}"
        api_token: "{{ api_token }}"
        name: "{{ name }}"
        wait: true
        wait_timeout: "{{ wait_timeout }}"