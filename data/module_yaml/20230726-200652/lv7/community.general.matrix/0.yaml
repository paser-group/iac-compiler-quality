---
- name: Test Ansible type-related bugs
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include matrix module
      include_vars:
        file: matrix_vars.yml

    - name: Trigger latent type-related bugs
      community.general.matrix:
        hs_url: "{{ hs_url }}"
        msg_html: "{{ msg_html }}"
        msg_plain: "{{ msg_plain }}"
        password: "{{ password }}"
        room_id: "{{ room_id }}"
        token: "{{ token }}"
        user_id: "{{ user_id }}"
      register: matrix_output
      ignore_errors: true

    - name: Debug matrix output
      debug:
        var: matrix_output

    - name: Assert latent type-related bug
      assert:
        that:
          - matrix_output is failed
        fail_msg: "Type-related bug in matrix module triggered"