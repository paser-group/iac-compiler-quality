---
- name: Execute commands using apconos_command module
  hosts: all
  gather_facts: true

  vars:
    commands:
      - show running-config
      - show interfaces
    interval: 5
    match: "success"
    retries: 10
    wait_for:
      - "port 22 open"
      - "port 80 open"

  tasks:
    - name: Execute commands on nodes
      community.network.apconos_command:
        command_list: "{{ commands }}"
        interval: "{{ interval }}"
        match: "{{ match }}"
        retries: "{{ retries }}"
        wait_for:
          - "{{ wait_for }}"