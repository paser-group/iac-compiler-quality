---
- name: Test playbook for exposing latent type-related bugs
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Set facts for before and after raw data
      set_fact:
        before_raw: '10.1.1.1,10.1.1.2,10.1.1.3,10.1.1.4'
        after_raw: '10.1.1.1,10.1.1.2,10.1.1.3,10.1.1.5'
    
    - name: Calculate limit based on division operation
      set_fact:
        limit: "{{ 10 | int / 3 }}"
    
    - name: Compare before and after raw data
      command:
        cmd: "{{ item }}"
      loop: "{{ lookup('template', 'fact_diff_plugins.j2') | from_yaml }}"
      register: diff_result
      changed_when: false
      failed_when: false
    
    - name: Show diff result
      debug:
        var: diff_result
    
    - name: Fail task if diff result is not empty
      fail:
        msg: "New type-related bug found"
      when: diff_result.stdout != ""