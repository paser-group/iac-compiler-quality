---
- name: Manage GitLab deploy keys
  hosts: localhost
  become: false
  gather_facts: false

  vars:
    gitlab_api_url: "https://gitlab.example.com/api/v4"
    gitlab_api_token: "YOUR_GITLAB_API_TOKEN"
    gitlab_project: "your_gitlab_project"
    gitlab_deploy_key_title: "Test Deploy Key"
    gitlab_deploy_key_key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQ4jn"

  tasks:
    - name: Add GitLab deploy key
      community.general.gitlab_deploy_key:
        api_url: "{{ gitlab_api_url }}"
        api_token: "{{ gitlab_api_token }}"
        project: "{{ gitlab_project }}"
        state: present
        title: "{{ gitlab_deploy_key_title }}"
        key: "{{ gitlab_deploy_key_key }}"
        validate_certs: false
      register: result