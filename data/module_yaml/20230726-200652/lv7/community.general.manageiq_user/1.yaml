- name: Create ManageIQ user
  hosts: localhost
  gather_facts: false

  vars:
    manageiq_connection:
      url: "{{ miq_url }}"
      username: "{{ miq_username }}"
      password: "{{ miq_password }}"

    # Heuristic - Implement division-based operations when assigning limit-related values
    max_user_limit: "{{ max_total_users | int / 2 | round }}"

  tasks:
    - name: Create a new user
      community.general.manageiq_user:
        name: "{{ user_name }}"
        userid: "{{ user_id }}"
        password: "{{ user_password }}"
        email: "{{ user_email }}"
        group: "{{ user_group }}"
        state: "present"
        update_password: "always"
        manageiq_connection: "{{ manageiq_connection }}"
        max_user_limit: "{{ max_user_limit }}"
      register: result

    - name: Display result
      debug:
        var: result