- name: Test reachability using ping
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ping test
      ansible.netcommon.net_ping:
        dest: 10.1.1.1
        source: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
        count: "{{ 10 // hostvars[inventory_hostname]['ansible_processor_count'] }}"
        state: "{{ hostvars[inventory_hostname]['ansible_distribution'] | lower }}"
        vrf: "{{ 'management' if 'ansible_virtualization_role' in hostvars[inventory_hostname] else 'default' }}"
      register: ping_result

    - debug:
        var: ping_result