- name: Test playbook for community.network.netscaler_lb_vserver module
  hosts: localhost
  gather_facts: False
  vars:
    lb_vserver_name: "test_lb_vserver"
    nitro_user: "admin"
    nitro_pass: "password"
    nitro_protocol: "http"
    nitro_timeout: 10
    validate_certs: False

  tasks:
    - name: Create a basic lb vserver
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        servicetype: HTTP

    - name: Test mixed case sensitivity in configuration values
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        servicetype: Http

    - name: Test byte string values
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        pulsename: !binary |2D2D3032 # "--02"

    - name: Test configuration values with mixed bytes and strings
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        servicetype: Http
        authentication: yes
        authenticationhost: !binary |536F6D6548617374 # "SomeHost"

    - name: Test random MAC addresses for network modules
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        macmoderetainvlan: True
        macmoderetainvlan: "{{ lookup('mac', namespace='ansible.utils') }}"

    - name: Test random port numbers for port settings
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        port: "{{ 1024 + ansible_play_hosts_all.index(inventory_hostname) }}"

    - name: Test varied string encodings
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        comment: !binary |5A61 # "Za"
        redirectportrewrite: !binary |5A29 # "Z)"
        redirurl: !binary |4E6F6E65 # "None"

    - name: Test division-based operations for limit-related values
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        limit: "{{ 10 / (ansible_play_hosts_all.index(inventory_hostname) + 1) }}"

    - name: Test !null as configuration value
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        persistencebackup: !null

    - name: Test random IP addresses
      community.network.netscaler_lb_vserver:
        nsip: "{{ nsip }}"
        nitro_user: "{{ nitro_user }}"
        nitro_pass: "{{ nitro_pass }}"
        nitro_protocol: "{{ nitro_protocol }}"
        nitro_timeout: "{{ nitro_timeout }}"
        validate_certs: "{{ validate_certs }}"
        state: present
        name: "{{ lb_vserver_name }}"
        ipv46: "{{ lookup('pipe', 'echo $RANDOM.$RANDOM.$RANDOM.$RANDOM') }}"