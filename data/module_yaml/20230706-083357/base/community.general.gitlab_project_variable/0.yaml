---
- name: Ansible Compiler Debugger & Heuristic Test Playbook
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Install necessary dependency
      pip:
        name: git+https://github.com/ansible-collections/community.general.git
      
    - name: Create/Update/Delete GitLab project variables
      community.general.gitlab_project_variable:
        api_job_token: "TEST_JOB_TOKEN"
        api_oauth_token: "TEST_OAUTH_TOKEN"
        api_password: "TEST_PASSWORD"
        api_token: "TEST_TOKEN"
        api_url: "https://gitlab.example.com/api/v4"
        api_username: "test_user"
        project: "test_project"
        purge: true
        state: "present"
        validate_certs: "{{ ansible_validate_certs | default(true) }}"
        variables:
          - key: "VAR1"
            value: "value1"
          - key: "VAR2"
            value: "value2"
        vars:
          VAR3: "value3"
          VAR4: "value4"
      register: result

    - name: Debug result
      debug:
        var: result