---
- name: Ansible Compiler Debugger & Heuristic Test
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include vars
      include_vars:
        file: vars/main.yml

    - name: Create security group
      community.general.scaleway_security_group_info:
        api_timeout: "{{ api_timeout }}"
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        query_parameters: "{{ query_parameters }}"
        region: "{{ region }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Debug result
      debug:
        var: result

    - name: Remove security group
      community.general.scaleway_security_group_info:
        api_timeout: "{{ api_timeout }}"
        api_token: "{{ api_token }}"
        api_url: "{{ api_url }}"
        query_parameters: "{{ query_parameters }}"
        region: "{{ region }}"
        validate_certs: "{{ validate_certs }}"
        state: absent
      when: result.changed

    - name: Debug result
      debug:
        var: result