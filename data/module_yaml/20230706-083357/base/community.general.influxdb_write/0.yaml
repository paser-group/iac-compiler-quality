---
- name: Heuristic-based test scenarios for community.general.influxdb_write module
  hosts: localhost
  gather_facts: false

  vars:
    data_points:
      - measurement: "cpu"
        tags:
          cpu_num: 1
        fields:
          usage: 70
      - measurement: "memory"
        tags:
          region: "us-west"
        fields:
          usage: 80

    database_name: "test_db"
    hostname: "localhost"
    password: "password"
    path: "/api/v2/write?org=my-org&bucket=my-bucket&precision=ms"
    port: 8086
    retries: 3
    ssl: true
    timeout: 60
    udp_port: 8089
    use_udp: false
    username: "admin"
    validate_certs: true

  tasks:
    - name: Write data points to influxdb
      community.general.influxdb_write:
        data_points: "{{ data_points }}"
        database_name: "{{ database_name }}"
        hostname: "{{ hostname }}"
        password: "{{ password }}"
        path: "{{ path }}"
        port: "{{ port }}"
        retries: "{{ retries }}"
        ssl: "{{ ssl }}"
        timeout: "{{ timeout }}"
        udp_port: "{{ udp_port }}"
        use_udp: "{{ use_udp }}"
        username: "{{ username }}"
        validate_certs: "{{ validate_certs }}"
      register: result

    - name: Debug result
      debug:
        var: result