---
- name: Heuristic test playbook for community.general.ufw
  hosts: localhost
  gather_facts: false

  vars:
    comment: "Test ufw rule"
    default: "{{ ['deny', 'allow'] | random }}"
    delete: "{{ [True, False] | random }}"
    direction: "{{ ['in', 'out'] | random }}"
    from_ip: "{{ ['192.168.1.1', '10.0.0.1'] | random }}"
    from_port: "{{ range(1, 65536) | random }}"
    insert: "{{ range(1, 10) | random }}"
    insert_relative_to: "{{ ['logging', 'interface'] | random }}"
    interface: "{{ ['eth0', 'eth1', 'eth2'] | random }}"
    interface_in: "{{ ['eth3', 'eth4'] | random }}"
    interface_out: "{{ ['eth5', 'eth6'] | random }}"
    log: "{{ [True, False] | random }}"
    logging: "{{ ['LOG', 'DEBUG'] | random }}"
    name: "Allow SSH"
    proto: "{{ ['tcp', 'udp'] | random }}"
    route: "{{ [True, False] | random }}"
    rule: "{{ ['allow', 'deny'] | random }}"
    state: "{{ ['present', 'absent'] | random }}"
    to_ip: "{{ ['192.168.1.10', '10.0.0.2'] | random }}"
    to_port: "{{ range(1, 65536) | random }}"

  tasks:
    - name: Ensure ufw rule is configured
      community.general.ufw:
        comment: "{{ comment }}"
        default: "{{ default }}"
        delete: "{{ delete }}"
        direction: "{{ direction }}"
        from_ip: "{{ from_ip }}"
        from_port: "{{ from_port }}"
        insert: "{{ insert }}"
        insert_relative_to: "{{ insert_relative_to }}"
        interface: "{{ interface }}"
        interface_in: "{{ interface_in }}"
        interface_out: "{{ interface_out }}"
        log: "{{ log }}"
        logging: "{{ logging }}"
        name: "{{ name }}"
        proto: "{{ proto }}"
        route: "{{ route }}"
        rule: "{{ rule }}"
        state: "{{ state }}"
        to_ip: "{{ to_ip }}"
        to_port: "{{ to_port }}"

    - name: Debug ufw rule configuration
      debug:
        var: ansible_facts.ansible_distribution_version