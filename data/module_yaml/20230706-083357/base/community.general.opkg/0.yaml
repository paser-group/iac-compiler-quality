- name: Heuristic-based playbook for community.general.opkg module
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Updating opkg cache
      community.general.opkg:
        update_cache: true

    - name: Check if 'community.general.opkg' is installed
      community.general.opkg_facts:
        name: community.general.opkg
      register: check_opkg

    - name: Print opkg facts
      debug:
        var: check_opkg

    - name: Install package using opkg
      community.general.opkg:
        name:
          - "example-package"
        state: present

    - name: Remove package using opkg
      community.general.opkg:
        name:
          - "example-package"
        state: absent