---
- name: Test playbook for community.network.avi_applicationpersistenceprofile module
  hosts: localhost
  gather_facts: false

  vars:
    module_options:
      controller: "10.1.1.1"
      username: admin
      password: password
      tenant: admin
      persistence_type: "SERVER_PERSISTENCE"
      hdr_persistence_profile:
        key: "testProfileKey"
        hdr_name: "Host"
        value: "example.com"

  tasks:
    - name: Test configuration with invalid option
      community.network.avi_applicationpersistenceprofile:
        {{ module_options | to_nice_yaml }}
        invalid_option: "invalid"
      register: result
      ignore_errors: true

    - name: Debug invalid option test
      debug:
        msg: "{{ item.stdout }}"
      loop: "{{ result.results }}"
      when: item is failed