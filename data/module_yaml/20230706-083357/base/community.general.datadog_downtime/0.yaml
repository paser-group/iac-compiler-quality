- name: Ansible Compiler Debugger Playbook
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "http://api.datadoghq.com"
    api_key: "your_api_key"
    app_key: "your_app_key"
    downtime_message: "System Maintenance"
    end: 1631205000
    id: 123456
    monitor_id: 789012
    monitor_tags:
      - tag1
      - tag2
    rrule: "FREQ=WEEKLY;INTERVAL=1;BYDAY=MO"
    scope:
      - node1
      - node2
    start: 1629977400
    state: present
    timezone: "UTC"

  tasks:
    - name: Install datadog Python package
      pip:
        name: datadog
        state: present

    - name: Add datadog downtime
      community.general.datadog_downtime:
        api_host: "{{ api_host }}"
        api_key: "{{ api_key }}"
        app_key: "{{ app_key }}"
        downtime_message: "{{ downtime_message }}"
        end: "{{ end }}"
        id: "{{ id }}"
        monitor_id: "{{ monitor_id }}"
        monitor_tags: 
          - "{{ monitor_tags }}"
          - "extra"
        rrule: "{{ rrule }}"
        scope: "{{ scope }}"
        start: "{{ start }}"
        state: "{{ state }}"
        timezone: "{{ timezone }}"
      register: result

    - name: Debug result
      debug:
        var: result