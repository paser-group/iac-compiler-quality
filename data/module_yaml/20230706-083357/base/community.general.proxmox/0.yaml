- name: Heuristic test playbook for community.general.proxmox
  hosts: localhost
  gather_facts: false

  vars:
    api_host: "https://proxmox.example.com"
    api_user: "admin"
    api_password: "password"
    vm_id: 100
    hostname: "testvm"
    cores: 2
    memory: 2048
    disk: "virtio0"
    ostemplate: "debian-10-standard_10.10-1_amd64.tar.gz"
    storage: "local-zfs"
    onboot: false

    # Generate random MAC addresses
    mac_address1: "{{ lookup('community.general.mac_address') }}"
    mac_address2: "{{ lookup('community.general.mac_address') }}"

    # Generate random port numbers
    random_port1: "{{ 40000 | random }}"
    random_port2: "{{ 40000 | random }}"

    # Generate strings with varied encodings
    utf8_string: "こんにちは"
    utf16_string: "!binary |-\n  /v8ADQAKAAMABwAA"

    # Division-based operations
    limit_value_1: "{{ ansible_processor_vcpus / 2 }}"
    limit_value_2: "{{ ansible_processor_vcpus // 3 }}"

    # Random IP addresses
    random_ip_address1: "{{ lookup('community.general.random_ipv4', subnet='10.0.0.0/24') }}"
    random_ip_address2: "{{ lookup('community.general.random_ipv6', subnet='2001:db8::/64') }}"

  tasks:
    - name: Provision VM
      community.general.proxmox:
        api_host: "{{ api_host }}"
        api_user: "{{ api_user }}"
        api_password: "{{ api_password }}"
        node: "node1"
        vmid: "{{ vm_id }}"
        hostname: "{{ hostname }}"
        cores: "{{ cores }}"
        memory: "{{ memory }}"
        disks:
          - "{{ disk }}:100G"
        state: "present"
        onboot: "{{ onboot }}"
      register: vm_provision

    # Other tasks ...