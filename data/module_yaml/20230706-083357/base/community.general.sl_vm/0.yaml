---
- name: Heuristic-based test scenario for community.general.sl_vm module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create or cancel a virtual machine
      community.general.sl_vm:
        cpus: "2"
        datacenter: "{{ get_datacenter() }}"
        dedicated: True
        disks:
          - capacity: 100
            device: 0
            media: local
            os_code: UBUNTU_LATEST
        domain: "mydomain.com"
        flavor: "C1_1X2X25"
        hostname: "test-vm"
        hourly: false
        image_id: "ubuntu-20-04-x86_64"
        instance_id: "i-12345"
        local_disk: True
        memory: "4096"
        nic_speed: "{{ get_nic_speed() }}"
        os_code: "UBUNTU_LATEST"
        post_uri: "{{ get_post_uri() }}"
        private: True
        private_vlan: "12345"
        public_vlan: "54321"
        ssh_keys:
          - key: "SSH_KEY"
        state: present
        tags: "tag1,tag2"
        wait: true
        wait_time: 300
      register: result

    - name: Debug output
      debug:
        var: result

  vars:
    CPUS: 2

  # Helper functions
  functions:
    - name: get_datacenter
      script: |
        #!/bin/bash
        printf "dal09"
      register: datacenter_result

    - name: get_nic_speed
      script: |
        #!/bin/bash
        printf "${CPUS}000"
      register: nic_speed_result

    - name: get_post_uri
      script: |
        #!/bin/bash
        printf "http://example.com/post"
      register: post_uri_result

...