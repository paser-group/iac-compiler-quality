- name: Create IPA host group
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Create random MAC addresses
      set_fact:
        mac_address: "{{ '%012x' | format(ansible_random | random(281474976710655)) }}"
    - name: Create random port numbers
      set_fact:
        random_port: "{{ (ansible_random | random(65535)) + 1 }}"
    - name: Generate random IP addresses
      set_fact:
        ip_address: "{{ (ansible_random_ipv4.network_address | ipaddr('int') + 1 ) | ipaddr('address') }}"
    - name: Create IPA host group
      community.general.ipa_hostgroup:
        append: "{{ append | bool }}"
        cn: "{{ cn | string }}"
        description: "{{ description | string }}"
        host:
          - "{{ host }}"
        hostgroup:
          - "{{ hostgroup }}"
        ipa_host: "{{ ipa_host | string }}"
        ipa_pass: "{{ ipa_pass | string }}"
        ipa_port: "{{ ipa_port | int }}"
        ipa_prot: "{{ ipa_prot | string }}"
        ipa_timeout: "{{ ipa_timeout | int }}"
        ipa_user: "{{ ipa_user | string }}"
        state: "{{ state | string }}"
        validate_certs: "{{ validate_certs | bool }}"
      register: result

    - name: Display result
      debug:
        var: result