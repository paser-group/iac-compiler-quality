---
- name: Test Ansible Compiler for community.general.profitbricks module
  hosts: localhost
  gather_facts: false

  vars:
    # Random MAC address generator function
    random_mac_address: "{{ '%02x'*6|format(*[range(256)|random] * 6)|regex_replace('(..)', '\\1:')|regex_replace(':$', '') }}"

  tasks:
    - name: Create ProfitBricks VM with different data types
      community.general.profitbricks:
        name: "{{ ['test-vm', 'another-vm', 123] | random }}"
        cores: "{{ ['2', 4, '8'] | random }}"
        ram: "{{ ['4096', 8192, '16384'] | random }}"
        bus: "{{ ['VIRTIO', 'IDE', 123] | random }}"
        lan: "{{ random_mac_address }}"
        state: "{{ ['present', 'absent', 'stopped'] | random }}"
      register: result

    - name: Debug result
      debug:
        var: result