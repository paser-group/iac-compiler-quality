---
- name: Test playbook for community.network.avi_networkprofile module
  hosts: localhost
  gather_facts: false

  vars:
    api_context:
      tenant: Default-Cloud
    avi_credentials:
      controller: "{{ ansible_host }}"
      username: "{{ ansible_user }}"
      password: "{{ ansible_password }}"

  tasks:
    - name: Create Avi network profile (Mixed Case Sensitivity)
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present

    - name: Create Avi network profile with byte string value
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: b'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present

    - name: Create Avi network profile with byte string and regular string value
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: "{{ 'TEST_Profile_' | b64encode }}"
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present

    - name: Create Avi network profile with random MAC address
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        mac_address: "{{ lookup('community.general.random_string', length=17, charset='0123456789abcdef') }}"

    - name: Create Avi network profile with random port number
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        source_port_range_end: "{{ range(1024, 65535) | random }}"
        source_port_range_start: "{{ range(1024, 65535) | random }}"

    - name: Create Avi network profile with varied encoding string
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        description: "{{ '测试' | b64encode }}"

    - name: Create Avi network profile with division-based operation
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        num_slow_connections: "{{ 100 / 10 }}"

    - name: Create Avi network profile with null configuration value
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        rate_limit: "!null"

    - name: Create Avi network profile with random IP address
      community.network.avi_networkprofile:
        api_context: "{{ api_context }}"
        avi_credentials: "{{ avi_credentials }}"
        controller: "{{ controller }}"
        name: 'TEST_Profile'
        tenant: Default-Cloud
        profile: TCP_FAST_PATH
        connection_mirror: true
        state: present
        gateway: "{{ lookup('community.general.random_ipv4', network_address='10.1.1.0/24') }}"