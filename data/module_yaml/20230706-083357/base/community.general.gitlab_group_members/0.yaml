- name: Test community.general.gitlab_group_members
  hosts: localhost
  gather_facts: false

  vars:
    gitlab_group: "my-group"
    gitlab_user:
      - "user1@example.com"
      - "user2@example.com"
      - "user3@example.com"
    gitlab_users_access:
      - "guest"
      - "developer"
      - "maintainer"
    purge_users: []

  tasks:
    - name: Include the community.general.gitlab_group_members module
      include_tasks: "{{ playbook_dir }}/tasks/community.general.gitlab_group_members.yml"
      vars:
        access_level: "admin"
        api_job_token: "1234abcd"
        api_oauth_token: "5678efgh"
        api_password: "pass1234"
        api_token: "abcd5678"
        api_url: "https://gitlab.example.com/api/v4"
        api_username: "admin"
        gitlab_group: "{{ gitlab_group }}"
        gitlab_user: "{{ gitlab_user }}"
        gitlab_users_access: "{{ gitlab_users_access }}"
        purge_users: "{{ purge_users }}"
        state: "present"
        validate_certs: true
      register: result

    - name: Debug task output
      debug:
        var: result