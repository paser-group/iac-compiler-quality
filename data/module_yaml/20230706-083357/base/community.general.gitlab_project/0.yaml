- name: Test community.general.gitlab_project module
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Create or update GitLab project
      community.general.gitlab_project:
        name: "MyProject"
        username: "myUser"
        state: present
        validate_certs: true
        allow_merge_on_skipped_pipeline: !random_bool
        api_job_token: "{{ lookup('password', '/dev/null length=20') }}"
        api_oauth_token: !random_str
        api_password: !random_str
        api_token: "{{ lookup('password', '/dev/null chars=ascii_letters,digits length=32') }}"
        api_url: "https://my-gitlab-instance.com/api/v4"
        avatar_path: "/path/to/avatar.png"
        builds_access_level: "private"
        ci_config_path: "/path/to/.gitlab-ci.yml"
        container_registry_access_level: "disabled"
        default_branch: "main"
        description: !random_sentence
        environments_access_level: "private"
        feature_flags_access_level: "private"
        forking_access_level: "private"
        group: "my_group"
        import_url: "https://my-gitlab-instance.com/my_project/repository/archive.tar.gz"
        infrastructure_access_level: "disabled"
        initialize_with_readme: true
        issues_enabled: !random_bool
        lfs_enabled: !random_bool
        merge_method: "ff"
        merge_requests_enabled: !random_bool
        monitor_access_level: "private"
        only_allow_merge_if_all_discussions_are_resolved: !random_bool
        only_allow_merge_if_pipeline_succeeds: !random_bool
        packages_enabled: !random_bool
        path: "/path/to/project"
        releases_access_level: "private"
        remove_source_branch_after_merge: !random_bool
        security_and_compliance_access_level: "private"
        shared_runners_enabled: !random_bool
        snippets_enabled: !random_bool
        squash_option: "always"
        topics:
          - topic1
          - topic2
          - topic3
        username: "myUser"
        visibility: "public"
        wiki_enabled: !random_bool

      register: gitlab_result

    - name: Debug GitLab project result
      debug:
        var: gitlab_result