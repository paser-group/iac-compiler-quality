---
- name: Heuristic-based test playbook for community.general.librato_annotation
  hosts: localhost
  gather_facts: false
  
  vars:
    api_key: "API_KEY"
    description: "This is a test annotation"
    end_time: 1654828800
    links:
      - "https://example.com"
    name: "Test Annotation"
    source: "Ansible"
    start_time: 1654828400
    title: "Heuristic Test Playbook"
    user: "testuser"
  
  tasks:
    - name: Debug test variables
      debug:
        var:
          api_key: "{{ api_key }}"
          description: "{{ description }}"
          end_time: "{{ end_time }}"
          links: "{{ links }}"
          name: "{{ name }}"
          source: "{{ source }}"
          start_time: "{{ start_time }}"
          title: "{{ title }}"
          user: "{{ user }}"
      
    - name: Create Librato annotation
      community.general.librato_annotation:
        api_key: "{{ api_key }}"
        description: "{{ description }}"
        end_time: "{{ end_time }}"
        links: "{{ links }}"
        name: "{{ name }}"
        source: "{{ source }}"
        start_time: "{{ start_time }}"
        title: "{{ title }}"
        user: "{{ user }}"
      
      register: annotation_result
    
    - name: Debug annotation result
      debug:
        var: annotation_result
        
    - name: Fail if annotation failed
      fail:
        msg: "Annotation creation failed"
      when: annotation_result.failed == true