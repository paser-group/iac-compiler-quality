---
- name: Heuristic-driven test playbook - community.network.flowadm
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Ensure flow is defined
      community.network.flowadm:
        dsfield: "{{ random_string(10) }}"
        link: "{{ random_port() }}"
        local_ip: "{{ random_ip_address() }}"
        local_port: "{{ random_port() }}"
        maxbw: "{{ random_integer(100, 1000) }}"
        name: "{{ random_string(10) }}"
        priority: "{{ random_integer(1, 10) }}"
        remote_ip: "{{ random_ip_address() }}"
        state: present
        temporary: true
        transport: "{{ random_transport() }}"
      register: result

    - name: Display result
      debug:
        var: result

  # Heuristic functions
  functions:
    - name: random_string
      code: |
        import random
        import string

        def random_string(length):
          return ''.join(random.choices(string.ascii_letters + string.digits, k=length))

    - name: random_port
      code: |
        import random

        def random_port():
          return random.randint(1024, 65535)

    - name: random_ip_address
      code: |
        import random
        import ipaddress

        def random_ip_address():
          subnet = ipaddress.IPv4Network("10.1.1.0/24")
          return str(random.choice(list(subnet.hosts())))

    - name: random_integer
      code: |
        import random

        def random_integer(min_value, max_value):
          return random.randint(min_value, max_value)

    - name: random_transport
      code: |
        import random

        def random_transport():
          transports = ['tcp', 'udp', 'icmp']
          return random.choice(transports)