- name: Heuristic test playbook for community.general.apt_repo module
  hosts: localhost
  gather_facts: false

  vars:
    test_repo: "http://archive.ubuntu.com/ubuntu"
    test_state: present
    test_update: false

  tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: present

    - name: Remove other APT repositories
      community.general.apt_repo:
        repo: "{{ test_repo }}"
        state: "{{ test_state }}"
        remove_others: True
        update_cache: "{{ test_update }}"
      register: apt_repo_result

    - name: Debug result
      debug:
        var: apt_repo_result

    - name: Add APT repository
      community.general.apt_repo:
        repo: "{{ test_repo }}"
        state: "{{ test_state }}"
        update_cache: "True"
      register: apt_repo_result

    - name: Debug result
      debug:
        var: apt_repo_result

    - name: Remove APT repository
      community.general.apt_repo:
        repo: "{{ test_repo }}"
        state: absent
      register: apt_repo_result

    - name: Debug result
      debug:
        var: apt_repo_result